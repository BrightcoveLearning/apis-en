---
title: 'Video Cloud SSAI API'
description: In this topic, you will learn how to use the Server-Side Ad Insertion (SSAI) API to create and manage ad configurations.
parent: Getting Started
grandparent: SSAI API
---

<h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section id="top" class="bcls-section">
<p>Ad Configurations define various aspects of SSAI playback, including ad call(s), beacons, and other configuration options. An account can have multiple configurations and currently configurations cannot be shared across accounts.</p>

<aside class="bcls-aside bcls-aside--tip">You can easily create, list and delete ad configurations from Video Cloud Studio. For details, see the <a href="https://studio.support.brightcove.com/admin/configuring-server-side-ad-settings.html">Configuring Server-Side Ad Settings</a> document.</aside>

<aside class="bcls-aside bcls-aside--information">Notes:
<ul>
  <li>To use SSAI, your Video Cloud account needs to be configured for <a href="https://studio.support.brightcove.com/general/overview-dynamic-delivery.html">Dynamic Delivery</a> and enabled for SSAI. Contact your Customer Success Manager to start using this feature.</li>
  <li>SSAI works with Video-on-Demand (VOD) and supports Live playback.</li>
  <li>
    If you build custom implementations on top of the Brightcove Playback API (PAPI) responses, please note the following:
      <ul>
        <li>With Server-Side Ad Insertion (SSAI), the thumbnails manifest is located in the VMAP instead of the PAPI response.</li>
        <li>With non-SSAI, the thumbnails manifest is included in the PAPI response.</li>
      </ul>
  </li>
  <li>For a list of limitations, see the <a href="https://ssai.support.brightcove.com/getting-started/video-cloud-ssai-overview.html#Limitations">SSAI Overview</a> document.</li>
  <li>We support receiving more than one creative in a single pod.</li>
  <li>SSAI Macros do not support cookies. For the case mentioned, Brightcove recommends using the <a href="#Client_side_macros">Client-side macros</a>.</li>
</ul>
</aside>
</section>

<section class="bcls-section">
<h2 id="General_information">General information</h2>

<p>The following information pertains to all SSAI API requests.</p>

<h3>Base URL</h3>

<p>The base URL for the SSAI API is:</p>

<pre>
<code class="language-http" translate="No">https://ssai.api.brightcove.com/v1</code></pre>

<h4>Account path</h4>

<p>In all cases, requests will be made for a specific Video Cloud Account. So, you will always add the term <code translate="No">accounts</code> followed by your account id to the base URL:</p>

<pre>
<code class="language-http" translate="No">https://ssai.api.brightcove.com/v1<strong>/accounts/</strong><span class="bcls-input">your account id</span></code></pre>

<h3>Authentication</h3>

<p>Authentication for requests requires an Authorization header:</p>

<pre>
<code class="language-http" translate="No">Authorization: Bearer <span class="bcls-input">your access token</span></code></pre>

<p>The <code translate="No">access_token</code> is a temporary OAuth2 access token that must be obtained from the Brightcove OAuth service. For details on how to obtain client credentials and use them to retrieve access tokens, see the <a href="/getting-started/authentication-brightcove-api-requests.html">Authentication for Brightcove 
API Requests</a>.</p>

<h3>Operations</h3>

<p>When you request client credentials, you will need to specify the type of account access or operations that you want. The following is a list of the currently supported operations for the SSAI API:</p>

<ul>
  <li>SSAI data:
  <p><code translate="No">video-cloud/ssai/read</code><br />
  <code translate="No">video-cloud/ssai/all</code></p>
  </li>
</ul>
</section>

<section class="bcls-section">
<h2 id="Manage_ad_configurations">Manage ad configurations</h2>

<p>The API supports the following GET and PUT requests:</p>

<ul>
  <li><a href="#List_ad_configurations">List ad configurations</a></li>
  <li><a href="#Create_an_ad_configuration">Create an ad configuration</a></li>
  <li><a href="#Get_ad_configuration_details">Get ad configuration details</a></li>
  <li><a href="#Update_an_ad_configuration">Update an ad configuration</a></li>
</ul>

<h3 id="List_ad_configurations">List ad configurations</h3>

<p>List the ad configurations defined for an account.</p>

<table class="bcls-table">
  <tbody class="bcls-table__body">
    <tr>
      <th>Method</th>
      <td>GET</td>
    </tr>
    <tr>
      <th>URL</th>
      <td>https://ssai.api.brightcove.com/v1/accounts/<span class="bcls-input">your account id</span>/ssai_configs</td>
    </tr>
    <tr>
      <th rowspan="2">Headers</th>
      <td>Authorization: Bearer <span class="bcls-input">your access token</span></td>
    </tr>
    <tr>
      <td>Content-Type: application/json</td>
    </tr>
  </tbody>
</table>

<h4>Sample response:</h4>
<pre class="line-numbers">
<code class="language-json" translate="No">{% raw %}[
  {
    "name": "VMAP Ad Server",
    "vmap_response_namespace": "bc",
    "config_id": "2ecc6beb-d6a4-4deb-a78e-37ac27e0f883",
    "account_id": "57838016001",
    "created_timestamp": "2017-07-24T19:28:34.976878586Z",
    "updated_timestamp": "2017-07-24T19:28:34.976878586Z",
    "ad_config": {
      "expected_ad_response": "dfp_ad_rules",
      "disable_server_beacons": false,
      "template_url": {
          "template": "https://solutions.brightcove.com/bcls/ads/simple-ad-rules?ip={{ system.ip_address }}&amp;vid={{ metadata.video_id }}&amp;ppid={{ system.unique_user_id }}&amp;p_vmap={{ url.p_vmap }}"
      }
    }
  }
]{% endraw %}</code></pre>

<p>For field definitions, see the <a href="#Configuration_field_details">Configuration field details</a> section.</p>

<h3 id="Create_an_ad_configuration">Create an ad configuration</h3>

<p>Create an ad configuration for an account.</p>

<table class="bcls-table">
  <tbody class="bcls-table__body">
    <tr>
      <th>Method</th>
      <td>POST</td>
    </tr>
    <tr>
      <th>URL</th>
      <td>https://ssai.api.brightcove.com/v1/accounts/<span class="bcls-input">your account id</span>/ssai_configs</td>
    </tr>
    <tr>
      <th rowspan="2">Headers</th>
      <td>Authorization: Bearer <span class="bcls-input">your access token</span></td>
    </tr>
    <tr>
      <td>Content-Type: application/json</td>
    </tr>
  </tbody>
</table>

<h4>Sample Body:</h4>

<pre class="line-numbers">
<code class="language-json" translate="No">{% raw %}{
  "name": "VMAP Ad Server",
  "vmap_response_namespace": "bc",
  "ad_tracking_sample_percentage": 100,
  "ad_config": {
    "expected_ad_response": "vast_3_0",
    "disable_server_beacons": false,
    "round_up_cue_points": false,
    "template_url": {
      "template": "https://solutions.brightcove.com/bcls/ads/simple-ad-rules?ip={{ system.ip_address }}&amp;vid={{ metadata.video_id }}&amp;ppid={{ system.unique_user_id }}&amp;p_vmap={{ url.p_vmap }}"
    }
  },
  "discontinuities": {
    "hls": [ "*" ]
  }
}{% endraw %}</code></pre>

<p>For field definitions, see the <a href="#Configuration_field_details">Configuration field details</a> section.</p>

<h4>Notes</h4>
<ul>
<li>
  <code translate="No">ad_tracking_sample_percentage</code> determines the percentage of sessions that will be logged. It can any value from 0 (disable logging) to 100 (log all sessions).
</li>
</ul>

<h3 id="Get_ad_configuration_details">Get ad configuration details</h3>

<p>For an account, get the ad configuration details by config Id.</p>

<table class="bcls-table">
  <tbody class="bcls-table__body">
    <tr>
      <th>Method</th>
      <td>GET</td>
    </tr>
    <tr>
      <th>URL</th>
      <td>https://ssai.api.brightcove.com/v1/accounts/<span class="bcls-input">your account id</span>/ssai_configs/<span class="bcls-input">your ad config id</span></td>
    </tr>
    <tr>
      <th rowspan="2">Headers</th>
      <td>Authorization: Bearer <span class="bcls-input">your access token</span></td>
    </tr>
    <tr>
      <td>Content-Type: application/json</td>
    </tr>
  </tbody>
</table>
<details>
  <summary>Sample response:</summary>
  
  <pre class="line-numbers">
  <code class="language-json" translate="No">{% raw %}{
    "name": "VMAP Ad Server",
    "vmap_response_namespace": "bc",
    "config_id": "2ecc6beb-d6a4-4deb-a78e-37ac27e0f883",
    "account_id": "57838016001",
    "created_timestamp": "2017-07-24T19:28:34.976878586Z",
    "updated_timestamp": "2017-07-24T19:28:34.976878586Z",
    "ad_tracking_sample_percentage": 100,
    "ad_config": {
      "expected_ad_response": "dfp_ad_rules",
      "disable_server_beacons": false,
      "template_url": {
          "template": "https://solutions.brightcove.com/bcls/ads/simple-ad-rules?ip={{ system.ip_address }}&amp;vid={{ metadata.video_id }}&amp;ppid={{ system.unique_user_id }}&amp;p_vmap={{ url.p_vmap }}"
      }
    },
    "beacon_templates": [
        {
          "type": "content_start",
          "template_url": {
            "template": "https://myserver.com/beaconRX/{{metadata.video_id}}/load?position=load&amp;sid={{system.xfp.unique_user_id}}&amp;jid={{metadata.video_id}}&amp;rnd32={{sytem.random_number_32}}&amp;bid={{system.uuid}}&amp;t={{system.timestamp_utc}}&amp;ua={{system.user_agent}}&amp;ip={{system.ip_address}}&amp;ref={{system.referer}}"
          }
        },
        {
          "type": "content_midpoint",
          "template_url": {
            "template": "https://myserver.com/beaconRX/{{metadata.video_id}}/load?position=load&amp;sid={{system.xfp.unique_user_id}}&amp;jid={{metadata.video_id}}&amp;rnd32={{sytem.random_number_32}}&amp;bid={{system.uuid}}&amp;t={{system.timestamp_utc}}&amp;ua={{system.user_agent}}&amp;ip={{system.ip_address}}&amp;ref={{system.referer}}"
          }
        },
        {
          "type": "ad_start",
          "template_url": {
            "template": "https://myserver.com/beaconRX/{{metadata.video_id}}/load?position=load&amp;sid={{system.xfp.unique_user_id}}&amp;jid={{metadata.video_id}}&amp;rnd32={{sytem.random_number_32}}&amp;bid={{system.uuid}}&amp;t={{system.timestamp_utc}}&amp;ua={{system.user_agent}}&amp;ip={{system.ip_address}}&amp;ref={{system.referer}}"
          }
        },
        {
          "type": "content_complete",
          "template_url": {
            "template": "https://myserver.com/beaconRX/{{metadata.video_id}}/load?position=load&amp;sid={{system.xfp.unique_user_id}}&amp;jid={{metadata.video_id}}&amp;rnd32={{sytem.random_number_32}}&amp;bid={{system.uuid}}&amp;t={{system.timestamp_utc}}&amp;ua={{system.user_agent}}&amp;ip={{system.ip_address}}&amp;ref={{system.referer}}"
          }
        }
      ],
      "discontinuities": {
        "dash": [
          "*"
        ],
        "hls": [
          "*"
        ]
      },
      "extend_beacon_guard_ttl": true
    }
  }{% endraw %}</code></pre>
</details>
<br/>
<p>For field definitions, see the <a href="#Configuration_field_details">Configuration field details</a> section.</p>

<h3 id="Update_an_ad_configuration">Update an ad configuration</h3>

<p>Update an ad configuration by config Id.</p>

<table class="bcls-table">
  <tbody class="bcls-table__body">
    <tr>
      <th>Method</th>
      <td>PUT</td>
    </tr>
    <tr>
      <th>URL</th>
      <td>https://ssai.api.brightcove.com/v1/accounts/<span class="bcls-input">your account id</span>/ssai_configs/<span class="bcls-input">your ad config id</span></td>
    </tr>
    <tr>
      <th rowspan="2">Headers</th>
      <td>Authorization: Bearer <span class="bcls-input">your access token</span></td>
    </tr>
    <tr>
      <td>Content-Type: application/json</td>
    </tr>
    <tr>
      <th>Sample Body</th>
      <td>
      <pre>
<code class="language-json" translate="No">{
    "name": "VMAP Ad Server - updated"
}</code></pre>
      </td>
    </tr>
  </tbody>
</table>

<details>
  <summary>Sample response:</summary>
  
  <pre class="line-numbers">
  <code class="language-json" translate="No">{% raw %}{
    "name": "VMAP Ad Server - updated",
    "vmap_response_namespace": "bc",
    "config_id": "2ecc6beb-d6a4-4deb-a78e-37ac27e0f883",
    "account_id": "57838016001",
    "created_timestamp": "2017-07-24T19:28:34.976878586Z",
    "updated_timestamp": "2017-07-24T19:28:34.976878586Z",
    "ad_config": {
      "expected_ad_response": "dfp_ad_rules",
      "disable_server_beacons": false,
      "template_url": {
        "template": "https://solutions.brightcove.com/bcls/ads/simple-ad-rules?ip={{ system.ip_address }}&amp;vid={{ metadata.video_id }}&amp;ppid={{ system.unique_user_id }}&amp;p_vmap={{ url.p_vmap }}"
      }
    }
  }{% endraw %}</code></pre>
</details>
<br/>
<p>For field definitions, see the <a href="#Configuration_field_details">Configuration field details</a> section.</p>
</section>

<section class="bcls-section">
<h2 id="Configuration_field_details">Configuration field details</h2>

<p>This table defines the ad configuration fields used within the body section of a request.</p>

<table class="bcls-table">
  <thead class="bcls-table__head">
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody class="bcls-table__body">
    <tr>
      <td><code translate="No">name</code></td>
      <td>String</td>
      <td>Human readable name</td>
    </tr>
    <tr>
      <td><code translate="No">vmap_response_namespace</code></td>
      <td>String</td>
      <td>Adjusts the VMAP output to use the legacy Unicorn Once namespace format or to use the new Brightcove namespace format.<br />
      <br />
      Values: <code translate="No">uo</code>, <code translate="No">bc</code> Default: <code translate="No">bc</code></td>
    </tr>
    <tr>
      <td><code translate="No">description</code></td>
      <td>String</td>
      <td>Human readable description</td>
    </tr>
    <tr>
      <td><code translate="No">ad_config.expected_ad_response</code></td>
      <td>String</td>
      <td>Which tech to use to parse the response. <sup><a href="#n1"> [1]</a></sup><br />
      <br />
      Values:
      <ul>
        <li><code translate="No">dfp_ad_rules</code></li>
        <li><code translate="No">dfp_vmap</code></li>
        <li><code translate="No">smart_xml</code></li>
        <li><code translate="No">vast_3_0</code></li>
      </ul>
      For details, see the <a href="#Ad_response_types">Ad response types</a> section.
      </td>
    </tr>
    <tr>
      <td><code translate="No">ad_config.disable_server_beacons</code></td>
      <td>Boolean</td>
      <td>Flags whether to disable the server side firing of ad impressions/beacons<br />
      <br />
      When set to <code translate="No">true</code>, SSAI will not fire any beacons server-side and will include all beacons in the VMAP output<br />
      <br />
      When set to <code translate="No">false</code>, SSAI will fire the beacons it is able to server-side and include any it is not able to in the VMAP output</td>
    </tr>
    <tr>
      <td><code translate="No">ad_config.round_up_cue_points</code></td>
      <td>Boolean</td>
      <td>Flags whether to round up to the next keyframe when choosing a nearby position for inserting ads.<br />
      <br />
      Default: <code translate="No">false</code>, which chooses the closest keyframe to the desired ad position.</td>
    </tr>
    <tr>
      <td><code translate="No">ad_config.template_url.template</code></td>
      <td>String</td>
      <td>Ad tag template. Available variables described in a later section.</td>
    </tr>
    <tr>
      <td><code translate="No">ad_config.template_url.defaults</code></td>
      <td>Object</td>
      <td>Map of String to String defining the default to use in the case where a url param is not provided.<br />
      <br />
      Can be a literal <code translate="No">{ "url.foo": "SomeString" }</code><br />
      <br />
      Or reference another variable <code translate="No">{% raw %}{ "url.foo": "{{ metadata.title_id }}" }{% endraw %}</code></td>
    </tr>
    <tr>
      <td><code translate="No">ad_tracking_sample_percentage</code></td>
      <td>integer</td>
      <td>This value determines the percentage of sessions that will be logged. It can any value from <code translate="No">0</code> (disable logging) to <code translate="No">100</code> (log all sessions). A value of <code translate="No">0</code> disables logs entirely.<br />
      <br />
      Default: <code translate="No">0</code><br />
      <br />
      Values: <code translate="No">[ 0 .. 100 ]</code><br />
      </td>
    </tr>
    <tr>
      <td><code translate="No">beacon_templates</code></td>
      <td>Array</td>
      <td>An array of beacons to fire (example: 3rd-party beacons)</td>
    </tr>
    <tr>
      <td><code translate="No">beacon_templates[].type</code></td>
      <td>String</td>
      <td>
      <p>Type of beacon to fire. Values:</p>

      <ul>
        <li><code translate="No">content_start</code></li>
        <li><code translate="No">content_first_quartile</code></li>
        <li><code translate="No">content_midpoint</code></li>
        <li><code translate="No">content_third_quartile</code></li>
        <li><code translate="No">content_complete</code></li>
        <li><code translate="No">content_quartiles</code></li>
        <li><code translate="No">content_interval</code></li>
        <li><code translate="No">ad_start</code></li>
        <li><code translate="No">ad_first_quartile</code></li>
        <li><code translate="No">ad_midpoint</code></li>
        <li><code translate="No">ad_third_quartile</code></li>
        <li><code translate="No">ad_complete</code></li>
        <li><code translate="No">ad_quartiles</code></li>
        <li><code translate="No">ad_break_start</code></li>
        <li><code translate="No">ad_break_end</code></li>
        <li><code translate="No">segment_start</code></li>
        <li><code translate="No">segment_end</code></li>
        <li><code translate="No">on_load</code></li>
      </ul>
      </td>
    </tr>
    <tr>
      <td><code translate="No">beacon_templates[].template_url.template</code></td>
      <td>String</td>
      <td>Beacon URL template</td>
    </tr>
    <tr>
      <td><code translate="No">discontinuities.dash</code> <sup><a href="#n2"> [2]</a></sup></td>
      <td>[]String</td>
      <td>Controls which versions of dash to deliver Multi Period Dash manifests.<br />
      <br />
      Set to <code translate="No">["*"]</code> to deliver multi-period dash for all versions<br />
      <br />
      Empty list for never<br />
      <br />
      Example: <code translate="No">["live-timeline"]</code> to deliver for live-timeline but not for hbbtv</td>
    </tr>
    <tr>
      <td><code translate="No">discontinuities.hls</code> <sup><a href="#n2"> [2]</a></sup></td>
      <td>[]String</td>
      <td>Controls which versions of hls to deliver with discontinuities.<br />
      <br />
      Set to <code translate="No">["*"]</code> to delivery with discontinuities in all versions of HLS<br />
      <br />
      Empty list for never<br />
      <br />
      Example: <code translate="No">["v4","v5"]</code> to deliver for v4 &amp; v5 but not for v3</td>
    </tr>
    <tr>
      <td><code translate="No">extend_beacon_guard_ttl</code></td>
      <td>Boolean</td>
      <td>Sets the length of the Beacon Guard TTL (Time to live) to the length of the Content’s Session TTL. Otherwise, the default is 1 minute.</td>
    </tr>
  </tbody>
</table>

<aside class="bcls-aside bcls-aside--information">
<p>The following notes refer to the fields in the table above.</p>

<p id="n1"><sup>[1]</sup> When the <code translate="No">expected_ad_response</code> is set to <code translate="No">vast_3_0</code>, SSAI makes one VAST call for each ad cue point defined in Video Cloud. For VMAP and ad rules, SSAI makes requests based on the defined ad breaks in the initial ad response.</p>

<p id="n2"><sup>[2]</sup> Discontinuity tags indicate a change in frame rate encoding between content video and ad segments. They tell the system to reconstruct the rendering chain. For scalable SSAI, the video player needs to be able to play HLS with Discontinuity tags and MPEG DASH containing multiple periods.</p>
</aside>
</section>

<section class="bcls-section">
  <h2 id="Ad_response_types">Ad response types</h2>
  
  <p>Here is some additional information about working with <code translate="No">ad_config.expected_ad_response</code> types from the table above. Values:</p>
  <ul>
    <li><code translate="No">vast_3_0</code> - <a href="https://www.iab.com/guidelines/vast/">Digital Video Ad Serving Template (VAST)</a></li>
    <li><code translate="No">dfp_vmap</code> - <a href="https://www.iab.com/guidelines/vmap/">Video Multiple Ad Playlist (VMAP)</a></li>
    <li><code translate="No">dfp_ad_rules</code> - Proprietary format for Google DFP, which has been rebranded as Google Ad Manager(GAM)</li>
    <li><code translate="No">smart_xml</code> - Proprietary format for FreeWheel</li> 
  </ul>
  <h3>Process flow</h3>
  <figure class="bcls-figure">
    <img class="bcls-image--no-border" src="/assets/images/ssai/vod-ssai-configurations.svg" alt="VOD SSAI Configurations">
    <figcaption class="bcls-caption--image">VOD SSAI Configurations</figcaption>
  </figure>
  <p>When creating SSAI ad configurations, keep in mind the following process notes:</p>
  <h4>VMAP</h4>
  <p>If SSAI Config's Ad Response Type is DFP VMAP:</p>
  <ul>
    <li>Any cue points configured with a video will be ignored.</li>
    <li>SSAI parses the VMAP XML file from the ad provider which contains all the ads with their defined positions.</li>
  </ul>
  <h4>VAST</h4>
  <p>If SSAI Config's Ad Response Type is VAST 3.0:</p>
  <ul>
    <li>Define cue points in your video. SSAI will make requests for each cue point in the video to construct ad breaks.</li>
    <li>If no cue point is configured with a video, a preroll ad is inserted by default.</li>
  </ul>
  </section>

<section class="bcls-section">
<h2 id="Ad_variables">Ad variables</h2>

<p>Variables in the <strong>template url</strong> are identified by double curly braces (<code translate="No">{% raw %}{{ … }}{% endraw %}</code>) with optional whitespace before and after the variable path. All variables are prefixed by one of three namespaces:</p>

<ul>
  <li><a href="#System_variables">system</a></li>
  <li><a href="#URL_variables">url</a></li>
  <li><a href="#Metadata_variables">metadata</a></li>
</ul>

<aside class="bcls-aside bcls-aside--information">Note:
  <ul>
    <li>The maximum length allowed for variable names is 256 and for value it’s 1024.</li>
  </ul>
</aside>

<h3 id="System_variables">System variables</h3>

<p>System variables are provided by the SSAI system and can be information about the end user or helper variables to generate random values. The values must be URI-encoded before being inserted into the URL templates.</p>

<p>System variables are identified as: <code translate="No">{% raw %}{{system.*}}{% endraw %}</code></p>

<table class="bcls-table">
  <thead class="bcls-table__head">
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody class="bcls-table__body">
    <tr>
      <td><code translate="No">ad.position_time</code></td>
      <td>The time in seconds of the Cue Point that triggered the ad request; Only available for the VAST ad response type</td>
    </tr>
    <tr>
      <td><code translate="No">ip_address</code></td>
      <td>End User's IP Address</td>
    </tr>
    <tr>
      <td><code translate="No">random_number_32</code></td>
      <td>Random 32-bit integer</td>
    </tr>
    <tr>
      <td><code translate="No"> random_number_&lt;min&gt;_&lt;max&gt;</code></td>
      <td>Generates a random number between two numbers. The range accepted goes from 0 to the max value of <code translate="No">UInt32</code>. Only positive numbers are allowed, and the <code translate="no">min</code> has to be lower than the <code translate="no">max</code></td>
    </tr>
    <tr>
      <td><code translate="No">random_guid</code></td>
      <td>Random UUID</td>
    </tr>
    <tr>
      <td><code translate="No">referer</code></td>
      <td>End User's Referer header value</td>
    </tr>
    <tr>
      <td><code translate="No">timestamp_utc</code></td>
      <td>Current time as a unix timestamp</td>
    </tr>
    <tr>
      <td><code translate="No">unique_user_id</code></td>
      <td>MD5(ip_address + user_agent)</td>
    </tr>
    <tr>
      <td><code translate="No">unix_timestamp</code></td>
      <td>Current time as a unix timestamp (seconds)</td>
    </tr>
    <tr>
      <td><code translate="No">user_agent</code></td>
      <td>End User's User-Agent header value</td>
    </tr>
    <tr>
      <td><code translate="No">uuid</code></td>
      <td>Random uuid</td>
    </tr>
    <tr>
      <td><code translate="No">x_forwarded_for</code></td>
      <td>End User's X-Forwarded-For header value</td>
    </tr>
    <tr>
      <td><code translate="No">xfp.correlator</code></td>
      <td>Random 64-bit Integer</td>
    </tr>
    <!-- <tr>
      <td><code translate="No">xfp.ip_address</code></td>
      <td>End User's IP Address</td>
    </tr>
    <tr>
      <td><code translate="No">xfp.unique_user_id</code></td>
      <td>MD5(ip_address + user_agent)</td>
    </tr> -->
    <tr>
      <td><code translate="No">xfp.scor</code></td>
      <td>Random 64-bit Integer</td>
    </tr>
  </tbody>
</table>

<h3 id="URL_variables">URL variables</h3>
<p>Query Params provided on the entry point VMAP/Manifest are available under the <code translate="No">url</code> namespace. Unlike variables under other namespaces, these params are not url encoded when inserting into the template. If variable values need to be url encoded going to the ad provider, they will need to be double url encoded on the entry point url.</p>

<p>URL variables are identified as: <code translate="No">{% raw %}{{url.*}}{% endraw %}</code></p>
<p>URL variables are added to the VMAP urls using custom integration as follows:</p>
<ol class="bcls-tasklist">
  <li>Add <code translate="No">{% raw %}{{url.*}}{% endraw %}</code> macro variables to the ad tag for a specific server-side ad config. For example:
    <pre class="line-numbers"><code class="language-http" translate="No">https://general.support.brightcove.com/assets/ads/vmap/simple-vmap.xml?foo=&#123;&#123;url.foo&#125;&#125;&bar=&#123;&#123;url.bar&#125;&#125;</code></pre>
  </li>
  <li>Configure a player with the SSAI plugin and the ad configuration containing the ad tag with macros.</li>
  <li>Pass a vmapURLParams options object to the SSAI plugin containing the variable names and values to replace:
    <pre class="line-numbers"><code class="language-json" translate="No">"options": {
  "vmapURLParams": {
    "foo": 123,
    "bar": "test"
  }
}</code></pre>
  </li>
  <li>Brightcove player with SSAI plugin (v2.4.6+) calls to retrieve the VMAP URL from Playback API and then automatically appends the values of the variables before sending the request.</li>
</ol>
<aside class="bcls-aside bcls-aside--warning language-editable">TradeDesk's UID2 is not supported as an Ad Tag Macro.</aside>

<h3 id="Metadata_variables">Metadata variables</h3>
<p>Metadata variables are those that describe the content video, derived from both Video Cloud and Dynamic Delivery data sources. The values <strong>(except for <code translate="No">ad_keys</code>)</strong> are URL encoded before being inserted into the URL templates.</p>

<aside class="bcls-aside bcls-aside--information language-editable"><code translate="No">ad_keys</code> is designed to be filled in with separate query parameters to be passed through to the ad server, so url encoding would break that.</aside>

<p>Metadata variables are identified as: <code translate="No">{% raw %}{{metadata.*}}{% endraw %}</code></p>

<table class="bcls-table">
  <thead class="bcls-table__head">
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody class="bcls-table__body">
    <tr>
      <td><code translate="No">ad_keys</code></td>
      <td>
        <p>Free form text string that can be added and edited in the Video Cloud Studio Media module using one of the two fields below, depending on your ad response type</p>
        <ul>
          
          <li><strong>Non Vast 3.0</strong> - “Ad Keys” video field</li>
          <li><strong>Vast 3.0</strong> - The “Ad Keys” video field is concatenated with the “Key/Value Pairs” field on the video cue points. To learn how to work with cue points, see the  <a href="https://studio.support.brightcove.com/media/working-cue-points-media-module.html">working with cue points in the Media module</a> document.</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><code translate="No">{% raw %}custom_fields.{field_name}{% endraw %}</code></td>
      <td>Video Cloud custom fields</td>
    </tr>
    <tr>
      <td><code translate="No">long_description</code></td>
      <td>Video Cloud long description</td>
    </tr>
    <tr>
      <td><code translate="No">name</code></td>
      <td>Video Cloud video name</td>
    </tr>
    <tr>
      <td><code translate="No">reference_id</code></td>
      <td>Video Cloud reference id</td>
    </tr>
    <tr>
      <td><code translate="No">tags</code></td>
      <td>Comma separated list of the Video Cloud tags for the video</td>
    </tr>
    <tr>
      <td><code translate="No">title.duration</code></td>
      <td>Duration of the content in seconds</td>
    </tr>
    <tr>
      <td><code translate="No">title.id</code></td>
      <td>Dynamic Delivery title id</td>
    </tr>
    <tr>
      <td><code translate="No">title.name</code></td>
      <td>Dynamic Delivery title name</td>
    </tr>
    <tr>
      <td><code translate="No">video_id</code></td>
      <td>Video Cloud video id</td>
    </tr>
    <tr>
      <td colspan="2"><em>Other Video Cloud key/value pairs would be here as well</em></td>
    </tr>
  </tbody>
</table>

 <h4>Brightcove Ad Monetization</h4>
    <p>At minimum, a Brightcove Ad Monetization ad config using SpringServe will include the following macros when used with the Brightcove Web Player. For SDK and other implementations, values should be passed programmatically in-app instead of using the web player macros listed below.</p>
    <table class="bcls-table">
        <caption class="bcls-caption--table">Brightcove Ad Monetization</caption>
        <thead class="bcls-table__head">
            <tr>
                <th>Description</th>             
                <th>Ad Config Query Parameter</th>
                <th>Brightcove Web Player</th>
                <th>Always Available to SSAI system</th>
            </tr>
        </thead>
        <tbody class="bcls-table__body">
            <tr>
              <td>Player Width</td>          
              <td><code translate="No">w</code></td>
              <td><code translate="No">{% raw %}{{page.player.width}}{% endraw %}</code></td>
              <td>Implementation Dependent</td>
            </tr>
            <tr>
              <td>Player Height</td>          
              <td><code translate="No">h</code></td>
              <td><code translate="No">{% raw %}{{page.player.height}}{% endraw %}</code></td>
              <td>Implementation Dependent</td>
            </tr>   
            <tr>
              <td>Cachebuster Random number</td>          
              <td><code translate="No">cb</code></td>
              <td><code translate="No">{% raw %}{{system.random_number_32}}{% endraw %}</code></td>
              <td>Yes</td>
            </tr>   
            <tr>
              <td>Current page</td>          
              <td><code translate="No">url</code></td>
              <td><code translate="No">{% raw %}{{page.document.referrer}}{% endraw %}</code></td>
              <td>Implementation Dependent</td>
            </tr> 
            <tr>
              <td>User Agent</td>          
              <td><code translate="No">ua</code></td>
              <td><code translate="No">{% raw %}{{system.user_agent}}{% endraw %}</code></td>
              <td>Yes</td>
            </tr> 
            <tr>
              <td>GDPR Consent value</td>          
              <td><code translate="No">gdpr_consent</code></td>
              <td><code translate="No">{% raw %}{{page.pageVariable.gdpr_consent}}{% endraw %}</code></td>
              <td>See Privacy section below</td>
            </tr>  
            <tr>
              <td>Subject to GDPR</td>          
              <td><code translate="No">gdpr</code></td>
              <td><code translate="No">{% raw %}{{page.pageVariable.gdpr}}{% endraw %}</code></td>
              <td>See Privacy section below</td>
            </tr>  
            <tr>
              <td>Subject to US Privacy Regulations</td>          
              <td><code translate="No">us_privacy</code></td>
              <td><code translate="No">{% raw %}{{page.pageVariable.us_privacy}}{% endraw %}</code></td>
              <td>See Privacy section below</td>
            </tr> 
            <tr>
              <td>Subject to COPPA regulations</td>          
              <td><code translate="No">coppa</code></td>
              <td><code translate="No">{% raw %}{{page.pageVariable.coppa}}{% endraw %}</code></td>
              <td>See Privacy section below</td>
            </tr> 
            <tr>
              <td>Content Genre</td>          
              <td><code translate="No">content_genre</code></td>
              <td><code translate="No">{% raw %}{{metadata.custom_fields.genre}}{% endraw %}</code></td>
              <td>Brightcove Library dependent</td>
            </tr> 
            <tr>
              <td>Content Rating</td>  
              <td><code translate="No">rating</code></td>        
              <td><code translate="No">{% raw %}{{metadata.custom_fields.rating}}{% endraw %}</code></td>
              <td>Brightcove Library dependent</td>
            </tr> 
            <tr>
              <td>Content Language</td>          
              <td><code translate="No">language</code></td>
              <td><code translate="No">{% raw %}{{metadata.custom_fields.language}}{% endraw %}</code></td>
              <td>Brightcove Library dependent</td>
            </tr>
            <tr>
              <td>Content ID</td>          
              <td><code translate="No">content_id</code></td>
              <td><code translate="No">{% raw %}{{metadata.video_id}} OR {{metadata.custom_fields.content_id}}{% endraw %}</code></td>
              <td>Yes / Brightcove Library dependent</td>
            </tr>
            <tr>
              <td>App Store URL</td>          
              <td><code translate="No">app_store_url</code></td>
              <td><code translate="No">{% raw %}{{metadata.custom_fields.app_store_url}}{% endraw %}</code></td>
              <td>Brightcove Library dependent</td>
            </tr>
            <tr>
              <td>[Optional] Additional Custom Fields</td>          
              <td></td>
              <td><code translate="No">{% raw %}{{metadata.custom_fields.field_name}}{% endraw %}</code></td>
              <td>Brightcove Library dependent</td>
            </tr>
        </tbody>
    </table>
    <h5>Privacy</h5>
    <p>To add the privacy-related macros to your ad tag, your implementation needs to collect the data from users and pass them to the player or application at runtime. With a standard web player implementation, each variable is defined as a global JavaScript variable with the same name within the page or app, allowing the player to access them and send them to the ad server when it makes ad requests.</p>
    <p>If the variables are named differently within your page or app, ensure that the relevant macro name (<code translate="No">pageVariable.macro_name</code>) is updated to match. For example, you could define each variable within a &lt;script&gt; tag at the top of your page like this:</p>
    <pre><code class="language-javascript" translate="No">var my_gdpr_variable = true;</code></pre>

    <p>The player will then be able to retrieve the <code translate="No">gdpr</code> value of <code translate="No">true</code> via <code translate="No">{pageVariable.my_gdpr_variable}</code> and pass it through to the SSAI system.</p>

</section>

<section class="bcls-section">
<h2 id="Entrypoint_URL_parameters">Entrypoint URL parameters</h2>

<p>There are a handful of query parameters that can be added to the SSAI entry point URL (VMAP or manifest) in order to tweak some behaviors:</p>

<table class="bcls-table">
  <thead class="bcls-table__head">
    <tr>
      <th width="25%">Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody class="bcls-table__body">
    <tr>
      <td><code translate="No">?rule=sd-only</code></td>
      <td>Filters out any video rendition that has a height less than the threshold set in the Account Configuration</td>
    </tr>
    <tr>
      <td><code translate="No">?rule=discos-enabled</code></td>
      <td>Enable Playback with Discontinuities in HLS &amp; MultiPeriods in Dash. Takes precedence over discontinuities setting in Playback Config</td>
    </tr>
    <tr>
      <td><code translate="No">?rule=discos-disabled</code></td>
      <td>Disable Playback with Discontinuities in HLS &amp; MultiPeriods in Dash. Takes precedence over discontinuities setting in Playback Config</td>
    </tr>
  </tbody>
</table>
</section>

<section class="bcls-section">
<h2 id="Configuration_notes">Configuration notes</h2>

<ol>
  <li>Preloading ads should not be done with SSAI. The reason for this is that if you preload the player will report an ad impression and probably the first quartile beacons before the video is played. This could lead to inaccurate ad analytics. If you configure SSAI in Studio, this will automatically be done, but if you happen to setup SSAI manually you need to be aware of this issue.</li>
  <li>If the web player is using SSAI, and one of your motivations for doing so is to work around ad blockers, you should use server-side beacons. Client-side beacons should not be used as they will be blocked.</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Client_side_macros">Client-side macros</h2>

<p>Use the <code translate="No">page</code> prefix when you want to use client-side ad macros. These macros enable you to use variables in the VMAP and server URLs. For ad macro details, see the <a href="https://player.support.brightcove.com/plugins/advertising-ima3-plugin.html#Ad_macros_and_the_serverUrl">Ad macros and the serverURL</a> section of the Advertising with the IMA3 Plugin document.</p>
<!-- <p>
              When you prefix an Ad variable with , then a client-side macro will be appended to the end of the VMAP and SRC fields in the catalog response, when SSAI is being used. Then, the Brightcove player will run those strings through the client-side macro replacement logic.
            </p> -->

<p>Client-side macros are prefixed with: <code translate="No">{% raw %}{{page.*}}{% endraw %}</code></p>

<p>For example, to add the <code translate="No">document.referrer</code> and a <code translate="No">pageVariable</code> DOM window variable, you would prefix them with <code translate="No">page</code> in the ad template as follows:</p>

<pre>
<code class="language-html" translate="No">{% raw %}https://adserver.com/{{page.document.referrer}}/{{page.pageVariable.whateverIwant}}{% endraw %}</code></pre>

<p>The Playback API returns <code translate="No">document.referrer</code> and <code translate="No">pageVariable.whateverIwant</code> appended to the VMAP and SRC URLs. The Brightcove player then runs through its client-side macro replacement logic to replace the appropriate values, before sending the request:</p>

<pre>
<code class="language-html" translate="No">{% raw %}https://bolt-prefix/blah.vmap?document.referrer={document.referrer}&amp;pageVariable.whateverIwant={pageVariable.whateverIwant}{% endraw %}</code></pre>
</section>

<section class="bcls-section">
<h2 id="Ad_error_beacons">Ad error beacons</h2>

<p>VAST ad error beacons when using SSAI can be helpful for proactively finding and fixing problems with your ad workflow. For details, see the <a href="https://ssai.support.brightcove.com/vod/guides/ad-error-beacons-ssai.html">Ad Error Beacons with SSAI</a> document.</p>
</section>

<!-- <section class="bcls-section">
  <h2 id="Considerations">Considerations</h2>
  <p>Our system takes note of the cue points when using a VAST ad tag. Conversely, when using a VMAP ad tag, our system completely ignores cue points. This is because SSAI ignores the Video Cloud cue points when it requests ads using a playback config which is expecting a <strong>DFP VMAP</strong> response. It relies solely on the ad response data and title duration to set the positions of ad breaks.</p>
  <p>The use of VMAP for this function is not supported, and the result is unexpected. Therefore we do not recommend its use.</p>
</section> -->

</article>
