(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}})(typeof window!=="undefined"?window:this,function(window,noGlobal){var arr=[];var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var document=window.document,version="2.1.1",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)>=0},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}if(obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i)},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j]}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:Date.now,support:support});jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent!==parent.top){if(parent.addEventListener){parent.addEventListener("unload",function(){setDocument()},false)}else if(parent.attachEvent){parent.attachEvent("onunload",function(){setDocument()})}}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(doc.getElementsByClassName)&&assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select msallowclip=''><option selected=''></option></select>";if(div.querySelectorAll("[msallowclip^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}
function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context!==document&&context}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>=0!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return typeof rootjQuery.ready!=="undefined"?rootjQuery.ready(selector):selector(jQuery)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.extend({dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0])}return indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});var rnotwhite=/\S+/g;var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready")}}});function completed(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.ready.promise();var access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet};jQuery.acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!+owner.nodeType};function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Math.random()}Data.uid=1;Data.accepts=jQuery.acceptData;Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;if(key===undefined||key&&typeof key==="string"&&value===undefined){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:name.match(rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};var data_priv=new Data;var data_user=new Data;var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)};var rcheckableType=/^(?:checkbox|radio)$/i;(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue})();var strundefined=typeof undefined;support.focusinBubbles="onfocusin"in window;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==strundefined&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined}}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&jQuery.acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}},
simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}data_priv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);data_priv.remove(doc,fix)}else{data_priv.access(doc,fix,attaches)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,type,key,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(jQuery.acceptData(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}}});jQuery.fn.extend({text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value}})},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];this.domManip(arguments,function(elem){arg=this.parentNode;jQuery.cleanData(getAll(this));if(arg){arg.replaceChild(elem,this)}});return arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value)){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={};function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=iframe[0].contentDocument;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}var rmargin=/^margin/;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)};function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);if(computed){ret=computed.getPropertyValue(name)||computed[name]}if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret!==undefined?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}(function(){var pixelPositionVal,boxSizingReliableVal,docElem=document.documentElement,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;"+"position:absolute";container.appendChild(div);function computePixelPositionAndBoxSizingReliable(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;display:block;margin-top:1%;top:1%;"+"border:1px;padding:1px;width:4px;position:absolute";div.innerHTML="";docElem.appendChild(container);var divStyle=window.getComputedStyle(div,null);pixelPositionVal=divStyle.top!=="1%";boxSizingReliableVal=divStyle.width==="4px";docElem.removeChild(container)}if(window.getComputedStyle){jQuery.extend(support,{pixelPosition:function(){computePixelPositionAndBoxSizingReliable();return pixelPositionVal},boxSizingReliable:function(){if(boxSizingReliableVal==null){computePixelPositionAndBoxSizingReliable()}return boxSizingReliableVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;padding:0";marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";docElem.appendChild(container);ret=!parseFloat(window.getComputedStyle(marginDiv,null).marginRight);docElem.removeChild(container);return ret}})}})();jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name[0].toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",defaultDisplay(elem.nodeName))}}else{hidden=isHidden(elem);if(display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{float:"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||value!==value){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?data_priv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else{display=undefined}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)}
;if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t"})();var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}});var rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}});jQuery.extend({propFix:{for:"htmlFor",class:"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=jQuery.trim(cur);if(elem.className!==finalValue){elem.className=finalValue}}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=arguments.length===0||typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}finalValue=value?jQuery.trim(cur):"";if(elem.className!==finalValue){elem.className=finalValue}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem))}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(option.value,values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now();var rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,throws:true})};jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrId=0,xhrCallbacks={},xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}})}support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else if(type==="error"){complete(xhr.status,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[id]=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback){throw e}}},abort:function(){if(callback){callback()}}}}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter(function(s){if(s.crossDomain){s.contents.script=false}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});script[0].setAttribute("importance","high");document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=jQuery.trim(url.slice(off));url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},position:function(){if(!this[0]){
return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof hy.define==="function"&&hy.define.amd){hy.define("jquery",[],function(){return jQuery})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};noGlobal=true;if(!noGlobal){window.jQuery=window.$=jQuery}return jQuery});hapyak.jQueryExists=!!window.jQuery;hy.define("jquery.noconflict",["jquery","module"],function(jQuery,module){var matched,browser,Ember;var config=module.config();jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}};matched=jQuery.uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version}if(browser.chrome){browser.webkit=true}else if(browser.webkit){browser.safari=true}jQuery.browser=browser;if(!jQuery.support.cors&&window.XDomainRequest){var httpRegEx=/^https?:\/\//i;var getOrPostRegEx=/^get|post$/i;var sameSchemeRegEx=new RegExp("^"+location.protocol,"i");var xmlRegEx=/\/xml/i;jQuery.ajaxTransport("text html xml json",function(options,userOptions,jqXHR){if(options.crossDomain&&options.async&&getOrPostRegEx.test(options.type)&&httpRegEx.test(userOptions.url)&&sameSchemeRegEx.test(userOptions.url)){var xdr=null;var userType=(userOptions.dataType||"").toLowerCase();return{send:function(headers,complete){xdr=new XDomainRequest;if(/^\d+$/.test(userOptions.timeout)){xdr.timeout=userOptions.timeout}xdr.ontimeout=function(){complete(500,"timeout")};xdr.onload=function(){var allResponseHeaders="Content-Length: "+xdr.responseText.length+"\r\nContent-Type: "+xdr.contentType;var status={code:200,message:"success"};var responses={text:xdr.responseText};try{if(userType==="json"){try{responses.json=JSON.parse(xdr.responseText)}catch(e){status.code=500;status.message="parseerror"}}else if(userType==="xml"||userType!=="text"&&xmlRegEx.test(xdr.contentType)){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.async=false;try{doc.loadXML(xdr.responseText)}catch(e){doc=undefined}if(!doc||!doc.documentElement||doc.getElementsByTagName("parsererror").length){status.code=500;status.message="parseerror";throw new Error("Invalid XML: "+xdr.responseText)}responses.xml=doc}}catch(parseMessage){throw parseMessage}finally{complete(status.code,status.message,responses,allResponseHeaders)}};xdr.onerror=function(){complete(500,"error",{text:xdr.responseText})};xdr.open(options.type,options.url);xdr.send()},abort:function(){if(xdr){xdr.abort()}}}}})}Ember={imports:{jQuery:jQuery}};if(typeof window!=="undefined"){if(typeof window.Ember==="undefined"){window.Ember=Ember}else if(typeof window.Ember!=="undefined"&&window.Ember.hasOwnProperty("imports")){window.Ember.imports.jQuery=Ember.imports.jQuery}else{window.Ember.imports=Ember.imports}window.Ember.$=Ember.imports.jQuery}if(/^(?:www|dev|feature|staging)?\.?hapyak\.com/.test(window.location.host)){return jQuery}return hapyak.jQueryExists?jQuery.noConflict(true):jQuery.noConflict()});(function(){var define,requireModule,require,requirejs;(function(){var registry={},seen={};define=function(name,deps,callback){registry[name]={deps:deps,callback:callback}};requirejs=require=requireModule=function(name){requirejs._eak_seen=registry;if(seen[name]){return seen[name]}seen[name]={};if(!registry[name]){throw new Error("Could not find module "+name)}var mod=registry[name],deps=mod.deps,callback=mod.callback,reified=[],exports;for(var i=0,l=deps.length;i<l;i++){if(deps[i]==="exports"){reified.push(exports={})}else{reified.push(requireModule(resolve(deps[i])))}}var value=callback.apply(this,reified);return seen[name]=exports||value;function resolve(child){if(child.charAt(0)!=="."){return child}var parts=child.split("/");var parentBase=name.split("/").slice(0,-1);for(var i=0,l=parts.length;i<l;i++){var part=parts[i];if(part===".."){parentBase.pop()}else if(part==="."){continue}else{parentBase.push(part)}}return parentBase.join("/")}}})();(function(){if("undefined"===typeof Ember){Ember={}}var imports=Ember.imports=Ember.imports||this;var exports=Ember.exports=Ember.exports||this;var lookup=Ember.lookup=Ember.lookup||this;exports.Em=exports.Ember=Em=Ember;Ember.isNamespace=true;Ember.toString=function(){return"Ember"};Ember.VERSION="1.4.0-beta.3";if(Ember.ENV){}else if("undefined"!==typeof EmberENV){Ember.ENV=EmberENV}else if("undefined"!==typeof ENV){Ember.ENV=ENV}else{Ember.ENV={}}Ember.config=Ember.config||{};if("undefined"===typeof Ember.ENV.DISABLE_RANGE_API){Ember.ENV.DISABLE_RANGE_API=true}if("undefined"===typeof MetamorphENV){exports.MetamorphENV={}}MetamorphENV.DISABLE_RANGE_API=Ember.ENV.DISABLE_RANGE_API;Ember.FEATURES=Ember.ENV.FEATURES||{};Ember.FEATURES.isEnabled=function(feature){var featureValue=Ember.FEATURES[feature];if(Ember.ENV.ENABLE_ALL_FEATURES){return true}else if(featureValue===true||featureValue===false||featureValue===undefined){return featureValue}else if(Ember.ENV.ENABLE_OPTIONAL_FEATURES){return true}else{return false}};Ember.EXTEND_PROTOTYPES=Ember.ENV.EXTEND_PROTOTYPES;if(typeof Ember.EXTEND_PROTOTYPES==="undefined"){Ember.EXTEND_PROTOTYPES=true}Ember.LOG_STACKTRACE_ON_DEPRECATION=Ember.ENV.LOG_STACKTRACE_ON_DEPRECATION!==false;Ember.SHIM_ES5=Ember.ENV.SHIM_ES5===false?false:Ember.EXTEND_PROTOTYPES;Ember.LOG_VERSION=Ember.ENV.LOG_VERSION===false?false:true;Ember.K=function(){return this};if("undefined"===typeof Ember.assert){Ember.assert=Ember.K}if("undefined"===typeof Ember.warn){Ember.warn=Ember.K}if("undefined"===typeof Ember.debug){Ember.debug=Ember.K}if("undefined"===typeof Ember.deprecate){Ember.deprecate=Ember.K}if("undefined"===typeof Ember.deprecateFunc){Ember.deprecateFunc=function(_,func){return func}}Ember.uuid=0;Ember.merge=function(original,updates){for(var prop in updates){if(!updates.hasOwnProperty(prop)){continue}original[prop]=updates[prop]}return original};Ember.isNone=function(obj){return obj===null||obj===undefined};Ember.none=Ember.deprecateFunc("Ember.none is deprecated. Please use Ember.isNone instead.",Ember.isNone);Ember.isEmpty=function(obj){return Ember.isNone(obj)||obj.length===0&&typeof obj!=="function"||typeof obj==="object"&&Ember.get(obj,"length")===0};Ember.empty=Ember.deprecateFunc("Ember.empty is deprecated. Please use Ember.isEmpty instead.",Ember.isEmpty)})();(function(){var platform=Ember.platform={};Ember.create=Object.create;if(Ember.create){if(Ember.create({a:1},{a:{value:2}}).a!==2){Ember.create=null}}if(!Ember.create||Ember.ENV.STUB_OBJECT_CREATE){var K=function(){};Ember.create=function(obj,props){K.prototype=obj;obj=new K;if(props){K.prototype=obj;for(var prop in props){K.prototype[prop]=props[prop].value}obj=new K}K.prototype=null;return obj};Ember.create.isSimulated=true}var defineProperty=Object.defineProperty;var canRedefineProperties,canDefinePropertyOnDOM;if(defineProperty){try{defineProperty({},"a",{get:function(){}})}catch(e){defineProperty=null}}if(defineProperty){canRedefineProperties=function(){var obj={};defineProperty(obj,"a",{configurable:true,enumerable:true,get:function(){},set:function(){}});defineProperty(obj,"a",{configurable:true,enumerable:true,writable:true,value:true});return obj.a===true}();canDefinePropertyOnDOM=function(){try{defineProperty(document.createElement("div"),"definePropertyOnDOM",{});return true}catch(e){}return false}();if(!canRedefineProperties){defineProperty=null}else if(!canDefinePropertyOnDOM){defineProperty=function(obj,keyName,desc){var isNode;if(typeof Node==="object"){isNode=obj instanceof Node}else{isNode=typeof obj==="object"&&typeof obj.nodeType==="number"&&typeof obj.nodeName==="string"}if(isNode){return obj[keyName]=desc.value}else{return Object.defineProperty(obj,keyName,desc)}}}}platform.defineProperty=defineProperty;platform.hasPropertyAccessors=true;if(!platform.defineProperty){platform.hasPropertyAccessors=false;platform.defineProperty=function(obj,keyName,desc){if(!desc.get){obj[keyName]=desc.value}};platform.defineProperty.isSimulated=true}if(Ember.ENV.MANDATORY_SETTER&&!platform.hasPropertyAccessors){Ember.ENV.MANDATORY_SETTER=false}})();(function(){var isNativeFunc=function(func){return func&&Function.prototype.toString.call(func).indexOf("[native code]")>-1};var arrayMap=isNativeFunc(Array.prototype.map)?Array.prototype.map:function(fun){if(this===void 0||this===null){throw new TypeError}var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function"){throw new TypeError}var res=new Array(len);var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){res[i]=fun.call(thisp,t[i],i,t)}}return res};var arrayForEach=isNativeFunc(Array.prototype.forEach)?Array.prototype.forEach:function(fun){if(this===void 0||this===null){throw new TypeError}var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function"){throw new TypeError}var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){fun.call(thisp,t[i],i,t)}}};var arrayIndexOf=isNativeFunc(Array.prototype.indexOf)?Array.prototype.indexOf:function(obj,fromIndex){if(fromIndex===null||fromIndex===undefined){fromIndex=0}else if(fromIndex<0){fromIndex=Math.max(0,this.length+fromIndex)}for(var i=fromIndex,j=this.length;i<j;i++){if(this[i]===obj){return i}}return-1};Ember.ArrayPolyfills={map:arrayMap,forEach:arrayForEach,indexOf:arrayIndexOf};if(Ember.SHIM_ES5){if(!Array.prototype.map){Array.prototype.map=arrayMap}if(!Array.prototype.forEach){Array.prototype.forEach=arrayForEach}if(!Array.prototype.indexOf){Array.prototype.indexOf=arrayIndexOf}}})();(function(){var errorProps=["description","fileName","lineNumber","message","name","number","stack"];Ember.Error=function(){var tmp=Error.apply(this,arguments);if(Error.captureStackTrace){Error.captureStackTrace(this,Ember.Error)}for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]]}};Ember.Error.prototype=Ember.create(Error.prototype);Ember.onerror=null;Ember.handleErrors=function(func,context){if("function"===typeof Ember.onerror){try{return func.call(context||this)}catch(error){Ember.onerror(error)}}else{return func.call(context||this)}}})();(function(){Ember.GUID_PREFIX="ember";var o_defineProperty=Ember.platform.defineProperty,o_create=Ember.create,GUID_KEY="__ember"+ +new Date,uuid=0,numberCache=[],stringCache={};var MANDATORY_SETTER=Ember.ENV.MANDATORY_SETTER;Ember.GUID_KEY=GUID_KEY;var GUID_DESC={writable:false,configurable:false,enumerable:false,value:null};Ember.generateGuid=function generateGuid(obj,prefix){if(!prefix)prefix=Ember.GUID_PREFIX;var ret=prefix+uuid++;if(obj){GUID_DESC.value=ret;o_defineProperty(obj,GUID_KEY,GUID_DESC)}return ret};Ember.guidFor=function guidFor(obj){if(obj===undefined)return"(undefined)";if(obj===null)return"(null)";var ret;var type=typeof obj;switch(type){case"number":ret=numberCache[obj];if(!ret)ret=numberCache[obj]="nu"+obj;return ret;case"string":ret=stringCache[obj];if(!ret)ret=stringCache[obj]="st"+uuid++;return ret;case"boolean":return obj?"(true)":"(false)";default:if(obj[GUID_KEY])return obj[GUID_KEY];if(obj===Object)return"(Object)";if(obj===Array)return"(Array)";ret="ember"+uuid++;GUID_DESC.value=ret;o_defineProperty(obj,GUID_KEY,GUID_DESC);return ret}};var META_DESC=Ember.META_DESC={writable:true,configurable:false,enumerable:false,value:null};var META_KEY=Ember.GUID_KEY+"_meta";Ember.META_KEY=META_KEY;var isDefinePropertySimulated=Ember.platform.defineProperty.isSimulated;function Meta(obj){this.descs={};this.watching={};this.cache={};this.source=obj}Meta.prototype={descs:null,deps:null,watching:null,listeners:null,cache:null,source:null,mixins:null,bindings:null,chains:null,chainWatchers:null,values:null,proto:null};if(isDefinePropertySimulated){Meta.prototype.__preventPlainObject__=true;Meta.prototype.toJSON=function(){}}var EMPTY_META=new Meta(null);if(MANDATORY_SETTER){EMPTY_META.values={}}Ember.EMPTY_META=EMPTY_META;Ember.meta=function meta(obj,writable){var ret=obj[META_KEY];if(writable===false)return ret||EMPTY_META;if(!ret){if(!isDefinePropertySimulated)o_defineProperty(obj,META_KEY,META_DESC);ret=new Meta(obj);if(MANDATORY_SETTER){ret.values={}}obj[META_KEY]=ret;ret.descs.constructor=null}else if(ret.source!==obj){if(!isDefinePropertySimulated)o_defineProperty(obj,META_KEY,META_DESC);ret=o_create(ret);ret.descs=o_create(ret.descs);ret.watching=o_create(ret.watching);ret.cache={};ret.source=obj;if(MANDATORY_SETTER){ret.values=o_create(ret.values)}obj[META_KEY]=ret}return ret};Ember.getMeta=function getMeta(obj,property){var meta=Ember.meta(obj,false);return meta[property]};Ember.setMeta=function setMeta(obj,property,value){var meta=Ember.meta(obj,true);meta[property]=value;return value};Ember.metaPath=function metaPath(obj,path,writable){var meta=Ember.meta(obj,writable),keyName,value;for(var i=0,l=path.length;i<l;i++){keyName=path[i];value=meta[keyName];if(!value){if(!writable){return undefined}value=meta[keyName]={__ember_source__:obj}}else if(value.__ember_source__!==obj){if(!writable){return undefined}value=meta[keyName]=o_create(value);value.__ember_source__=obj}meta=value}return value};Ember.wrap=function(func,superFunc){function K(){}function superWrapper(){var ret,sup=this._super;this._super=superFunc||K;ret=func.apply(this,arguments);this._super=sup;return ret}superWrapper.wrappedFunction=func;superWrapper.__ember_observes__=func.__ember_observes__;superWrapper.__ember_observesBefore__=func.__ember_observesBefore__;superWrapper.__ember_listens__=func.__ember_listens__;return superWrapper};Ember.isArray=function(obj){if(!obj||obj.setInterval){return false}if(Array.isArray&&Array.isArray(obj)){return true}if(Ember.Array&&Ember.Array.detect(obj)){return true}if(obj.length!==undefined&&"object"===typeof obj){return true}return false};Ember.makeArray=function(obj){if(obj===null||obj===undefined){return[]}return Ember.isArray(obj)?obj:[obj]};function canInvoke(obj,methodName){return!!(obj&&typeof obj[methodName]==="function")}Ember.canInvoke=canInvoke;Ember.tryInvoke=function(obj,methodName,args){if(canInvoke(obj,methodName)){return obj[methodName].apply(obj,args||[])}};var needsFinallyFix=function(){var count=0;try{try{}finally{count++;throw new Error("needsFinallyFixTest")}}catch(e){}return count!==1}();if(needsFinallyFix){Ember.tryFinally=function(tryable,finalizer,binding){var result,finalResult,finalError;binding=binding||this;try{result=tryable.call(binding)}finally{try{finalResult=finalizer.call(binding)}catch(e){finalError=e}}if(finalError){throw finalError}return finalResult===undefined?result:finalResult}}else{Ember.tryFinally=function(tryable,finalizer,binding){var result,finalResult;binding=binding||this;try{result=tryable.call(binding)}finally{finalResult=finalizer.call(binding)}return finalResult===undefined?result:finalResult}}if(needsFinallyFix){Ember.tryCatchFinally=function(tryable,catchable,finalizer,binding){var result,finalResult,finalError;binding=binding||this;try{result=tryable.call(binding)}catch(error){result=catchable.call(binding,error)}finally{try{finalResult=finalizer.call(binding)}catch(e){finalError=e}}if(finalError){throw finalError}return finalResult===undefined?result:finalResult}}else{Ember.tryCatchFinally=function(tryable,catchable,finalizer,binding){var result,finalResult;binding=binding||this;try{result=tryable.call(binding)}catch(error){result=catchable.call(binding,error)}finally{finalResult=finalizer.call(binding)}return finalResult===undefined?result:finalResult}}var TYPE_MAP={};var t="Boolean Number String Function Array Date RegExp Object".split(" ");Ember.ArrayPolyfills.forEach.call(t,function(name){TYPE_MAP["[object "+name+"]"]=name.toLowerCase()});var toString=Object.prototype.toString;Ember.typeOf=function(item){var ret;ret=item===null||item===undefined?String(item):TYPE_MAP[toString.call(item)]||"object";if(ret==="function"){if(Ember.Object&&Ember.Object.detect(item))ret="class"}else if(ret==="object"){if(item instanceof Error)ret="error";else if(Ember.Object&&item instanceof Ember.Object)ret="instance";else if(item instanceof Date)ret="date"}return ret};Ember.inspect=function(obj){var type=Ember.typeOf(obj);if(type==="array"){return"["+obj+"]"}if(type!=="object"){return obj+""}var v,ret=[];for(var key in obj){if(obj.hasOwnProperty(key)){v=obj[key];if(v==="toString"){continue}if(Ember.typeOf(v)==="function"){v="function() { ... }"}ret.push(key+": "+v)}}return"{"+ret.join(", ")+"}"}})();(function(){Ember.Instrumentation={};var subscribers=[],cache={};var populateListeners=function(name){var listeners=[],subscriber;for(var i=0,l=subscribers.length;i<l;i++){subscriber=subscribers[i];if(subscriber.regex.test(name)){listeners.push(subscriber.object)}}cache[name]=listeners;return listeners};var time=function(){var perf="undefined"!==typeof window?window.performance||{}:{};var fn=perf.now||perf.mozNow||perf.webkitNow||perf.msNow||perf.oNow;return fn?fn.bind(perf):function(){return+new Date}}();Ember.Instrumentation.instrument=function(name,payload,callback,binding){var listeners=cache[name],timeName,ret;if(Ember.STRUCTURED_PROFILE){timeName=name+": "+payload.object;console.time(timeName)}if(!listeners){listeners=populateListeners(name)}if(listeners.length===0){ret=callback.call(binding);if(Ember.STRUCTURED_PROFILE){console.timeEnd(timeName)}return ret}var beforeValues=[],listener,i,l;function tryable(){for(i=0,l=listeners.length;i<l;i++){listener=listeners[i];beforeValues[i]=listener.before(name,time(),payload)}return callback.call(binding)}function catchable(e){payload=payload||{};payload.exception=e}function finalizer(){for(i=0,l=listeners.length;i<l;i++){listener=listeners[i];listener.after(name,time(),payload,beforeValues[i])}if(Ember.STRUCTURED_PROFILE){console.timeEnd(timeName)}}return Ember.tryCatchFinally(tryable,catchable,finalizer)};Ember.Instrumentation.subscribe=function(pattern,object){var paths=pattern.split("."),path,regex=[];for(var i=0,l=paths.length;i<l;i++){path=paths[i];if(path==="*"){regex.push("[^\\.]*")}else{regex.push(path)}}regex=regex.join("\\.");regex=regex+"(\\..*)?";var subscriber={pattern:pattern,regex:new RegExp("^"+regex+"$"),object:object};subscribers.push(subscriber);cache={};return subscriber};Ember.Instrumentation.unsubscribe=function(subscriber){var index;for(var i=0,l=subscribers.length;i<l;i++){if(subscribers[i]===subscriber){index=i}}subscribers.splice(index,1);cache={}};Ember.Instrumentation.reset=function(){subscribers=[];cache={}};Ember.instrument=Ember.Instrumentation.instrument;Ember.subscribe=Ember.Instrumentation.subscribe})();(function(){var map,forEach,indexOf,splice,filter;map=Array.prototype.map||Ember.ArrayPolyfills.map;forEach=Array.prototype.forEach||Ember.ArrayPolyfills.forEach;indexOf=Array.prototype.indexOf||Ember.ArrayPolyfills.indexOf;filter=Array.prototype.filter||Ember.ArrayPolyfills.filter;splice=Array.prototype.splice;var utils=Ember.EnumerableUtils={map:function(obj,callback,thisArg){return obj.map?obj.map.call(obj,callback,thisArg):map.call(obj,callback,thisArg)},forEach:function(obj,callback,thisArg){return obj.forEach?obj.forEach.call(obj,callback,thisArg):forEach.call(obj,callback,thisArg)},filter:function(obj,callback,thisArg){return obj.filter?obj.filter.call(obj,callback,thisArg):filter.call(obj,callback,thisArg)},indexOf:function(obj,element,index){return obj.indexOf?obj.indexOf.call(obj,element,index):indexOf.call(obj,element,index)},indexesOf:function(obj,elements){return elements===undefined?[]:utils.map(elements,function(item){return utils.indexOf(obj,item)})},addObject:function(array,item){var index=utils.indexOf(array,item);if(index===-1){array.push(item)}},removeObject:function(array,item){var index=utils.indexOf(array,item);if(index!==-1){array.splice(index,1)}},_replace:function(array,idx,amt,objects){var args=[].concat(objects),chunk,ret=[],size=6e4,start=idx,ends=amt,count;while(args.length){count=ends>size?size:ends;if(count<=0){count=0}chunk=args.splice(0,size);chunk=[start,count].concat(chunk);start+=size;ends-=count;ret=ret.concat(splice.apply(array,chunk))}return ret},replace:function(array,idx,amt,objects){if(array.replace){return array.replace(idx,amt,objects)}else{return utils._replace(array,idx,amt,objects)}},intersection:function(array1,array2){var intersection=[];utils.forEach(array1,function(element){if(utils.indexOf(array2,element)>=0){intersection.push(element)}});return intersection}}})();(function(){var META_KEY=Ember.META_KEY,get;var MANDATORY_SETTER=Ember.ENV.MANDATORY_SETTER;var IS_GLOBAL_PATH=/^([A-Z$]|([0-9][A-Z$])).*[\.\*]/;var HAS_THIS=/^this[\.\*]/;var FIRST_KEY=/^([^\.\*]+)/;get=function get(obj,keyName){if(keyName===""){return obj}if(!keyName&&"string"===typeof obj){keyName=obj;obj=null}if(obj===null||keyName.indexOf(".")!==-1){return getPath(obj,keyName)}var meta=obj[META_KEY],desc=meta&&meta.descs[keyName],ret;if(desc){return desc.get(obj,keyName)}else{if(MANDATORY_SETTER&&meta&&meta.watching[keyName]>0){ret=meta.values[keyName]}else{ret=obj[keyName]}if(ret===undefined&&"object"===typeof obj&&!(keyName in obj)&&"function"===typeof obj.unknownProperty){return obj.unknownProperty(keyName)}return ret}};if(Ember.config.overrideAccessors){Ember.get=get;Ember.config.overrideAccessors();get=Ember.get}var normalizeTuple=Ember.normalizeTuple=function(target,path){var hasThis=HAS_THIS.test(path),isGlobal=!hasThis&&IS_GLOBAL_PATH.test(path),key;if(!target||isGlobal)target=Ember.lookup;if(hasThis)path=path.slice(5);if(target===Ember.lookup){key=path.match(FIRST_KEY)[0];target=get(target,key);path=path.slice(key.length+1)}if(!path||path.length===0)throw new Ember.Error("Path cannot be empty");return[target,path]};var getPath=Ember._getPath=function(root,path){var hasThis,parts,tuple,idx,len;if(root===null&&path.indexOf(".")===-1){return get(Ember.lookup,path)}hasThis=HAS_THIS.test(path);if(!root||hasThis){tuple=normalizeTuple(root,path);root=tuple[0];path=tuple[1];tuple.length=0}parts=path.split(".");len=parts.length;for(idx=0;root!=null&&idx<len;idx++){root=get(root,parts[idx],true);if(root&&root.isDestroyed){return undefined}}return root};Ember.getWithDefault=function(root,key,defaultValue){var value=get(root,key);if(value===undefined){return defaultValue}return value};Ember.get=get})();(function(){var o_create=Ember.create,metaFor=Ember.meta,META_KEY=Ember.META_KEY,a_slice=[].slice,ONCE=1,SUSPENDED=2;function indexOf(array,target,method){var index=-1;for(var i=0,l=array.length;i<l;i+=3){if(target===array[i]&&method===array[i+1]){index=i;break}}return index}function actionsFor(obj,eventName){var meta=metaFor(obj,true),actions;if(!meta.listeners){meta.listeners={}}if(!meta.hasOwnProperty("listeners")){meta.listeners=o_create(meta.listeners)}actions=meta.listeners[eventName];if(actions&&!meta.listeners.hasOwnProperty(eventName)){actions=meta.listeners[eventName]=meta.listeners[eventName].slice()}else if(!actions){actions=meta.listeners[eventName]=[]}return actions}function actionsUnion(obj,eventName,otherActions){var meta=obj[META_KEY],actions=meta&&meta.listeners&&meta.listeners[eventName];if(!actions){return}for(var i=actions.length-3;i>=0;i-=3){var target=actions[i],method=actions[i+1],flags=actions[i+2],actionIndex=indexOf(otherActions,target,method);if(actionIndex===-1){otherActions.push(target,method,flags)}}}function actionsDiff(obj,eventName,otherActions){var meta=obj[META_KEY],actions=meta&&meta.listeners&&meta.listeners[eventName],diffActions=[];if(!actions){return}for(var i=actions.length-3;i>=0;i-=3){var target=actions[i],method=actions[i+1],flags=actions[i+2],actionIndex=indexOf(otherActions,target,method);if(actionIndex!==-1){continue}otherActions.push(target,method,flags);diffActions.push(target,method,flags)}return diffActions}function addListener(obj,eventName,target,method,once){if(!method&&"function"===typeof target){method=target;target=null}var actions=actionsFor(obj,eventName),actionIndex=indexOf(actions,target,method),flags=0;if(once)flags|=ONCE;if(actionIndex!==-1){return}actions.push(target,method,flags);if("function"===typeof obj.didAddListener){obj.didAddListener(eventName,target,method)}}function removeListener(obj,eventName,target,method){if(!method&&"function"===typeof target){method=target;target=null}function _removeListener(target,method){var actions=actionsFor(obj,eventName),actionIndex=indexOf(actions,target,method);if(actionIndex===-1){return}actions.splice(actionIndex,3);if("function"===typeof obj.didRemoveListener){obj.didRemoveListener(eventName,target,method)}}if(method){_removeListener(target,method)}else{var meta=obj[META_KEY],actions=meta&&meta.listeners&&meta.listeners[eventName];if(!actions){return}for(var i=actions.length-3;i>=0;i-=3){_removeListener(actions[i],actions[i+1])}}}function suspendListener(obj,eventName,target,method,callback){if(!method&&"function"===typeof target){method=target;target=null}var actions=actionsFor(obj,eventName),actionIndex=indexOf(actions,target,method);if(actionIndex!==-1){actions[actionIndex+2]|=SUSPENDED}function tryable(){return callback.call(target)}function finalizer(){if(actionIndex!==-1){actions[actionIndex+2]&=~SUSPENDED}}return Ember.tryFinally(tryable,finalizer)}function suspendListeners(obj,eventNames,target,method,callback){if(!method&&"function"===typeof target){method=target;target=null}var suspendedActions=[],actionsList=[],eventName,actions,i,l;for(i=0,l=eventNames.length;i<l;i++){eventName=eventNames[i];actions=actionsFor(obj,eventName);var actionIndex=indexOf(actions,target,method);if(actionIndex!==-1){actions[actionIndex+2]|=SUSPENDED;suspendedActions.push(actionIndex);actionsList.push(actions)}}function tryable(){return callback.call(target)}function finalizer(){for(var i=0,l=suspendedActions.length;i<l;i++){var actionIndex=suspendedActions[i];actionsList[i][actionIndex+2]&=~SUSPENDED}}return Ember.tryFinally(tryable,finalizer)}function watchedEvents(obj){var listeners=obj[META_KEY].listeners,ret=[];if(listeners){for(var eventName in listeners){if(listeners[eventName]){ret.push(eventName)}}}return ret}function sendEvent(obj,eventName,params,actions){if(obj!==Ember&&"function"===typeof obj.sendEvent){obj.sendEvent(eventName,params)}if(!actions){var meta=obj[META_KEY];actions=meta&&meta.listeners&&meta.listeners[eventName]}if(!actions){return}for(var i=actions.length-3;i>=0;i-=3){var target=actions[i],method=actions[i+1],flags=actions[i+2];if(!method){continue}if(flags&SUSPENDED){continue}if(flags&ONCE){removeListener(obj,eventName,target,method)}if(!target){target=obj}if("string"===typeof method){method=target[method]}if(params){method.apply(target,params)}else{method.call(target)}}return true}function hasListeners(obj,eventName){var meta=obj[META_KEY],actions=meta&&meta.listeners&&meta.listeners[eventName];return!!(actions&&actions.length)}function listenersFor(obj,eventName){var ret=[];var meta=obj[META_KEY],actions=meta&&meta.listeners&&meta.listeners[eventName];if(!actions){return ret}for(var i=0,l=actions.length;i<l;i+=3){var target=actions[i],method=actions[i+1];ret.push([target,method])}return ret}Ember.on=function(){var func=a_slice.call(arguments,-1)[0],events=a_slice.call(arguments,0,-1);func.__ember_listens__=events;return func};Ember.addListener=addListener;Ember.removeListener=removeListener;Ember._suspendListener=suspendListener;Ember._suspendListeners=suspendListeners;Ember.sendEvent=sendEvent;Ember.hasListeners=hasListeners;Ember.watchedEvents=watchedEvents;Ember.listenersFor=listenersFor;Ember.listenersDiff=actionsDiff;Ember.listenersUnion=actionsUnion})();(function(){var guidFor=Ember.guidFor,sendEvent=Ember.sendEvent;var ObserverSet=Ember._ObserverSet=function(){this.clear()};ObserverSet.prototype.add=function(sender,keyName,eventName){var observerSet=this.observerSet,observers=this.observers,senderGuid=guidFor(sender),keySet=observerSet[senderGuid],index;if(!keySet){observerSet[senderGuid]=keySet={}}index=keySet[keyName];if(index===undefined){index=observers.push({sender:sender,keyName:keyName,eventName:eventName,listeners:[]})-1;keySet[keyName]=index}return observers[index].listeners};ObserverSet.prototype.flush=function(){var observers=this.observers,i,len,observer,sender;this.clear();for(i=0,len=observers.length;i<len;++i){observer=observers[i];sender=observer.sender;if(sender.isDestroying||sender.isDestroyed){continue}sendEvent(sender,observer.eventName,[sender,observer.keyName],observer.listeners)}};ObserverSet.prototype.clear=function(){this.observerSet={};this.observers=[]}})();(function(){var META_KEY=Ember.META_KEY,guidFor=Ember.guidFor,tryFinally=Ember.tryFinally,sendEvent=Ember.sendEvent,listenersUnion=Ember.listenersUnion,listenersDiff=Ember.listenersDiff,ObserverSet=Ember._ObserverSet,beforeObserverSet=new ObserverSet,observerSet=new ObserverSet,deferred=0;function propertyWillChange(obj,keyName){var m=obj[META_KEY],watching=m&&m.watching[keyName]>0||keyName==="length",proto=m&&m.proto,desc=m&&m.descs[keyName];if(!watching){return}if(proto===obj){return}if(desc&&desc.willChange){desc.willChange(obj,keyName)}dependentKeysWillChange(obj,keyName,m);chainsWillChange(obj,keyName,m);notifyBeforeObservers(obj,keyName)}Ember.propertyWillChange=propertyWillChange;function propertyDidChange(obj,keyName){var m=obj[META_KEY],watching=m&&m.watching[keyName]>0||keyName==="length",proto=m&&m.proto,desc=m&&m.descs[keyName];if(proto===obj){return}if(desc&&desc.didChange){desc.didChange(obj,keyName)}if(!watching&&keyName!=="length"){return}dependentKeysDidChange(obj,keyName,m)
;chainsDidChange(obj,keyName,m,false);notifyObservers(obj,keyName)}Ember.propertyDidChange=propertyDidChange;var WILL_SEEN,DID_SEEN;function dependentKeysWillChange(obj,depKey,meta){if(obj.isDestroying){return}var seen=WILL_SEEN,top=!seen;if(top){seen=WILL_SEEN={}}iterDeps(propertyWillChange,obj,depKey,seen,meta);if(top){WILL_SEEN=null}}function dependentKeysDidChange(obj,depKey,meta){if(obj.isDestroying){return}var seen=DID_SEEN,top=!seen;if(top){seen=DID_SEEN={}}iterDeps(propertyDidChange,obj,depKey,seen,meta);if(top){DID_SEEN=null}}function iterDeps(method,obj,depKey,seen,meta){var guid=guidFor(obj);if(!seen[guid])seen[guid]={};if(seen[guid][depKey])return;seen[guid][depKey]=true;var deps=meta.deps;deps=deps&&deps[depKey];if(deps){for(var key in deps){var desc=meta.descs[key];if(desc&&desc._suspended===obj)continue;method(obj,key)}}}function chainsWillChange(obj,keyName,m){if(!(m.hasOwnProperty("chainWatchers")&&m.chainWatchers[keyName])){return}var nodes=m.chainWatchers[keyName],events=[],i,l;for(i=0,l=nodes.length;i<l;i++){nodes[i].willChange(events)}for(i=0,l=events.length;i<l;i+=2){propertyWillChange(events[i],events[i+1])}}function chainsDidChange(obj,keyName,m,suppressEvents){if(!(m&&m.hasOwnProperty("chainWatchers")&&m.chainWatchers[keyName])){return}var nodes=m.chainWatchers[keyName],events=suppressEvents?null:[],i,l;for(i=0,l=nodes.length;i<l;i++){nodes[i].didChange(events)}if(suppressEvents){return}for(i=0,l=events.length;i<l;i+=2){propertyDidChange(events[i],events[i+1])}}Ember.overrideChains=function(obj,keyName,m){chainsDidChange(obj,keyName,m,true)};function beginPropertyChanges(){deferred++}Ember.beginPropertyChanges=beginPropertyChanges;function endPropertyChanges(){deferred--;if(deferred<=0){beforeObserverSet.clear();observerSet.flush()}}Ember.endPropertyChanges=endPropertyChanges;Ember.changeProperties=function(cb,binding){beginPropertyChanges();tryFinally(cb,endPropertyChanges,binding)};function notifyBeforeObservers(obj,keyName){if(obj.isDestroying){return}var eventName=keyName+":before",listeners,diff;if(deferred){listeners=beforeObserverSet.add(obj,keyName,eventName);diff=listenersDiff(obj,eventName,listeners);sendEvent(obj,eventName,[obj,keyName],diff)}else{sendEvent(obj,eventName,[obj,keyName])}}function notifyObservers(obj,keyName){if(obj.isDestroying){return}var eventName=keyName+":change",listeners;if(deferred){listeners=observerSet.add(obj,keyName,eventName);listenersUnion(obj,eventName,listeners)}else{sendEvent(obj,eventName,[obj,keyName])}}})();(function(){var META_KEY=Ember.META_KEY,MANDATORY_SETTER=Ember.ENV.MANDATORY_SETTER,IS_GLOBAL=/^([A-Z$]|([0-9][A-Z$]))/,getPath=Ember._getPath;var set=function set(obj,keyName,value,tolerant){if(typeof obj==="string"){value=keyName;keyName=obj;obj=null}if(!obj||keyName.indexOf(".")!==-1){return setPath(obj,keyName,value,tolerant)}var meta=obj[META_KEY],desc=meta&&meta.descs[keyName],isUnknown,currentValue;if(desc){desc.set(obj,keyName,value)}else{isUnknown="object"===typeof obj&&!(keyName in obj);if(isUnknown&&"function"===typeof obj.setUnknownProperty){obj.setUnknownProperty(keyName,value)}else if(meta&&meta.watching[keyName]>0){if(MANDATORY_SETTER){currentValue=meta.values[keyName]}else{currentValue=obj[keyName]}if(value!==currentValue){Ember.propertyWillChange(obj,keyName);if(MANDATORY_SETTER){if(currentValue===undefined&&!(keyName in obj)||!obj.propertyIsEnumerable(keyName)){Ember.defineProperty(obj,keyName,null,value)}else{meta.values[keyName]=value}}else{obj[keyName]=value}Ember.propertyDidChange(obj,keyName)}}else{obj[keyName]=value}}return value};if(Ember.config.overrideAccessors){Ember.set=set;Ember.config.overrideAccessors();set=Ember.set}function setPath(root,path,value,tolerant){var keyName;keyName=path.slice(path.lastIndexOf(".")+1);path=path===keyName?keyName:path.slice(0,path.length-(keyName.length+1));if(path!=="this"){root=getPath(root,path)}if(!keyName||keyName.length===0){throw new Ember.Error("Property set failed: You passed an empty path")}if(!root){if(tolerant){return}else{throw new Ember.Error('Property set failed: object in path "'+path+'" could not be found or was destroyed.')}}return set(root,keyName,value)}Ember.set=set;Ember.trySet=function(root,path,value){return set(root,path,value,true)}})();(function(){var set=Ember.set,guidFor=Ember.guidFor,indexOf=Ember.ArrayPolyfills.indexOf;var copy=function(obj){var output={};for(var prop in obj){if(obj.hasOwnProperty(prop)){output[prop]=obj[prop]}}return output};var copyMap=function(original,newObject){var keys=original.keys.copy(),values=copy(original.values);newObject.keys=keys;newObject.values=values;newObject.length=original.length;return newObject};var OrderedSet=Ember.OrderedSet=function(){this.clear()};OrderedSet.create=function(){return new OrderedSet};OrderedSet.prototype={clear:function(){this.presenceSet={};this.list=[]},add:function(obj){var guid=guidFor(obj),presenceSet=this.presenceSet,list=this.list;if(guid in presenceSet){return}presenceSet[guid]=true;list.push(obj)},remove:function(obj){var guid=guidFor(obj),presenceSet=this.presenceSet,list=this.list;delete presenceSet[guid];var index=indexOf.call(list,obj);if(index>-1){list.splice(index,1)}},isEmpty:function(){return this.list.length===0},has:function(obj){var guid=guidFor(obj),presenceSet=this.presenceSet;return guid in presenceSet},forEach:function(fn,self){var list=this.toArray();for(var i=0,j=list.length;i<j;i++){fn.call(self,list[i])}},toArray:function(){return this.list.slice()},copy:function(){var set=new OrderedSet;set.presenceSet=copy(this.presenceSet);set.list=this.toArray();return set}};var Map=Ember.Map=function(){this.keys=Ember.OrderedSet.create();this.values={}};Map.create=function(){return new Map};Map.prototype={length:0,get:function(key){var values=this.values,guid=guidFor(key);return values[guid]},set:function(key,value){var keys=this.keys,values=this.values,guid=guidFor(key);keys.add(key);values[guid]=value;set(this,"length",keys.list.length)},remove:function(key){var keys=this.keys,values=this.values,guid=guidFor(key);if(values.hasOwnProperty(guid)){keys.remove(key);delete values[guid];set(this,"length",keys.list.length);return true}else{return false}},has:function(key){var values=this.values,guid=guidFor(key);return values.hasOwnProperty(guid)},forEach:function(callback,self){var keys=this.keys,values=this.values;keys.forEach(function(key){var guid=guidFor(key);callback.call(self,key,values[guid])})},copy:function(){return copyMap(this,new Map)}};var MapWithDefault=Ember.MapWithDefault=function(options){Map.call(this);this.defaultValue=options.defaultValue};MapWithDefault.create=function(options){if(options){return new MapWithDefault(options)}else{return new Map}};MapWithDefault.prototype=Ember.create(Map.prototype);MapWithDefault.prototype.get=function(key){var hasValue=this.has(key);if(hasValue){return Map.prototype.get.call(this,key)}else{var defaultValue=this.defaultValue(key);this.set(key,defaultValue);return defaultValue}};MapWithDefault.prototype.copy=function(){return copyMap(this,new MapWithDefault({defaultValue:this.defaultValue}))}})();(function(){function consoleMethod(name){var consoleObj,logToConsole;if(Ember.imports.console){consoleObj=Ember.imports.console}else if(typeof console!=="undefined"){consoleObj=console}var method=typeof consoleObj==="object"?consoleObj[name]:null;if(method){if(method.apply){logToConsole=function(){method.apply(consoleObj,arguments)};logToConsole.displayName="console."+name;return logToConsole}else{return function(){var message=Array.prototype.join.call(arguments,", ");method(message)}}}}function assertPolyfill(test,message){if(!test){try{throw new Ember.Error("assertion failed: "+message)}catch(error){setTimeout(function(){throw error},0)}}}Ember.Logger={log:consoleMethod("log")||Ember.K,warn:consoleMethod("warn")||Ember.K,error:consoleMethod("error")||Ember.K,info:consoleMethod("info")||Ember.K,debug:consoleMethod("debug")||consoleMethod("info")||Ember.K,assert:consoleMethod("assert")||assertPolyfill}})();(function(){var META_KEY=Ember.META_KEY,metaFor=Ember.meta,objectDefineProperty=Ember.platform.defineProperty;var MANDATORY_SETTER=Ember.ENV.MANDATORY_SETTER;Ember.Descriptor=function(){};var MANDATORY_SETTER_FUNCTION=Ember.MANDATORY_SETTER_FUNCTION=function(value){};var DEFAULT_GETTER_FUNCTION=Ember.DEFAULT_GETTER_FUNCTION=function(name){return function(){var meta=this[META_KEY];return meta&&meta.values[name]}};Ember.defineProperty=function(obj,keyName,desc,data,meta){var descs,existingDesc,watching,value;if(!meta)meta=metaFor(obj);descs=meta.descs;existingDesc=meta.descs[keyName];watching=meta.watching[keyName]>0;if(existingDesc instanceof Ember.Descriptor){existingDesc.teardown(obj,keyName)}if(desc instanceof Ember.Descriptor){value=desc;descs[keyName]=desc;if(MANDATORY_SETTER&&watching){objectDefineProperty(obj,keyName,{configurable:true,enumerable:true,writable:true,value:undefined})}else{obj[keyName]=undefined}if(desc.func&&desc._dependentCPs){addImplicitCPs(obj,desc._dependentCPs,meta)}}else{descs[keyName]=undefined;if(desc==null){value=data;if(MANDATORY_SETTER&&watching){meta.values[keyName]=data;objectDefineProperty(obj,keyName,{configurable:true,enumerable:true,set:MANDATORY_SETTER_FUNCTION,get:DEFAULT_GETTER_FUNCTION(keyName)})}else{obj[keyName]=data}}else{value=desc;objectDefineProperty(obj,keyName,desc)}}if(watching){Ember.overrideChains(obj,keyName,meta)}if(obj.didDefineProperty){obj.didDefineProperty(obj,keyName,value)}return this};var addImplicitCPs=function defineImplicitCPs(obj,implicitCPs,meta){var cp,key,length=implicitCPs.length;for(var i=0;i<length;++i){cp=implicitCPs[i];key=cp.implicitCPKey;Ember.defineProperty(obj,key,cp,undefined,meta);if(cp._dependentCPs){addImplicitCPs(obj,cp._dependentCPs,meta)}}}})();(function(){var get=Ember.get;Ember.getProperties=function(obj){var ret={},propertyNames=arguments,i=1;if(arguments.length===2&&Ember.typeOf(arguments[1])==="array"){i=0;propertyNames=arguments[1]}for(var len=propertyNames.length;i<len;i++){ret[propertyNames[i]]=get(obj,propertyNames[i])}return ret}})();(function(){var changeProperties=Ember.changeProperties,set=Ember.set;Ember.setProperties=function(self,hash){changeProperties(function(){for(var prop in hash){if(hash.hasOwnProperty(prop)){set(self,prop,hash[prop])}}});return self}})();(function(){var metaFor=Ember.meta,typeOf=Ember.typeOf,MANDATORY_SETTER=Ember.ENV.MANDATORY_SETTER,o_defineProperty=Ember.platform.defineProperty;Ember.watchKey=function(obj,keyName,meta){if(keyName==="length"&&typeOf(obj)==="array"){return}var m=meta||metaFor(obj),watching=m.watching;if(!watching[keyName]){watching[keyName]=1;if("function"===typeof obj.willWatchProperty){obj.willWatchProperty(keyName)}if(MANDATORY_SETTER&&keyName in obj){m.values[keyName]=obj[keyName];o_defineProperty(obj,keyName,{configurable:true,enumerable:obj.propertyIsEnumerable(keyName),set:Ember.MANDATORY_SETTER_FUNCTION,get:Ember.DEFAULT_GETTER_FUNCTION(keyName)})}}else{watching[keyName]=(watching[keyName]||0)+1}};Ember.unwatchKey=function(obj,keyName,meta){var m=meta||metaFor(obj),watching=m.watching;if(watching[keyName]===1){watching[keyName]=0;if("function"===typeof obj.didUnwatchProperty){obj.didUnwatchProperty(keyName)}if(MANDATORY_SETTER&&keyName in obj){o_defineProperty(obj,keyName,{configurable:true,enumerable:obj.propertyIsEnumerable(keyName),set:function(val){o_defineProperty(obj,keyName,{configurable:true,writable:true,enumerable:true,value:val});delete m.values[keyName]},get:Ember.DEFAULT_GETTER_FUNCTION(keyName)})}}else if(watching[keyName]>1){watching[keyName]--}}})();(function(){var metaFor=Ember.meta,get=Ember.get,normalizeTuple=Ember.normalizeTuple,forEach=Ember.ArrayPolyfills.forEach,warn=Ember.warn,watchKey=Ember.watchKey,unwatchKey=Ember.unwatchKey,FIRST_KEY=/^([^\.\*]+)/,META_KEY=Ember.META_KEY;function firstKey(path){return path.match(FIRST_KEY)[0]}var pendingQueue=[];Ember.flushPendingChains=function(){if(pendingQueue.length===0){return}var queue=pendingQueue;pendingQueue=[];forEach.call(queue,function(q){q[0].add(q[1])});warn("Watching an undefined global, Ember expects watched globals to be setup by the time the run loop is flushed, check for typos",pendingQueue.length===0)};function addChainWatcher(obj,keyName,node){if(!obj||"object"!==typeof obj){return}var m=metaFor(obj),nodes=m.chainWatchers;if(!m.hasOwnProperty("chainWatchers")){nodes=m.chainWatchers={}}if(!nodes[keyName]){nodes[keyName]=[]}nodes[keyName].push(node);watchKey(obj,keyName,m)}var removeChainWatcher=Ember.removeChainWatcher=function(obj,keyName,node){if(!obj||"object"!==typeof obj){return}var m=obj[META_KEY];if(m&&!m.hasOwnProperty("chainWatchers")){return}var nodes=m&&m.chainWatchers;if(nodes&&nodes[keyName]){nodes=nodes[keyName];for(var i=0,l=nodes.length;i<l;i++){if(nodes[i]===node){nodes.splice(i,1)}}}unwatchKey(obj,keyName,m)};var ChainNode=Ember._ChainNode=function(parent,key,value){this._parent=parent;this._key=key;this._watching=value===undefined;this._value=value;this._paths={};if(this._watching){this._object=parent.value();if(this._object){addChainWatcher(this._object,this._key,this)}}if(this._parent&&this._parent._key==="@each"){this.value()}};var ChainNodePrototype=ChainNode.prototype;function lazyGet(obj,key){if(!obj)return undefined;var meta=obj[META_KEY];if(meta&&meta.proto===obj)return undefined;if(key==="@each")return get(obj,key);var desc=meta&&meta.descs[key];if(desc&&desc._cacheable){if(key in meta.cache){return meta.cache[key]}else{return undefined}}return get(obj,key)}ChainNodePrototype.value=function(){if(this._value===undefined&&this._watching){var obj=this._parent.value();this._value=lazyGet(obj,this._key)}return this._value};ChainNodePrototype.destroy=function(){if(this._watching){var obj=this._object;if(obj){removeChainWatcher(obj,this._key,this)}this._watching=false}};ChainNodePrototype.copy=function(obj){var ret=new ChainNode(null,null,obj),paths=this._paths,path;for(path in paths){if(paths[path]<=0){continue}ret.add(path)}return ret};ChainNodePrototype.add=function(path){var obj,tuple,key,src,paths;paths=this._paths;paths[path]=(paths[path]||0)+1;obj=this.value();tuple=normalizeTuple(obj,path);if(tuple[0]&&tuple[0]===obj){path=tuple[1];key=firstKey(path);path=path.slice(key.length+1)}else if(!tuple[0]){pendingQueue.push([this,path]);tuple.length=0;return}else{src=tuple[0];key=path.slice(0,0-(tuple[1].length+1));path=tuple[1]}tuple.length=0;this.chain(key,path,src)};ChainNodePrototype.remove=function(path){var obj,tuple,key,src,paths;paths=this._paths;if(paths[path]>0){paths[path]--}obj=this.value();tuple=normalizeTuple(obj,path);if(tuple[0]===obj){path=tuple[1];key=firstKey(path);path=path.slice(key.length+1)}else{src=tuple[0];key=path.slice(0,0-(tuple[1].length+1));path=tuple[1]}tuple.length=0;this.unchain(key,path)};ChainNodePrototype.count=0;ChainNodePrototype.chain=function(key,path,src){var chains=this._chains,node;if(!chains){chains=this._chains={}}node=chains[key];if(!node){node=chains[key]=new ChainNode(this,key,src)}node.count++;if(path&&path.length>0){key=firstKey(path);path=path.slice(key.length+1);node.chain(key,path)}};ChainNodePrototype.unchain=function(key,path){var chains=this._chains,node=chains[key];if(path&&path.length>1){key=firstKey(path);path=path.slice(key.length+1);node.unchain(key,path)}node.count--;if(node.count<=0){delete chains[node._key];node.destroy()}};ChainNodePrototype.willChange=function(events){var chains=this._chains;if(chains){for(var key in chains){if(!chains.hasOwnProperty(key)){continue}chains[key].willChange(events)}}if(this._parent){this._parent.chainWillChange(this,this._key,1,events)}};ChainNodePrototype.chainWillChange=function(chain,path,depth,events){if(this._key){path=this._key+"."+path}if(this._parent){this._parent.chainWillChange(this,path,depth+1,events)}else{if(depth>1){events.push(this.value(),path)}path="this."+path;if(this._paths[path]>0){events.push(this.value(),path)}}};ChainNodePrototype.chainDidChange=function(chain,path,depth,events){if(this._key){path=this._key+"."+path}if(this._parent){this._parent.chainDidChange(this,path,depth+1,events)}else{if(depth>1){events.push(this.value(),path)}path="this."+path;if(this._paths[path]>0){events.push(this.value(),path)}}};ChainNodePrototype.didChange=function(events){if(this._watching){var obj=this._parent.value();if(obj!==this._object){removeChainWatcher(this._object,this._key,this);this._object=obj;addChainWatcher(obj,this._key,this)}this._value=undefined;if(this._parent&&this._parent._key==="@each")this.value()}var chains=this._chains;if(chains){for(var key in chains){if(!chains.hasOwnProperty(key)){continue}chains[key].didChange(events)}}if(events===null){return}if(this._parent){this._parent.chainDidChange(this,this._key,1,events)}};Ember.finishChains=function(obj){var m=obj[META_KEY],chains=m&&m.chains;if(chains){if(chains.value()!==obj){metaFor(obj).chains=chains=chains.copy(obj)}else{chains.didChange(null)}}}})();(function(){var forEach=Ember.EnumerableUtils.forEach,BRACE_EXPANSION=/^((?:[^\.]*\.)*)\{(.*)\}$/;Ember.expandProperties=function(pattern,callback){var match,prefix,list;if(match=BRACE_EXPANSION.exec(pattern)){prefix=match[1];list=match[2];forEach(list.split(","),function(suffix){callback(prefix+suffix)})}else{callback(pattern)}}})();(function(){var metaFor=Ember.meta,typeOf=Ember.typeOf,ChainNode=Ember._ChainNode;function chainsFor(obj,meta){var m=meta||metaFor(obj),ret=m.chains;if(!ret){ret=m.chains=new ChainNode(null,null,obj)}else if(ret.value()!==obj){ret=m.chains=ret.copy(obj)}return ret}Ember.watchPath=function(obj,keyPath,meta){if(keyPath==="length"&&typeOf(obj)==="array"){return}var m=meta||metaFor(obj),watching=m.watching;if(!watching[keyPath]){watching[keyPath]=1;chainsFor(obj,m).add(keyPath)}else{watching[keyPath]=(watching[keyPath]||0)+1}};Ember.unwatchPath=function(obj,keyPath,meta){var m=meta||metaFor(obj),watching=m.watching;if(watching[keyPath]===1){watching[keyPath]=0;chainsFor(obj,m).remove(keyPath)}else if(watching[keyPath]>1){watching[keyPath]--}}})();(function(){var metaFor=Ember.meta,GUID_KEY=Ember.GUID_KEY,META_KEY=Ember.META_KEY,removeChainWatcher=Ember.removeChainWatcher,watchKey=Ember.watchKey,unwatchKey=Ember.unwatchKey,watchPath=Ember.watchPath,unwatchPath=Ember.unwatchPath,typeOf=Ember.typeOf,generateGuid=Ember.generateGuid,IS_PATH=/[\.\*]/;function isKeyName(path){return path==="*"||!IS_PATH.test(path)}Ember.watch=function(obj,_keyPath,m){if(_keyPath==="length"&&typeOf(obj)==="array"){return}if(isKeyName(_keyPath)){watchKey(obj,_keyPath,m)}else{watchPath(obj,_keyPath,m)}};Ember.isWatching=function isWatching(obj,key){var meta=obj[META_KEY];return(meta&&meta.watching[key])>0};Ember.watch.flushPending=Ember.flushPendingChains;Ember.unwatch=function(obj,_keyPath,m){if(_keyPath==="length"&&typeOf(obj)==="array"){return}if(isKeyName(_keyPath)){unwatchKey(obj,_keyPath,m)}else{unwatchPath(obj,_keyPath,m)}};Ember.rewatch=function(obj){var m=obj[META_KEY],chains=m&&m.chains;if(GUID_KEY in obj&&!obj.hasOwnProperty(GUID_KEY)){generateGuid(obj)}if(chains&&chains.value()!==obj){m.chains=chains.copy(obj)}};var NODE_STACK=[];Ember.destroy=function(obj){var meta=obj[META_KEY],node,nodes,key,nodeObject;if(meta){obj[META_KEY]=null;node=meta.chains;if(node){NODE_STACK.push(node);while(NODE_STACK.length>0){node=NODE_STACK.pop();nodes=node._chains;if(nodes){for(key in nodes){if(nodes.hasOwnProperty(key)){NODE_STACK.push(nodes[key])}}}if(node._watching){nodeObject=node._object;if(nodeObject){removeChainWatcher(nodeObject,node._key,node)}}}}}}})();(function(){var get=Ember.get,set=Ember.set,metaFor=Ember.meta,a_slice=[].slice,o_create=Ember.create,META_KEY=Ember.META_KEY,watch=Ember.watch,unwatch=Ember.unwatch;var expandProperties=Ember.expandProperties;function keysForDep(depsMeta,depKey){var keys=depsMeta[depKey];if(!keys){keys=depsMeta[depKey]={}}else if(!depsMeta.hasOwnProperty(depKey)){keys=depsMeta[depKey]=o_create(keys)}return keys}function metaForDeps(meta){return keysForDep(meta,"deps")}function addDependentKeys(desc,obj,keyName,meta){var depKeys=desc._dependentKeys,depsMeta,idx,len,depKey,keys;if(!depKeys)return;depsMeta=metaForDeps(meta);for(idx=0,len=depKeys.length;idx<len;idx++){depKey=depKeys[idx];keys=keysForDep(depsMeta,depKey);keys[keyName]=(keys[keyName]||0)+1;watch(obj,depKey,meta)}}function removeDependentKeys(desc,obj,keyName,meta){var depKeys=desc._dependentKeys,depsMeta,idx,len,depKey,keys;if(!depKeys)return;depsMeta=metaForDeps(meta);for(idx=0,len=depKeys.length;idx<len;idx++){depKey=depKeys[idx];keys=keysForDep(depsMeta,depKey);keys[keyName]=(keys[keyName]||0)-1;unwatch(obj,depKey,meta)}}function ComputedProperty(func,opts){this.func=func;setDependentKeys(this,opts&&opts.dependentKeys);this._cacheable=opts&&opts.cacheable!==undefined?opts.cacheable:true;this._readOnly=opts&&(opts.readOnly!==undefined||!!opts.readOnly)}Ember.ComputedProperty=ComputedProperty;ComputedProperty.prototype=new Ember.Descriptor;var ComputedPropertyPrototype=ComputedProperty.prototype;ComputedPropertyPrototype.toString=function(){if(this.implicitCPKey){return this.implicitCPKey}return Ember.Descriptor.prototype.toString.apply(this,arguments)};ComputedPropertyPrototype.cacheable=function(aFlag){this._cacheable=aFlag!==false;return this};ComputedPropertyPrototype.volatile=function(){return this.cacheable(false)};ComputedPropertyPrototype.readOnly=function(readOnly){this._readOnly=readOnly===undefined||!!readOnly;return this};ComputedPropertyPrototype.property=function(){var args;var addArg=function(property){args.push(property)};args=[];for(var i=0,l=arguments.length;i<l;i++){expandProperties(arguments[i],addArg)}setDependentKeys(this,args);return this};ComputedPropertyPrototype.meta=function(meta){if(arguments.length===0){return this._meta||{}}else{this._meta=meta;return this}};ComputedPropertyPrototype.didChange=function(obj,keyName){if(this._cacheable&&this._suspended!==obj){var meta=metaFor(obj);if(keyName in meta.cache){delete meta.cache[keyName];removeDependentKeys(this,obj,keyName,meta)}}};function finishChains(chainNodes){for(var i=0,l=chainNodes.length;i<l;i++){chainNodes[i].didChange(null)}}ComputedPropertyPrototype.get=function(obj,keyName){var ret,cache,meta,chainNodes;if(this._cacheable){meta=metaFor(obj);cache=meta.cache;if(keyName in cache){return cache[keyName]}ret=cache[keyName]=this.func.call(obj,keyName);chainNodes=meta.chainWatchers&&meta.chainWatchers[keyName];if(chainNodes){finishChains(chainNodes)}addDependentKeys(this,obj,keyName,meta)}else{ret=this.func.call(obj,keyName)}return ret};ComputedPropertyPrototype.set=function(obj,keyName,value){var cacheable=this._cacheable,func=this.func,meta=metaFor(obj,cacheable),watched=meta.watching[keyName],oldSuspended=this._suspended,hadCachedValue=false,cache=meta.cache,funcArgLength,cachedValue,ret;if(this._readOnly){throw new Ember.Error("Cannot Set: "+keyName+" on: "+Ember.inspect(obj))}this._suspended=obj;try{if(cacheable&&cache.hasOwnProperty(keyName)){cachedValue=cache[keyName];hadCachedValue=true}funcArgLength=func.wrappedFunction?func.wrappedFunction.length:func.length;if(funcArgLength===3){ret=func.call(obj,keyName,value,cachedValue)}else if(funcArgLength===2){ret=func.call(obj,keyName,value)}else{Ember.defineProperty(obj,keyName,null,cachedValue);Ember.set(obj,keyName,value);return}if(hadCachedValue&&cachedValue===ret){return}if(watched){Ember.propertyWillChange(obj,keyName)}if(hadCachedValue){delete cache[keyName]}if(cacheable){if(!hadCachedValue){addDependentKeys(this,obj,keyName,meta)}cache[keyName]=ret}if(watched){Ember.propertyDidChange(obj,keyName)}}finally{this._suspended=oldSuspended}return ret};ComputedPropertyPrototype.teardown=function(obj,keyName){var meta=metaFor(obj);if(keyName in meta.cache){removeDependentKeys(this,obj,keyName,meta)}if(this._cacheable){delete meta.cache[keyName]}return null};Ember.computed=function(func){var args;if(arguments.length>1){args=a_slice.call(arguments,0,-1);func=a_slice.call(arguments,-1)[0]}if(typeof func!=="function"){throw new Ember.Error("Computed Property declared without a property function")}var cp=new ComputedProperty(func);if(args){cp.property.apply(cp,args)}return cp};Ember.cacheFor=function cacheFor(obj,key){var meta=obj[META_KEY],cache=meta&&meta.cache;if(cache&&key in cache){return cache[key]}};function getProperties(self,propertyNames){var ret={};for(var i=0;i<propertyNames.length;i++){ret[propertyNames[i]]=get(self,propertyNames[i])}return ret}var registerComputed,registerComputedWithProperties;var guidFor=Ember.guidFor,map=Ember.EnumerableUtils.map,filter=Ember.EnumerableUtils.filter,typeOf=Ember.typeOf;var implicitKey=function(cp){return[guidFor(cp)].concat(cp._dependentKeys).join("_")};var normalizeDependentKey=function(key){if(key instanceof Ember.ComputedProperty){return implicitKey(key)}else if(typeof key==="string"||key instanceof String||typeof key==="object"||typeof key==="number"){return key}else{}};var normalizeDependentKeys=function(keys){return map(keys,function(key){return normalizeDependentKey(key)})};var selectDependentCPs=function(keys){return filter(keys,function(key){return key instanceof Ember.ComputedProperty})};var setDependentKeys=function(cp,dependentKeys){if(dependentKeys){cp._dependentKeys=normalizeDependentKeys(dependentKeys);cp._dependentCPs=selectDependentCPs(dependentKeys);cp.implicitCPKey=implicitKey(cp)}else{cp._dependentKeys=cp._dependentCPs=[];delete cp.implicitCPKey}};Ember.computed.normalizeDependentKey=normalizeDependentKey;Ember.computed.normalizeDependentKeys=normalizeDependentKeys;registerComputed=function(name,macro){Ember.computed[name]=function(dependentKey){var args=normalizeDependentKeys(a_slice.call(arguments));return Ember.computed(dependentKey,function(){return macro.apply(this,args)})}};registerComputedWithProperties=function(name,macro){Ember.computed[name]=function(){var args=a_slice.call(arguments);var properties=normalizeDependentKeys(args);var computed=Ember.computed(function(){return macro.apply(this,[getProperties(this,properties)])});return computed.property.apply(computed,args)}};Ember.computed.literal=function(value){return Ember.computed(function(){return value})};registerComputed("empty",function(dependentKey){return Ember.isEmpty(get(this,dependentKey))});registerComputed("notEmpty",function(dependentKey){return!Ember.isEmpty(get(this,dependentKey))});registerComputed("none",function(dependentKey){return Ember.isNone(get(this,dependentKey))});registerComputed("not",function(dependentKey){return!get(this,dependentKey)});registerComputed("bool",function(dependentKey){return!!get(this,dependentKey)});registerComputed("match",function(dependentKey,regexp){var value=get(this,dependentKey);return typeof value==="string"?regexp.test(value):false});registerComputed("equal",function(dependentKey,value){return get(this,dependentKey)===value});registerComputed("gt",function(dependentKey,value){return get(this,dependentKey)>value});registerComputed("gte",function(dependentKey,value){return get(this,dependentKey)>=value});registerComputed("lt",function(dependentKey,value){return get(this,dependentKey)<value});registerComputed("lte",function(dependentKey,value){return get(this,dependentKey)<=value});registerComputedWithProperties("and",function(properties){for(var key in properties){if(properties.hasOwnProperty(key)&&!properties[key]){return false}}return true});registerComputedWithProperties("or",function(properties){for(var key in properties){if(properties.hasOwnProperty(key)&&properties[key]){return true}}return false});registerComputedWithProperties("any",function(properties){for(var key in properties){if(properties.hasOwnProperty(key)&&properties[key]){return properties[key]}}return null});registerComputedWithProperties("collect",function(properties){var res=[];for(var key in properties){if(properties.hasOwnProperty(key)){if(Ember.isNone(properties[key])){res.push(null)}else{res.push(properties[key])}}}return res});Ember.computed.alias=function(dependentKey){return Ember.computed(dependentKey,function(key,value){if(arguments.length>1){set(this,dependentKey,value);return value}else{return get(this,dependentKey)}})};Ember.computed.oneWay=function(dependentKey){return Ember.computed(dependentKey,function(){return get(this,dependentKey)})};if(Ember.FEATURES.isEnabled("computed-read-only")){Ember.computed.readOnly=function(dependentKey){return Ember.computed(dependentKey,function(){return get(this,dependentKey)}).readOnly()}}Ember.computed.defaultTo=function(defaultPath){return Ember.computed(function(key,newValue,cachedValue){if(arguments.length===1){return cachedValue!=null?cachedValue:get(this,defaultPath)}return newValue!=null?newValue:get(this,defaultPath)})}})();(function(){var AFTER_OBSERVERS=":change",BEFORE_OBSERVERS=":before";function changeEvent(keyName){return keyName+AFTER_OBSERVERS}function beforeEvent(keyName){return keyName+BEFORE_OBSERVERS}Ember.addObserver=function(obj,_path,target,method){Ember.addListener(obj,changeEvent(_path),target,method);Ember.watch(obj,_path);return this};Ember.observersFor=function(obj,path){return Ember.listenersFor(obj,changeEvent(path))};Ember.removeObserver=function(obj,_path,target,method){Ember.unwatch(obj,_path);Ember.removeListener(obj,changeEvent(_path),target,method);return this};Ember.addBeforeObserver=function(obj,_path,target,method){Ember.addListener(obj,beforeEvent(_path),target,method);Ember.watch(obj,_path);return this};Ember._suspendBeforeObserver=function(obj,path,target,method,callback){return Ember._suspendListener(obj,beforeEvent(path),target,method,callback)};Ember._suspendObserver=function(obj,path,target,method,callback){return Ember._suspendListener(obj,changeEvent(path),target,method,callback)};var map=Ember.ArrayPolyfills.map;Ember._suspendBeforeObservers=function(obj,paths,target,method,callback){var events=map.call(paths,beforeEvent);return Ember._suspendListeners(obj,events,target,method,callback)};Ember._suspendObservers=function(obj,paths,target,method,callback){var events=map.call(paths,changeEvent);return Ember._suspendListeners(obj,events,target,method,callback)};Ember.beforeObserversFor=function(obj,path){return Ember.listenersFor(obj,beforeEvent(path))};Ember.removeBeforeObserver=function(obj,_path,target,method){Ember.unwatch(obj,_path);Ember.removeListener(obj,beforeEvent(_path),target,method);return this}})();(function(){define("backburner/queue",["exports"],function(__exports__){function Queue(daq,name,options){this.daq=daq;this.name=name;this.options=options;this._queue=[]}Queue.prototype={daq:null,name:null,options:null,_queue:null,push:function(target,method,args,stack){var queue=this._queue;queue.push(target,method,args,stack);return{queue:this,target:target,method:method}},pushUnique:function(target,method,args,stack){var queue=this._queue,currentTarget,currentMethod,i,l;for(i=0,l=queue.length;i<l;i+=4){currentTarget=queue[i];currentMethod=queue[i+1];if(currentTarget===target&&currentMethod===method){queue[i+2]=args;queue[i+3]=stack;return{queue:this,target:target,method:method}}}this._queue.push(target,method,args,stack);return{queue:this,target:target,method:method}},flush:function(){var queue=this._queue,options=this.options,before=options&&options.before,after=options&&options.after,target,method,args,stack,i,l=queue.length;if(l&&before){before()}for(i=0;i<l;i+=4){target=queue[i];method=queue[i+1];args=queue[i+2];stack=queue[i+3];if(args&&args.length>0){method.apply(target,args)}else{method.call(target)}}if(l&&after){after()}if(queue.length>l){this._queue=queue.slice(l);this.flush()}else{this._queue.length=0}},cancel:function(actionToCancel){var queue=this._queue,currentTarget,currentMethod,i,l;for(i=0,l=queue.length;i<l;i+=4){currentTarget=queue[i];currentMethod=queue[i+1];if(currentTarget===actionToCancel.target&&currentMethod===actionToCancel.method){queue.splice(i,4);return true}}queue=this._queueBeingFlushed;if(!queue){return}for(i=0,
l=queue.length;i<l;i+=4){currentTarget=queue[i];currentMethod=queue[i+1];if(currentTarget===actionToCancel.target&&currentMethod===actionToCancel.method){queue[i+1]=null;return true}}}};__exports__.Queue=Queue});define("backburner/deferred_action_queues",["backburner/queue","exports"],function(__dependency1__,__exports__){var Queue=__dependency1__.Queue;function DeferredActionQueues(queueNames,options){var queues=this.queues={};this.queueNames=queueNames=queueNames||[];var queueName;for(var i=0,l=queueNames.length;i<l;i++){queueName=queueNames[i];queues[queueName]=new Queue(this,queueName,options[queueName])}}DeferredActionQueues.prototype={queueNames:null,queues:null,schedule:function(queueName,target,method,args,onceFlag,stack){var queues=this.queues,queue=queues[queueName];if(!queue){throw new Error("You attempted to schedule an action in a queue ("+queueName+") that doesn't exist")}if(onceFlag){return queue.pushUnique(target,method,args,stack)}else{return queue.push(target,method,args,stack)}},flush:function(){var queues=this.queues,queueNames=this.queueNames,queueName,queue,queueItems,priorQueueNameIndex,queueNameIndex=0,numberOfQueues=queueNames.length;outerloop:while(queueNameIndex<numberOfQueues){queueName=queueNames[queueNameIndex];queue=queues[queueName];queueItems=queue._queueBeingFlushed=queue._queue.slice();queue._queue=[];var options=queue.options,before=options&&options.before,after=options&&options.after,target,method,args,stack,queueIndex=0,numberOfQueueItems=queueItems.length;if(numberOfQueueItems&&before){before()}while(queueIndex<numberOfQueueItems){target=queueItems[queueIndex];method=queueItems[queueIndex+1];args=queueItems[queueIndex+2];stack=queueItems[queueIndex+3];if(typeof method==="string"){method=target[method]}if(method){if(args&&args.length>0){method.apply(target,args)}else{method.call(target)}}queueIndex+=4}queue._queueBeingFlushed=null;if(numberOfQueueItems&&after){after()}if((priorQueueNameIndex=indexOfPriorQueueWithActions(this,queueNameIndex))!==-1){queueNameIndex=priorQueueNameIndex;continue outerloop}queueNameIndex++}}};function indexOfPriorQueueWithActions(daq,currentQueueIndex){var queueName,queue;for(var i=0,l=currentQueueIndex;i<=l;i++){queueName=daq.queueNames[i];queue=daq.queues[queueName];if(queue._queue.length){return i}}return-1}__exports__.DeferredActionQueues=DeferredActionQueues});define("backburner",["backburner/deferred_action_queues","exports"],function(__dependency1__,__exports__){var DeferredActionQueues=__dependency1__.DeferredActionQueues;var slice=[].slice,pop=[].pop,throttlers=[],debouncees=[],timers=[],autorun,laterTimer,laterTimerExpiresAt,global=this,NUMBER=/\d+/;function isCoercableNumber(number){return typeof number==="number"||NUMBER.test(number)}function Backburner(queueNames,options){this.queueNames=queueNames;this.options=options||{};if(!this.options.defaultQueue){this.options.defaultQueue=queueNames[0]}this.instanceStack=[]}Backburner.prototype={queueNames:null,options:null,currentInstance:null,instanceStack:null,begin:function(){var onBegin=this.options&&this.options.onBegin,previousInstance=this.currentInstance;if(previousInstance){this.instanceStack.push(previousInstance)}this.currentInstance=new DeferredActionQueues(this.queueNames,this.options);if(onBegin){onBegin(this.currentInstance,previousInstance)}},end:function(){var onEnd=this.options&&this.options.onEnd,currentInstance=this.currentInstance,nextInstance=null;try{currentInstance.flush()}finally{this.currentInstance=null;if(this.instanceStack.length){nextInstance=this.instanceStack.pop();this.currentInstance=nextInstance}if(onEnd){onEnd(currentInstance,nextInstance)}}},run:function(target,method){var ret;this.begin();if(!method){method=target;target=null}if(typeof method==="string"){method=target[method]}var finallyAlreadyCalled=false;try{if(arguments.length>2){ret=method.apply(target,slice.call(arguments,2))}else{ret=method.call(target)}}finally{if(!finallyAlreadyCalled){finallyAlreadyCalled=true;this.end()}}return ret},defer:function(queueName,target,method){if(!method){method=target;target=null}if(typeof method==="string"){method=target[method]}var stack=this.DEBUG?new Error:undefined,args=arguments.length>3?slice.call(arguments,3):undefined;if(!this.currentInstance){createAutorun(this)}return this.currentInstance.schedule(queueName,target,method,args,false,stack)},deferOnce:function(queueName,target,method){if(!method){method=target;target=null}if(typeof method==="string"){method=target[method]}var stack=this.DEBUG?new Error:undefined,args=arguments.length>3?slice.call(arguments,3):undefined;if(!this.currentInstance){createAutorun(this)}return this.currentInstance.schedule(queueName,target,method,args,true,stack)},setTimeout:function(){var args=slice.call(arguments);var length=args.length;var method,wait,target;var self=this;var methodOrTarget,methodOrWait,methodOrArgs;if(length===0){return}else if(length===1){method=args.shift();wait=0}else if(length===2){methodOrTarget=args[0];methodOrWait=args[1];if(typeof methodOrWait==="function"||typeof methodOrTarget[methodOrWait]==="function"){target=args.shift();method=args.shift();wait=0}else if(isCoercableNumber(methodOrWait)){method=args.shift();wait=args.shift()}else{method=args.shift();wait=0}}else{var last=args[args.length-1];if(isCoercableNumber(last)){wait=args.pop()}methodOrTarget=args[0];methodOrArgs=args[1];if(typeof methodOrArgs==="function"||typeof methodOrArgs==="string"&&methodOrTarget!==null&&methodOrArgs in methodOrTarget){target=args.shift();method=args.shift()}else{method=args.shift()}}var executeAt=+new Date+parseInt(wait,10);if(typeof method==="string"){method=target[method]}function fn(){method.apply(target,args)}var i,l;for(i=0,l=timers.length;i<l;i+=2){if(executeAt<timers[i]){break}}timers.splice(i,0,executeAt,fn);updateLaterTimer(self,executeAt,wait);return fn},throttle:function(target,method){var self=this,args=arguments,wait=parseInt(pop.call(args),10),throttler,index,timer;index=findThrottler(target,method);if(index>-1){return throttlers[index]}timer=global.setTimeout(function(){self.run.apply(self,args);var index=findThrottler(target,method);if(index>-1){throttlers.splice(index,1)}},wait);throttler=[target,method,timer];throttlers.push(throttler);return throttler},debounce:function(target,method){var self=this,args=arguments,immediate=pop.call(args),wait,index,debouncee,timer;if(typeof immediate==="number"||typeof immediate==="string"){wait=immediate;immediate=false}else{wait=pop.call(args)}wait=parseInt(wait,10);index=findDebouncee(target,method);if(index>-1){debouncee=debouncees[index];debouncees.splice(index,1);clearTimeout(debouncee[2])}timer=global.setTimeout(function(){if(!immediate){self.run.apply(self,args)}var index=findDebouncee(target,method);if(index>-1){debouncees.splice(index,1)}},wait);if(immediate&&index===-1){self.run.apply(self,args)}debouncee=[target,method,timer];debouncees.push(debouncee);return debouncee},cancelTimers:function(){var i,len;for(i=0,len=throttlers.length;i<len;i++){clearTimeout(throttlers[i][2])}throttlers=[];for(i=0,len=debouncees.length;i<len;i++){clearTimeout(debouncees[i][2])}debouncees=[];if(laterTimer){clearTimeout(laterTimer);laterTimer=null}timers=[];if(autorun){clearTimeout(autorun);autorun=null}},hasTimers:function(){return!!timers.length||autorun},cancel:function(timer){var timerType=typeof timer;if(timer&&timerType==="object"&&timer.queue&&timer.method){return timer.queue.cancel(timer)}else if(timerType==="function"){for(var i=0,l=timers.length;i<l;i+=2){if(timers[i+1]===timer){timers.splice(i,2);return true}}}else if(window.toString.call(timer)==="[object Array]"){return this._cancelItem(findThrottler,throttlers,timer)||this._cancelItem(findDebouncee,debouncees,timer)}else{return}},_cancelItem:function(findMethod,array,timer){var item,index;if(timer.length<3){return false}index=findMethod(timer[0],timer[1]);if(index>-1){item=array[index];if(item[2]===timer[2]){array.splice(index,1);clearTimeout(timer[2]);return true}}return false}};Backburner.prototype.schedule=Backburner.prototype.defer;Backburner.prototype.scheduleOnce=Backburner.prototype.deferOnce;Backburner.prototype.later=Backburner.prototype.setTimeout;function createAutorun(backburner){backburner.begin();autorun=global.setTimeout(function(){autorun=null;backburner.end()})}function updateLaterTimer(self,executeAt,wait){if(!laterTimer||executeAt<laterTimerExpiresAt){if(laterTimer){clearTimeout(laterTimer)}laterTimer=global.setTimeout(function(){laterTimer=null;laterTimerExpiresAt=null;executeTimers(self)},wait);laterTimerExpiresAt=executeAt}}function executeTimers(self){var now=+new Date,time,fns,i,l;self.run(function(){for(i=0,l=timers.length;i<l;i+=2){time=timers[i];if(time>now){break}}fns=timers.splice(0,i);for(i=1,l=fns.length;i<l;i+=2){self.schedule(self.options.defaultQueue,null,fns[i])}});if(timers.length){updateLaterTimer(self,timers[0],timers[0]-now)}}function findDebouncee(target,method){var debouncee,index=-1;for(var i=0,l=debouncees.length;i<l;i++){debouncee=debouncees[i];if(debouncee[0]===target&&debouncee[1]===method){index=i;break}}return index}function findThrottler(target,method){var throttler,index=-1;for(var i=0,l=throttlers.length;i<l;i++){throttler=throttlers[i];if(throttler[0]===target&&throttler[1]===method){index=i;break}}return index}__exports__.Backburner=Backburner})})();(function(){var onBegin=function(current){Ember.run.currentRunLoop=current};var onEnd=function(current,next){Ember.run.currentRunLoop=next};var Backburner=requireModule("backburner").Backburner,backburner=new Backburner(["sync","actions","destroy"],{sync:{before:Ember.beginPropertyChanges,after:Ember.endPropertyChanges},defaultQueue:"actions",onBegin:onBegin,onEnd:onEnd}),slice=[].slice,concat=[].concat;Ember.run=function(target,method){var ret;if(Ember.onerror){try{ret=backburner.run.apply(backburner,arguments)}catch(e){Ember.onerror(e)}}else{ret=backburner.run.apply(backburner,arguments)}return ret};Ember.run.join=function(target,method){if(!Ember.run.currentRunLoop){return Ember.run.apply(Ember.run,arguments)}var args=slice.call(arguments);args.unshift("actions");Ember.run.schedule.apply(Ember.run,args)};Ember.run.bind=function(target,method){var args=arguments;return function(){return Ember.run.join.apply(Ember.run,args)}};Ember.run.backburner=backburner;var run=Ember.run;Ember.run.currentRunLoop=null;Ember.run.queues=backburner.queueNames;Ember.run.begin=function(){backburner.begin()};Ember.run.end=function(){backburner.end()};Ember.run.schedule=function(queue,target,method){checkAutoRun();backburner.schedule.apply(backburner,arguments)};Ember.run.hasScheduledTimers=function(){return backburner.hasTimers()};Ember.run.cancelTimers=function(){backburner.cancelTimers()};Ember.run.sync=function(){if(backburner.currentInstance){backburner.currentInstance.queues.sync.flush()}};Ember.run.later=function(target,method){return backburner.later.apply(backburner,arguments)};Ember.run.once=function(target,method){checkAutoRun();var args=slice.call(arguments);args.unshift("actions");return backburner.scheduleOnce.apply(backburner,args)};Ember.run.scheduleOnce=function(queue,target,method){checkAutoRun();return backburner.scheduleOnce.apply(backburner,arguments)};Ember.run.next=function(){var args=slice.call(arguments);args.push(1);return backburner.later.apply(backburner,args)};Ember.run.cancel=function(timer){return backburner.cancel(timer)};Ember.run.debounce=function(){return backburner.debounce.apply(backburner,arguments)};Ember.run.throttle=function(){return backburner.throttle.apply(backburner,arguments)};function checkAutoRun(){if(!Ember.run.currentRunLoop){}}})();(function(){Ember.LOG_BINDINGS=false||!!Ember.ENV.LOG_BINDINGS;var get=Ember.get,set=Ember.set,guidFor=Ember.guidFor,IS_GLOBAL=/^([A-Z$]|([0-9][A-Z$]))/;var isGlobalPath=Ember.isGlobalPath=function(path){return IS_GLOBAL.test(path)};function getWithGlobals(obj,path){return get(isGlobalPath(path)?Ember.lookup:obj,path)}var Binding=function(toPath,fromPath){this._direction="fwd";this._from=fromPath;this._to=toPath;this._directionMap=Ember.Map.create()};Binding.prototype={copy:function(){var copy=new Binding(this._to,this._from);if(this._oneWay){copy._oneWay=true}return copy},from:function(path){this._from=path;return this},to:function(path){this._to=path;return this},oneWay:function(){this._oneWay=true;return this},toString:function(){var oneWay=this._oneWay?"[oneWay]":"";return"Ember.Binding<"+guidFor(this)+">("+this._from+" -> "+this._to+")"+oneWay},connect:function(obj){var fromPath=this._from,toPath=this._to;Ember.trySet(obj,toPath,getWithGlobals(obj,fromPath));Ember.addObserver(obj,fromPath,this,this.fromDidChange);if(!this._oneWay){Ember.addObserver(obj,toPath,this,this.toDidChange)}this._readyToSync=true;return this},disconnect:function(obj){var twoWay=!this._oneWay;Ember.removeObserver(obj,this._from,this,this.fromDidChange);if(twoWay){Ember.removeObserver(obj,this._to,this,this.toDidChange)}this._readyToSync=false;return this},fromDidChange:function(target){this._scheduleSync(target,"fwd")},toDidChange:function(target){this._scheduleSync(target,"back")},_scheduleSync:function(obj,dir){var directionMap=this._directionMap;var existingDir=directionMap.get(obj);if(!existingDir){Ember.run.schedule("sync",this,this._sync,obj);directionMap.set(obj,dir)}if(existingDir==="back"&&dir==="fwd"){directionMap.set(obj,"fwd")}},_sync:function(obj){var log=Ember.LOG_BINDINGS;if(obj.isDestroyed||!this._readyToSync){return}var directionMap=this._directionMap;var direction=directionMap.get(obj);var fromPath=this._from,toPath=this._to;directionMap.remove(obj);if(direction==="fwd"){var fromValue=getWithGlobals(obj,this._from);if(log){Ember.Logger.log(" ",this.toString(),"->",fromValue,obj)}if(this._oneWay){Ember.trySet(obj,toPath,fromValue)}else{Ember._suspendObserver(obj,toPath,this,this.toDidChange,function(){Ember.trySet(obj,toPath,fromValue)})}}else if(direction==="back"){var toValue=get(obj,this._to);if(log){Ember.Logger.log(" ",this.toString(),"<-",toValue,obj)}Ember._suspendObserver(obj,fromPath,this,this.fromDidChange,function(){Ember.trySet(Ember.isGlobalPath(fromPath)?Ember.lookup:obj,fromPath,toValue)})}}};function mixinProperties(to,from){for(var key in from){if(from.hasOwnProperty(key)){to[key]=from[key]}}}mixinProperties(Binding,{from:function(){var C=this,binding=new C;return binding.from.apply(binding,arguments)},to:function(){var C=this,binding=new C;return binding.to.apply(binding,arguments)},oneWay:function(from,flag){var C=this,binding=new C(null,from);return binding.oneWay(flag)}});Ember.Binding=Binding;Ember.bind=function(obj,to,from){return new Ember.Binding(to,from).connect(obj)};Ember.oneWay=function(obj,to,from){return new Ember.Binding(to,from).oneWay().connect(obj)}})();(function(){var Mixin,REQUIRED,Alias,a_map=Ember.ArrayPolyfills.map,a_indexOf=Ember.ArrayPolyfills.indexOf,a_forEach=Ember.ArrayPolyfills.forEach,a_slice=[].slice,o_create=Ember.create,defineProperty=Ember.defineProperty,guidFor=Ember.guidFor,metaFor=Ember.meta,META_KEY=Ember.META_KEY;var expandProperties=Ember.expandProperties;function mixinsMeta(obj){var m=metaFor(obj,true),ret=m.mixins;if(!ret){ret=m.mixins={}}else if(!m.hasOwnProperty("mixins")){ret=m.mixins=o_create(ret)}return ret}function initMixin(mixin,args){if(args&&args.length>0){mixin.mixins=a_map.call(args,function(x){if(x instanceof Mixin){return x}var mixin=new Mixin;mixin.properties=x;return mixin})}return mixin}function isMethod(obj){return"function"===typeof obj&&obj.isMethod!==false&&obj!==Boolean&&obj!==Object&&obj!==Number&&obj!==Array&&obj!==Date&&obj!==String}var CONTINUE={};function mixinProperties(mixinsMeta,mixin){var guid;if(mixin instanceof Mixin){guid=guidFor(mixin);if(mixinsMeta[guid]){return CONTINUE}mixinsMeta[guid]=mixin;return mixin.properties}else{return mixin}}function concatenatedMixinProperties(concatProp,props,values,base){var concats;concats=values[concatProp]||base[concatProp];if(props[concatProp]){concats=concats?concats.concat(props[concatProp]):props[concatProp]}return concats}function giveDescriptorSuper(meta,key,property,values,descs){var superProperty;if(values[key]===undefined){superProperty=descs[key]}superProperty=superProperty||meta.descs[key];if(!superProperty||!(superProperty instanceof Ember.ComputedProperty)){return property}property=o_create(property);property.func=Ember.wrap(property.func,superProperty.func);return property}function giveMethodSuper(obj,key,method,values,descs){var superMethod;if(descs[key]===undefined){superMethod=values[key]}superMethod=superMethod||obj[key];if("function"!==typeof superMethod){return method}return Ember.wrap(method,superMethod)}function applyConcatenatedProperties(obj,key,value,values){var baseValue=values[key]||obj[key];if(baseValue){if("function"===typeof baseValue.concat){return baseValue.concat(value)}else{return Ember.makeArray(baseValue).concat(value)}}else{return Ember.makeArray(value)}}function applyMergedProperties(obj,key,value,values){var baseValue=values[key]||obj[key];if(!baseValue){return value}var newBase=Ember.merge({},baseValue);for(var prop in value){if(!value.hasOwnProperty(prop)){continue}var propValue=value[prop];if(isMethod(propValue)){newBase[prop]=giveMethodSuper(obj,prop,propValue,baseValue,{})}else{newBase[prop]=propValue}}return newBase}function addNormalizedProperty(base,key,value,meta,descs,values,concats,mergings){if(value instanceof Ember.Descriptor){if(value===REQUIRED&&descs[key]){return CONTINUE}if(value.func){value=giveDescriptorSuper(meta,key,value,values,descs)}descs[key]=value;values[key]=undefined}else{if(concats&&a_indexOf.call(concats,key)>=0||key==="concatenatedProperties"||key==="mergedProperties"){value=applyConcatenatedProperties(base,key,value,values)}else if(mergings&&a_indexOf.call(mergings,key)>=0){value=applyMergedProperties(base,key,value,values)}else if(isMethod(value)){value=giveMethodSuper(base,key,value,values,descs)}descs[key]=undefined;values[key]=value}}function mergeMixins(mixins,m,descs,values,base,keys){var mixin,props,key,concats,mergings,meta;function removeKeys(keyName){delete descs[keyName];delete values[keyName]}for(var i=0,l=mixins.length;i<l;i++){mixin=mixins[i];props=mixinProperties(m,mixin);if(props===CONTINUE){continue}if(props){meta=metaFor(base);if(base.willMergeMixin){base.willMergeMixin(props)}concats=concatenatedMixinProperties("concatenatedProperties",props,values,base);mergings=concatenatedMixinProperties("mergedProperties",props,values,base);for(key in props){if(!props.hasOwnProperty(key)){continue}keys.push(key);addNormalizedProperty(base,key,props[key],meta,descs,values,concats,mergings)}if(props.hasOwnProperty("toString")){base.toString=props.toString}}else if(mixin.mixins){mergeMixins(mixin.mixins,m,descs,values,base,keys);if(mixin._without){a_forEach.call(mixin._without,removeKeys)}}}}var IS_BINDING=Ember.IS_BINDING=/^.+Binding$/;function detectBinding(obj,key,value,m){if(IS_BINDING.test(key)){var bindings=m.bindings;if(!bindings){bindings=m.bindings={}}else if(!m.hasOwnProperty("bindings")){bindings=m.bindings=o_create(m.bindings)}bindings[key]=value}}function connectBindings(obj,m){var bindings=m.bindings,key,binding,to;if(bindings){for(key in bindings){binding=bindings[key];if(binding){to=key.slice(0,-7);if(binding instanceof Ember.Binding){binding=binding.copy();binding.to(to)}else{binding=new Ember.Binding(to,binding)}binding.connect(obj);obj[key]=binding}}m.bindings={}}}function finishPartial(obj,m){connectBindings(obj,m||metaFor(obj));return obj}function followAlias(obj,desc,m,descs,values){var altKey=desc.methodName,value;if(descs[altKey]||values[altKey]){value=values[altKey];desc=descs[altKey]}else if(m.descs[altKey]){desc=m.descs[altKey];value=undefined}else{desc=undefined;value=obj[altKey]}return{desc:desc,value:value}}function updateObserversAndListeners(obj,key,observerOrListener,pathsKey,updateMethod){var paths=observerOrListener[pathsKey];if(paths){for(var i=0,l=paths.length;i<l;i++){Ember[updateMethod](obj,paths[i],null,key)}}}function replaceObserversAndListeners(obj,key,observerOrListener){var prev=obj[key];if("function"===typeof prev){updateObserversAndListeners(obj,key,prev,"__ember_observesBefore__","removeBeforeObserver");updateObserversAndListeners(obj,key,prev,"__ember_observes__","removeObserver");updateObserversAndListeners(obj,key,prev,"__ember_listens__","removeListener")}if("function"===typeof observerOrListener){updateObserversAndListeners(obj,key,observerOrListener,"__ember_observesBefore__","addBeforeObserver");updateObserversAndListeners(obj,key,observerOrListener,"__ember_observes__","addObserver");updateObserversAndListeners(obj,key,observerOrListener,"__ember_listens__","addListener")}}function applyMixin(obj,mixins,partial){var descs={},values={},m=metaFor(obj),key,value,desc,keys=[];mergeMixins(mixins,mixinsMeta(obj),descs,values,obj,keys);for(var i=0,l=keys.length;i<l;i++){key=keys[i];if(key==="constructor"||!values.hasOwnProperty(key)){continue}desc=descs[key];value=values[key];if(desc===REQUIRED){continue}while(desc&&desc instanceof Alias){var followed=followAlias(obj,desc,m,descs,values);desc=followed.desc;value=followed.value}if(desc===undefined&&value===undefined){continue}replaceObserversAndListeners(obj,key,value);detectBinding(obj,key,value,m);defineProperty(obj,key,desc,value,m)}if(!partial){finishPartial(obj,m)}return obj}Ember.mixin=function(obj){var args=a_slice.call(arguments,1);applyMixin(obj,args,false);return obj};Ember.Mixin=function(){return initMixin(this,arguments)};Mixin=Ember.Mixin;Mixin.prototype={properties:null,mixins:null,ownerConstructor:null};Mixin._apply=applyMixin;Mixin.applyPartial=function(obj){var args=a_slice.call(arguments,1);return applyMixin(obj,args,true)};Mixin.finishPartial=finishPartial;Ember.anyUnprocessedMixins=false;Mixin.create=function(){Ember.anyUnprocessedMixins=true;var M=this;return initMixin(new M,arguments)};var MixinPrototype=Mixin.prototype;MixinPrototype.reopen=function(){var mixin,tmp;if(this.properties){mixin=Mixin.create();mixin.properties=this.properties;delete this.properties;this.mixins=[mixin]}else if(!this.mixins){this.mixins=[]}var len=arguments.length,mixins=this.mixins,idx;for(idx=0;idx<len;idx++){mixin=arguments[idx];if(mixin instanceof Mixin){mixins.push(mixin)}else{tmp=Mixin.create();tmp.properties=mixin;mixins.push(tmp)}}return this};MixinPrototype.apply=function(obj){return applyMixin(obj,[this],false)};MixinPrototype.applyPartial=function(obj){return applyMixin(obj,[this],true)};function _detect(curMixin,targetMixin,seen){var guid=guidFor(curMixin);if(seen[guid]){return false}seen[guid]=true;if(curMixin===targetMixin){return true}var mixins=curMixin.mixins,loc=mixins?mixins.length:0;while(--loc>=0){if(_detect(mixins[loc],targetMixin,seen)){return true}}return false}MixinPrototype.detect=function(obj){if(!obj){return false}if(obj instanceof Mixin){return _detect(obj,this,{})}var m=obj[META_KEY],mixins=m&&m.mixins;if(mixins){return!!mixins[guidFor(this)]}return false};MixinPrototype.without=function(){var ret=new Mixin(this);ret._without=a_slice.call(arguments);return ret};function _keys(ret,mixin,seen){if(seen[guidFor(mixin)]){return}seen[guidFor(mixin)]=true;if(mixin.properties){var props=mixin.properties;for(var key in props){if(props.hasOwnProperty(key)){ret[key]=true}}}else if(mixin.mixins){a_forEach.call(mixin.mixins,function(x){_keys(ret,x,seen)})}}MixinPrototype.keys=function(){var keys={},seen={},ret=[];_keys(keys,this,seen);for(var key in keys){if(keys.hasOwnProperty(key)){ret.push(key)}}return ret};Mixin.mixins=function(obj){var m=obj[META_KEY],mixins=m&&m.mixins,ret=[];if(!mixins){return ret}for(var key in mixins){var mixin=mixins[key];if(!mixin.properties){ret.push(mixin)}}return ret};REQUIRED=new Ember.Descriptor;REQUIRED.toString=function(){return"(Required Property)"};Ember.required=function(){return REQUIRED};Alias=function(methodName){this.methodName=methodName};Alias.prototype=new Ember.Descriptor;Ember.aliasMethod=function(methodName){return new Alias(methodName)};Ember.observer=function(){var func=a_slice.call(arguments,-1)[0];var paths;var addWatchedProperty=function(path){paths.push(path)};var _paths=a_slice.call(arguments,0,-1);if(typeof func!=="function"){func=arguments[0];_paths=a_slice.call(arguments,1)}paths=[];for(var i=0;i<_paths.length;++i){expandProperties(_paths[i],addWatchedProperty)}if(typeof func!=="function"){throw new Ember.Error("Ember.observer called without a function")}func.__ember_observes__=paths;return func};Ember.immediateObserver=function(){for(var i=0,l=arguments.length;i<l;i++){var arg=arguments[i]}return Ember.observer.apply(this,arguments)};Ember.beforeObserver=function(){var func=a_slice.call(arguments,-1)[0];var paths;var addWatchedProperty=function(path){paths.push(path)};var _paths=a_slice.call(arguments,0,-1);if(typeof func!=="function"){func=arguments[0];_paths=a_slice.call(arguments,1)}paths=[];for(var i=0;i<_paths.length;++i){expandProperties(_paths[i],addWatchedProperty)}if(typeof func!=="function"){throw new Ember.Error("Ember.beforeObserver called without a function")}func.__ember_observesBefore__=paths;return func}})();(function(){var forEach=Ember.EnumerableUtils.forEach,indexOf=Ember.EnumerableUtils.indexOf;Ember.libraries=function(){var libraries=[];var coreLibIndex=0;var getLibrary=function(name){for(var i=0;i<libraries.length;i++){if(libraries[i].name===name){return libraries[i]}}};libraries.register=function(name,version){if(!getLibrary(name)){libraries.push({name:name,version:version})}};libraries.registerCoreLibrary=function(name,version){if(!getLibrary(name)){libraries.splice(coreLibIndex++,0,{name:name,version:version})}};libraries.deRegister=function(name){var lib=getLibrary(name);if(lib)libraries.splice(indexOf(libraries,lib),1)};libraries.each=function(callback){forEach(libraries,function(lib){callback(lib.name,lib.version)})};return libraries}();Ember.libraries.registerCoreLibrary("Ember",Ember.VERSION)})();(function(){})();(function(){define("rsvp/all",["./promise","exports"],function(__dependency1__,__exports__){var Promise=__dependency1__["default"];__exports__["default"]=function all(array,label){return Promise.all(array,label)}});define("rsvp/all_settled",["./promise","./utils","exports"],function(__dependency1__,__dependency2__,__exports__){var Promise=__dependency1__["default"];var isArray=__dependency2__.isArray;var isNonThenable=__dependency2__.isNonThenable;__exports__["default"]=function allSettled(entries,label){return new Promise(function(resolve,reject){if(!isArray(entries)){throw new TypeError("You must pass an array to allSettled.")}var remaining=entries.length;var entry;if(remaining===0){resolve([]);return}var results=new Array(remaining);function fulfilledResolver(index){return function(value){resolveAll(index,fulfilled(value))}}function rejectedResolver(index){return function(reason){resolveAll(index,rejected(reason))}}function resolveAll(index,value){results[index]=value;if(--remaining===0){resolve(results)}}for(var index=0;index<entries.length;index++){entry=entries[index];if(isNonThenable(entry)){resolveAll(index,fulfilled(entry))}else{Promise.cast(entry).then(fulfilledResolver(index),rejectedResolver(index))}}},label)};function fulfilled(value){return{state:"fulfilled",value:value}}function rejected(reason){return{state:"rejected",reason:reason}}});define("rsvp/config",["./events","exports"],function(__dependency1__,__exports__){var EventTarget=__dependency1__["default"];var config={instrument:false};EventTarget.mixin(config);function configure(name,value){if(name==="onerror"){config.on("error",value);return}if(arguments.length===2){config[name]=value}else{return config[name]}}__exports__.config=config;__exports__.configure=configure});define("rsvp/defer",["./promise","exports"],function(__dependency1__,__exports__){var Promise=__dependency1__["default"];__exports__["default"]=function defer(label){var deferred={};deferred.promise=new Promise(function(resolve,reject){deferred.resolve=resolve;deferred.reject=reject},label);return deferred}});define("rsvp/events",["exports"],function(__exports__){var indexOf=function(callbacks,callback){for(var i=0,l=callbacks.length;i<l;i++){if(callbacks[i]===callback){return i}}return-1};var callbacksFor=function(object){var callbacks=object._promiseCallbacks;if(!callbacks){callbacks=object._promiseCallbacks={}}return callbacks};__exports__["default"]={mixin:function(object){object.on=this.on;object.off=this.off;object.trigger=this.trigger;object._promiseCallbacks=undefined;return object},on:function(eventName,callback){var allCallbacks=callbacksFor(this),callbacks;callbacks=allCallbacks[eventName];if(!callbacks){callbacks=allCallbacks[eventName]=[]}if(indexOf(callbacks,callback)===-1){callbacks.push(callback)}},off:function(eventName,callback){var allCallbacks=callbacksFor(this),callbacks,index;if(!callback){allCallbacks[eventName]=[];return}callbacks=allCallbacks[eventName];index=indexOf(callbacks,callback);if(index!==-1){callbacks.splice(index,1)}},trigger:function(eventName,options){var allCallbacks=callbacksFor(this),callbacks,callbackTuple,callback,binding;if(callbacks=allCallbacks[eventName]){for(var i=0;i<callbacks.length;i++){callback=callbacks[i];callback(options)}}}}});define("rsvp/filter",["./all","./map","./utils","exports"],function(__dependency1__,__dependency2__,__dependency3__,__exports__){var all=__dependency1__["default"];var map=__dependency2__["default"];var isFunction=__dependency3__.isFunction;var isArray=__dependency3__.isArray;function filter(promises,filterFn,label){return all(promises,label).then(function(values){if(!isArray(promises)){throw new TypeError("You must pass an array to filter.")}if(!isFunction(filterFn)){throw new TypeError("You must pass a function to filter's second argument.")}return map(promises,filterFn,label).then(function(filterResults){var i,valuesLen=values.length,filtered=[];for(i=0;i<valuesLen;i++){if(filterResults[i])filtered.push(values[i])}return filtered})})}__exports__["default"]=filter});define("rsvp/hash",["./promise","./utils","exports"],function(__dependency1__,__dependency2__,__exports__){var Promise=__dependency1__["default"];var isNonThenable=__dependency2__.isNonThenable;var keysOf=__dependency2__.keysOf;__exports__["default"]=function hash(object,label){return new Promise(function(resolve,reject){var results={};var keys=keysOf(object);var remaining=keys.length;var entry,property;if(remaining===0){resolve(results);return}function fulfilledTo(property){return function(value){results[property]=value;if(--remaining===0){resolve(results)}}}function onRejection(reason){remaining=0;reject(reason)}for(var i=0;i<keys.length;i++){property=keys[i];entry=object[property];if(isNonThenable(entry)){results[property]=entry;if(--remaining===0){resolve(results)}}else{Promise.cast(entry).then(fulfilledTo(property),onRejection)}}})}});define("rsvp/instrument",["./config","./utils","exports"],function(__dependency1__,__dependency2__,__exports__){var config=__dependency1__.config;var now=__dependency2__.now;__exports__["default"]=function instrument(eventName,promise,child){try{config.trigger(eventName,{guid:promise._guidKey+promise._id,eventName:eventName,detail:promise._detail,childGuid:child&&promise._guidKey+child._id,label:promise._label,timeStamp:now(),stack:new Error(promise._label).stack})}catch(error){setTimeout(function(){throw error},0)}}});define("rsvp/map",["./promise","./all","./utils","exports"],function(__dependency1__,__dependency2__,__dependency3__,__exports__){var Promise=__dependency1__["default"];var all=__dependency2__["default"];var isArray=__dependency3__.isArray;var isFunction=__dependency3__.isFunction;__exports__["default"]=function map(promises,mapFn,label){return all(promises,label).then(function(results){if(!isArray(promises)){
throw new TypeError("You must pass an array to map.")}if(!isFunction(mapFn)){throw new TypeError("You must pass a function to map's second argument.")}var resultLen=results.length,mappedResults=[],i;for(i=0;i<resultLen;i++){mappedResults.push(mapFn(results[i]))}return all(mappedResults,label)})}});define("rsvp/node",["./promise","exports"],function(__dependency1__,__exports__){var Promise=__dependency1__["default"];var slice=Array.prototype.slice;function makeNodeCallbackFor(resolve,reject){return function(error,value){if(error){reject(error)}else if(arguments.length>2){resolve(slice.call(arguments,1))}else{resolve(value)}}}__exports__["default"]=function denodeify(nodeFunc,binding){return function(){var nodeArgs=slice.call(arguments),resolve,reject;var thisArg=this||binding;return new Promise(function(resolve,reject){Promise.all(nodeArgs).then(function(nodeArgs){try{nodeArgs.push(makeNodeCallbackFor(resolve,reject));nodeFunc.apply(thisArg,nodeArgs)}catch(e){reject(e)}})})}}});define("rsvp/promise",["./config","./events","./instrument","./utils","./promise/cast","./promise/all","./promise/race","./promise/resolve","./promise/reject","exports"],function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__,__dependency6__,__dependency7__,__dependency8__,__dependency9__,__exports__){var config=__dependency1__.config;var EventTarget=__dependency2__["default"];var instrument=__dependency3__["default"];var objectOrFunction=__dependency4__.objectOrFunction;var isFunction=__dependency4__.isFunction;var now=__dependency4__.now;var cast=__dependency5__["default"];var all=__dependency6__["default"];var race=__dependency7__["default"];var Resolve=__dependency8__["default"];var Reject=__dependency9__["default"];var guidKey="rsvp_"+now()+"-";var counter=0;function noop(){}__exports__["default"]=Promise;function Promise(resolver,label){if(!isFunction(resolver)){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}if(!(this instanceof Promise)){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}this._id=counter++;this._label=label;this._subscribers=[];if(config.instrument){instrument("created",this)}if(noop!==resolver){invokeResolver(resolver,this)}}function invokeResolver(resolver,promise){function resolvePromise(value){resolve(promise,value)}function rejectPromise(reason){reject(promise,reason)}try{resolver(resolvePromise,rejectPromise)}catch(e){rejectPromise(e)}}Promise.cast=cast;Promise.all=all;Promise.race=race;Promise.resolve=Resolve;Promise.reject=Reject;var PENDING=void 0;var SEALED=0;var FULFILLED=1;var REJECTED=2;function subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;subscribers[length]=child;subscribers[length+FULFILLED]=onFulfillment;subscribers[length+REJECTED]=onRejection}function publish(promise,settled){var child,callback,subscribers=promise._subscribers,detail=promise._detail;if(config.instrument){instrument(settled===FULFILLED?"fulfilled":"rejected",promise)}for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];invokeCallback(settled,child,callback,detail)}promise._subscribers=null}Promise.prototype={constructor:Promise,_id:undefined,_guidKey:guidKey,_label:undefined,_state:undefined,_detail:undefined,_subscribers:undefined,_onerror:function(reason){config.trigger("error",reason)},then:function(onFulfillment,onRejection,label){var promise=this;this._onerror=null;var thenPromise=new this.constructor(noop,label);if(this._state){var callbacks=arguments;config.async(function invokePromiseCallback(){invokeCallback(promise._state,thenPromise,callbacks[promise._state-1],promise._detail)})}else{subscribe(this,thenPromise,onFulfillment,onRejection)}if(config.instrument){instrument("chained",promise,thenPromise)}return thenPromise},catch:function(onRejection,label){return this.then(null,onRejection,label)},finally:function(callback,label){var constructor=this.constructor;return this.then(function(value){return constructor.cast(callback()).then(function(){return value})},function(reason){return constructor.cast(callback()).then(function(){throw reason})},label)}};function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value,error,succeeded,failed;if(hasCallback){try{value=callback(detail);succeeded=true}catch(e){failed=true;error=e}}else{value=detail;succeeded=true}if(handleThenable(promise,value)){return}else if(hasCallback&&succeeded){resolve(promise,value)}else if(failed){reject(promise,error)}else if(settled===FULFILLED){resolve(promise,value)}else if(settled===REJECTED){reject(promise,value)}}function handleThenable(promise,value){var then=null,resolved;try{if(promise===value){throw new TypeError("A promises callback cannot return that same promise.")}if(objectOrFunction(value)){then=value.then;if(isFunction(then)){then.call(value,function(val){if(resolved){return true}resolved=true;if(value!==val){resolve(promise,val)}else{fulfill(promise,val)}},function(val){if(resolved){return true}resolved=true;reject(promise,val)},"derived from: "+(promise._label||" unknown promise"));return true}}}catch(error){if(resolved){return true}reject(promise,error);return true}return false}function resolve(promise,value){if(promise===value){fulfill(promise,value)}else if(!handleThenable(promise,value)){fulfill(promise,value)}}function fulfill(promise,value){if(promise._state!==PENDING){return}promise._state=SEALED;promise._detail=value;config.async(publishFulfillment,promise)}function reject(promise,reason){if(promise._state!==PENDING){return}promise._state=SEALED;promise._detail=reason;config.async(publishRejection,promise)}function publishFulfillment(promise){publish(promise,promise._state=FULFILLED)}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._detail)}publish(promise,promise._state=REJECTED)}});define("rsvp/promise/all",["../utils","exports"],function(__dependency1__,__exports__){var isArray=__dependency1__.isArray;var isNonThenable=__dependency1__.isNonThenable;__exports__["default"]=function all(entries,label){var Constructor=this;return new Constructor(function(resolve,reject){if(!isArray(entries)){throw new TypeError("You must pass an array to all.")}var remaining=entries.length;var results=new Array(remaining);var entry,pending=true;if(remaining===0){resolve(results);return}function fulfillmentAt(index){return function(value){results[index]=value;if(--remaining===0){resolve(results)}}}function onRejection(reason){remaining=0;reject(reason)}for(var index=0;index<entries.length;index++){entry=entries[index];if(isNonThenable(entry)){results[index]=entry;if(--remaining===0){resolve(results)}}else{Constructor.cast(entry).then(fulfillmentAt(index),onRejection)}}},label)}});define("rsvp/promise/cast",["exports"],function(__exports__){__exports__["default"]=function cast(object,label){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}return new Constructor(function(resolve){resolve(object)},label)}});define("rsvp/promise/race",["../utils","exports"],function(__dependency1__,__exports__){var isArray=__dependency1__.isArray;var isFunction=__dependency1__.isFunction;var isNonThenable=__dependency1__.isNonThenable;__exports__["default"]=function race(entries,label){var Constructor=this,entry;return new Constructor(function(resolve,reject){if(!isArray(entries)){throw new TypeError("You must pass an array to race.")}var pending=true;function onFulfillment(value){if(pending){pending=false;resolve(value)}}function onRejection(reason){if(pending){pending=false;reject(reason)}}for(var i=0;i<entries.length;i++){entry=entries[i];if(isNonThenable(entry)){pending=false;resolve(entry);return}else{Constructor.cast(entry).then(onFulfillment,onRejection)}}},label)}});define("rsvp/promise/reject",["exports"],function(__exports__){__exports__["default"]=function reject(reason,label){var Constructor=this;return new Constructor(function(resolve,reject){reject(reason)},label)}});define("rsvp/promise/resolve",["exports"],function(__exports__){__exports__["default"]=function resolve(value,label){var Constructor=this;return new Constructor(function(resolve,reject){resolve(value)},label)}});define("rsvp/race",["./promise","exports"],function(__dependency1__,__exports__){var Promise=__dependency1__["default"];__exports__["default"]=function race(array,label){return Promise.race(array,label)}});define("rsvp/reject",["./promise","exports"],function(__dependency1__,__exports__){var Promise=__dependency1__["default"];__exports__["default"]=function reject(reason,label){return Promise.reject(reason,label)}});define("rsvp/resolve",["./promise","exports"],function(__dependency1__,__exports__){var Promise=__dependency1__["default"];__exports__["default"]=function resolve(value,label){return Promise.resolve(value,label)}});define("rsvp/rethrow",["exports"],function(__exports__){__exports__["default"]=function rethrow(reason){setTimeout(function(){throw reason});throw reason}});define("rsvp/utils",["exports"],function(__exports__){function objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}__exports__.objectOrFunction=objectOrFunction;function isFunction(x){return typeof x==="function"}__exports__.isFunction=isFunction;function isNonThenable(x){return!objectOrFunction(x)}__exports__.isNonThenable=isNonThenable;function isArray(x){return Object.prototype.toString.call(x)==="[object Array]"}__exports__.isArray=isArray;var now=Date.now||function(){return(new Date).getTime()};__exports__.now=now;var keysOf=Object.keys||function(object){var result=[];for(var prop in object){result.push(prop)}return result};__exports__.keysOf=keysOf});define("rsvp",["./rsvp/promise","./rsvp/events","./rsvp/node","./rsvp/all","./rsvp/all_settled","./rsvp/race","./rsvp/hash","./rsvp/rethrow","./rsvp/defer","./rsvp/config","./rsvp/map","./rsvp/resolve","./rsvp/reject","./rsvp/filter","exports"],function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__,__dependency6__,__dependency7__,__dependency8__,__dependency9__,__dependency10__,__dependency11__,__dependency12__,__dependency13__,__dependency14__,__exports__){var Promise=__dependency1__["default"];var EventTarget=__dependency2__["default"];var denodeify=__dependency3__["default"];var all=__dependency4__["default"];var allSettled=__dependency5__["default"];var race=__dependency6__["default"];var hash=__dependency7__["default"];var rethrow=__dependency8__["default"];var defer=__dependency9__["default"];var config=__dependency10__.config;var configure=__dependency10__.configure;var map=__dependency11__["default"];var resolve=__dependency12__["default"];var reject=__dependency13__["default"];var filter=__dependency14__["default"];function async(callback,arg){config.async(callback,arg)}function on(){config.on.apply(config,arguments)}function off(){config.off.apply(config,arguments)}if(typeof window!=="undefined"&&typeof window.__PROMISE_INSTRUMENTATION__==="object"){var callbacks=window.__PROMISE_INSTRUMENTATION__;configure("instrument",true);for(var eventName in callbacks){if(callbacks.hasOwnProperty(eventName)){on(eventName,callbacks[eventName])}}}__exports__.Promise=Promise;__exports__.EventTarget=EventTarget;__exports__.all=all;__exports__.allSettled=allSettled;__exports__.race=race;__exports__.hash=hash;__exports__.rethrow=rethrow;__exports__.defer=defer;__exports__.denodeify=denodeify;__exports__.configure=configure;__exports__.on=on;__exports__.off=off;__exports__.resolve=resolve;__exports__.reject=reject;__exports__.async=async;__exports__.map=map;__exports__.filter=filter})})();(function(){Ember.MODEL_FACTORY_INJECTIONS=false||!!Ember.ENV.MODEL_FACTORY_INJECTIONS;define("container",[],function(){function InheritingDict(parent){this.parent=parent;this.dict={}}InheritingDict.prototype={parent:null,dict:null,get:function(key){var dict=this.dict;if(dict.hasOwnProperty(key)){return dict[key]}if(this.parent){return this.parent.get(key)}},set:function(key,value){this.dict[key]=value},remove:function(key){delete this.dict[key]},has:function(key){var dict=this.dict;if(dict.hasOwnProperty(key)){return true}if(this.parent){return this.parent.has(key)}return false},eachLocal:function(callback,binding){var dict=this.dict;for(var prop in dict){if(dict.hasOwnProperty(prop)){callback.call(binding,prop,dict[prop])}}}};function Container(parent){this.parent=parent;this.children=[];this.resolver=parent&&parent.resolver||function(){};this.registry=new InheritingDict(parent&&parent.registry);this.cache=new InheritingDict(parent&&parent.cache);this.factoryCache=new InheritingDict(parent&&parent.factoryCache);this.resolveCache=new InheritingDict(parent&&parent.resolveCache);this.typeInjections=new InheritingDict(parent&&parent.typeInjections);this.injections={};this.factoryTypeInjections=new InheritingDict(parent&&parent.factoryTypeInjections);this.factoryInjections={};this._options=new InheritingDict(parent&&parent._options);this._typeOptions=new InheritingDict(parent&&parent._typeOptions)}Container.prototype={parent:null,children:null,resolver:null,registry:null,cache:null,typeInjections:null,injections:null,_options:null,_typeOptions:null,child:function(){var container=new Container(this);this.children.push(container);return container},set:function(object,key,value){object[key]=value},register:function(fullName,factory,options){validateFullName(fullName);if(factory===undefined){throw new TypeError("Attempting to register an unknown factory: `"+fullName+"`")}var normalizedName=this.normalize(fullName);if(this.cache.has(normalizedName)){throw new Error("Cannot re-register: `"+fullName+"`, as it has already been looked up.")}this.registry.set(normalizedName,factory);this._options.set(normalizedName,options||{})},unregister:function(fullName){validateFullName(fullName);var normalizedName=this.normalize(fullName);this.registry.remove(normalizedName);this.cache.remove(normalizedName);this.factoryCache.remove(normalizedName);this.resolveCache.remove(normalizedName);this._options.remove(normalizedName)},resolve:function(fullName){validateFullName(fullName);var normalizedName=this.normalize(fullName);var cached=this.resolveCache.get(normalizedName);if(cached){return cached}var resolved=this.resolver(normalizedName)||this.registry.get(normalizedName);this.resolveCache.set(normalizedName,resolved);return resolved},describe:function(fullName){return fullName},normalize:function(fullName){return fullName},makeToString:function(factory,fullName){return factory.toString()},lookup:function(fullName,options){validateFullName(fullName);return lookup(this,this.normalize(fullName),options)},lookupFactory:function(fullName){validateFullName(fullName);return factoryFor(this,this.normalize(fullName))},has:function(fullName){validateFullName(fullName);return has(this,this.normalize(fullName))},optionsForType:function(type,options){if(this.parent){illegalChildOperation("optionsForType")}this._typeOptions.set(type,options)},options:function(type,options){this.optionsForType(type,options)},typeInjection:function(type,property,fullName){validateFullName(fullName);if(this.parent){illegalChildOperation("typeInjection")}addTypeInjection(this.typeInjections,type,property,fullName)},injection:function(fullName,property,injectionName){if(this.parent){illegalChildOperation("injection")}validateFullName(injectionName);var normalizedInjectionName=this.normalize(injectionName);if(fullName.indexOf(":")===-1){return this.typeInjection(fullName,property,normalizedInjectionName)}validateFullName(fullName);var normalizedName=this.normalize(fullName);addInjection(this.injections,normalizedName,property,normalizedInjectionName)},factoryTypeInjection:function(type,property,fullName){if(this.parent){illegalChildOperation("factoryTypeInjection")}addTypeInjection(this.factoryTypeInjections,type,property,this.normalize(fullName))},factoryInjection:function(fullName,property,injectionName){if(this.parent){illegalChildOperation("injection")}var normalizedName=this.normalize(fullName);var normalizedInjectionName=this.normalize(injectionName);validateFullName(injectionName);if(fullName.indexOf(":")===-1){return this.factoryTypeInjection(normalizedName,property,normalizedInjectionName)}validateFullName(fullName);addInjection(this.factoryInjections,normalizedName,property,normalizedInjectionName)},destroy:function(){for(var i=0,l=this.children.length;i<l;i++){this.children[i].destroy()}this.children=[];eachDestroyable(this,function(item){item.destroy()});this.parent=undefined;this.isDestroyed=true},reset:function(){for(var i=0,l=this.children.length;i<l;i++){resetCache(this.children[i])}resetCache(this)}};function has(container,fullName){if(container.cache.has(fullName)){return true}return!!container.resolve(fullName)}function lookup(container,fullName,options){options=options||{};if(container.cache.has(fullName)&&options.singleton!==false){return container.cache.get(fullName)}var value=instantiate(container,fullName);if(value===undefined){return}if(isSingleton(container,fullName)&&options.singleton!==false){container.cache.set(fullName,value)}return value}function illegalChildOperation(operation){throw new Error(operation+" is not currently supported on child containers")}function isSingleton(container,fullName){var singleton=option(container,fullName,"singleton");return singleton!==false}function buildInjections(container,injections){var hash={};if(!injections){return hash}var injection,injectable;for(var i=0,l=injections.length;i<l;i++){injection=injections[i];injectable=lookup(container,injection.fullName);if(injectable!==undefined){hash[injection.property]=injectable}else{throw new Error("Attempting to inject an unknown injection: `"+injection.fullName+"`")}}return hash}function option(container,fullName,optionName){var options=container._options.get(fullName);if(options&&options[optionName]!==undefined){return options[optionName]}var type=fullName.split(":")[0];options=container._typeOptions.get(type);if(options){return options[optionName]}}function factoryFor(container,fullName){var name=fullName;var factory=container.resolve(name);var injectedFactory;var cache=container.factoryCache;var type=fullName.split(":")[0];if(factory===undefined){return}if(cache.has(fullName)){return cache.get(fullName)}if(!factory||typeof factory.extend!=="function"||!Ember.MODEL_FACTORY_INJECTIONS&&type==="model"){return factory}else{var injections=injectionsFor(container,fullName);var factoryInjections=factoryInjectionsFor(container,fullName);factoryInjections._toString=container.makeToString(factory,fullName);injectedFactory=factory.extend(injections);injectedFactory.reopenClass(factoryInjections);cache.set(fullName,injectedFactory);return injectedFactory}}function injectionsFor(container,fullName){var splitName=fullName.split(":"),type=splitName[0],injections=[];injections=injections.concat(container.typeInjections.get(type)||[]);injections=injections.concat(container.injections[fullName]||[]);injections=buildInjections(container,injections);injections._debugContainerKey=fullName;injections.container=container;return injections}function factoryInjectionsFor(container,fullName){var splitName=fullName.split(":"),type=splitName[0],factoryInjections=[];factoryInjections=factoryInjections.concat(container.factoryTypeInjections.get(type)||[]);factoryInjections=factoryInjections.concat(container.factoryInjections[fullName]||[]);factoryInjections=buildInjections(container,factoryInjections);factoryInjections._debugContainerKey=fullName;return factoryInjections}function instantiate(container,fullName){var factory=factoryFor(container,fullName);if(option(container,fullName,"instantiate")===false){return factory}if(factory){if(typeof factory.extend==="function"){return factory.create()}else{return factory.create(injectionsFor(container,fullName))}}}function eachDestroyable(container,callback){container.cache.eachLocal(function(key,value){if(option(container,key,"instantiate")===false){return}callback(value)})}function resetCache(container){container.cache.eachLocal(function(key,value){if(option(container,key,"instantiate")===false){return}value.destroy()});container.cache.dict={}}function addTypeInjection(rules,type,property,fullName){var injections=rules.get(type);if(!injections){injections=[];rules.set(type,injections)}injections.push({property:property,fullName:fullName})}var VALID_FULL_NAME_REGEXP=/^[^:]+.+:[^:]+$/;function validateFullName(fullName){if(!VALID_FULL_NAME_REGEXP.test(fullName)){throw new TypeError("Invalid Fullname, expected: `type:name` got: "+fullName)}}function addInjection(rules,factoryName,property,injectionName){var injections=rules[factoryName]=rules[factoryName]||[];injections.push({property:property,fullName:injectionName})}return Container})})();(function(){var indexOf=Ember.EnumerableUtils.indexOf;Ember.compare=function compare(v,w){if(v===w){return 0}var type1=Ember.typeOf(v);var type2=Ember.typeOf(w);var Comparable=Ember.Comparable;if(Comparable){if(type1==="instance"&&Comparable.detect(v.constructor)){return v.constructor.compare(v,w)}if(type2==="instance"&&Comparable.detect(w.constructor)){return 1-w.constructor.compare(w,v)}}var mapping=Ember.ORDER_DEFINITION_MAPPING;if(!mapping){var order=Ember.ORDER_DEFINITION;mapping=Ember.ORDER_DEFINITION_MAPPING={};var idx,len;for(idx=0,len=order.length;idx<len;++idx){mapping[order[idx]]=idx}delete Ember.ORDER_DEFINITION}var type1Index=mapping[type1];var type2Index=mapping[type2];if(type1Index<type2Index){return-1}if(type1Index>type2Index){return 1}switch(type1){case"boolean":case"number":if(v<w){return-1}if(v>w){return 1}return 0;case"string":var comp=v.localeCompare(w);if(comp<0){return-1}if(comp>0){return 1}return 0;case"array":var vLen=v.length;var wLen=w.length;var l=Math.min(vLen,wLen);var r=0;var i=0;while(r===0&&i<l){r=compare(v[i],w[i]);i++}if(r!==0){return r}if(vLen<wLen){return-1}if(vLen>wLen){return 1}return 0;case"instance":if(Ember.Comparable&&Ember.Comparable.detect(v)){return v.compare(v,w)}return 0;case"date":var vNum=v.getTime();var wNum=w.getTime();if(vNum<wNum){return-1}if(vNum>wNum){return 1}return 0;default:return 0}};function _copy(obj,deep,seen,copies){var ret,loc,key;if("object"!==typeof obj||obj===null)return obj;if(deep&&(loc=indexOf(seen,obj))>=0)return copies[loc];if(Ember.typeOf(obj)==="array"){ret=obj.slice();if(deep){loc=ret.length;while(--loc>=0)ret[loc]=_copy(ret[loc],deep,seen,copies)}}else if(Ember.Copyable&&Ember.Copyable.detect(obj)){ret=obj.copy(deep,seen,copies)}else{ret={};for(key in obj){if(!obj.hasOwnProperty(key))continue;if(key.substring(0,2)==="__")continue;ret[key]=deep?_copy(obj[key],deep,seen,copies):obj[key]}}if(deep){seen.push(obj);copies.push(ret)}return ret}Ember.copy=function(obj,deep){if("object"!==typeof obj||obj===null)return obj;if(Ember.Copyable&&Ember.Copyable.detect(obj))return obj.copy(deep);return _copy(obj,deep,deep?[]:null,deep?[]:null)};Ember.isEqual=function(a,b){if(a&&"function"===typeof a.isEqual)return a.isEqual(b);return a===b};Ember.ORDER_DEFINITION=Ember.ENV.ORDER_DEFINITION||["undefined","null","boolean","number","string","array","object","instance","function","class","date"];Ember.keys=Object.keys;if(!Ember.keys||Ember.create.isSimulated){var prototypeProperties=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","valueOf","toLocaleString","toString"],pushPropertyName=function(obj,array,key){if(key.substring(0,2)==="__")return;if(key==="_super")return;if(indexOf(array,key)>=0)return;if(!obj.hasOwnProperty(key))return;array.push(key)};Ember.keys=function(obj){var ret=[],key;for(key in obj){pushPropertyName(obj,ret,key)}for(var i=0,l=prototypeProperties.length;i<l;i++){key=prototypeProperties[i];pushPropertyName(obj,ret,key)}return ret}}})();(function(){var STRING_DASHERIZE_REGEXP=/[ _]/g;var STRING_DASHERIZE_CACHE={};var STRING_DECAMELIZE_REGEXP=/([a-z\d])([A-Z])/g;var STRING_CAMELIZE_REGEXP=/(\-|_|\.|\s)+(.)?/g;var STRING_UNDERSCORE_REGEXP_1=/([a-z\d])([A-Z]+)/g;var STRING_UNDERSCORE_REGEXP_2=/\-|\s+/g;var STRING_PARAMETERIZE_REGEXP_1=/[_|\/|\s]+/g;var STRING_PARAMETERIZE_REGEXP_2=/[^a-z0-9\-]+/gi;var STRING_PARAMETERIZE_REGEXP_3=/[\-]+/g;var STRING_PARAMETERIZE_REGEXP_4=/^-+|-+$/g;Ember.STRINGS={};Ember.String={fmt:function(str,formats){var idx=0;return str.replace(/%@([0-9]+)?/g,function(s,argIndex){argIndex=argIndex?parseInt(argIndex,10)-1:idx++;s=formats[argIndex];return s===null?"(null)":s===undefined?"":Ember.inspect(s)})},loc:function(str,formats){str=Ember.STRINGS[str]||str;return Ember.String.fmt(str,formats)},w:function(str){return str.split(/\s+/)},decamelize:function(str){return str.replace(STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase()},dasherize:function(str){var cache=STRING_DASHERIZE_CACHE,hit=cache.hasOwnProperty(str),ret;if(hit){return cache[str]}else{ret=Ember.String.decamelize(str).replace(STRING_DASHERIZE_REGEXP,"-");cache[str]=ret}return ret},camelize:function(str){return str.replace(STRING_CAMELIZE_REGEXP,function(match,separator,chr){return chr?chr.toUpperCase():""}).replace(/^([A-Z])/,function(match,separator,chr){return match.toLowerCase()})},classify:function(str){var parts=str.split("."),out=[];for(var i=0,l=parts.length;i<l;i++){var camelized=Ember.String.camelize(parts[i]);out.push(camelized.charAt(0).toUpperCase()+camelized.substr(1))}return out.join(".")},underscore:function(str){return str.replace(STRING_UNDERSCORE_REGEXP_1,"$1_$2").replace(STRING_UNDERSCORE_REGEXP_2,"_").toLowerCase()},capitalize:function(str){return str.charAt(0).toUpperCase()+str.substr(1)}};if(Ember.FEATURES.isEnabled("string-humanize")){Ember.String.humanize=function(str){return str.replace(/_id$/,"").replace(/_/g," ").replace(/^\w/g,function(s){return s.toUpperCase()})}}if(Ember.FEATURES.isEnabled("string-parameterize")){Ember.String.parameterize=function(str){return str.replace(STRING_PARAMETERIZE_REGEXP_1,"-").replace(STRING_PARAMETERIZE_REGEXP_2,"").replace(STRING_PARAMETERIZE_REGEXP_3,"-").replace(STRING_PARAMETERIZE_REGEXP_4,"").toLowerCase()}}})();(function(){var fmt=Ember.String.fmt,w=Ember.String.w,loc=Ember.String.loc,camelize=Ember.String.camelize,decamelize=Ember.String.decamelize,dasherize=Ember.String.dasherize,underscore=Ember.String.underscore,capitalize=Ember.String.capitalize,classify=Ember.String.classify;if(Ember.FEATURES.isEnabled("string-humanize")){var humanize=Ember.String.humanize}if(Ember.FEATURES.isEnabled("string-parameterize")){var parameterize=Ember.String.parameterize}if(Ember.EXTEND_PROTOTYPES===true||Ember.EXTEND_PROTOTYPES.String){String.prototype.fmt=function(){return fmt(this,arguments)};String.prototype.w=function(){return w(this)};String.prototype.loc=function(){return loc(this,arguments)};String.prototype.camelize=function(){return camelize(this)};String.prototype.decamelize=function(){return decamelize(this)};String.prototype.dasherize=function(){return dasherize(this)};String.prototype.underscore=function(){return underscore(this)};String.prototype.classify=function(){return classify(this)};String.prototype.capitalize=function(){return capitalize(this)};if(Ember.FEATURES.isEnabled("string-humanize")){String.prototype.humanize=function(){return humanize(this)}}if(Ember.FEATURES.isEnabled("string-parameterize")){String.prototype.parameterize=function(){return parameterize(this)}}}})();(function(){var get=Ember.get,set=Ember.set,slice=Array.prototype.slice,getProperties=Ember.getProperties;Ember.Observable=Ember.Mixin.create({get:function(keyName){return get(this,keyName)},getProperties:function(){return getProperties.apply(null,[this].concat(slice.call(arguments)))},set:function(keyName,value){set(this,keyName,value);return this},setProperties:function(hash){return Ember.setProperties(this,hash)},beginPropertyChanges:function(){Ember.beginPropertyChanges();return this},endPropertyChanges:function(){Ember.endPropertyChanges();return this},propertyWillChange:function(keyName){Ember.propertyWillChange(this,keyName);return this},propertyDidChange:function(keyName){Ember.propertyDidChange(this,keyName);return this},notifyPropertyChange:function(keyName){this.propertyWillChange(keyName);this.propertyDidChange(keyName);return this},addBeforeObserver:function(key,target,method){Ember.addBeforeObserver(this,key,target,method)},addObserver:function(key,target,method){Ember.addObserver(this,key,target,method)},removeObserver:function(key,target,method){Ember.removeObserver(this,key,target,method)},hasObserverFor:function(key){return Ember.hasListeners(this,key+":change")},getWithDefault:function(keyName,defaultValue){return Ember.getWithDefault(this,keyName,defaultValue)},incrementProperty:function(keyName,increment){if(Ember.isNone(increment)){increment=1}set(this,keyName,(get(this,keyName)||0)+increment);return get(this,keyName)},decrementProperty:function(keyName,decrement){if(Ember.isNone(decrement)){decrement=1}set(this,keyName,(get(this,keyName)||0)-decrement);return get(this,keyName)},toggleProperty:function(keyName){set(this,keyName,!get(this,keyName));return get(this,keyName)},cacheFor:function(keyName){return Ember.cacheFor(this,keyName)},observersForKey:function(keyName){return Ember.observersFor(this,keyName)}})})();(function(){var set=Ember.set,get=Ember.get,o_create=Ember.create,o_defineProperty=Ember.platform.defineProperty,GUID_KEY=Ember.GUID_KEY,guidFor=Ember.guidFor,generateGuid=Ember.generateGuid,meta=Ember.meta,META_KEY=Ember.META_KEY,rewatch=Ember.rewatch,finishChains=Ember.finishChains,sendEvent=Ember.sendEvent,destroy=Ember.destroy,schedule=Ember.run.schedule,Mixin=Ember.Mixin,applyMixin=Mixin._apply,finishPartial=Mixin.finishPartial,reopen=Mixin.prototype.reopen,MANDATORY_SETTER=Ember.ENV.MANDATORY_SETTER,indexOf=Ember.EnumerableUtils.indexOf;var undefinedDescriptor={configurable:true,writable:true,enumerable:false,value:undefined};function makeCtor(){var wasApplied=false,initMixins,initProperties;var Class=function(){if(!wasApplied){Class.proto()}o_defineProperty(this,GUID_KEY,undefinedDescriptor);o_defineProperty(this,"_super",undefinedDescriptor);var m=meta(this),proto=m.proto;m.proto=this;if(initMixins){var mixins=initMixins;initMixins=null;this.reopen.apply(this,mixins)}if(initProperties){var props=initProperties;initProperties=null;var concatenatedProperties=this.concatenatedProperties;for(var i=0,l=props.length;i<l;i++){var properties=props[i];if(typeof properties!=="object"&&properties!==undefined){throw new Ember.Error("Ember.Object.create only accepts objects.")}if(!properties){continue}var keyNames=Ember.keys(properties);for(var j=0,ll=keyNames.length;j<ll;j++){var keyName=keyNames[j];if(!properties.hasOwnProperty(keyName)){continue}var value=properties[keyName],IS_BINDING=Ember.IS_BINDING;if(IS_BINDING.test(keyName)){var bindings=m.bindings;if(!bindings){bindings=m.bindings={}}else if(!m.hasOwnProperty("bindings")){bindings=m.bindings=o_create(m.bindings)}bindings[keyName]=value}var desc=m.descs[keyName];if(concatenatedProperties&&indexOf(concatenatedProperties,keyName)>=0){var baseValue=this[keyName];if(baseValue){if("function"===typeof baseValue.concat){value=baseValue.concat(value)}else{value=Ember.makeArray(baseValue).concat(value)}}else{value=Ember.makeArray(value)}}if(desc){desc.set(this,keyName,value)}else{if(typeof this.setUnknownProperty==="function"&&!(keyName in this)){this.setUnknownProperty(keyName,value)}else if(MANDATORY_SETTER){Ember.defineProperty(this,keyName,null,value)}else{this[keyName]=value}}}}}finishPartial(this,m);this.init.apply(this,arguments);m.proto=proto;finishChains(this);sendEvent(this,"init")};Class.toString=Mixin.prototype.toString;Class.willReopen=function(){if(wasApplied){Class.PrototypeMixin=Mixin.create(Class.PrototypeMixin)}
wasApplied=false};Class._initMixins=function(args){initMixins=args};Class._initProperties=function(args){initProperties=args};Class.proto=function(){var superclass=Class.superclass;if(superclass){superclass.proto()}if(!wasApplied){wasApplied=true;Class.PrototypeMixin.applyPartial(Class.prototype);rewatch(Class.prototype)}return this.prototype};return Class}var CoreObject=makeCtor();CoreObject.toString=function(){return"Ember.CoreObject"};CoreObject.PrototypeMixin=Mixin.create({reopen:function(){applyMixin(this,arguments,true);return this},init:function(){},concatenatedProperties:null,isDestroyed:false,isDestroying:false,destroy:function(){if(this.isDestroying){return}this.isDestroying=true;schedule("actions",this,this.willDestroy);schedule("destroy",this,this._scheduledDestroy);return this},willDestroy:Ember.K,_scheduledDestroy:function(){if(this.isDestroyed){return}destroy(this);this.isDestroyed=true},bind:function(to,from){if(!(from instanceof Ember.Binding)){from=Ember.Binding.from(from)}from.to(to).connect(this);return from},toString:function toString(){var hasToStringExtension=typeof this.toStringExtension==="function",extension=hasToStringExtension?":"+this.toStringExtension():"";var ret="<"+this.constructor.toString()+":"+guidFor(this)+extension+">";this.toString=makeToString(ret);return ret}});CoreObject.PrototypeMixin.ownerConstructor=CoreObject;function makeToString(ret){return function(){return ret}}if(Ember.config.overridePrototypeMixin){Ember.config.overridePrototypeMixin(CoreObject.PrototypeMixin)}CoreObject.__super__=null;var ClassMixin=Mixin.create({ClassMixin:Ember.required(),PrototypeMixin:Ember.required(),isClass:true,isMethod:false,extend:function(){var Class=makeCtor(),proto;Class.ClassMixin=Mixin.create(this.ClassMixin);Class.PrototypeMixin=Mixin.create(this.PrototypeMixin);Class.ClassMixin.ownerConstructor=Class;Class.PrototypeMixin.ownerConstructor=Class;reopen.apply(Class.PrototypeMixin,arguments);Class.superclass=this;Class.__super__=this.prototype;proto=Class.prototype=o_create(this.prototype);proto.constructor=Class;generateGuid(proto);meta(proto).proto=proto;Class.ClassMixin.apply(Class);return Class},createWithMixins:function(){var C=this;if(arguments.length>0){this._initMixins(arguments)}return new C},create:function(){var C=this;if(arguments.length>0){this._initProperties(arguments)}return new C},reopen:function(){this.willReopen();reopen.apply(this.PrototypeMixin,arguments);return this},reopenClass:function(){reopen.apply(this.ClassMixin,arguments);applyMixin(this,arguments,false);return this},detect:function(obj){if("function"!==typeof obj){return false}while(obj){if(obj===this){return true}obj=obj.superclass}return false},detectInstance:function(obj){return obj instanceof this},metaForProperty:function(key){var meta=this.proto()[META_KEY],desc=meta&&meta.descs[key];return desc._meta||{}},eachComputedProperty:function(callback,binding){var proto=this.proto(),descs=meta(proto).descs,empty={},property;for(var name in descs){property=descs[name];if(property instanceof Ember.ComputedProperty){callback.call(binding||this,name,property._meta||empty)}}}});ClassMixin.ownerConstructor=CoreObject;if(Ember.config.overrideClassMixin){Ember.config.overrideClassMixin(ClassMixin)}CoreObject.ClassMixin=ClassMixin;ClassMixin.apply(CoreObject);Ember.CoreObject=CoreObject})();(function(){Ember.Object=Ember.CoreObject.extend(Ember.Observable);Ember.Object.toString=function(){return"Ember.Object"}})();(function(){var get=Ember.get,indexOf=Ember.ArrayPolyfills.indexOf;var Namespace=Ember.Namespace=Ember.Object.extend({isNamespace:true,init:function(){Ember.Namespace.NAMESPACES.push(this);Ember.Namespace.PROCESSED=false},toString:function(){var name=get(this,"name");if(name){return name}findNamespaces();return this[Ember.GUID_KEY+"_name"]},nameClasses:function(){processNamespace([this.toString()],this,{})},destroy:function(){var namespaces=Ember.Namespace.NAMESPACES;Ember.lookup[this.toString()]=undefined;namespaces.splice(indexOf.call(namespaces,this),1);this._super()}});Namespace.reopenClass({NAMESPACES:[Ember],NAMESPACES_BY_ID:{},PROCESSED:false,processAll:processAllNamespaces,byName:function(name){if(!Ember.BOOTED){processAllNamespaces()}return NAMESPACES_BY_ID[name]}});var NAMESPACES_BY_ID=Namespace.NAMESPACES_BY_ID;var hasOwnProp={}.hasOwnProperty,guidFor=Ember.guidFor;function processNamespace(paths,root,seen){var idx=paths.length;NAMESPACES_BY_ID[paths.join(".")]=root;for(var key in root){if(!hasOwnProp.call(root,key)){continue}var obj=root[key];paths[idx]=key;if(obj&&obj.toString===classToString){obj.toString=makeToString(paths.join("."));obj[NAME_KEY]=paths.join(".")}else if(obj&&obj.isNamespace){if(seen[guidFor(obj)]){continue}seen[guidFor(obj)]=true;processNamespace(paths,obj,seen)}}paths.length=idx}function findNamespaces(){var Namespace=Ember.Namespace,lookup=Ember.lookup,obj,isNamespace;if(Namespace.PROCESSED){return}for(var prop in lookup){if(prop==="parent"||prop==="top"||prop==="frameElement"||prop==="webkitStorageInfo"){continue}if(prop==="globalStorage"&&lookup.StorageList&&lookup.globalStorage instanceof lookup.StorageList){continue}if(lookup.hasOwnProperty&&!lookup.hasOwnProperty(prop)){continue}try{obj=Ember.lookup[prop];isNamespace=obj&&obj.isNamespace}catch(e){continue}if(isNamespace){obj[NAME_KEY]=prop}}}var NAME_KEY=Ember.NAME_KEY=Ember.GUID_KEY+"_name";function superClassString(mixin){var superclass=mixin.superclass;if(superclass){if(superclass[NAME_KEY]){return superclass[NAME_KEY]}else{return superClassString(superclass)}}else{return}}function classToString(){if(!Ember.BOOTED&&!this[NAME_KEY]){processAllNamespaces()}var ret;if(this[NAME_KEY]){ret=this[NAME_KEY]}else if(this._toString){ret=this._toString}else{var str=superClassString(this);if(str){ret="(subclass of "+str+")"}else{ret="(unknown mixin)"}this.toString=makeToString(ret)}return ret}function processAllNamespaces(){var unprocessedNamespaces=!Namespace.PROCESSED,unprocessedMixins=Ember.anyUnprocessedMixins;if(unprocessedNamespaces){findNamespaces();Namespace.PROCESSED=true}if(unprocessedNamespaces||unprocessedMixins){var namespaces=Namespace.NAMESPACES,namespace;for(var i=0,l=namespaces.length;i<l;i++){namespace=namespaces[i];processNamespace([namespace.toString()],namespace,{})}Ember.anyUnprocessedMixins=false}}function makeToString(ret){return function(){return ret}}Ember.Mixin.prototype.toString=classToString})();(function(){var get=Ember.get,set=Ember.set,fmt=Ember.String.fmt,addBeforeObserver=Ember.addBeforeObserver,addObserver=Ember.addObserver,removeBeforeObserver=Ember.removeBeforeObserver,removeObserver=Ember.removeObserver,propertyWillChange=Ember.propertyWillChange,propertyDidChange=Ember.propertyDidChange,meta=Ember.meta,defineProperty=Ember.defineProperty;function contentPropertyWillChange(content,contentKey){var key=contentKey.slice(8);if(key in this){return}propertyWillChange(this,key)}function contentPropertyDidChange(content,contentKey){var key=contentKey.slice(8);if(key in this){return}propertyDidChange(this,key)}Ember.ObjectProxy=Ember.Object.extend({content:null,_contentDidChange:Ember.observer("content",function(){}),isTruthy:Ember.computed.bool("content"),_debugContainerKey:null,willWatchProperty:function(key){var contentKey="content."+key;addBeforeObserver(this,contentKey,null,contentPropertyWillChange);addObserver(this,contentKey,null,contentPropertyDidChange)},didUnwatchProperty:function(key){var contentKey="content."+key;removeBeforeObserver(this,contentKey,null,contentPropertyWillChange);removeObserver(this,contentKey,null,contentPropertyDidChange)},unknownProperty:function(key){var content=get(this,"content");if(content){return get(content,key)}},setUnknownProperty:function(key,value){var m=meta(this);if(m.proto===this){defineProperty(this,key,null,value);return value}var content=get(this,"content");return set(content,key,value)}})})();(function(){var get=Ember.get,set=Ember.set;var a_slice=Array.prototype.slice;var a_indexOf=Ember.EnumerableUtils.indexOf;var contexts=[];function popCtx(){return contexts.length===0?{}:contexts.pop()}function pushCtx(ctx){contexts.push(ctx);return null}function iter(key,value){var valueProvided=arguments.length===2;function i(item){var cur=get(item,key);return valueProvided?value===cur:!!cur}return i}Ember.Enumerable=Ember.Mixin.create({nextObject:Ember.required(Function),firstObject:Ember.computed(function(){if(get(this,"length")===0)return undefined;var context=popCtx(),ret;ret=this.nextObject(0,null,context);pushCtx(context);return ret}).property("[]"),lastObject:Ember.computed(function(){var len=get(this,"length");if(len===0)return undefined;var context=popCtx(),idx=0,cur,last=null;do{last=cur;cur=this.nextObject(idx++,last,context)}while(cur!==undefined);pushCtx(context);return last}).property("[]"),contains:function(obj){return this.find(function(item){return item===obj})!==undefined},forEach:function(callback,target){if(typeof callback!=="function")throw new TypeError;var len=get(this,"length"),last=null,context=popCtx();if(target===undefined)target=null;for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);callback.call(target,next,idx,this);last=next}last=null;context=pushCtx(context);return this},getEach:function(key){return this.mapBy(key)},setEach:function(key,value){return this.forEach(function(item){set(item,key,value)})},map:function(callback,target){var ret=Ember.A();this.forEach(function(x,idx,i){ret[idx]=callback.call(target,x,idx,i)});return ret},mapBy:function(key){return this.map(function(next){return get(next,key)})},mapProperty:Ember.aliasMethod("mapBy"),filter:function(callback,target){var ret=Ember.A();this.forEach(function(x,idx,i){if(callback.call(target,x,idx,i))ret.push(x)});return ret},reject:function(callback,target){return this.filter(function(){return!callback.apply(target,arguments)})},filterBy:function(key,value){return this.filter(iter.apply(this,arguments))},filterProperty:Ember.aliasMethod("filterBy"),rejectBy:function(key,value){var exactValue=function(item){return get(item,key)===value},hasValue=function(item){return!!get(item,key)},use=arguments.length===2?exactValue:hasValue;return this.reject(use)},rejectProperty:Ember.aliasMethod("rejectBy"),find:function(callback,target){var len=get(this,"length");if(target===undefined)target=null;var last=null,next,found=false,ret;var context=popCtx();for(var idx=0;idx<len&&!found;idx++){next=this.nextObject(idx,last,context);if(found=callback.call(target,next,idx,this))ret=next;last=next}next=last=null;context=pushCtx(context);return ret},findBy:function(key,value){return this.find(iter.apply(this,arguments))},findProperty:Ember.aliasMethod("findBy"),every:function(callback,target){return!this.find(function(x,idx,i){return!callback.call(target,x,idx,i)})},everyBy:Ember.aliasMethod("isEvery"),everyProperty:Ember.aliasMethod("isEvery"),isEvery:function(key,value){return this.every(iter.apply(this,arguments))},any:function(callback,target){var found=this.find(function(x,idx,i){return!!callback.call(target,x,idx,i)});return typeof found!=="undefined"},some:Ember.aliasMethod("any"),isAny:function(key,value){return this.any(iter.apply(this,arguments))},anyBy:Ember.aliasMethod("isAny"),someProperty:Ember.aliasMethod("isAny"),reduce:function(callback,initialValue,reducerProperty){if(typeof callback!=="function"){throw new TypeError}var ret=initialValue;this.forEach(function(item,i){ret=callback(ret,item,i,this,reducerProperty)},this);return ret},invoke:function(methodName){var args,ret=Ember.A();if(arguments.length>1)args=a_slice.call(arguments,1);this.forEach(function(x,idx){var method=x&&x[methodName];if("function"===typeof method){ret[idx]=args?method.apply(x,args):x[methodName]()}},this);return ret},toArray:function(){var ret=Ember.A();this.forEach(function(o,idx){ret[idx]=o});return ret},compact:function(){return this.filter(function(value){return value!=null})},without:function(value){if(!this.contains(value))return this;var ret=Ember.A();this.forEach(function(k){if(k!==value)ret[ret.length]=k});return ret},uniq:function(){var ret=Ember.A();this.forEach(function(k){if(a_indexOf(ret,k)<0)ret.push(k)});return ret},"[]":Ember.computed(function(key,value){return this}),addEnumerableObserver:function(target,opts){var willChange=opts&&opts.willChange||"enumerableWillChange",didChange=opts&&opts.didChange||"enumerableDidChange";var hasObservers=get(this,"hasEnumerableObservers");if(!hasObservers)Ember.propertyWillChange(this,"hasEnumerableObservers");Ember.addListener(this,"@enumerable:before",target,willChange);Ember.addListener(this,"@enumerable:change",target,didChange);if(!hasObservers)Ember.propertyDidChange(this,"hasEnumerableObservers");return this},removeEnumerableObserver:function(target,opts){var willChange=opts&&opts.willChange||"enumerableWillChange",didChange=opts&&opts.didChange||"enumerableDidChange";var hasObservers=get(this,"hasEnumerableObservers");if(hasObservers)Ember.propertyWillChange(this,"hasEnumerableObservers");Ember.removeListener(this,"@enumerable:before",target,willChange);Ember.removeListener(this,"@enumerable:change",target,didChange);if(hasObservers)Ember.propertyDidChange(this,"hasEnumerableObservers");return this},hasEnumerableObservers:Ember.computed(function(){return Ember.hasListeners(this,"@enumerable:change")||Ember.hasListeners(this,"@enumerable:before")}),enumerableContentWillChange:function(removing,adding){var removeCnt,addCnt,hasDelta;if("number"===typeof removing)removeCnt=removing;else if(removing)removeCnt=get(removing,"length");else removeCnt=removing=-1;if("number"===typeof adding)addCnt=adding;else if(adding)addCnt=get(adding,"length");else addCnt=adding=-1;hasDelta=addCnt<0||removeCnt<0||addCnt-removeCnt!==0;if(removing===-1)removing=null;if(adding===-1)adding=null;Ember.propertyWillChange(this,"[]");if(hasDelta)Ember.propertyWillChange(this,"length");Ember.sendEvent(this,"@enumerable:before",[this,removing,adding]);return this},enumerableContentDidChange:function(removing,adding){var removeCnt,addCnt,hasDelta;if("number"===typeof removing)removeCnt=removing;else if(removing)removeCnt=get(removing,"length");else removeCnt=removing=-1;if("number"===typeof adding)addCnt=adding;else if(adding)addCnt=get(adding,"length");else addCnt=adding=-1;hasDelta=addCnt<0||removeCnt<0||addCnt-removeCnt!==0;if(removing===-1)removing=null;if(adding===-1)adding=null;Ember.sendEvent(this,"@enumerable:change",[this,removing,adding]);if(hasDelta)Ember.propertyDidChange(this,"length");Ember.propertyDidChange(this,"[]");return this},sortBy:function(){var sortKeys=arguments;return this.toArray().sort(function(a,b){for(var i=0;i<sortKeys.length;i++){var key=sortKeys[i],propA=get(a,key),propB=get(b,key);var compareValue=Ember.compare(propA,propB);if(compareValue){return compareValue}}return 0})}})})();(function(){var get=Ember.get,set=Ember.set,isNone=Ember.isNone,map=Ember.EnumerableUtils.map,cacheFor=Ember.cacheFor;Ember.Array=Ember.Mixin.create(Ember.Enumerable,{length:Ember.required(),objectAt:function(idx){if(idx<0||idx>=get(this,"length"))return undefined;return get(this,idx)},objectsAt:function(indexes){var self=this;return map(indexes,function(idx){return self.objectAt(idx)})},nextObject:function(idx){return this.objectAt(idx)},"[]":Ember.computed(function(key,value){if(value!==undefined)this.replace(0,get(this,"length"),value);return this}),firstObject:Ember.computed(function(){return this.objectAt(0)}),lastObject:Ember.computed(function(){return this.objectAt(get(this,"length")-1)}),contains:function(obj){return this.indexOf(obj)>=0},slice:function(beginIndex,endIndex){var ret=Ember.A();var length=get(this,"length");if(isNone(beginIndex))beginIndex=0;if(isNone(endIndex)||endIndex>length)endIndex=length;if(beginIndex<0)beginIndex=length+beginIndex;if(endIndex<0)endIndex=length+endIndex;while(beginIndex<endIndex){ret[ret.length]=this.objectAt(beginIndex++)}return ret},indexOf:function(object,startAt){var idx,len=get(this,"length");if(startAt===undefined)startAt=0;if(startAt<0)startAt+=len;for(idx=startAt;idx<len;idx++){if(this.objectAt(idx)===object)return idx}return-1},lastIndexOf:function(object,startAt){var idx,len=get(this,"length");if(startAt===undefined||startAt>=len)startAt=len-1;if(startAt<0)startAt+=len;for(idx=startAt;idx>=0;idx--){if(this.objectAt(idx)===object)return idx}return-1},addArrayObserver:function(target,opts){var willChange=opts&&opts.willChange||"arrayWillChange",didChange=opts&&opts.didChange||"arrayDidChange";var hasObservers=get(this,"hasArrayObservers");if(!hasObservers)Ember.propertyWillChange(this,"hasArrayObservers");Ember.addListener(this,"@array:before",target,willChange);Ember.addListener(this,"@array:change",target,didChange);if(!hasObservers)Ember.propertyDidChange(this,"hasArrayObservers");return this},removeArrayObserver:function(target,opts){var willChange=opts&&opts.willChange||"arrayWillChange",didChange=opts&&opts.didChange||"arrayDidChange";var hasObservers=get(this,"hasArrayObservers");if(hasObservers)Ember.propertyWillChange(this,"hasArrayObservers");Ember.removeListener(this,"@array:before",target,willChange);Ember.removeListener(this,"@array:change",target,didChange);if(hasObservers)Ember.propertyDidChange(this,"hasArrayObservers");return this},hasArrayObservers:Ember.computed(function(){return Ember.hasListeners(this,"@array:change")||Ember.hasListeners(this,"@array:before")}),arrayContentWillChange:function(startIdx,removeAmt,addAmt){if(startIdx===undefined){startIdx=0;removeAmt=addAmt=-1}else{if(removeAmt===undefined)removeAmt=-1;if(addAmt===undefined)addAmt=-1}if(Ember.isWatching(this,"@each")){get(this,"@each")}Ember.sendEvent(this,"@array:before",[this,startIdx,removeAmt,addAmt]);var removing,lim;if(startIdx>=0&&removeAmt>=0&&get(this,"hasEnumerableObservers")){removing=[];lim=startIdx+removeAmt;for(var idx=startIdx;idx<lim;idx++)removing.push(this.objectAt(idx))}else{removing=removeAmt}this.enumerableContentWillChange(removing,addAmt);return this},arrayContentDidChange:function(startIdx,removeAmt,addAmt){if(startIdx===undefined){startIdx=0;removeAmt=addAmt=-1}else{if(removeAmt===undefined)removeAmt=-1;if(addAmt===undefined)addAmt=-1}var adding,lim;if(startIdx>=0&&addAmt>=0&&get(this,"hasEnumerableObservers")){adding=[];lim=startIdx+addAmt;for(var idx=startIdx;idx<lim;idx++)adding.push(this.objectAt(idx))}else{adding=addAmt}this.enumerableContentDidChange(removeAmt,adding);Ember.sendEvent(this,"@array:change",[this,startIdx,removeAmt,addAmt]);var length=get(this,"length"),cachedFirst=cacheFor(this,"firstObject"),cachedLast=cacheFor(this,"lastObject");if(this.objectAt(0)!==cachedFirst){Ember.propertyWillChange(this,"firstObject");Ember.propertyDidChange(this,"firstObject")}if(this.objectAt(length-1)!==cachedLast){Ember.propertyWillChange(this,"lastObject");Ember.propertyDidChange(this,"lastObject")}return this},"@each":Ember.computed(function(){if(!this.__each)this.__each=new Ember.EachProxy(this);return this.__each})})})();(function(){var e_get=Ember.get,set=Ember.set,guidFor=Ember.guidFor,metaFor=Ember.meta,propertyWillChange=Ember.propertyWillChange,propertyDidChange=Ember.propertyDidChange,addBeforeObserver=Ember.addBeforeObserver,removeBeforeObserver=Ember.removeBeforeObserver,addObserver=Ember.addObserver,removeObserver=Ember.removeObserver,ComputedProperty=Ember.ComputedProperty,a_slice=[].slice,o_create=Ember.create,forEach=Ember.EnumerableUtils.forEach,eachPropertyPattern=/^(.*)\.@each\.(.*)/,doubleEachPropertyPattern=/(.*\.@each){2,}/,arrayBracketPattern=/\.\[\]$/;var expandProperties=Ember.expandProperties;function get(obj,key){if(key==="@this"){return obj}return e_get(obj,key)}function DependentArraysObserver(callbacks,cp,instanceMeta,context,propertyName,sugarMeta){this.callbacks=callbacks;this.cp=cp;this.instanceMeta=instanceMeta;this.dependentKeysByGuid={};this.trackedArraysByGuid={};this.suspended=false;this.changedItems={}}function ItemPropertyObserverContext(dependentArray,index,trackedArray){this.dependentArray=dependentArray;this.index=index;this.item=dependentArray.objectAt(index);this.trackedArray=trackedArray;this.beforeObserver=null;this.observer=null;this.destroyed=false}DependentArraysObserver.prototype={setValue:function(newValue){this.instanceMeta.setValue(newValue,true)},getValue:function(){return this.instanceMeta.getValue()},setupObservers:function(dependentArray,dependentKey){this.dependentKeysByGuid[guidFor(dependentArray)]=dependentKey;dependentArray.addArrayObserver(this,{willChange:"dependentArrayWillChange",didChange:"dependentArrayDidChange"});if(this.cp._itemPropertyKeys[dependentKey]){this.setupPropertyObservers(dependentKey,this.cp._itemPropertyKeys[dependentKey])}},teardownObservers:function(dependentArray,dependentKey){var itemPropertyKeys=this.cp._itemPropertyKeys[dependentKey]||[];delete this.dependentKeysByGuid[guidFor(dependentArray)];this.teardownPropertyObservers(dependentKey,itemPropertyKeys);dependentArray.removeArrayObserver(this,{willChange:"dependentArrayWillChange",didChange:"dependentArrayDidChange"})},suspendArrayObservers:function(callback,binding){var oldSuspended=this.suspended;this.suspended=true;callback.call(binding);this.suspended=oldSuspended},setupPropertyObservers:function(dependentKey,itemPropertyKeys){var dependentArray=get(this.instanceMeta.context,dependentKey),length=get(dependentArray,"length"),observerContexts=new Array(length);this.resetTransformations(dependentKey,observerContexts);forEach(dependentArray,function(item,index){var observerContext=this.createPropertyObserverContext(dependentArray,index,this.trackedArraysByGuid[dependentKey]);observerContexts[index]=observerContext;forEach(itemPropertyKeys,function(propertyKey){addBeforeObserver(item,propertyKey,this,observerContext.beforeObserver);addObserver(item,propertyKey,this,observerContext.observer)},this)},this)},teardownPropertyObservers:function(dependentKey,itemPropertyKeys){var dependentArrayObserver=this,trackedArray=this.trackedArraysByGuid[dependentKey],beforeObserver,observer,item;if(!trackedArray){return}trackedArray.apply(function(observerContexts,offset,operation){if(operation===Ember.TrackedArray.DELETE){return}forEach(observerContexts,function(observerContext){observerContext.destroyed=true;beforeObserver=observerContext.beforeObserver;observer=observerContext.observer;item=observerContext.item;forEach(itemPropertyKeys,function(propertyKey){removeBeforeObserver(item,propertyKey,dependentArrayObserver,beforeObserver);removeObserver(item,propertyKey,dependentArrayObserver,observer)})})})},createPropertyObserverContext:function(dependentArray,index,trackedArray){var observerContext=new ItemPropertyObserverContext(dependentArray,index,trackedArray);this.createPropertyObserver(observerContext);return observerContext},createPropertyObserver:function(observerContext){var dependentArrayObserver=this;observerContext.beforeObserver=function(obj,keyName){return dependentArrayObserver.itemPropertyWillChange(obj,keyName,observerContext.dependentArray,observerContext)};observerContext.observer=function(obj,keyName){return dependentArrayObserver.itemPropertyDidChange(obj,keyName,observerContext.dependentArray,observerContext)}},resetTransformations:function(dependentKey,observerContexts){this.trackedArraysByGuid[dependentKey]=new Ember.TrackedArray(observerContexts)},trackAdd:function(dependentKey,index,newItems){var trackedArray=this.trackedArraysByGuid[dependentKey];if(trackedArray){trackedArray.addItems(index,newItems)}},trackRemove:function(dependentKey,index,removedCount){var trackedArray=this.trackedArraysByGuid[dependentKey];if(trackedArray){return trackedArray.removeItems(index,removedCount)}return[]},updateIndexes:function(trackedArray,array){var length=get(array,"length");trackedArray.apply(function(observerContexts,offset,operation){if(operation===Ember.TrackedArray.DELETE){return}if(operation===Ember.TrackedArray.RETAIN&&observerContexts.length===length&&offset===0){return}forEach(observerContexts,function(context,index){context.index=index+offset})})},dependentArrayWillChange:function(dependentArray,index,removedCount,addedCount){if(this.suspended){return}var removedItem=this.callbacks.removedItem,changeMeta,guid=guidFor(dependentArray),dependentKey=this.dependentKeysByGuid[guid],itemPropertyKeys=this.cp._itemPropertyKeys[dependentKey]||[],length=get(dependentArray,"length"),normalizedIndex=normalizeIndex(index,length,0),normalizedRemoveCount=normalizeRemoveCount(normalizedIndex,length,removedCount),item,itemIndex,sliceIndex,observerContexts;observerContexts=this.trackRemove(dependentKey,normalizedIndex,normalizedRemoveCount);function removeObservers(propertyKey){observerContexts[sliceIndex].destroyed=true;removeBeforeObserver(item,propertyKey,this,observerContexts[sliceIndex].beforeObserver);removeObserver(item,propertyKey,this,observerContexts[sliceIndex].observer)}for(sliceIndex=normalizedRemoveCount-1;sliceIndex>=0;--sliceIndex){itemIndex=normalizedIndex+sliceIndex;if(itemIndex>=length){break}item=dependentArray.objectAt(itemIndex);forEach(itemPropertyKeys,removeObservers,this);changeMeta=createChangeMeta(dependentArray,item,itemIndex,this.instanceMeta.propertyName,this.cp);this.setValue(removedItem.call(this.instanceMeta.context,this.getValue(),item,changeMeta,this.instanceMeta.sugarMeta))}},dependentArrayDidChange:function(dependentArray,index,removedCount,addedCount){if(this.suspended){return}var addedItem=this.callbacks.addedItem,guid=guidFor(dependentArray),dependentKey=this.dependentKeysByGuid[guid],observerContexts=new Array(addedCount),itemPropertyKeys=this.cp._itemPropertyKeys[dependentKey],length=get(dependentArray,"length"),normalizedIndex=normalizeIndex(index,length,addedCount),changeMeta,observerContext;forEach(dependentArray.slice(normalizedIndex,normalizedIndex+addedCount),function(item,sliceIndex){if(itemPropertyKeys){observerContext=observerContexts[sliceIndex]=this.createPropertyObserverContext(dependentArray,normalizedIndex+sliceIndex,this.trackedArraysByGuid[dependentKey]);forEach(itemPropertyKeys,function(propertyKey){addBeforeObserver(item,propertyKey,this,observerContext.beforeObserver);addObserver(item,propertyKey,this,observerContext.observer)},this)}changeMeta=createChangeMeta(dependentArray,item,normalizedIndex+sliceIndex,this.instanceMeta.propertyName,this.cp);this.setValue(addedItem.call(this.instanceMeta.context,this.getValue(),item,changeMeta,this.instanceMeta.sugarMeta))},this);this.trackAdd(dependentKey,normalizedIndex,observerContexts)},itemPropertyWillChange:function(obj,keyName,array,observerContext){var guid=guidFor(obj);if(!this.changedItems[guid]){this.changedItems[guid]={array:array,observerContext:observerContext,obj:obj,previousValues:{}}}this.changedItems[guid].previousValues[keyName]=get(obj,keyName)},itemPropertyDidChange:function(obj,keyName,array,observerContext){this.flushChanges()},flushChanges:function(){var changedItems=this.changedItems,key,c,changeMeta;for(key in changedItems){c=changedItems[key];if(c.observerContext.destroyed){continue}this.updateIndexes(c.observerContext.trackedArray,c.observerContext.dependentArray);changeMeta=createChangeMeta(c.array,c.obj,c.observerContext.index,this.instanceMeta.propertyName,this.cp,c.previousValues);this.setValue(this.callbacks.removedItem.call(this.instanceMeta.context,this.getValue(),c.obj,changeMeta,this.instanceMeta.sugarMeta));this.setValue(this.callbacks.addedItem.call(this.instanceMeta.context,this.getValue(),c.obj,changeMeta,this.instanceMeta.sugarMeta))}this.changedItems={}}};function normalizeIndex(index,length,newItemsOffset){if(index<0){return Math.max(0,length+index)}else if(index<length){return index}else{return Math.min(length-newItemsOffset,index)}}function normalizeRemoveCount(index,length,removedCount){return Math.min(removedCount,length-index)}function createChangeMeta(dependentArray,item,index,propertyName,property,previousValues){var meta={arrayChanged:dependentArray,index:index,item:item,propertyName:propertyName,property:property};if(previousValues){meta.previousValues=previousValues}return meta}function addItems(dependentArray,callbacks,cp,propertyName,meta){forEach(dependentArray,function(item,index){meta.setValue(callbacks.addedItem.call(this,meta.getValue(),item,createChangeMeta(dependentArray,item,index,propertyName,cp),meta.sugarMeta))},this)}function reset(cp,propertyName){var callbacks=cp._callbacks(),meta;if(cp._hasInstanceMeta(this,propertyName)){meta=cp._instanceMeta(this,propertyName);meta.setValue(cp.resetValue(meta.getValue()))}else{meta=cp._instanceMeta(this,propertyName)}if(cp.options.initialize){cp.options.initialize.call(this,meta.getValue(),{property:cp,propertyName:propertyName},meta.sugarMeta)}}function partiallyRecomputeFor(obj,dependentKey){if(arrayBracketPattern.test(dependentKey)){return false}var value=get(obj,dependentKey);return Ember.Array.detect(value)}function ReduceComputedPropertyInstanceMeta(context,propertyName,initialValue){this.context=context;this.propertyName=propertyName;this.cache=metaFor(context).cache;this.dependentArrays={};this.sugarMeta={};this.initialValue=initialValue}ReduceComputedPropertyInstanceMeta.prototype={getValue:function(){if(this.propertyName in this.cache){return this.cache[this.propertyName]}else{return this.initialValue}},setValue:function(newValue,triggerObservers){if(newValue!==undefined){var fireObservers=triggerObservers&&newValue!==this.cache[this.propertyName];if(fireObservers){propertyWillChange(this.context,this.propertyName)}this.cache[this.propertyName]=newValue;if(fireObservers){propertyDidChange(this.context,this.propertyName)}}else{delete this.cache[this.propertyName]}}};function ReduceComputedProperty(options){var cp=this;this.options=options;this._instanceMetas={};this._dependentKeys=null;this._itemPropertyKeys={};this._previousItemPropertyKeys={};this.readOnly();this.cacheable();this.recomputeOnce=function(propertyName){Ember.run.once(this,recompute,propertyName)};var recompute=function(propertyName){var dependentKeys=cp._dependentKeys,meta=cp._instanceMeta(this,propertyName),callbacks=cp._callbacks();reset.call(this,cp,propertyName);meta.dependentArraysObserver.suspendArrayObservers(function(){forEach(cp._dependentKeys,function(dependentKey){if(!partiallyRecomputeFor(this,dependentKey)){return}var dependentArray=get(this,dependentKey),previousDependentArray=meta.dependentArrays[dependentKey];if(dependentArray===previousDependentArray){if(cp._previousItemPropertyKeys[dependentKey]){delete cp._previousItemPropertyKeys[dependentKey];meta.dependentArraysObserver.setupPropertyObservers(dependentKey,cp._itemPropertyKeys[dependentKey])}}else{meta.dependentArrays[dependentKey]=dependentArray;if(previousDependentArray){meta.dependentArraysObserver.teardownObservers(previousDependentArray,dependentKey)}if(dependentArray){meta.dependentArraysObserver.setupObservers(dependentArray,dependentKey)}}},this)},this);forEach(cp._dependentKeys,function(dependentKey){if(!partiallyRecomputeFor(this,dependentKey)){return}var dependentArray=get(this,dependentKey);if(dependentArray){addItems.call(this,dependentArray,callbacks,cp,propertyName,meta)}},this)};this.func=function(propertyName){recompute.call(this,propertyName);return cp._instanceMeta(this,propertyName).getValue()}}Ember.ReduceComputedProperty=ReduceComputedProperty;ReduceComputedProperty.prototype=o_create(ComputedProperty.prototype);function defaultCallback(computedValue){return computedValue}ReduceComputedProperty.prototype._callbacks=function(){if(!this.callbacks){var options=this.options;this.callbacks={removedItem:options.removedItem||defaultCallback,addedItem:options.addedItem||defaultCallback}}return this.callbacks};ReduceComputedProperty.prototype._hasInstanceMeta=function(context,propertyName){var guid=guidFor(context),key=guid+":"+propertyName;return!!this._instanceMetas[key]};ReduceComputedProperty.prototype._instanceMeta=function(context,propertyName){
var guid=guidFor(context),key=guid+":"+propertyName,meta=this._instanceMetas[key];if(!meta){meta=this._instanceMetas[key]=new ReduceComputedPropertyInstanceMeta(context,propertyName,this.initialValue());meta.dependentArraysObserver=new DependentArraysObserver(this._callbacks(),this,meta,context,propertyName,meta.sugarMeta)}return meta};ReduceComputedProperty.prototype.initialValue=function(){if(typeof this.options.initialValue==="function"){return this.options.initialValue()}else{return this.options.initialValue}};ReduceComputedProperty.prototype.resetValue=function(value){return this.initialValue()};ReduceComputedProperty.prototype.itemPropertyKey=function(dependentArrayKey,itemPropertyKey){this._itemPropertyKeys[dependentArrayKey]=this._itemPropertyKeys[dependentArrayKey]||[];this._itemPropertyKeys[dependentArrayKey].push(itemPropertyKey)};ReduceComputedProperty.prototype.clearItemPropertyKeys=function(dependentArrayKey){if(this._itemPropertyKeys[dependentArrayKey]){this._previousItemPropertyKeys[dependentArrayKey]=this._itemPropertyKeys[dependentArrayKey];this._itemPropertyKeys[dependentArrayKey]=[]}};ReduceComputedProperty.prototype.property=function(){var cp=this,args=a_slice.call(arguments),propertyArgs=new Ember.Set,match,dependentArrayKey,itemPropertyKey;forEach(a_slice.call(arguments),function(dependentKey){if(doubleEachPropertyPattern.test(dependentKey)){throw new Ember.Error("Nested @each properties not supported: "+dependentKey)}else if(match=eachPropertyPattern.exec(dependentKey)){dependentArrayKey=match[1];var itemPropertyKeyPattern=match[2],addItemPropertyKey=function(itemPropertyKey){cp.itemPropertyKey(dependentArrayKey,itemPropertyKey)};expandProperties(itemPropertyKeyPattern,addItemPropertyKey);propertyArgs.add(dependentArrayKey)}else{propertyArgs.add(dependentKey)}});return ComputedProperty.prototype.property.apply(this,propertyArgs.toArray())};Ember.reduceComputed=function(options){var args;if(arguments.length>1){args=a_slice.call(arguments,0,-1);options=a_slice.call(arguments,-1)[0]}if(typeof options!=="object"){throw new Ember.Error("Reduce Computed Property declared without an options hash")}if(!("initialValue"in options)){throw new Ember.Error("Reduce Computed Property declared without an initial value")}var cp=new ReduceComputedProperty(options);if(args){cp.property.apply(cp,args)}return cp}})();(function(){var ReduceComputedProperty=Ember.ReduceComputedProperty,a_slice=[].slice,o_create=Ember.create,forEach=Ember.EnumerableUtils.forEach;function ArrayComputedProperty(){var cp=this;ReduceComputedProperty.apply(this,arguments);this.func=function(reduceFunc){return function(propertyName){if(!cp._hasInstanceMeta(this,propertyName)){forEach(cp._dependentKeys,function(dependentKey){Ember.addObserver(this,dependentKey,function(){cp.recomputeOnce.call(this,propertyName)})},this)}return reduceFunc.apply(this,arguments)}}(this.func);return this}Ember.ArrayComputedProperty=ArrayComputedProperty;ArrayComputedProperty.prototype=o_create(ReduceComputedProperty.prototype);ArrayComputedProperty.prototype.initialValue=function(){return Ember.A()};ArrayComputedProperty.prototype.resetValue=function(array){array.clear();return array};ArrayComputedProperty.prototype.didChange=function(obj,keyName){return};Ember.arrayComputed=function(options){var args;if(arguments.length>1){args=a_slice.call(arguments,0,-1);options=a_slice.call(arguments,-1)[0]}if(typeof options!=="object"){throw new Ember.Error("Array Computed Property declared without an options hash")}var cp=new ArrayComputedProperty(options);if(args){cp.property.apply(cp,args)}return cp}})();(function(){var get=Ember.get,set=Ember.set,guidFor=Ember.guidFor,merge=Ember.merge,a_slice=[].slice,forEach=Ember.EnumerableUtils.forEach,map=Ember.EnumerableUtils.map,SearchProxy;Ember.computed.sum=function(dependentKey){return Ember.reduceComputed(dependentKey,{initialValue:0,addedItem:function(accumulatedValue,item,changeMeta,instanceMeta){return accumulatedValue+item},removedItem:function(accumulatedValue,item,changeMeta,instanceMeta){return accumulatedValue-item}})};Ember.computed.max=function(dependentKey){return Ember.reduceComputed(dependentKey,{initialValue:-Infinity,addedItem:function(accumulatedValue,item,changeMeta,instanceMeta){return Math.max(accumulatedValue,item)},removedItem:function(accumulatedValue,item,changeMeta,instanceMeta){if(item<accumulatedValue){return accumulatedValue}}})};Ember.computed.min=function(dependentKey){return Ember.reduceComputed(dependentKey,{initialValue:Infinity,addedItem:function(accumulatedValue,item,changeMeta,instanceMeta){return Math.min(accumulatedValue,item)},removedItem:function(accumulatedValue,item,changeMeta,instanceMeta){if(item>accumulatedValue){return accumulatedValue}}})};Ember.computed.map=function(dependentKey,callback){var options={addedItem:function(array,item,changeMeta,instanceMeta){var mapped=callback.call(this,item);array.insertAt(changeMeta.index,mapped);return array},removedItem:function(array,item,changeMeta,instanceMeta){array.removeAt(changeMeta.index,1);return array}};return Ember.arrayComputed(dependentKey,options)};Ember.computed.mapBy=function(dependentKey,propertyKey){var callback=function(item){return get(item,propertyKey)};return Ember.computed.map(dependentKey+".@each."+propertyKey,callback)};Ember.computed.mapProperty=Ember.computed.mapBy;Ember.computed.filter=function(dependentKey,callback){var options={initialize:function(array,changeMeta,instanceMeta){instanceMeta.filteredArrayIndexes=new Ember.SubArray},addedItem:function(array,item,changeMeta,instanceMeta){var match=!!callback.call(this,item),filterIndex=instanceMeta.filteredArrayIndexes.addItem(changeMeta.index,match);if(match){array.insertAt(filterIndex,item)}return array},removedItem:function(array,item,changeMeta,instanceMeta){var filterIndex=instanceMeta.filteredArrayIndexes.removeItem(changeMeta.index);if(filterIndex>-1){array.removeAt(filterIndex)}return array}};return Ember.arrayComputed(dependentKey,options)};Ember.computed.filterBy=function(dependentKey,propertyKey,value){var callback;if(arguments.length===2){callback=function(item){return get(item,propertyKey)}}else{callback=function(item){return get(item,propertyKey)===value}}return Ember.computed.filter(dependentKey+".@each."+propertyKey,callback)};Ember.computed.filterProperty=Ember.computed.filterBy;Ember.computed.uniq=function(){var args=a_slice.call(arguments);args.push({initialize:function(array,changeMeta,instanceMeta){instanceMeta.itemCounts={}},addedItem:function(array,item,changeMeta,instanceMeta){var guid=guidFor(item);if(!instanceMeta.itemCounts[guid]){instanceMeta.itemCounts[guid]=1}else{++instanceMeta.itemCounts[guid]}array.addObject(item);return array},removedItem:function(array,item,_,instanceMeta){var guid=guidFor(item),itemCounts=instanceMeta.itemCounts;if(--itemCounts[guid]===0){array.removeObject(item)}return array}});return Ember.arrayComputed.apply(null,args)};Ember.computed.union=Ember.computed.uniq;Ember.computed.intersect=function(){var getDependentKeyGuids=function(changeMeta){return map(changeMeta.property._dependentKeys,function(dependentKey){return guidFor(dependentKey)})};var args=a_slice.call(arguments);args.push({initialize:function(array,changeMeta,instanceMeta){instanceMeta.itemCounts={}},addedItem:function(array,item,changeMeta,instanceMeta){var itemGuid=guidFor(item),dependentGuids=getDependentKeyGuids(changeMeta),dependentGuid=guidFor(changeMeta.arrayChanged),numberOfDependentArrays=changeMeta.property._dependentKeys.length,itemCounts=instanceMeta.itemCounts;if(!itemCounts[itemGuid]){itemCounts[itemGuid]={}}if(itemCounts[itemGuid][dependentGuid]===undefined){itemCounts[itemGuid][dependentGuid]=0}if(++itemCounts[itemGuid][dependentGuid]===1&&numberOfDependentArrays===Ember.keys(itemCounts[itemGuid]).length){array.addObject(item)}return array},removedItem:function(array,item,changeMeta,instanceMeta){var itemGuid=guidFor(item),dependentGuids=getDependentKeyGuids(changeMeta),dependentGuid=guidFor(changeMeta.arrayChanged),numberOfDependentArrays=changeMeta.property._dependentKeys.length,numberOfArraysItemAppearsIn,itemCounts=instanceMeta.itemCounts;if(itemCounts[itemGuid][dependentGuid]===undefined){itemCounts[itemGuid][dependentGuid]=0}if(--itemCounts[itemGuid][dependentGuid]===0){delete itemCounts[itemGuid][dependentGuid];numberOfArraysItemAppearsIn=Ember.keys(itemCounts[itemGuid]).length;if(numberOfArraysItemAppearsIn===0){delete itemCounts[itemGuid]}array.removeObject(item)}return array}});return Ember.arrayComputed.apply(null,args)};Ember.computed.setDiff=function(setAProperty,setBProperty){if(arguments.length!==2){throw new Ember.Error("setDiff requires exactly two dependent arrays.")}return Ember.arrayComputed(setAProperty,setBProperty,{addedItem:function(array,item,changeMeta,instanceMeta){var setA=get(this,setAProperty),setB=get(this,setBProperty);if(changeMeta.arrayChanged===setA){if(!setB.contains(item)){array.addObject(item)}}else{array.removeObject(item)}return array},removedItem:function(array,item,changeMeta,instanceMeta){var setA=get(this,setAProperty),setB=get(this,setBProperty);if(changeMeta.arrayChanged===setB){if(setA.contains(item)){array.addObject(item)}}else{array.removeObject(item)}return array}})};function binarySearch(array,item,low,high){var mid,midItem,res,guidMid,guidItem;if(arguments.length<4){high=get(array,"length")}if(arguments.length<3){low=0}if(low===high){return low}mid=low+Math.floor((high-low)/2);midItem=array.objectAt(mid);guidMid=_guidFor(midItem);guidItem=_guidFor(item);if(guidMid===guidItem){return mid}res=this.order(midItem,item);if(res===0){res=guidMid<guidItem?-1:1}if(res<0){return this.binarySearch(array,item,mid+1,high)}else if(res>0){return this.binarySearch(array,item,low,mid)}return mid;function _guidFor(item){if(SearchProxy.detectInstance(item)){return guidFor(get(item,"content"))}return guidFor(item)}}SearchProxy=Ember.ObjectProxy.extend();Ember.computed.sort=function(itemsKey,sortDefinition){var initFn,sortPropertiesKey;if(typeof sortDefinition==="function"){initFn=function(array,changeMeta,instanceMeta){instanceMeta.order=sortDefinition;instanceMeta.binarySearch=binarySearch}}else{sortPropertiesKey=sortDefinition;initFn=function(array,changeMeta,instanceMeta){function setupSortProperties(){var sortPropertyDefinitions=get(this,sortPropertiesKey),sortProperty,sortProperties=instanceMeta.sortProperties=[],sortPropertyAscending=instanceMeta.sortPropertyAscending={},idx,asc;changeMeta.property.clearItemPropertyKeys(itemsKey);forEach(sortPropertyDefinitions,function(sortPropertyDefinition){if((idx=sortPropertyDefinition.indexOf(":"))!==-1){sortProperty=sortPropertyDefinition.substring(0,idx);asc=sortPropertyDefinition.substring(idx+1).toLowerCase()!=="desc"}else{sortProperty=sortPropertyDefinition;asc=true}sortProperties.push(sortProperty);sortPropertyAscending[sortProperty]=asc;changeMeta.property.itemPropertyKey(itemsKey,sortProperty)});sortPropertyDefinitions.addObserver("@each",this,updateSortPropertiesOnce)}function updateSortPropertiesOnce(){Ember.run.once(this,updateSortProperties,changeMeta.propertyName)}function updateSortProperties(propertyName){setupSortProperties.call(this);changeMeta.property.recomputeOnce.call(this,propertyName)}Ember.addObserver(this,sortPropertiesKey,updateSortPropertiesOnce);setupSortProperties.call(this);instanceMeta.order=function(itemA,itemB){var sortProperty,result,asc;for(var i=0;i<this.sortProperties.length;++i){sortProperty=this.sortProperties[i];result=Ember.compare(get(itemA,sortProperty),get(itemB,sortProperty));if(result!==0){asc=this.sortPropertyAscending[sortProperty];return asc?result:-1*result}}return 0};instanceMeta.binarySearch=binarySearch}}return Ember.arrayComputed(itemsKey,{initialize:initFn,addedItem:function(array,item,changeMeta,instanceMeta){var index=instanceMeta.binarySearch(array,item);array.insertAt(index,item);return array},removedItem:function(array,item,changeMeta,instanceMeta){var proxyProperties,index,searchItem;if(changeMeta.previousValues){proxyProperties=merge({content:item},changeMeta.previousValues);searchItem=SearchProxy.create(proxyProperties)}else{searchItem=item}index=instanceMeta.binarySearch(array,searchItem);array.removeAt(index);return array}})}})();(function(){Ember.RSVP=requireModule("rsvp");Ember.RSVP.onerrorDefault=function(error){if(error instanceof Error){if(Ember.testing){if(Ember.Test&&Ember.Test.adapter){Ember.Test.adapter.exception(error)}else{throw error}}else{Ember.Logger.error(error.stack)}}};Ember.RSVP.on("error",Ember.RSVP.onerrorDefault)})();(function(){var a_slice=Array.prototype.slice;var expandProperties=Ember.expandProperties;if(Ember.EXTEND_PROTOTYPES===true||Ember.EXTEND_PROTOTYPES.Function){Function.prototype.property=function(){var ret=Ember.computed(this);return ret.property.apply(ret,arguments)};Function.prototype.observes=function(){var addWatchedProperty=function(obs){watched.push(obs)};var watched=[];for(var i=0;i<arguments.length;++i){expandProperties(arguments[i],addWatchedProperty)}this.__ember_observes__=watched;return this};Function.prototype.observesImmediately=function(){for(var i=0,l=arguments.length;i<l;i++){var arg=arguments[i]}return this.observes.apply(this,arguments)};Function.prototype.observesBefore=function(){var addWatchedProperty=function(obs){watched.push(obs)};var watched=[];for(var i=0;i<arguments.length;++i){expandProperties(arguments[i],addWatchedProperty)}this.__ember_observesBefore__=watched;return this};Function.prototype.on=function(){var events=a_slice.call(arguments);this.__ember_listens__=events;return this}}})();(function(){})();(function(){Ember.Comparable=Ember.Mixin.create({compare:Ember.required(Function)})})();(function(){var get=Ember.get,set=Ember.set;Ember.Copyable=Ember.Mixin.create({copy:Ember.required(Function),frozenCopy:function(){if(Ember.Freezable&&Ember.Freezable.detect(this)){return get(this,"isFrozen")?this:this.copy().freeze()}else{throw new Ember.Error(Ember.String.fmt("%@ does not support freezing",[this]))}}})})();(function(){var get=Ember.get,set=Ember.set;Ember.Freezable=Ember.Mixin.create({isFrozen:false,freeze:function(){if(get(this,"isFrozen"))return this;set(this,"isFrozen",true);return this}});Ember.FROZEN_ERROR="Frozen object cannot be modified."})();(function(){var forEach=Ember.EnumerableUtils.forEach;Ember.MutableEnumerable=Ember.Mixin.create(Ember.Enumerable,{addObject:Ember.required(Function),addObjects:function(objects){Ember.beginPropertyChanges(this);forEach(objects,function(obj){this.addObject(obj)},this);Ember.endPropertyChanges(this);return this},removeObject:Ember.required(Function),removeObjects:function(objects){Ember.beginPropertyChanges(this);forEach(objects,function(obj){this.removeObject(obj)},this);Ember.endPropertyChanges(this);return this}})})();(function(){var OUT_OF_RANGE_EXCEPTION="Index out of range";var EMPTY=[];var get=Ember.get,set=Ember.set;Ember.MutableArray=Ember.Mixin.create(Ember.Array,Ember.MutableEnumerable,{replace:Ember.required(),clear:function(){var len=get(this,"length");if(len===0)return this;this.replace(0,len,EMPTY);return this},insertAt:function(idx,object){if(idx>get(this,"length"))throw new Ember.Error(OUT_OF_RANGE_EXCEPTION);this.replace(idx,0,[object]);return this},removeAt:function(start,len){if("number"===typeof start){if(start<0||start>=get(this,"length")){throw new Ember.Error(OUT_OF_RANGE_EXCEPTION)}if(len===undefined)len=1;this.replace(start,len,EMPTY)}return this},pushObject:function(obj){this.insertAt(get(this,"length"),obj);return obj},pushObjects:function(objects){if(!(Ember.Enumerable.detect(objects)||Ember.isArray(objects))){throw new TypeError("Must pass Ember.Enumerable to Ember.MutableArray#pushObjects")}this.replace(get(this,"length"),0,objects);return this},popObject:function(){var len=get(this,"length");if(len===0)return null;var ret=this.objectAt(len-1);this.removeAt(len-1,1);return ret},shiftObject:function(){if(get(this,"length")===0)return null;var ret=this.objectAt(0);this.removeAt(0);return ret},unshiftObject:function(obj){this.insertAt(0,obj);return obj},unshiftObjects:function(objects){this.replace(0,0,objects);return this},reverseObjects:function(){var len=get(this,"length");if(len===0)return this;var objects=this.toArray().reverse();this.replace(0,len,objects);return this},setObjects:function(objects){if(objects.length===0)return this.clear();var len=get(this,"length");this.replace(0,len,objects);return this},removeObject:function(obj){var loc=get(this,"length")||0;while(--loc>=0){var curObject=this.objectAt(loc);if(curObject===obj)this.removeAt(loc)}return this},addObject:function(obj){if(!this.contains(obj))this.pushObject(obj);return this}})})();(function(){var get=Ember.get,set=Ember.set;Ember.TargetActionSupport=Ember.Mixin.create({target:null,action:null,actionContext:null,targetObject:Ember.computed(function(){var target=get(this,"target");if(Ember.typeOf(target)==="string"){var value=get(this,target);if(value===undefined){value=get(Ember.lookup,target)}return value}else{return target}}).property("target"),actionContextObject:Ember.computed(function(){var actionContext=get(this,"actionContext");if(Ember.typeOf(actionContext)==="string"){var value=get(this,actionContext);if(value===undefined){value=get(Ember.lookup,actionContext)}return value}else{return actionContext}}).property("actionContext"),triggerAction:function(opts){opts=opts||{};var action=opts.action||get(this,"action"),target=opts.target||get(this,"targetObject"),actionContext=opts.actionContext;function args(options,actionName){var ret=[];if(actionName){ret.push(actionName)}return ret.concat(options)}if(typeof actionContext==="undefined"){actionContext=get(this,"actionContextObject")||this}if(target&&action){var ret;if(target.send){ret=target.send.apply(target,args(actionContext,action))}else{ret=target[action].apply(target,args(actionContext))}if(ret!==false)ret=true;return ret}else{return false}}})})();(function(){Ember.Evented=Ember.Mixin.create({on:function(name,target,method){Ember.addListener(this,name,target,method);return this},one:function(name,target,method){if(!method){method=target;target=null}Ember.addListener(this,name,target,method,true);return this},trigger:function(name){var args=[],i,l;for(i=1,l=arguments.length;i<l;i++){args.push(arguments[i])}Ember.sendEvent(this,name,args)},off:function(name,target,method){Ember.removeListener(this,name,target,method);return this},has:function(name){return Ember.hasListeners(this,name)}})})();(function(){var RSVP=requireModule("rsvp");RSVP.configure("async",function(callback,promise){Ember.run.schedule("actions",promise,callback,promise)});RSVP.Promise.prototype.fail=function(callback,label){return this["catch"](callback,label)};var get=Ember.get;Ember.DeferredMixin=Ember.Mixin.create({then:function(resolve,reject,label){var deferred,promise,entity;entity=this;deferred=get(this,"_deferred");promise=deferred.promise;function fulfillmentHandler(fulfillment){if(fulfillment===promise){return resolve(entity)}else{return resolve(fulfillment)}}return promise.then(resolve&&fulfillmentHandler,reject,label)},resolve:function(value){var deferred,promise;deferred=get(this,"_deferred");promise=deferred.promise;if(value===this){deferred.resolve(promise)}else{deferred.resolve(value)}},reject:function(value){get(this,"_deferred").reject(value)},_deferred:Ember.computed(function(){return RSVP.defer("Ember: DeferredMixin - "+this)})})})();(function(){var get=Ember.get,typeOf=Ember.typeOf;Ember.ActionHandler=Ember.Mixin.create({mergedProperties:["_actions"],willMergeMixin:function(props){var hashName;if(!props._actions){if(typeOf(props.actions)==="object"){hashName="actions"}else if(typeOf(props.events)==="object"){hashName="events"}if(hashName){props._actions=Ember.merge(props._actions||{},props[hashName])}delete props[hashName]}},send:function(actionName){var args=[].slice.call(arguments,1),target;if(this._actions&&this._actions[actionName]){if(this._actions[actionName].apply(this,args)===true){}else{return}}else if(this.deprecatedSend&&this.deprecatedSendHandles&&this.deprecatedSendHandles(actionName)){if(this.deprecatedSend.apply(this,[].slice.call(arguments))===true){}else{return}}if(target=get(this,"target")){target.send.apply(target,arguments)}}})})();(function(){var set=Ember.set,get=Ember.get,not=Ember.computed.not,or=Ember.computed.or;function tap(proxy,promise){return promise.then(function(value){set(proxy,"isFulfilled",true);set(proxy,"content",value);return value},function(reason){set(proxy,"isRejected",true);set(proxy,"reason",reason);throw reason},"Ember: PromiseProxy")}Ember.PromiseProxyMixin=Ember.Mixin.create({reason:null,isPending:not("isSettled").readOnly(),isSettled:or("isRejected","isFulfilled").readOnly(),isRejected:false,isFulfilled:false,promise:Ember.computed(function(key,promise){if(arguments.length===2){return tap(this,promise)}else{throw new Ember.Error("PromiseProxy's promise must be set")}}),then:promiseAlias("then"),catch:promiseAlias("catch"),finally:promiseAlias("finally")});function promiseAlias(name){return function(){var promise=get(this,"promise");return promise[name].apply(promise,arguments)}}})();(function(){})();(function(){var get=Ember.get,forEach=Ember.EnumerableUtils.forEach,RETAIN="r",INSERT="i",DELETE="d";Ember.TrackedArray=function(items){if(arguments.length<1){items=[]}var length=get(items,"length");if(length){this._operations=[new ArrayOperation(RETAIN,length,items)]}else{this._operations=[]}};Ember.TrackedArray.RETAIN=RETAIN;Ember.TrackedArray.INSERT=INSERT;Ember.TrackedArray.DELETE=DELETE;Ember.TrackedArray.prototype={addItems:function(index,newItems){var count=get(newItems,"length");if(count<1){return}var match=this._findArrayOperation(index),arrayOperation=match.operation,arrayOperationIndex=match.index,arrayOperationRangeStart=match.rangeStart,composeIndex,splitIndex,splitItems,splitArrayOperation,newArrayOperation;newArrayOperation=new ArrayOperation(INSERT,count,newItems);if(arrayOperation){if(!match.split){this._operations.splice(arrayOperationIndex,0,newArrayOperation);composeIndex=arrayOperationIndex}else{this._split(arrayOperationIndex,index-arrayOperationRangeStart,newArrayOperation);composeIndex=arrayOperationIndex+1}}else{this._operations.push(newArrayOperation);composeIndex=arrayOperationIndex}this._composeInsert(composeIndex)},removeItems:function(index,count){if(count<1){return}var match=this._findArrayOperation(index),arrayOperation=match.operation,arrayOperationIndex=match.index,arrayOperationRangeStart=match.rangeStart,newArrayOperation,composeIndex;newArrayOperation=new ArrayOperation(DELETE,count);if(!match.split){this._operations.splice(arrayOperationIndex,0,newArrayOperation);composeIndex=arrayOperationIndex}else{this._split(arrayOperationIndex,index-arrayOperationRangeStart,newArrayOperation);composeIndex=arrayOperationIndex+1}return this._composeDelete(composeIndex)},apply:function(callback){var items=[],offset=0;forEach(this._operations,function(arrayOperation){callback(arrayOperation.items,offset,arrayOperation.type);if(arrayOperation.type!==DELETE){offset+=arrayOperation.count;items=items.concat(arrayOperation.items)}});this._operations=[new ArrayOperation(RETAIN,items.length,items)]},_findArrayOperation:function(index){var arrayOperationIndex,len,split=false,arrayOperation,arrayOperationRangeStart,arrayOperationRangeEnd;for(arrayOperationIndex=arrayOperationRangeStart=0,len=this._operations.length;arrayOperationIndex<len;++arrayOperationIndex){arrayOperation=this._operations[arrayOperationIndex];if(arrayOperation.type===DELETE){continue}arrayOperationRangeEnd=arrayOperationRangeStart+arrayOperation.count-1;if(index===arrayOperationRangeStart){break}else if(index>arrayOperationRangeStart&&index<=arrayOperationRangeEnd){split=true;break}else{arrayOperationRangeStart=arrayOperationRangeEnd+1}}return new ArrayOperationMatch(arrayOperation,arrayOperationIndex,split,arrayOperationRangeStart)},_split:function(arrayOperationIndex,splitIndex,newArrayOperation){var arrayOperation=this._operations[arrayOperationIndex],splitItems=arrayOperation.items.slice(splitIndex),splitArrayOperation=new ArrayOperation(arrayOperation.type,splitItems.length,splitItems);arrayOperation.count=splitIndex;arrayOperation.items=arrayOperation.items.slice(0,splitIndex);this._operations.splice(arrayOperationIndex+1,0,newArrayOperation,splitArrayOperation)},_composeInsert:function(index){var newArrayOperation=this._operations[index],leftArrayOperation=this._operations[index-1],rightArrayOperation=this._operations[index+1],leftOp=leftArrayOperation&&leftArrayOperation.type,rightOp=rightArrayOperation&&rightArrayOperation.type;if(leftOp===INSERT){leftArrayOperation.count+=newArrayOperation.count;leftArrayOperation.items=leftArrayOperation.items.concat(newArrayOperation.items);if(rightOp===INSERT){leftArrayOperation.count+=rightArrayOperation.count;leftArrayOperation.items=leftArrayOperation.items.concat(rightArrayOperation.items);this._operations.splice(index,2)}else{this._operations.splice(index,1)}}else if(rightOp===INSERT){newArrayOperation.count+=rightArrayOperation.count;newArrayOperation.items=newArrayOperation.items.concat(rightArrayOperation.items);this._operations.splice(index+1,1)}},_composeDelete:function(index){var arrayOperation=this._operations[index],deletesToGo=arrayOperation.count,leftArrayOperation=this._operations[index-1],leftOp=leftArrayOperation&&leftArrayOperation.type,nextArrayOperation,nextOp,nextCount,removeNewAndNextOp=false,removedItems=[];if(leftOp===DELETE){arrayOperation=leftArrayOperation;index-=1}for(var i=index+1;deletesToGo>0;++i){nextArrayOperation=this._operations[i];nextOp=nextArrayOperation.type;nextCount=nextArrayOperation.count;if(nextOp===DELETE){arrayOperation.count+=nextCount;continue}if(nextCount>deletesToGo){removedItems=removedItems.concat(nextArrayOperation.items.splice(0,deletesToGo));nextArrayOperation.count-=deletesToGo;i-=1;nextCount=deletesToGo;deletesToGo=0}else{if(nextCount===deletesToGo){removeNewAndNextOp=true}removedItems=removedItems.concat(nextArrayOperation.items);deletesToGo-=nextCount}if(nextOp===INSERT){arrayOperation.count-=nextCount}}if(arrayOperation.count>0){this._operations.splice(index+1,i-1-index)}else{this._operations.splice(index,removeNewAndNextOp?2:1)}return removedItems},toString:function(){var str="";forEach(this._operations,function(operation){str+=" "+operation.type+":"+operation.count});return str.substring(1)}};function ArrayOperation(operation,count,items){this.type=operation;this.count=count;this.items=items}function ArrayOperationMatch(operation,index,split,rangeStart){this.operation=operation;this.index=index;this.split=split;this.rangeStart=rangeStart}})();(function(){var get=Ember.get,forEach=Ember.EnumerableUtils.forEach,RETAIN="r",FILTER="f";function Operation(type,count){this.type=type;this.count=count}Ember.SubArray=function(length){if(arguments.length<1){length=0}if(length>0){this._operations=[new Operation(RETAIN,length)]}else{this._operations=[]}};Ember.SubArray.prototype={addItem:function(index,match){var returnValue=-1,itemType=match?RETAIN:FILTER,self=this;this._findOperation(index,function(operation,operationIndex,rangeStart,rangeEnd,seenInSubArray){var newOperation,splitOperation;if(itemType===operation.type){++operation.count}else if(index===rangeStart){self._operations.splice(operationIndex,0,new Operation(itemType,1))}else{newOperation=new Operation(itemType,1);splitOperation=new Operation(operation.type,rangeEnd-index+1);operation.count=index-rangeStart;self._operations.splice(operationIndex+1,0,newOperation,splitOperation)}if(match){if(operation.type===RETAIN){returnValue=seenInSubArray+(index-rangeStart)}else{returnValue=seenInSubArray}}self._composeAt(operationIndex)},function(seenInSubArray){self._operations.push(new Operation(itemType,1));if(match){returnValue=seenInSubArray}self._composeAt(self._operations.length-1)});return returnValue},removeItem:function(index){var returnValue=-1,self=this;this._findOperation(index,function(operation,operationIndex,rangeStart,rangeEnd,seenInSubArray){if(operation.type===RETAIN){returnValue=seenInSubArray+(index-rangeStart)}if(operation.count>1){--operation.count}else{self._operations.splice(operationIndex,1);self._composeAt(operationIndex)}},function(){throw new Ember.Error("Can't remove an item that has never been added.")});return returnValue},_findOperation:function(index,foundCallback,notFoundCallback){var operationIndex,len,operation,rangeStart,rangeEnd,seenInSubArray=0;for(operationIndex=rangeStart=0,len=this._operations.length;operationIndex<len;rangeStart=rangeEnd+1,++operationIndex){operation=this._operations[operationIndex];rangeEnd=rangeStart+operation.count-1;if(index>=rangeStart&&index<=rangeEnd){foundCallback(operation,operationIndex,rangeStart,rangeEnd,seenInSubArray);return}else if(operation.type===RETAIN){seenInSubArray+=operation.count}}notFoundCallback(seenInSubArray)},_composeAt:function(index){var op=this._operations[index],otherOp;if(!op){return}if(index>0){otherOp=this._operations[index-1];if(otherOp.type===op.type){op.count+=otherOp.count;this._operations.splice(index-1,1);--index}}if(index<this._operations.length-1){otherOp=this._operations[index+1];if(otherOp.type===op.type){op.count+=otherOp.count;this._operations.splice(index+1,1)}}},toString:function(){var str="";forEach(this._operations,function(operation){str+=" "+operation.type+":"+operation.count});return str.substring(1)}}})();(function(){Ember.Container=requireModule("container");Ember.Container.set=Ember.set})();(function(){Ember.Application=Ember.Namespace.extend()})();(function(){var OUT_OF_RANGE_EXCEPTION="Index out of range";var EMPTY=[];var get=Ember.get,set=Ember.set;Ember.ArrayProxy=Ember.Object.extend(Ember.MutableArray,{content:null,arrangedContent:Ember.computed.alias("content"),objectAtContent:function(idx){return get(this,"arrangedContent").objectAt(idx)},replaceContent:function(idx,amt,objects){get(this,"content").replace(idx,amt,objects)},_contentWillChange:Ember.beforeObserver("content",function(){this._teardownContent()}),_teardownContent:function(){var content=get(this,"content");if(content){content.removeArrayObserver(this,{willChange:"contentArrayWillChange",didChange:"contentArrayDidChange"})}},contentArrayWillChange:Ember.K,contentArrayDidChange:Ember.K,_contentDidChange:Ember.observer("content",function(){var content=get(this,"content");this._setupContent()}),_setupContent:function(){var content=get(this,"content");if(content){content.addArrayObserver(this,{willChange:"contentArrayWillChange",didChange:"contentArrayDidChange"})}},_arrangedContentWillChange:Ember.beforeObserver("arrangedContent",function(){var arrangedContent=get(this,"arrangedContent"),len=arrangedContent?get(arrangedContent,"length"):0;this.arrangedContentArrayWillChange(this,0,len,undefined);this.arrangedContentWillChange(this);this._teardownArrangedContent(arrangedContent)}),_arrangedContentDidChange:Ember.observer("arrangedContent",function(){var arrangedContent=get(this,"arrangedContent"),len=arrangedContent?get(arrangedContent,"length"):0;this._setupArrangedContent();this.arrangedContentDidChange(this);this.arrangedContentArrayDidChange(this,0,undefined,len)}),_setupArrangedContent:function(){var arrangedContent=get(this,"arrangedContent");if(arrangedContent){arrangedContent.addArrayObserver(this,{willChange:"arrangedContentArrayWillChange",didChange:"arrangedContentArrayDidChange"})}},_teardownArrangedContent:function(){var arrangedContent=get(this,"arrangedContent");if(arrangedContent){arrangedContent.removeArrayObserver(this,{willChange:"arrangedContentArrayWillChange",didChange:"arrangedContentArrayDidChange"})}},arrangedContentWillChange:Ember.K,arrangedContentDidChange:Ember.K,objectAt:function(idx){return get(this,"content")&&this.objectAtContent(idx)},length:Ember.computed(function(){var arrangedContent=get(this,"arrangedContent")
;return arrangedContent?get(arrangedContent,"length"):0}),_replace:function(idx,amt,objects){var content=get(this,"content");if(content)this.replaceContent(idx,amt,objects);return this},replace:function(){if(get(this,"arrangedContent")===get(this,"content")){this._replace.apply(this,arguments)}else{throw new Ember.Error("Using replace on an arranged ArrayProxy is not allowed.")}},_insertAt:function(idx,object){if(idx>get(this,"content.length"))throw new Ember.Error(OUT_OF_RANGE_EXCEPTION);this._replace(idx,0,[object]);return this},insertAt:function(idx,object){if(get(this,"arrangedContent")===get(this,"content")){return this._insertAt(idx,object)}else{throw new Ember.Error("Using insertAt on an arranged ArrayProxy is not allowed.")}},removeAt:function(start,len){if("number"===typeof start){var content=get(this,"content"),arrangedContent=get(this,"arrangedContent"),indices=[],i;if(start<0||start>=get(this,"length")){throw new Ember.Error(OUT_OF_RANGE_EXCEPTION)}if(len===undefined)len=1;for(i=start;i<start+len;i++){indices.push(content.indexOf(arrangedContent.objectAt(i)))}indices.sort(function(a,b){return b-a});Ember.beginPropertyChanges();for(i=0;i<indices.length;i++){this._replace(indices[i],1,EMPTY)}Ember.endPropertyChanges()}return this},pushObject:function(obj){this._insertAt(get(this,"content.length"),obj);return obj},pushObjects:function(objects){if(!(Ember.Enumerable.detect(objects)||Ember.isArray(objects))){throw new TypeError("Must pass Ember.Enumerable to Ember.MutableArray#pushObjects")}this._replace(get(this,"length"),0,objects);return this},setObjects:function(objects){if(objects.length===0)return this.clear();var len=get(this,"length");this._replace(0,len,objects);return this},unshiftObject:function(obj){this._insertAt(0,obj);return obj},unshiftObjects:function(objects){this._replace(0,0,objects);return this},slice:function(){var arr=this.toArray();return arr.slice.apply(arr,arguments)},arrangedContentArrayWillChange:function(item,idx,removedCnt,addedCnt){this.arrayContentWillChange(idx,removedCnt,addedCnt)},arrangedContentArrayDidChange:function(item,idx,removedCnt,addedCnt){this.arrayContentDidChange(idx,removedCnt,addedCnt)},init:function(){this._super();this._setupContent();this._setupArrangedContent()},willDestroy:function(){this._teardownArrangedContent();this._teardownContent()}})})();(function(){var set=Ember.set,get=Ember.get,guidFor=Ember.guidFor;var forEach=Ember.EnumerableUtils.forEach,indexOf=Ember.ArrayPolyfills.indexOf;var EachArray=Ember.Object.extend(Ember.Array,{init:function(content,keyName,owner){this._super();this._keyName=keyName;this._owner=owner;this._content=content},objectAt:function(idx){var item=this._content.objectAt(idx);return item&&get(item,this._keyName)},length:Ember.computed(function(){var content=this._content;return content?get(content,"length"):0})});var IS_OBSERVER=/^.+:(before|change)$/;function addObserverForContentKey(content,keyName,proxy,idx,loc){var objects=proxy._objects,guid;if(!objects)objects=proxy._objects={};while(--loc>=idx){var item=content.objectAt(loc);if(item){Ember.addBeforeObserver(item,keyName,proxy,"contentKeyWillChange");Ember.addObserver(item,keyName,proxy,"contentKeyDidChange");guid=guidFor(item);if(!objects[guid])objects[guid]=[];objects[guid].push(loc)}}}function removeObserverForContentKey(content,keyName,proxy,idx,loc){var objects=proxy._objects;if(!objects)objects=proxy._objects={};var indicies,guid;while(--loc>=idx){var item=content.objectAt(loc);if(item){Ember.removeBeforeObserver(item,keyName,proxy,"contentKeyWillChange");Ember.removeObserver(item,keyName,proxy,"contentKeyDidChange");guid=guidFor(item);indicies=objects[guid];indicies[indexOf.call(indicies,loc)]=null}}}Ember.EachProxy=Ember.Object.extend({init:function(content){this._super();this._content=content;content.addArrayObserver(this);forEach(Ember.watchedEvents(this),function(eventName){this.didAddListener(eventName)},this)},unknownProperty:function(keyName,value){var ret;ret=new EachArray(this._content,keyName,this);Ember.defineProperty(this,keyName,null,ret);this.beginObservingContentKey(keyName);return ret},arrayWillChange:function(content,idx,removedCnt,addedCnt){var keys=this._keys,key,lim;lim=removedCnt>0?idx+removedCnt:-1;Ember.beginPropertyChanges(this);for(key in keys){if(!keys.hasOwnProperty(key)){continue}if(lim>0){removeObserverForContentKey(content,key,this,idx,lim)}Ember.propertyWillChange(this,key)}Ember.propertyWillChange(this._content,"@each");Ember.endPropertyChanges(this)},arrayDidChange:function(content,idx,removedCnt,addedCnt){var keys=this._keys,lim;lim=addedCnt>0?idx+addedCnt:-1;Ember.changeProperties(function(){for(var key in keys){if(!keys.hasOwnProperty(key)){continue}if(lim>0){addObserverForContentKey(content,key,this,idx,lim)}Ember.propertyDidChange(this,key)}Ember.propertyDidChange(this._content,"@each")},this)},didAddListener:function(eventName){if(IS_OBSERVER.test(eventName)){this.beginObservingContentKey(eventName.slice(0,-7))}},didRemoveListener:function(eventName){if(IS_OBSERVER.test(eventName)){this.stopObservingContentKey(eventName.slice(0,-7))}},beginObservingContentKey:function(keyName){var keys=this._keys;if(!keys)keys=this._keys={};if(!keys[keyName]){keys[keyName]=1;var content=this._content,len=get(content,"length");addObserverForContentKey(content,keyName,this,0,len)}else{keys[keyName]++}},stopObservingContentKey:function(keyName){var keys=this._keys;if(keys&&keys[keyName]>0&&--keys[keyName]<=0){var content=this._content,len=get(content,"length");removeObserverForContentKey(content,keyName,this,0,len)}},contentKeyWillChange:function(obj,keyName){Ember.propertyWillChange(this,keyName)},contentKeyDidChange:function(obj,keyName){Ember.propertyDidChange(this,keyName)}})})();(function(){var get=Ember.get,set=Ember.set,replace=Ember.EnumerableUtils._replace;var NativeArray=Ember.Mixin.create(Ember.MutableArray,Ember.Observable,Ember.Copyable,{get:function(key){if(key==="length")return this.length;else if("number"===typeof key)return this[key];else return this._super(key)},objectAt:function(idx){return this[idx]},replace:function(idx,amt,objects){if(this.isFrozen)throw Ember.FROZEN_ERROR;var len=objects?get(objects,"length"):0;this.arrayContentWillChange(idx,amt,len);if(len===0){this.splice(idx,amt)}else{replace(this,idx,amt,objects)}this.arrayContentDidChange(idx,amt,len);return this},unknownProperty:function(key,value){var ret;if(value!==undefined&&ret===undefined){ret=this[key]=value}return ret},indexOf:function(object,startAt){var idx,len=this.length;if(startAt===undefined)startAt=0;else startAt=startAt<0?Math.ceil(startAt):Math.floor(startAt);if(startAt<0)startAt+=len;for(idx=startAt;idx<len;idx++){if(this[idx]===object)return idx}return-1},lastIndexOf:function(object,startAt){var idx,len=this.length;if(startAt===undefined)startAt=len-1;else startAt=startAt<0?Math.ceil(startAt):Math.floor(startAt);if(startAt<0)startAt+=len;for(idx=startAt;idx>=0;idx--){if(this[idx]===object)return idx}return-1},copy:function(deep){if(deep){return this.map(function(item){return Ember.copy(item,true)})}return this.slice()}});var ignore=["length"];Ember.EnumerableUtils.forEach(NativeArray.keys(),function(methodName){if(Array.prototype[methodName])ignore.push(methodName)});if(ignore.length>0){NativeArray=NativeArray.without.apply(NativeArray,ignore)}Ember.NativeArray=NativeArray;Ember.A=function(arr){if(arr===undefined){arr=[]}return Ember.Array.detect(arr)?arr:Ember.NativeArray.apply(arr)};Ember.NativeArray.activate=function(){NativeArray.apply(Array.prototype);Ember.A=function(arr){return arr||[]}};if(Ember.EXTEND_PROTOTYPES===true||Ember.EXTEND_PROTOTYPES.Array){Ember.NativeArray.activate()}})();(function(){var get=Ember.get,set=Ember.set,guidFor=Ember.guidFor,isNone=Ember.isNone,fmt=Ember.String.fmt;Ember.Set=Ember.CoreObject.extend(Ember.MutableEnumerable,Ember.Copyable,Ember.Freezable,{length:0,clear:function(){if(this.isFrozen){throw new Ember.Error(Ember.FROZEN_ERROR)}var len=get(this,"length");if(len===0){return this}var guid;this.enumerableContentWillChange(len,0);Ember.propertyWillChange(this,"firstObject");Ember.propertyWillChange(this,"lastObject");for(var i=0;i<len;i++){guid=guidFor(this[i]);delete this[guid];delete this[i]}set(this,"length",0);Ember.propertyDidChange(this,"firstObject");Ember.propertyDidChange(this,"lastObject");this.enumerableContentDidChange(len,0);return this},isEqual:function(obj){if(!Ember.Enumerable.detect(obj))return false;var loc=get(this,"length");if(get(obj,"length")!==loc)return false;while(--loc>=0){if(!obj.contains(this[loc]))return false}return true},add:Ember.aliasMethod("addObject"),remove:Ember.aliasMethod("removeObject"),pop:function(){if(get(this,"isFrozen"))throw new Ember.Error(Ember.FROZEN_ERROR);var obj=this.length>0?this[this.length-1]:null;this.remove(obj);return obj},push:Ember.aliasMethod("addObject"),shift:Ember.aliasMethod("pop"),unshift:Ember.aliasMethod("push"),addEach:Ember.aliasMethod("addObjects"),removeEach:Ember.aliasMethod("removeObjects"),init:function(items){this._super();if(items)this.addObjects(items)},nextObject:function(idx){return this[idx]},firstObject:Ember.computed(function(){return this.length>0?this[0]:undefined}),lastObject:Ember.computed(function(){return this.length>0?this[this.length-1]:undefined}),addObject:function(obj){if(get(this,"isFrozen"))throw new Ember.Error(Ember.FROZEN_ERROR);if(isNone(obj))return this;var guid=guidFor(obj),idx=this[guid],len=get(this,"length"),added;if(idx>=0&&idx<len&&this[idx]===obj)return this;added=[obj];this.enumerableContentWillChange(null,added);Ember.propertyWillChange(this,"lastObject");len=get(this,"length");this[guid]=len;this[len]=obj;set(this,"length",len+1);Ember.propertyDidChange(this,"lastObject");this.enumerableContentDidChange(null,added);return this},removeObject:function(obj){if(get(this,"isFrozen"))throw new Ember.Error(Ember.FROZEN_ERROR);if(isNone(obj))return this;var guid=guidFor(obj),idx=this[guid],len=get(this,"length"),isFirst=idx===0,isLast=idx===len-1,last,removed;if(idx>=0&&idx<len&&this[idx]===obj){removed=[obj];this.enumerableContentWillChange(removed,null);if(isFirst){Ember.propertyWillChange(this,"firstObject")}if(isLast){Ember.propertyWillChange(this,"lastObject")}if(idx<len-1){last=this[len-1];this[idx]=last;this[guidFor(last)]=idx}delete this[guid];delete this[len-1];set(this,"length",len-1);if(isFirst){Ember.propertyDidChange(this,"firstObject")}if(isLast){Ember.propertyDidChange(this,"lastObject")}this.enumerableContentDidChange(removed,null)}return this},contains:function(obj){return this[guidFor(obj)]>=0},copy:function(){var C=this.constructor,ret=new C,loc=get(this,"length");set(ret,"length",loc);while(--loc>=0){ret[loc]=this[loc];ret[guidFor(this[loc])]=loc}return ret},toString:function(){var len=this.length,idx,array=[];for(idx=0;idx<len;idx++){array[idx]=this[idx]}return fmt("Ember.Set<%@>",[array.join(",")])}})})();(function(){var DeferredMixin=Ember.DeferredMixin,get=Ember.get;var Deferred=Ember.Object.extend(DeferredMixin);Deferred.reopenClass({promise:function(callback,binding){var deferred=Deferred.create();callback.call(binding,deferred);return deferred}});Ember.Deferred=Deferred})();(function(){var forEach=Ember.ArrayPolyfills.forEach;var loadHooks=Ember.ENV.EMBER_LOAD_HOOKS||{};var loaded={};Ember.onLoad=function(name,callback){var object;loadHooks[name]=loadHooks[name]||Ember.A();loadHooks[name].pushObject(callback);if(object=loaded[name]){callback(object)}};Ember.runLoadHooks=function(name,object){loaded[name]=object;if(loadHooks[name]){forEach.call(loadHooks[name],function(callback){callback(object)})}}})();(function(){})();(function(){var get=Ember.get;Ember.ControllerMixin=Ember.Mixin.create(Ember.ActionHandler,{isController:true,target:null,container:null,parentController:null,store:null,model:Ember.computed.alias("content"),deprecatedSendHandles:function(actionName){return!!this[actionName]},deprecatedSend:function(actionName){var args=[].slice.call(arguments,1);this[actionName].apply(this,args);return}});Ember.Controller=Ember.Object.extend(Ember.ControllerMixin)})();(function(){var get=Ember.get,set=Ember.set,forEach=Ember.EnumerableUtils.forEach;Ember.SortableMixin=Ember.Mixin.create(Ember.MutableEnumerable,{sortProperties:null,sortAscending:true,sortFunction:Ember.compare,orderBy:function(item1,item2){var result=0,sortProperties=get(this,"sortProperties"),sortAscending=get(this,"sortAscending"),sortFunction=get(this,"sortFunction");forEach(sortProperties,function(propertyName){if(result===0){result=sortFunction(get(item1,propertyName),get(item2,propertyName));if(result!==0&&!sortAscending){result=-1*result}}});return result},destroy:function(){var content=get(this,"content"),sortProperties=get(this,"sortProperties");if(content&&sortProperties){forEach(content,function(item){forEach(sortProperties,function(sortProperty){Ember.removeObserver(item,sortProperty,this,"contentItemSortPropertyDidChange")},this)},this)}return this._super()},isSorted:Ember.computed.bool("sortProperties"),arrangedContent:Ember.computed("content","sortProperties.@each",function(key,value){var content=get(this,"content"),isSorted=get(this,"isSorted"),sortProperties=get(this,"sortProperties"),self=this;if(content&&isSorted){content=content.slice();content.sort(function(item1,item2){return self.orderBy(item1,item2)});forEach(content,function(item){forEach(sortProperties,function(sortProperty){Ember.addObserver(item,sortProperty,this,"contentItemSortPropertyDidChange")},this)},this);return Ember.A(content)}return content}),_contentWillChange:Ember.beforeObserver("content",function(){var content=get(this,"content"),sortProperties=get(this,"sortProperties");if(content&&sortProperties){forEach(content,function(item){forEach(sortProperties,function(sortProperty){Ember.removeObserver(item,sortProperty,this,"contentItemSortPropertyDidChange")},this)},this)}this._super()}),sortAscendingWillChange:Ember.beforeObserver("sortAscending",function(){this._lastSortAscending=get(this,"sortAscending")}),sortAscendingDidChange:Ember.observer("sortAscending",function(){if(get(this,"sortAscending")!==this._lastSortAscending){var arrangedContent=get(this,"arrangedContent");arrangedContent.reverseObjects()}}),contentArrayWillChange:function(array,idx,removedCount,addedCount){var isSorted=get(this,"isSorted");if(isSorted){var arrangedContent=get(this,"arrangedContent");var removedObjects=array.slice(idx,idx+removedCount);var sortProperties=get(this,"sortProperties");forEach(removedObjects,function(item){arrangedContent.removeObject(item);forEach(sortProperties,function(sortProperty){Ember.removeObserver(item,sortProperty,this,"contentItemSortPropertyDidChange")},this)},this)}return this._super(array,idx,removedCount,addedCount)},contentArrayDidChange:function(array,idx,removedCount,addedCount){var isSorted=get(this,"isSorted"),sortProperties=get(this,"sortProperties");if(isSorted){var addedObjects=array.slice(idx,idx+addedCount);forEach(addedObjects,function(item){this.insertItemSorted(item);forEach(sortProperties,function(sortProperty){Ember.addObserver(item,sortProperty,this,"contentItemSortPropertyDidChange")},this)},this)}return this._super(array,idx,removedCount,addedCount)},insertItemSorted:function(item){var arrangedContent=get(this,"arrangedContent");var length=get(arrangedContent,"length");var idx=this._binarySearch(item,0,length);arrangedContent.insertAt(idx,item)},contentItemSortPropertyDidChange:function(item){var arrangedContent=get(this,"arrangedContent"),oldIndex=arrangedContent.indexOf(item),leftItem=arrangedContent.objectAt(oldIndex-1),rightItem=arrangedContent.objectAt(oldIndex+1),leftResult=leftItem&&this.orderBy(item,leftItem),rightResult=rightItem&&this.orderBy(item,rightItem);if(leftResult<0||rightResult>0){arrangedContent.removeObject(item);this.insertItemSorted(item)}},_binarySearch:function(item,low,high){var mid,midItem,res,arrangedContent;if(low===high){return low}arrangedContent=get(this,"arrangedContent");mid=low+Math.floor((high-low)/2);midItem=arrangedContent.objectAt(mid);res=this.orderBy(midItem,item);if(res<0){return this._binarySearch(item,mid+1,high)}else if(res>0){return this._binarySearch(item,low,mid)}return mid}})})();(function(){var get=Ember.get,set=Ember.set,forEach=Ember.EnumerableUtils.forEach,replace=Ember.EnumerableUtils.replace;Ember.ArrayController=Ember.ArrayProxy.extend(Ember.ControllerMixin,Ember.SortableMixin,{itemController:null,lookupItemController:function(object){return get(this,"itemController")},objectAtContent:function(idx){var length=get(this,"length"),arrangedContent=get(this,"arrangedContent"),object=arrangedContent&&arrangedContent.objectAt(idx);if(idx>=0&&idx<length){var controllerClass=this.lookupItemController(object);if(controllerClass){return this.controllerAt(idx,object,controllerClass)}}return object},arrangedContentDidChange:function(){this._super();this._resetSubControllers()},arrayContentDidChange:function(idx,removedCnt,addedCnt){var subControllers=get(this,"_subControllers"),subControllersToRemove=subControllers.slice(idx,idx+removedCnt);forEach(subControllersToRemove,function(subController){if(subController){subController.destroy()}});replace(subControllers,idx,removedCnt,new Array(addedCnt));this._super(idx,removedCnt,addedCnt)},init:function(){this._super();this.set("_subControllers",Ember.A())},content:Ember.computed(function(){return Ember.A()}),controllerAt:function(idx,object,controllerClass){var container=get(this,"container"),subControllers=get(this,"_subControllers"),subController=subControllers[idx],factory,fullName;if(subController){return subController}fullName="controller:"+controllerClass;if(!container.has(fullName)){throw new Ember.Error('Could not resolve itemController: "'+controllerClass+'"')}subController=container.lookupFactory(fullName).create({target:this,parentController:get(this,"parentController")||this,content:object});subControllers[idx]=subController;return subController},_subControllers:null,_resetSubControllers:function(){var subControllers=get(this,"_subControllers");if(subControllers){forEach(subControllers,function(subController){if(subController){subController.destroy()}})}this.set("_subControllers",Ember.A())}})})();(function(){Ember.ObjectController=Ember.ObjectProxy.extend(Ember.ControllerMixin)})();(function(){})();(function(){})()})();if(typeof location!=="undefined"&&(location.hostname==="localhost"||location.hostname==="127.0.0.1")){Ember.Logger.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. "+"If you want full error messages please use the non-minified build provided on the Ember website.")}hy.define("ember",["jquery.noconflict"],function(global){return function(){var ret,fn;return ret||global.Ember}}(this));hy.define("ember.noconflict",["jquery.noconflict","ember"],function(){if(typeof window!=="undefined"){return window.Ember}});(function($){function safe_add(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function binl_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var i,olda,oldb,oldc,oldd,a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(i=0;i<x.length;i+=16){olda=a;oldb=b;oldc=c;oldd=d;a=md5_ff(a,b,c,d,x[i],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return[a,b,c,d]}function binl2rstr(input){var i,output="";for(i=0;i<input.length*32;i+=8){output+=String.fromCharCode(input[i>>5]>>>i%32&255)}return output}function rstr2binl(input){var i,output=[];output[(input.length>>2)-1]=undefined;for(i=0;i<output.length;i+=1){output[i]=0}for(i=0;i<input.length*8;i+=8){output[i>>5]|=(input.charCodeAt(i/8)&255)<<i%32}return output}function rstr_md5(s){return binl2rstr(binl_md5(rstr2binl(s),s.length*8))}function rstr_hmac_md5(key,data){var i,bkey=rstr2binl(key),ipad=[],opad=[],hash;ipad[15]=opad[15]=undefined;if(bkey.length>16){bkey=binl_md5(bkey,key.length*8)}for(i=0;i<16;i+=1){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}hash=binl_md5(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binl_md5(opad.concat(hash),512+128))}function rstr2hex(input){var hex_tab="0123456789abcdef",output="",x,i;for(i=0;i<input.length;i+=1){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function str2rstr_utf8(input){return unescape(encodeURIComponent(input))}function raw_md5(s){return rstr_md5(str2rstr_utf8(s))}function hex_md5(s){return rstr2hex(raw_md5(s))}function raw_hmac_md5(k,d){return rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d))}function hex_hmac_md5(k,d){return rstr2hex(raw_hmac_md5(k,d))}function md5(string,key,raw){if(!key){if(!raw){return hex_md5(string)}return raw_md5(string)}if(!raw){return hex_hmac_md5(key,string)}return raw_hmac_md5(key,string)}if(typeof hy.define==="function"&&hy.define.amd){hy.define("crypto/md5",[],function(){return md5})}else{$.md5=md5}})(this);!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"===typeof hy.define&&hy.define.amd)hy.define("raven",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Raven=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){this.name="RavenConfigError",this.message=a}d.prototype=new Error,d.prototype.constructor=d,b.exports=d},{}],2:[function(a,b,c){var d=a(5),e=function(a,b,c){var e=a[b],f=a;if(b in a){var g="warn"===b?"warning":b;a[b]=function(){var a=[].slice.call(arguments),h=d.safeJoin(a," "),i={level:g,logger:"console",extra:{arguments:a}};"assert"===b?a[0]===!1&&(h="Assertion failed: "+(d.safeJoin(a.slice(1)," ")||"console.assert"),i.extra.arguments=a.slice(1),c&&c(h,i)):c&&c(h,i),e&&Function.prototype.apply.call(e,f,a)}}};b.exports={wrapMethod:e}},{5:5}],3:[function(a,b,c){(function(c){function d(){return+new Date}function e(a,b){return s(b)?function(c){return b(c,a)}:b}function f(){this.a=!("object"!=typeof JSON||!JSON.stringify),this.b=!r(S),this.c=!r(T),this.d=null,this.e=null,this.f=null,this.g=null,this.h=null,this.i=null,this.j={},this.k={release:R.SENTRY_RELEASE&&R.SENTRY_RELEASE.id,logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],headers:null,collectWindowErrors:!0,captureUnhandledRejections:!0,maxMessageLength:0,maxUrlLength:250,stackTraceLimit:50,autoBreadcrumbs:!0,instrument:!0,sampleRate:1,sanitizeKeys:[]},this.l={method:"POST",referrerPolicy:K()?"origin":""},this.m=0,this.n=!1,this.o=Error.stackTraceLimit,this.p=R.console||{},this.q={},this.r=[],this.s=d(),this.t=[],this.u=[],this.v=null,this.w=R.location,this.x=this.w&&this.w.href,this.y();for(var a in this.p)this.q[a]=this.p[a]}var g=a(6),h=a(7),i=a(8),j=a(1),k=a(5),l=k.isErrorEvent,m=k.isDOMError,n=k.isDOMException,o=k.isError,p=k.isObject,q=k.isPlainObject,r=k.isUndefined,s=k.isFunction,t=k.isString,u=k.isArray,v=k.isEmptyObject,w=k.each,x=k.objectMerge,y=k.truncate,z=k.objectFrozen,A=k.hasKey,B=k.joinRegExp,C=k.urlencode,D=k.uuid4,E=k.htmlTreeAsString,F=k.isSameException,G=k.isSameStacktrace,H=k.parseUrl,I=k.fill,J=k.supportsFetch,K=k.supportsReferrerPolicy,L=k.serializeKeysForMessage,M=k.serializeException,N=k.sanitize,O=a(2).wrapMethod,P="source protocol user pass host port path".split(" "),Q=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/,R="undefined"!=typeof window?window:"undefined"!=typeof c?c:"undefined"!=typeof self?self:{},S=R.document,T=R.navigator;f.prototype={VERSION:"3.27.0",debug:!1,TraceKit:g,config:function(a,b){var c=this;if(c.g)return this.z("error","Error: Raven has already been configured"),c;if(!a)return c;var d=c.k;b&&w(b,function(a,b){"tags"===a||"extra"===a||"user"===a?c.j[a]=b:d[a]=b}),c.setDSN(a),d.ignoreErrors.push(/^Script error\.?$/),d.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),d.ignoreErrors=B(d.ignoreErrors),d.ignoreUrls=!!d.ignoreUrls.length&&B(d.ignoreUrls),d.whitelistUrls=!!d.whitelistUrls.length&&B(d.whitelistUrls),d.includePaths=B(d.includePaths),d.maxBreadcrumbs=Math.max(0,Math.min(d.maxBreadcrumbs||100,100));var e={xhr:!0,console:!0,dom:!0,location:!0,sentry:!0},f=d.autoBreadcrumbs;"[object Object]"==={}.toString.call(f)?f=x(e,f):f!==!1&&(f=e),d.autoBreadcrumbs=f;var h={tryCatch:!0},i=d.instrument;return"[object Object]"==={}.toString.call(i)?i=x(h,i):i!==!1&&(i=h),d.instrument=i,g.collectWindowErrors=!!d.collectWindowErrors,c},install:function(){var a=this;return a.isSetup()&&!a.n&&(g.report.subscribe(function(){a.A.apply(a,arguments)}),a.k.captureUnhandledRejections&&a.B(),a.C(),a.k.instrument&&a.k.instrument.tryCatch&&a.D(),a.k.autoBreadcrumbs&&a.E(),a.F(),a.n=!0),Error.stackTraceLimit=a.k.stackTraceLimit,this},setDSN:function(a){var b=this,c=b.G(a),d=c.path.lastIndexOf("/"),e=c.path.substr(1,d);b.H=a,b.h=c.user,b.I=c.pass&&c.pass.substr(1),b.i=c.path.substr(d+1),b.g=b.J(c),b.K=b.g+"/"+e+"api/"+b.i+"/store/",this.y()},context:function(a,b,c){return s(a)&&(c=b||[],b=a,a={}),this.wrap(a,b).apply(this,c)},wrap:function(a,b,c){function d(){var d=[],f=arguments.length,g=!a||a&&a.deep!==!1;for(c&&s(c)&&c.apply(this,arguments);f--;)d[f]=g?e.wrap(a,arguments[f]):arguments[f];try{return b.apply(this,d)}catch(h){throw e.L(),e.captureException(h,a),h}}var e=this;if(r(b)&&!s(a))return a;if(s(a)&&(b=a,a=void 0),!s(b))return b;try{if(b.M)return b;if(b.N)return b.N}catch(f){return b}for(var g in b)A(b,g)&&(d[g]=b[g]);return d.prototype=b.prototype,b.N=d,d.M=!0,d.O=b,d},uninstall:function(){return g.report.uninstall(),this.P(),this.Q(),this.R(),this.S(),Error.stackTraceLimit=this.o,this.n=!1,this},T:function(a){this.z("debug","Raven caught unhandled promise rejection:",a),this.captureException(a.reason,{mechanism:{type:"onunhandledrejection",handled:!1}})},B:function(){return this.T=this.T.bind(this),R.addEventListener&&R.addEventListener("unhandledrejection",this.T),this},P:function(){return R.removeEventListener&&R.removeEventListener("unhandledrejection",this.T),this},captureException:function(a,b){if(b=x({trimHeadFrames:0},b?b:{}),l(a)&&a.error)a=a.error;else{if(m(a)||n(a)){var c=a.name||(m(a)?"DOMError":"DOMException"),d=a.message?c+": "+a.message:c;return this.captureMessage(d,x(b,{stacktrace:!0,trimHeadFrames:b.trimHeadFrames+1}))}if(o(a))a=a;else{if(!q(a))return this.captureMessage(a,x(b,{stacktrace:!0,trimHeadFrames:b.trimHeadFrames+1}));b=this.U(b,a),a=new Error(b.message)}}this.d=a;try{var e=g.computeStackTrace(a);this.V(e,b)}catch(f){if(a!==f)throw f}return this},U:function(a,b){var c=Object.keys(b).sort(),d=x(a,{message:"Non-Error exception captured with keys: "+L(c),fingerprint:[i(c)],extra:a.extra||{}});return d.extra.W=M(b),d},captureMessage:function(a,b){if(!this.k.ignoreErrors.test||!this.k.ignoreErrors.test(a)){b=b||{},a+="";var c,d=x({message:a},b);try{throw new Error(a)}catch(e){c=e}c.name=null;var f=g.computeStackTrace(c),h=u(f.stack)&&f.stack[1];h&&"Raven.captureException"===h.func&&(h=f.stack[2]);var i=h&&h.url||"";if((!this.k.ignoreUrls.test||!this.k.ignoreUrls.test(i))&&(!this.k.whitelistUrls.test||this.k.whitelistUrls.test(i))){if(this.k.stacktrace||b.stacktrace||""===d.message){d.fingerprint=null==d.fingerprint?a:d.fingerprint,b=x({trimHeadFrames:0},b),b.trimHeadFrames+=1;var j=this.X(f,b);d.stacktrace={frames:j.reverse()}}return d.fingerprint&&(d.fingerprint=u(d.fingerprint)?d.fingerprint:[d.fingerprint]),this.Y(d),this}}},captureBreadcrumb:function(a){var b=x({timestamp:d()/1e3},a);if(s(this.k.breadcrumbCallback)){var c=this.k.breadcrumbCallback(b);if(p(c)&&!v(c))b=c;else if(c===!1)return this}return this.u.push(b),this.u.length>this.k.maxBreadcrumbs&&this.u.shift(),this},addPlugin:function(a){var b=[].slice.call(arguments,1);return this.r.push([a,b]),this.n&&this.F(),this},setUserContext:function(a){return this.j.user=a,this},setExtraContext:function(a){return this.Z("extra",a),this},setTagsContext:function(a){return this.Z("tags",a),this},clearContext:function(){return this.j={},this},getContext:function(){return JSON.parse(h(this.j))},setEnvironment:function(a){return this.k.environment=a,this},setRelease:function(a){return this.k.release=a,this},setDataCallback:function(a){var b=this.k.dataCallback;return this.k.dataCallback=e(b,a),this},setBreadcrumbCallback:function(a){var b=this.k.breadcrumbCallback;return this.k.breadcrumbCallback=e(b,a),this},setShouldSendCallback:function(a){var b=this.k.shouldSendCallback;return this.k.shouldSendCallback=e(b,a),this},setTransport:function(a){return this.k.transport=a,this},lastException:function(){return this.d},lastEventId:function(){return this.f},isSetup:function(){
return!!this.a&&(!!this.g||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this.z("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var a=R.RavenConfig;a&&this.config(a.dsn,a.config).install()},showReportDialog:function(a){if(S){if(a=x({eventId:this.lastEventId(),dsn:this.H,user:this.j.user||{}},a),!a.eventId)throw new j("Missing eventId");if(!a.dsn)throw new j("Missing DSN");var b=encodeURIComponent,c=[];for(var d in a)if("user"===d){var e=a.user;e.name&&c.push("name="+b(e.name)),e.email&&c.push("email="+b(e.email))}else c.push(b(d)+"="+b(a[d]));var f=this.J(this.G(a.dsn)),g=S.createElement("script");g.async=!0,g.src=f+"/api/embed/error-page/?"+c.join("&"),(S.head||S.body).appendChild(g)}},L:function(){var a=this;this.m+=1,setTimeout(function(){a.m-=1})},$:function(a,b){var c,d;if(this.b){b=b||{},a="raven"+a.substr(0,1).toUpperCase()+a.substr(1),S.createEvent?(c=S.createEvent("HTMLEvents"),c.initEvent(a,!0,!0)):(c=S.createEventObject(),c.eventType=a);for(d in b)A(b,d)&&(c[d]=b[d]);if(S.createEvent)S.dispatchEvent(c);else try{S.fireEvent("on"+c.eventType.toLowerCase(),c)}catch(e){}}},_:function(a){var b=this;return function(c){if(b.aa=null,b.v!==c){b.v=c;var d;try{d=E(c.target)}catch(e){d="<unknown>"}b.captureBreadcrumb({category:"ui."+a,message:d})}}},ba:function(){var a=this,b=1e3;return function(c){var d;try{d=c.target}catch(e){return}var f=d&&d.tagName;if(f&&("INPUT"===f||"TEXTAREA"===f||d.isContentEditable)){var g=a.aa;g||a._("input")(c),clearTimeout(g),a.aa=setTimeout(function(){a.aa=null},b)}}},ca:function(a,b){var c=H(this.w.href),d=H(b),e=H(a);this.x=b,c.protocol===d.protocol&&c.host===d.host&&(b=d.relative),c.protocol===e.protocol&&c.host===e.host&&(a=e.relative),this.captureBreadcrumb({category:"navigation",data:{to:b,from:a}})},C:function(){var a=this;a.da=Function.prototype.toString,Function.prototype.toString=function(){return"function"==typeof this&&this.M?a.da.apply(this.O,arguments):a.da.apply(this,arguments)}},Q:function(){this.da&&(Function.prototype.toString=this.da)},D:function(){function a(a){return function(b,d){for(var e=new Array(arguments.length),f=0;f<e.length;++f)e[f]=arguments[f];var g=e[0];return s(g)&&(e[0]=c.wrap({mechanism:{type:"instrument",data:{function:a.name||"<anonymous>"}}},g)),a.apply?a.apply(this,e):a(e[0],e[1])}}function b(a){var b=R[a]&&R[a].prototype;b&&b.hasOwnProperty&&b.hasOwnProperty("addEventListener")&&(I(b,"addEventListener",function(b){return function(d,f,g,h){try{f&&f.handleEvent&&(f.handleEvent=c.wrap({mechanism:{type:"instrument",data:{target:a,function:"handleEvent",handler:f&&f.name||"<anonymous>"}}},f.handleEvent))}catch(i){}var j,k,l;return e&&e.dom&&("EventTarget"===a||"Node"===a)&&(k=c._("click"),l=c.ba(),j=function(a){if(a){var b;try{b=a.type}catch(c){return}return"click"===b?k(a):"keypress"===b?l(a):void 0}}),b.call(this,d,c.wrap({mechanism:{type:"instrument",data:{target:a,function:"addEventListener",handler:f&&f.name||"<anonymous>"}}},f,j),g,h)}},d),I(b,"removeEventListener",function(a){return function(b,c,d,e){try{c=c&&(c.N?c.N:c)}catch(f){}return a.call(this,b,c,d,e)}},d))}var c=this,d=c.t,e=this.k.autoBreadcrumbs;I(R,"setTimeout",a,d),I(R,"setInterval",a,d),R.requestAnimationFrame&&I(R,"requestAnimationFrame",function(a){return function(b){return a(c.wrap({mechanism:{type:"instrument",data:{function:"requestAnimationFrame",handler:a&&a.name||"<anonymous>"}}},b))}},d);for(var f=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],g=0;g<f.length;g++)b(f[g])},E:function(){function a(a,c){a in c&&s(c[a])&&I(c,a,function(c){return b.wrap({mechanism:{type:"instrument",data:{function:a,handler:c&&c.name||"<anonymous>"}}},c)})}var b=this,c=this.k.autoBreadcrumbs,d=b.t;if(c.xhr&&"XMLHttpRequest"in R){var e=R.XMLHttpRequest&&R.XMLHttpRequest.prototype;I(e,"open",function(a){return function(c,d){return t(d)&&d.indexOf(b.h)===-1&&(this.ea={method:c,url:d,status_code:null}),a.apply(this,arguments)}},d),I(e,"send",function(c){return function(){function d(){if(e.ea&&4===e.readyState){try{e.ea.status_code=e.status}catch(a){}b.captureBreadcrumb({type:"http",category:"xhr",data:e.ea})}}for(var e=this,f=["onload","onerror","onprogress"],g=0;g<f.length;g++)a(f[g],e);return"onreadystatechange"in e&&s(e.onreadystatechange)?I(e,"onreadystatechange",function(a){return b.wrap({mechanism:{type:"instrument",data:{function:"onreadystatechange",handler:a&&a.name||"<anonymous>"}}},a,d)}):e.onreadystatechange=d,c.apply(this,arguments)}},d)}c.xhr&&J()&&I(R,"fetch",function(a){return function(){for(var c=new Array(arguments.length),d=0;d<c.length;++d)c[d]=arguments[d];var e,f=c[0],g="GET";if("string"==typeof f?e=f:"Request"in R&&f instanceof R.Request?(e=f.url,f.method&&(g=f.method)):e=""+f,e.indexOf(b.h)!==-1)return a.apply(this,c);c[1]&&c[1].method&&(g=c[1].method);var h={method:g,url:e,status_code:null};return a.apply(this,c).then(function(a){return h.status_code=a.status,b.captureBreadcrumb({type:"http",category:"fetch",data:h}),a})["catch"](function(a){throw b.captureBreadcrumb({type:"http",category:"fetch",data:h,level:"error"}),a})}},d),c.dom&&this.b&&(S.addEventListener?(S.addEventListener("click",b._("click"),!1),S.addEventListener("keypress",b.ba(),!1)):S.attachEvent&&(S.attachEvent("onclick",b._("click")),S.attachEvent("onkeypress",b.ba())));var f=R.chrome,g=f&&f.app&&f.app.runtime,h=!g&&R.history&&R.history.pushState&&R.history.replaceState;if(c.location&&h){var i=R.onpopstate;R.onpopstate=function(){var a=b.w.href;if(b.ca(b.x,a),i)return i.apply(this,arguments)};var j=function(a){return function(){var c=arguments.length>2?arguments[2]:void 0;return c&&b.ca(b.x,c+""),a.apply(this,arguments)}};I(R.history,"pushState",j,d),I(R.history,"replaceState",j,d)}if(c.console&&"console"in R&&console.log){var k=function(a,c){b.captureBreadcrumb({message:a,level:c.level,category:"console"})};w(["debug","info","warn","error","log"],function(a,b){O(console,b,k)})}},R:function(){for(var a;this.t.length;){a=this.t.shift();var b=a[0],c=a[1],d=a[2];b[c]=d}},S:function(){for(var a in this.q)this.p[a]=this.q[a]},F:function(){var a=this;w(this.r,function(b,c){var d=c[0],e=c[1];d.apply(a,[a].concat(e))})},G:function(a){var b=Q.exec(a),c={},d=7;try{for(;d--;)c[P[d]]=b[d]||""}catch(e){throw new j("Invalid DSN: "+a)}if(c.pass&&!this.k.allowSecretKey)throw new j("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return c},J:function(a){var b="//"+a.host+(a.port?":"+a.port:"");return a.protocol&&(b=a.protocol+":"+b),b},A:function(a,b){b=b||{},b.mechanism=b.mechanism||{type:"onerror",handled:!1},this.m||this.V(a,b)},V:function(a,b){var c=this.X(a,b);this.$("handle",{stackInfo:a,options:b}),this.fa(a.name,a.message,a.url,a.lineno,c,b)},X:function(a,b){var c=this,d=[];if(a.stack&&a.stack.length&&(w(a.stack,function(b,e){var f=c.ga(e,a.url);f&&d.push(f)}),b&&b.trimHeadFrames))for(var e=0;e<b.trimHeadFrames&&e<d.length;e++)d[e].in_app=!1;return d=d.slice(0,this.k.stackTraceLimit)},ga:function(a,b){var c={filename:a.url,lineno:a.line,colno:a.column,function:a.func||"?"};return a.url||(c.filename=b),c.in_app=!(this.k.includePaths.test&&!this.k.includePaths.test(c.filename)||/(Raven|TraceKit)\./.test(c["function"])||/raven\.(min\.)?js$/.test(c.filename)),c},fa:function(a,b,c,d,e,f){var g=(a?a+": ":"")+(b||"");if(!this.k.ignoreErrors.test||!this.k.ignoreErrors.test(b)&&!this.k.ignoreErrors.test(g)){var h;if(e&&e.length?(c=e[0].filename||c,e.reverse(),h={frames:e}):c&&(h={frames:[{filename:c,lineno:d,in_app:!0}]}),(!this.k.ignoreUrls.test||!this.k.ignoreUrls.test(c))&&(!this.k.whitelistUrls.test||this.k.whitelistUrls.test(c))){var i=x({exception:{values:[{type:a,value:b,stacktrace:h}]},transaction:c},f),j=i.exception.values[0];null==j.type&&""===j.value&&(j.value="Unrecoverable error caught"),!i.exception.mechanism&&i.mechanism&&(i.exception.mechanism=i.mechanism,delete i.mechanism),i.exception.mechanism=x({type:"generic",handled:!0},i.exception.mechanism||{}),this.Y(i)}}},ha:function(a){var b=this.k.maxMessageLength;if(a.message&&(a.message=y(a.message,b)),a.exception){var c=a.exception.values[0];c.value=y(c.value,b)}var d=a.request;return d&&(d.url&&(d.url=y(d.url,this.k.maxUrlLength)),d.Referer&&(d.Referer=y(d.Referer,this.k.maxUrlLength))),a.breadcrumbs&&a.breadcrumbs.values&&this.ia(a.breadcrumbs),a},ia:function(a){for(var b,c,d,e=["to","from","url"],f=0;f<a.values.length;++f)if(c=a.values[f],c.hasOwnProperty("data")&&p(c.data)&&!z(c.data)){d=x({},c.data);for(var g=0;g<e.length;++g)b=e[g],d.hasOwnProperty(b)&&d[b]&&(d[b]=y(d[b],this.k.maxUrlLength));a.values[f].data=d}},ja:function(){if(this.c||this.b){var a={};return this.c&&T.userAgent&&(a.headers={"User-Agent":T.userAgent}),R.location&&R.location.href&&(a.url=R.location.href),this.b&&S.referrer&&(a.headers||(a.headers={}),a.headers.Referer=S.referrer),a}},y:function(){this.ka=0,this.la=null},ma:function(){return this.ka&&d()-this.la<this.ka},na:function(a){var b=this.e;return!(!b||a.message!==b.message||a.transaction!==b.transaction)&&(a.stacktrace||b.stacktrace?G(a.stacktrace,b.stacktrace):!a.exception&&!b.exception||F(a.exception,b.exception))},oa:function(a){if(!this.ma()){var b=a.status;if(400===b||401===b||429===b){var c;try{c=J()?a.headers.get("Retry-After"):a.getResponseHeader("Retry-After"),c=1e3*parseInt(c,10)}catch(e){}this.ka=c?c:2*this.ka||1e3,this.la=d()}}},Y:function(a){var b=this.k,c={project:this.i,logger:b.logger,platform:"javascript"},e=this.ja();if(e&&(c.request=e),a.trimHeadFrames&&delete a.trimHeadFrames,a=x(c,a),a.tags=x(x({},this.j.tags),a.tags),a.extra=x(x({},this.j.extra),a.extra),a.extra["session:duration"]=d()-this.s,this.u&&this.u.length>0&&(a.breadcrumbs={values:[].slice.call(this.u,0)}),this.j.user&&(a.user=this.j.user),b.environment&&(a.environment=b.environment),b.release&&(a.release=b.release),b.serverName&&(a.server_name=b.serverName),a=this.pa(a),Object.keys(a).forEach(function(b){(null==a[b]||""===a[b]||v(a[b]))&&delete a[b]}),s(b.dataCallback)&&(a=b.dataCallback(a)||a),a&&!v(a)&&(!s(b.shouldSendCallback)||b.shouldSendCallback(a)))return this.ma()?void this.z("warn","Raven dropped error due to backoff: ",a):void("number"==typeof b.sampleRate?Math.random()<b.sampleRate&&this.qa(a):this.qa(a))},pa:function(a){return N(a,this.k.sanitizeKeys)},ra:function(){return D()},qa:function(a,b){var c=this,d=this.k;if(this.isSetup()){if(a=this.ha(a),!this.k.allowDuplicates&&this.na(a))return void this.z("warn","Raven dropped repeat event: ",a);this.f=a.event_id||(a.event_id=this.ra()),this.e=a,this.z("debug","Raven about to send:",a);var e={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this.h};this.I&&(e.sentry_secret=this.I);var f=a.exception&&a.exception.values[0];this.k.autoBreadcrumbs&&this.k.autoBreadcrumbs.sentry&&this.captureBreadcrumb({category:"sentry",message:f?(f.type?f.type+": ":"")+f.value:a.message,event_id:a.event_id,level:a.level||"error"});var g=this.K;(d.transport||this._makeRequest).call(this,{url:g,auth:e,data:a,options:d,onSuccess:function(){c.y(),c.$("success",{data:a,src:g}),b&&b()},onError:function(d){c.z("error","Raven transport failed to send: ",d),d.request&&c.oa(d.request),c.$("failure",{data:a,src:g}),d=d||new Error("Raven send failed (no additional details provided)"),b&&b(d)}})}},_makeRequest:function(a){var b=a.url+"?"+C(a.auth),c=null,d={};if(a.options.headers&&(c=this.sa(a.options.headers)),a.options.fetchParameters&&(d=this.sa(a.options.fetchParameters)),J()){d.body=h(a.data);var e=x({},this.l),f=x(e,d);return c&&(f.headers=c),R.fetch(b,f).then(function(b){if(b.ok)a.onSuccess&&a.onSuccess();else{var c=new Error("Sentry error code: "+b.status);c.request=b,a.onError&&a.onError(c)}})["catch"](function(){a.onError&&a.onError(new Error("Sentry error code: network unavailable"))})}var g=R.XMLHttpRequest&&new R.XMLHttpRequest;if(g){var i="withCredentials"in g||"undefined"!=typeof XDomainRequest;i&&("withCredentials"in g?g.onreadystatechange=function(){if(4===g.readyState)if(200===g.status)a.onSuccess&&a.onSuccess();else if(a.onError){var b=new Error("Sentry error code: "+g.status);b.request=g,a.onError(b)}}:(g=new XDomainRequest,b=b.replace(/^https?:/,""),a.onSuccess&&(g.onload=a.onSuccess),a.onError&&(g.onerror=function(){var b=new Error("Sentry error code: XDomainRequest");b.request=g,a.onError(b)})),g.open("POST",b),c&&w(c,function(a,b){g.setRequestHeader(a,b)}),g.send(h(a.data)))}},sa:function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b[c]="function"==typeof d?d():d}return b},z:function(a){this.q[a]&&(this.debug||this.k.debug)&&Function.prototype.apply.call(this.q[a],this.p,[].slice.call(arguments,1))},Z:function(a,b){r(b)?delete this.j[a]:this.j[a]=x(this.j[a]||{},b)}},f.prototype.setUser=f.prototype.setUserContext,f.prototype.setReleaseContext=f.prototype.setRelease,b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,2:2,5:5,6:6,7:7,8:8}],4:[function(a,b,c){(function(c){var d=a(3),e="undefined"!=typeof window?window:"undefined"!=typeof c?c:"undefined"!=typeof self?self:{},f=e.Raven,g=new d;g.noConflict=function(){return e.Raven=f,g},g.afterLoad(),b.exports=g,b.exports.Client=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{3:3}],5:[function(a,b,c){(function(c){function d(a){return"object"==typeof a&&null!==a}function e(a){switch(Object.prototype.toString.call(a)){case"[object Error]":return!0;case"[object Exception]":return!0;case"[object DOMException]":return!0;default:return a instanceof Error}}function f(a){return"[object ErrorEvent]"===Object.prototype.toString.call(a)}function g(a){return"[object DOMError]"===Object.prototype.toString.call(a)}function h(a){return"[object DOMException]"===Object.prototype.toString.call(a)}function i(a){return void 0===a}function j(a){return"function"==typeof a}function k(a){return"[object Object]"===Object.prototype.toString.call(a)}function l(a){return"[object String]"===Object.prototype.toString.call(a)}function m(a){return"[object Array]"===Object.prototype.toString.call(a)}function n(a){if(!k(a))return!1;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function o(){try{return new ErrorEvent(""),!0}catch(a){return!1}}function p(){try{return new DOMError(""),!0}catch(a){return!1}}function q(){try{return new DOMException(""),!0}catch(a){return!1}}function r(){if(!("fetch"in U))return!1;try{return new Headers,new Request(""),new Response,!0}catch(a){return!1}}function s(){if(!r())return!1;try{return new Request("pickleRick",{referrerPolicy:"origin"}),!0}catch(a){return!1}}function t(){return"function"==typeof PromiseRejectionEvent}function u(a){function b(b,c){var d=a(b)||b;return c?c(d)||d:d}return b}function v(a,b){var c,d;if(i(a.length))for(c in a)z(a,c)&&b.call(null,c,a[c]);else if(d=a.length)for(c=0;c<d;c++)b.call(null,c,a[c])}function w(a,b){return b?(v(b,function(b,c){a[b]=c}),a):a}function x(a){return!!Object.isFrozen&&Object.isFrozen(a)}function y(a,b){if("number"!=typeof b)throw new Error("2nd argument to `truncate` function should be a number");return"string"!=typeof a||0===b?a:a.length<=b?a:a.substr(0,b)+"…"}function z(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function A(a){for(var b,c=[],d=0,e=a.length;d<e;d++)b=a[d],l(b)?c.push(b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):b&&b.source&&c.push(b.source);return new RegExp(c.join("|"),"i")}function B(a){var b=[];return v(a,function(a,c){b.push(encodeURIComponent(a)+"="+encodeURIComponent(c))}),b.join("&")}function C(a){if("string"!=typeof a)return{};var b=a.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/),c=b[6]||"",d=b[8]||"";return{protocol:b[2],host:b[4],path:b[5],relative:b[5]+c+d}}function D(){var a=U.crypto||U.msCrypto;if(!i(a)&&a.getRandomValues){var b=new Uint16Array(8);a.getRandomValues(b),b[3]=4095&b[3]|16384,b[4]=16383&b[4]|32768;var c=function(a){for(var b=a.toString(16);b.length<4;)b="0"+b;return b};return c(b[0])+c(b[1])+c(b[2])+c(b[3])+c(b[4])+c(b[5])+c(b[6])+c(b[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function E(a){for(var b,c=5,d=80,e=[],f=0,g=0,h=" > ",i=h.length;a&&f++<c&&(b=F(a),!("html"===b||f>1&&g+e.length*i+b.length>=d));)e.push(b),g+=b.length,a=a.parentNode;return e.reverse().join(h)}function F(a){var b,c,d,e,f,g=[];if(!a||!a.tagName)return"";if(g.push(a.tagName.toLowerCase()),a.id&&g.push("#"+a.id),b=a.className,b&&l(b))for(c=b.split(/\s+/),f=0;f<c.length;f++)g.push("."+c[f]);var h=["type","name","title","alt"];for(f=0;f<h.length;f++)d=h[f],e=a.getAttribute(d),e&&g.push("["+d+'="'+e+'"]');return g.join("")}function G(a,b){return!!(!!a^!!b)}function H(a,b){return i(a)&&i(b)}function I(a,b){return!G(a,b)&&(a=a.values[0],b=b.values[0],a.type===b.type&&a.value===b.value&&(!H(a.stacktrace,b.stacktrace)&&J(a.stacktrace,b.stacktrace)))}function J(a,b){if(G(a,b))return!1;var c=a.frames,d=b.frames;if(void 0===c||void 0===d)return!1;if(c.length!==d.length)return!1;for(var e,f,g=0;g<c.length;g++)if(e=c[g],f=d[g],e.filename!==f.filename||e.lineno!==f.lineno||e.colno!==f.colno||e["function"]!==f["function"])return!1;return!0}function K(a,b,c,d){if(null!=a){var e=a[b];a[b]=c(e),a[b].M=!0,a[b].O=e,d&&d.push([a,b,e])}}function L(a,b){if(!m(a))return"";for(var c=[],d=0;d<a.length;d++)try{c.push(String(a[d]))}catch(e){c.push("[value cannot be serialized]")}return c.join(b)}function M(a){return~-encodeURI(a).split(/%..|./).length}function N(a){return M(JSON.stringify(a))}function O(a){if("string"==typeof a){var b=40;return y(a,b)}if("number"==typeof a||"boolean"==typeof a||"undefined"==typeof a)return a;var c=Object.prototype.toString.call(a);return"[object Object]"===c?"[Object]":"[object Array]"===c?"[Array]":"[object Function]"===c?a.name?"[Function: "+a.name+"]":"[Function]":a}function P(a,b){return 0===b?O(a):k(a)?Object.keys(a).reduce(function(c,d){return c[d]=P(a[d],b-1),c},{}):Array.isArray(a)?a.map(function(a){return P(a,b-1)}):O(a)}function Q(a,b,c){if(!k(a))return a;b="number"!=typeof b?V:b,c="number"!=typeof b?W:c;var d=P(a,b);return N(T(d))>c?Q(a,b-1):d}function R(a,b){if("number"==typeof a||"string"==typeof a)return a.toString();if(!Array.isArray(a))return"";if(a=a.filter(function(a){return"string"==typeof a}),0===a.length)return"[object has no keys]";if(b="number"!=typeof b?X:b,a[0].length>=b)return a[0];for(var c=a.length;c>0;c--){var d=a.slice(0,c).join(", ");if(!(d.length>b))return c===a.length?d:d+"…"}return""}function S(a,b){function c(a){return m(a)?a.map(function(a){return c(a)}):k(a)?Object.keys(a).reduce(function(b,d){return b[d]=e.test(d)?f:c(a[d]),b},{}):a}if(!m(b)||m(b)&&0===b.length)return a;var d,e=A(b),f="********";try{d=JSON.parse(T(a))}catch(g){return a}return c(d)}var T=a(7),U="undefined"!=typeof window?window:"undefined"!=typeof c?c:"undefined"!=typeof self?self:{},V=3,W=51200,X=40;b.exports={isObject:d,isError:e,isErrorEvent:f,isDOMError:g,isDOMException:h,isUndefined:i,isFunction:j,isPlainObject:k,isString:l,isArray:m,isEmptyObject:n,supportsErrorEvent:o,supportsDOMError:p,supportsDOMException:q,supportsFetch:r,supportsReferrerPolicy:s,supportsPromiseRejectionEvent:t,wrappedCallback:u,each:v,objectMerge:w,truncate:y,objectFrozen:x,hasKey:z,joinRegExp:A,urlencode:B,uuid4:D,htmlTreeAsString:E,htmlElementAsString:F,isSameException:I,isSameStacktrace:J,parseUrl:C,fill:K,safeJoin:L,serializeException:Q,serializeKeysForMessage:R,sanitize:S}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{7:7}],6:[function(a,b,c){(function(c){function d(){return"undefined"==typeof document||null==document.location?"":document.location.href}function e(){return"undefined"==typeof document||null==document.location?"":document.location.origin?document.location.origin:document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:"")}var f=a(5),g={collectWindowErrors:!0,debug:!1},h="undefined"!=typeof window?window:"undefined"!=typeof c?c:"undefined"!=typeof self?self:{},i=[].slice,j="?",k=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;g.report=function(){function a(a){m(),s.push(a)}function b(a){for(var b=s.length-1;b>=0;--b)s[b]===a&&s.splice(b,1)}function c(){n(),s=[]}function e(a,b){var c=null;if(!b||g.collectWindowErrors){for(var d in s)if(s.hasOwnProperty(d))try{s[d].apply(null,[a].concat(i.call(arguments,2)))}catch(e){c=e}if(c)throw c}}function l(a,b,c,h,i){var l=null,m=f.isErrorEvent(i)?i.error:i,n=f.isErrorEvent(a)?a.message:a;if(v)g.computeStackTrace.augmentStackTraceWithInitialElement(v,b,c,n),o();else if(m&&f.isError(m))l=g.computeStackTrace(m),e(l,!0);else{var p,r={url:b,line:c,column:h},s=void 0;if("[object String]"==={}.toString.call(n)){var p=n.match(k);p&&(s=p[1],n=p[2])}r.func=j,l={name:s,message:n,url:d(),stack:[r]},e(l,!0)}return!!q&&q.apply(this,arguments)}function m(){r||(q=h.onerror,h.onerror=l,r=!0)}function n(){r&&(h.onerror=q,r=!1,q=void 0)}function o(){var a=v,b=t;t=null,v=null,u=null,e.apply(null,[a,!1].concat(b))}function p(a,b){var c=i.call(arguments,1);if(v){if(u===a)return;o()}var d=g.computeStackTrace(a);if(v=d,u=a,t=c,setTimeout(function(){u===a&&o()},d.incomplete?2e3:0),b!==!1)throw a}var q,r,s=[],t=null,u=null,v=null;return p.subscribe=a,p.unsubscribe=b,p.uninstall=c,p}(),g.computeStackTrace=function(){function a(a){if("undefined"!=typeof a.stack&&a.stack){for(var b,c,f,g=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,h=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx(?:-web)|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,i=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,k=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,l=/\((\S*)(?::(\d+))(?::(\d+))\)/,m=a.stack.split("\n"),n=[],o=(/^(.*) is undefined$/.exec(a.message),0),p=m.length;o<p;++o){if(c=g.exec(m[o])){var q=c[2]&&0===c[2].indexOf("native"),r=c[2]&&0===c[2].indexOf("eval");r&&(b=l.exec(c[2]))&&(c[2]=b[1],c[3]=b[2],c[4]=b[3]),f={url:q?null:c[2],func:c[1]||j,args:q?[c[2]]:[],line:c[3]?+c[3]:null,column:c[4]?+c[4]:null}}else if(c=h.exec(m[o]))f={url:c[2],func:c[1]||j,args:[],line:+c[3],column:c[4]?+c[4]:null};else{if(!(c=i.exec(m[o])))continue;var r=c[3]&&c[3].indexOf(" > eval")>-1;r&&(b=k.exec(c[3]))?(c[3]=b[1],c[4]=b[2],c[5]=null):0!==o||c[5]||"undefined"==typeof a.columnNumber||(n[0].column=a.columnNumber+1),f={url:c[3],func:c[1]||j,args:c[2]?c[2].split(","):[],line:c[4]?+c[4]:null,column:c[5]?+c[5]:null}}if(!f.func&&f.line&&(f.func=j),f.url&&"blob:"===f.url.substr(0,5)){var s=new XMLHttpRequest;if(s.open("GET",f.url,!1),s.send(null),200===s.status){var t=s.responseText||"";t=t.slice(-300);var u=t.match(/\/\/# sourceMappingURL=(.*)$/);if(u){var v=u[1];"~"===v.charAt(0)&&(v=e()+v.slice(1)),f.url=v.slice(0,-4)}}}n.push(f)}return n.length?{name:a.name,message:a.message,url:d(),stack:n}:null}}function b(a,b,c,d){var e={url:b,line:c};if(e.url&&e.line){if(a.incomplete=!1,e.func||(e.func=j),a.stack.length>0&&a.stack[0].url===e.url){if(a.stack[0].line===e.line)return!1;if(!a.stack[0].line&&a.stack[0].func===e.func)return a.stack[0].line=e.line,!1}return a.stack.unshift(e),a.partial=!0,!0}return a.incomplete=!0,!1}function c(a,e){for(var h,i,k=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,l=[],m={},n=!1,o=c.caller;o&&!n;o=o.caller)if(o!==f&&o!==g.report){if(i={url:null,func:j,line:null,column:null},o.name?i.func=o.name:(h=k.exec(o.toString()))&&(i.func=h[1]),"undefined"==typeof i.func)try{i.func=h.input.substring(0,h.input.indexOf("{"))}catch(p){}m[""+o]?n=!0:m[""+o]=!0,l.push(i)}e&&l.splice(0,e);var q={name:a.name,message:a.message,url:d(),stack:l};return b(q,a.sourceURL||a.fileName,a.line||a.lineNumber,a.message||a.description),q}function f(b,e){var f=null;e=null==e?0:+e;try{if(f=a(b))return f}catch(h){if(g.debug)throw h}try{if(f=c(b,e+1))return f}catch(h){if(g.debug)throw h}return{name:b.name,message:b.message,url:d()}}return f.augmentStackTraceWithInitialElement=b,f.computeStackTraceFromStackProp=a,f}(),b.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{5:5}],7:[function(a,b,c){function d(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function e(a,b,c,d){return JSON.stringify(a,g(b,d),c)}function f(a){var b={stack:a.stack,message:a.message,name:a.name};for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b}function g(a,b){var c=[],e=[];return null==b&&(b=function(a,b){return c[0]===b?"[Circular ~]":"[Circular ~."+e.slice(0,d(c,b)).join(".")+"]"}),function(g,h){if(c.length>0){var i=d(c,this);~i?c.splice(i+1):c.push(this),~i?e.splice(i,1/0,g):e.push(g),~d(c,h)&&(h=b.call(this,g,h))}else c.push(h);return null==a?h instanceof Error?f(h):h:a.call(this,g,h)}}c=b.exports=e,c.getSerialize=g},{}],8:[function(a,b,c){function d(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function e(a,b){return a<<b|a>>>32-b}function f(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)}function g(a,b,c,d,e,g,h){return f(b&c|~b&d,a,b,e,g,h)}function h(a,b,c,d,e,g,h){return f(b&d|c&~d,a,b,e,g,h)}function i(a,b,c,d,e,g,h){return f(b^c^d,a,b,e,g,h)}function j(a,b,c,d,e,g,h){return f(c^(b|~d),a,b,e,g,h)}function k(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;var c,e,f,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(c=0;c<a.length;c+=16)e=m,f=n,k=o,l=p,m=g(m,n,o,p,a[c],7,-680876936),p=g(p,m,n,o,a[c+1],12,-389564586),o=g(o,p,m,n,a[c+2],17,606105819),n=g(n,o,p,m,a[c+3],22,-1044525330),m=g(m,n,o,p,a[c+4],7,-176418897),p=g(p,m,n,o,a[c+5],12,1200080426),o=g(o,p,m,n,a[c+6],17,-1473231341),n=g(n,o,p,m,a[c+7],22,-45705983),m=g(m,n,o,p,a[c+8],7,1770035416),p=g(p,m,n,o,a[c+9],12,-1958414417),o=g(o,p,m,n,a[c+10],17,-42063),n=g(n,o,p,m,a[c+11],22,-1990404162),m=g(m,n,o,p,a[c+12],7,1804603682),p=g(p,m,n,o,a[c+13],12,-40341101),o=g(o,p,m,n,a[c+14],17,-1502002290),n=g(n,o,p,m,a[c+15],22,1236535329),m=h(m,n,o,p,a[c+1],5,-165796510),p=h(p,m,n,o,a[c+6],9,-1069501632),o=h(o,p,m,n,a[c+11],14,643717713),n=h(n,o,p,m,a[c],20,-373897302),m=h(m,n,o,p,a[c+5],5,-701558691),p=h(p,m,n,o,a[c+10],9,38016083),o=h(o,p,m,n,a[c+15],14,-660478335),n=h(n,o,p,m,a[c+4],20,-405537848),m=h(m,n,o,p,a[c+9],5,568446438),p=h(p,m,n,o,a[c+14],9,-1019803690),o=h(o,p,m,n,a[c+3],14,-187363961),n=h(n,o,p,m,a[c+8],20,1163531501),m=h(m,n,o,p,a[c+13],5,-1444681467),p=h(p,m,n,o,a[c+2],9,-51403784),o=h(o,p,m,n,a[c+7],14,1735328473),n=h(n,o,p,m,a[c+12],20,-1926607734),m=i(m,n,o,p,a[c+5],4,-378558),p=i(p,m,n,o,a[c+8],11,-2022574463),o=i(o,p,m,n,a[c+11],16,1839030562),n=i(n,o,p,m,a[c+14],23,-35309556),m=i(m,n,o,p,a[c+1],4,-1530992060),p=i(p,m,n,o,a[c+4],11,1272893353),o=i(o,p,m,n,a[c+7],16,-155497632),n=i(n,o,p,m,a[c+10],23,-1094730640),m=i(m,n,o,p,a[c+13],4,681279174),p=i(p,m,n,o,a[c],11,-358537222),o=i(o,p,m,n,a[c+3],16,-722521979),n=i(n,o,p,m,a[c+6],23,76029189),m=i(m,n,o,p,a[c+9],4,-640364487),p=i(p,m,n,o,a[c+12],11,-421815835),o=i(o,p,m,n,a[c+15],16,530742520),n=i(n,o,p,m,a[c+2],23,-995338651),m=j(m,n,o,p,a[c],6,-198630844),p=j(p,m,n,o,a[c+7],10,1126891415),o=j(o,p,m,n,a[c+14],15,-1416354905),n=j(n,o,p,m,a[c+5],21,-57434055),m=j(m,n,o,p,a[c+12],6,1700485571),p=j(p,m,n,o,a[c+3],10,-1894986606),o=j(o,p,m,n,a[c+10],15,-1051523),n=j(n,o,p,m,a[c+1],21,-2054922799),m=j(m,n,o,p,a[c+8],6,1873313359),p=j(p,m,n,o,a[c+15],10,-30611744),o=j(o,p,m,n,a[c+6],15,-1560198380),n=j(n,o,p,m,a[c+13],21,1309151649),m=j(m,n,o,p,a[c+4],6,-145523070),p=j(p,m,n,o,a[c+11],10,-1120210379),o=j(o,p,m,n,a[c+2],15,718787259),n=j(n,o,p,m,a[c+9],21,-343485551),m=d(m,e),n=d(n,f),o=d(o,k),p=d(p,l);return[m,n,o,p]}function l(a){var b,c="",d=32*a.length;for(b=0;b<d;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function m(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;var d=8*a.length;for(b=0;b<d;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function n(a){return l(k(m(a),8*a.length))}function o(a,b){var c,d,e=m(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=k(e,8*a.length)),c=0;c<16;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=k(f.concat(m(b)),512+8*b.length),l(k(g.concat(d),640))}function p(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function q(a){return unescape(encodeURIComponent(a))}function r(a){return n(q(a))}function s(a){return p(r(a))}function t(a,b){return o(q(a),q(b))}function u(a,b){return p(t(a,b))}function v(a,b,c){return b?c?t(b,a):u(b,a):c?r(a):s(a)}b.exports=v},{}]},{},[4])(4)});hy.define("raven.hapyak",["raven","configuration"],function(Raven,configuration,undefined){var i,whitelistUrls;var sentry={feature:"https://7ae3a37b0be24a8987d6f58a1dec1fe3@app.getsentry.com/4690",production:"https://5c1ea37229604fc0b6af526a44921e84@app.getsentry.com/2286",staging:"https://93681531623544f9bc54b3c606e30dc9@app.getsentry.com/2287"},sentryEndpoint=sentry[hapyak&&hapyak.environment];if(sentryEndpoint){whitelistUrls=[/hapyak\.com/,/d2qrdklrsxowl2\.cloudfront\.net/,/d3bo0fj9s1pd3n\.cloudfront\.net/,/dxwi20mo6v954\.cloudfront\.net/];if(configuration.sentry.whitelistUrls){for(i=0;i<configuration.sentry.whitelistUrls.length;i++){whitelistUrls.push(new RegExp(configuration.sentry.whitelistUrls[i].replace(/\./g,"\\.")))}}Raven.config(sentryEndpoint,{collectWindowErrors:false,whitelistUrls:whitelistUrls,includePaths:whitelistUrls.concat([new RegExp(window.location.host.replace(/\./g,"\\."))]),ignoreErrors:["top.GLOBALS","originalCreateNotification","canvas.contentDocument","MyApp_RemoveAllHighlights","http://tt.epicplay.com","Can't find variable: ZiteReader","jigsaw is not defined","ComboSearch is not defined","http://loading.retry.widdit.com/","atomicFindClose","fb_xd_fragment","bmi_SafeAddOnload","EBCallBackMessageReceived","conduitPage","timeout"],ignoreUrls:[/graph\.facebook\.com/i,/connect\.facebook\.net\/en_US\/all\.js/i,/eatdifferent\.com\.woopra-ns\.com/i,/static\.woopra\.com\/js\/woopra\.js/i,/extensions\//i,/^chrome:\/\//i,/127\.0\.0\.1:4001\/isrunning/i,/webappstoolbarba\.texthelp\.com\//i,/metrics\.itunes\.apple\.com\.edgesuite\.net\//i],tags:{hapyak_version:hapyak&&hapyak.VERSION||0}}).install()}return Raven});hy.define("cookie",[],function(){var cookie={set:function(key,value,days){var expires,date;if(days){date=new Date;date.setTime(date.getTime()+days*864e5);expires="; expires="+date.toGMTString()}else{expires=""}document.cookie=key+"="+value+expires+"; path=/"},get:function(key){var identifier=key+"=",cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=cookies[i];while(cookie.charAt(0)===" "){cookie=cookie.substring(1,cookie.length)}if(cookie.indexOf(identifier)===0){return cookie.substring(identifier.length,cookie.length)}}return null},remove:function(key){this.set(key,"",-1)}};if(typeof window!=="undefined"){window.HapyakCookie=cookie}return cookie});hy.define("utils.uuid",[],function(){var hex=function(){var a=[],i;for(i=0;i<16;i++){a.push(i.toString(16))}return a}();return function(){function randInt(){return Math.floor(4294967296*Math.random())}function calcUUID(w1,w2,w3,w4,version){var uuid,data,i,j,k,r,rnd;uuid=new Array(36)
;data=[w1&4294967295,w2&4294905855|(version||4)<<12,w3&1073741823|2147483648,w4&4294967295];for(i=0,k=0;i<4;i++){rnd=data[i];for(j=0;j<8;j++){if(k===8||k===13||k===18||k===23){uuid[k++]="-"}r=rnd>>>28&15;rnd=(rnd&268435455)<<4;uuid[k++]=hex[r]}}return uuid.join("")}return calcUUID(randInt(),randInt(),randInt(),randInt(),4)}});(function(){function n(n,t,e){e=(e||0)-1;for(var r=n?n.length:0;++e<r;)if(n[e]===t)return e;return-1}function t(t,e){var r=typeof e;if(t=t.l,"boolean"==r||null==e)return t[e]?0:-1;"number"!=r&&"string"!=r&&(r="object");var u="number"==r?e:m+e;return t=(t=t[r])&&t[u],"object"==r?t&&-1<n(t,e)?0:-1:t?0:-1}function e(n){var t=this.l,e=typeof n;if("boolean"==e||null==n)t[n]=true;else{"number"!=e&&"string"!=e&&(e="object");var r="number"==e?n:m+n,t=t[e]||(t[e]={});"object"==e?(t[r]||(t[r]=[])).push(n):t[r]=true}}function r(n){return n.charCodeAt(0)}function u(n,t){for(var e=n.m,r=t.m,u=-1,o=e.length;++u<o;){var i=e[u],a=r[u];if(i!==a){if(i>a||typeof i=="undefined")return 1;if(i<a||typeof a=="undefined")return-1}}return n.n-t.n}function o(n){var t=-1,r=n.length,u=n[0],o=n[r/2|0],i=n[r-1];if(u&&typeof u=="object"&&o&&typeof o=="object"&&i&&typeof i=="object")return false;for(u=f(),u["false"]=u["null"]=u["true"]=u.undefined=false,o=f(),o.k=n,o.l=u,o.push=e;++t<r;)o.push(n[t]);return o}function i(n){return"\\"+U[n]}function a(){return h.pop()||[]}function f(){return g.pop()||{k:null,l:null,m:null,false:false,n:0,null:false,number:null,object:null,push:null,string:null,true:false,undefined:false,o:null}}function l(n){n.length=0,h.length<_&&h.push(n)}function c(n){var t=n.l;t&&c(t),n.k=n.l=n.m=n.object=n.number=n.string=n.o=null,g.length<_&&g.push(n)}function p(n,t,e){t||(t=0),typeof e=="undefined"&&(e=n?n.length:0);var r=-1;e=e-t||0;for(var u=Array(0>e?0:e);++r<e;)u[r]=n[t+r];return u}function s(e){function h(n,t,e){if(!n||!V[typeof n])return n;t=t&&typeof e=="undefined"?t:tt(t,e,3);for(var r=-1,u=V[typeof n]&&Fe(n),o=u?u.length:0;++r<o&&(e=u[r],false!==t(n[e],e,n)););return n}function g(n,t,e){var r;if(!n||!V[typeof n])return n;t=t&&typeof e=="undefined"?t:tt(t,e,3);for(r in n)if(false===t(n[r],r,n))break;return n}function _(n,t,e){var r,u=n,o=u;if(!u)return o;for(var i=arguments,a=0,f=typeof e=="number"?2:i.length;++a<f;)if((u=i[a])&&V[typeof u])for(var l=-1,c=V[typeof u]&&Fe(u),p=c?c.length:0;++l<p;)r=c[l],"undefined"==typeof o[r]&&(o[r]=u[r]);return o}function U(n,t,e){var r,u=n,o=u;if(!u)return o;var i=arguments,a=0,f=typeof e=="number"?2:i.length;if(3<f&&"function"==typeof i[f-2])var l=tt(i[--f-1],i[f--],2);else 2<f&&"function"==typeof i[f-1]&&(l=i[--f]);for(;++a<f;)if((u=i[a])&&V[typeof u])for(var c=-1,p=V[typeof u]&&Fe(u),s=p?p.length:0;++c<s;)r=p[c],o[r]=l?l(o[r],u[r]):u[r];return o}function H(n){var t,e=[];if(!n||!V[typeof n])return e;for(t in n)me.call(n,t)&&e.push(t);return e}function J(n){return n&&typeof n=="object"&&!Te(n)&&me.call(n,"__wrapped__")?n:new Q(n)}function Q(n,t){this.__chain__=!!t,this.__wrapped__=n}function X(n){function t(){if(r){var n=p(r);be.apply(n,arguments)}if(this instanceof t){var o=nt(e.prototype),n=e.apply(o,n||arguments);return wt(n)?n:o}return e.apply(u,n||arguments)}var e=n[0],r=n[2],u=n[4];return $e(t,n),t}function Z(n,t,e,r,u){if(e){var o=e(n);if(typeof o!="undefined")return o}if(!wt(n))return n;var i=ce.call(n);if(!K[i])return n;var f=Ae[i];switch(i){case T:case F:return new f(+n);case W:case P:return new f(n);case z:return o=f(n.source,C.exec(n)),o.lastIndex=n.lastIndex,o}if(i=Te(n),t){var c=!r;r||(r=a()),u||(u=a());for(var s=r.length;s--;)if(r[s]==n)return u[s];o=i?f(n.length):{}}else o=i?p(n):U({},n);return i&&(me.call(n,"index")&&(o.index=n.index),me.call(n,"input")&&(o.input=n.input)),t?(r.push(n),u.push(o),(i?St:h)(n,function(n,i){o[i]=Z(n,t,e,r,u)}),c&&(l(r),l(u)),o):o}function nt(n){return wt(n)?ke(n):{}}function tt(n,t,e){if(typeof n!="function")return Ut;if(typeof t=="undefined"||!("prototype"in n))return n;var r=n.__bindData__;if(typeof r=="undefined"&&(De.funcNames&&(r=!n.name),r=r||!De.funcDecomp,!r)){var u=ge.call(n);De.funcNames||(r=!O.test(u)),r||(r=E.test(u),$e(n,r))}if(false===r||true!==r&&1&r[1])return n;switch(e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,u){return n.call(t,e,r,u)};case 4:return function(e,r,u,o){return n.call(t,e,r,u,o)}}return Mt(n,t)}function et(n){function t(){var n=f?i:this;if(u){var h=p(u);be.apply(h,arguments)}return(o||c)&&(h||(h=p(arguments)),o&&be.apply(h,o),c&&h.length<a)?(r|=16,et([e,s?r:-4&r,h,null,i,a])):(h||(h=arguments),l&&(e=n[v]),this instanceof t?(n=nt(e.prototype),h=e.apply(n,h),wt(h)?h:n):e.apply(n,h))}var e=n[0],r=n[1],u=n[2],o=n[3],i=n[4],a=n[5],f=1&r,l=2&r,c=4&r,s=8&r,v=e;return $e(t,n),t}function rt(e,r){var u=-1,i=st(),a=e?e.length:0,f=a>=b&&i===n,l=[];if(f){var p=o(r);p?(i=t,r=p):f=false}for(;++u<a;)p=e[u],0>i(r,p)&&l.push(p);return f&&c(r),l}function ut(n,t,e,r){r=(r||0)-1;for(var u=n?n.length:0,o=[];++r<u;){var i=n[r];if(i&&typeof i=="object"&&typeof i.length=="number"&&(Te(i)||yt(i))){t||(i=ut(i,t,e));var a=-1,f=i.length,l=o.length;for(o.length+=f;++a<f;)o[l++]=i[a]}else e||o.push(i)}return o}function ot(n,t,e,r,u,o){if(e){var i=e(n,t);if(typeof i!="undefined")return!!i}if(n===t)return 0!==n||1/n==1/t;if(n===n&&!(n&&V[typeof n]||t&&V[typeof t]))return false;if(null==n||null==t)return n===t;var f=ce.call(n),c=ce.call(t);if(f==D&&(f=q),c==D&&(c=q),f!=c)return false;switch(f){case T:case F:return+n==+t;case W:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case z:case P:return n==oe(t)}if(c=f==$,!c){var p=me.call(n,"__wrapped__"),s=me.call(t,"__wrapped__");if(p||s)return ot(p?n.__wrapped__:n,s?t.__wrapped__:t,e,r,u,o);if(f!=q)return false;if(f=n.constructor,p=t.constructor,f!=p&&!(dt(f)&&f instanceof f&&dt(p)&&p instanceof p)&&"constructor"in n&&"constructor"in t)return false}for(f=!u,u||(u=a()),o||(o=a()),p=u.length;p--;)if(u[p]==n)return o[p]==t;var v=0,i=true;if(u.push(n),o.push(t),c){if(p=n.length,v=t.length,(i=v==p)||r)for(;v--;)if(c=p,s=t[v],r)for(;c--&&!(i=ot(n[c],s,e,r,u,o)););else if(!(i=ot(n[v],s,e,r,u,o)))break}else g(t,function(t,a,f){return me.call(f,a)?(v++,i=me.call(n,a)&&ot(n[a],t,e,r,u,o)):void 0}),i&&!r&&g(n,function(n,t,e){return me.call(e,t)?i=-1<--v:void 0});return u.pop(),o.pop(),f&&(l(u),l(o)),i}function it(n,t,e,r,u){(Te(t)?St:h)(t,function(t,o){var i,a,f=t,l=n[o];if(t&&((a=Te(t))||Pe(t))){for(f=r.length;f--;)if(i=r[f]==t){l=u[f];break}if(!i){var c;e&&(f=e(l,t),c=typeof f!="undefined")&&(l=f),c||(l=a?Te(l)?l:[]:Pe(l)?l:{}),r.push(t),u.push(l),c||it(l,t,e,r,u)}}else e&&(f=e(l,t),typeof f=="undefined"&&(f=t)),typeof f!="undefined"&&(l=f);n[o]=l})}function at(n,t){return n+he(Re()*(t-n+1))}function ft(e,r,u){var i=-1,f=st(),p=e?e.length:0,s=[],v=!r&&p>=b&&f===n,h=u||v?a():s;for(v&&(h=o(h),f=t);++i<p;){var g=e[i],y=u?u(g,i,e):g;(r?!i||h[h.length-1]!==y:0>f(h,y))&&((u||v)&&h.push(y),s.push(g))}return v?(l(h.k),c(h)):u&&l(h),s}function lt(n){return function(t,e,r){var u={};e=J.createCallback(e,r,3),r=-1;var o=t?t.length:0;if(typeof o=="number")for(;++r<o;){var i=t[r];n(u,i,e(i,r,t),t)}else h(t,function(t,r,o){n(u,t,e(t,r,o),o)});return u}}function ct(n,t,e,r,u,o){var i=1&t,a=4&t,f=16&t,l=32&t;if(!(2&t||dt(n)))throw new ie;f&&!e.length&&(t&=-17,f=e=false),l&&!r.length&&(t&=-33,l=r=false);var c=n&&n.__bindData__;return c&&true!==c?(c=p(c),c[2]&&(c[2]=p(c[2])),c[3]&&(c[3]=p(c[3])),!i||1&c[1]||(c[4]=u),!i&&1&c[1]&&(t|=8),!a||4&c[1]||(c[5]=o),f&&be.apply(c[2]||(c[2]=[]),e),l&&we.apply(c[3]||(c[3]=[]),r),c[1]|=t,ct.apply(null,c)):(1==t||17===t?X:et)([n,t,e,r,u,o])}function pt(n){return Be[n]}function st(){var t=(t=J.indexOf)===Wt?n:t;return t}function vt(n){return typeof n=="function"&&pe.test(n)}function ht(n){var t,e;return n&&ce.call(n)==q&&(t=n.constructor,!dt(t)||t instanceof t)?(g(n,function(n,t){e=t}),typeof e=="undefined"||me.call(n,e)):false}function gt(n){return We[n]}function yt(n){return n&&typeof n=="object"&&typeof n.length=="number"&&ce.call(n)==D||false}function mt(n,t,e){var r=Fe(n),u=r.length;for(t=tt(t,e,3);u--&&(e=r[u],false!==t(n[e],e,n)););return n}function bt(n){var t=[];return g(n,function(n,e){dt(n)&&t.push(e)}),t.sort()}function _t(n){for(var t=-1,e=Fe(n),r=e.length,u={};++t<r;){var o=e[t];u[n[o]]=o}return u}function dt(n){return typeof n=="function"}function wt(n){return!(!n||!V[typeof n])}function jt(n){return typeof n=="number"||n&&typeof n=="object"&&ce.call(n)==W||false}function kt(n){return typeof n=="string"||n&&typeof n=="object"&&ce.call(n)==P||false}function xt(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;)u[t]=n[e[t]];return u}function Ct(n,t,e){var r=-1,u=st(),o=n?n.length:0,i=false;return e=(0>e?Ie(0,o+e):e)||0,Te(n)?i=-1<u(n,t,e):typeof o=="number"?i=-1<(kt(n)?n.indexOf(t,e):u(n,t,e)):h(n,function(n){return++r<e?void 0:!(i=n===t)}),i}function Ot(n,t,e){var r=true;t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if(typeof u=="number")for(;++e<u&&(r=!!t(n[e],e,n)););else h(n,function(n,e,u){return r=!!t(n,e,u)});return r}function Nt(n,t,e){var r=[];t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if(typeof u=="number")for(;++e<u;){var o=n[e];t(o,e,n)&&r.push(o)}else h(n,function(n,e,u){t(n,e,u)&&r.push(n)});return r}function It(n,t,e){t=J.createCallback(t,e,3),e=-1;var r=n?n.length:0;if(typeof r!="number"){var u;return h(n,function(n,e,r){return t(n,e,r)?(u=n,false):void 0}),u}for(;++e<r;){var o=n[e];if(t(o,e,n))return o}}function St(n,t,e){var r=-1,u=n?n.length:0;if(t=t&&typeof e=="undefined"?t:tt(t,e,3),typeof u=="number")for(;++r<u&&false!==t(n[r],r,n););else h(n,t);return n}function Et(n,t,e){var r=n?n.length:0;if(t=t&&typeof e=="undefined"?t:tt(t,e,3),typeof r=="number")for(;r--&&false!==t(n[r],r,n););else{var u=Fe(n),r=u.length;h(n,function(n,e,o){return e=u?u[--r]:--r,t(o[e],e,o)})}return n}function Rt(n,t,e){var r=-1,u=n?n.length:0;if(t=J.createCallback(t,e,3),typeof u=="number")for(var o=Xt(u);++r<u;)o[r]=t(n[r],r,n);else o=[],h(n,function(n,e,u){o[++r]=t(n,e,u)});return o}function At(n,t,e){var u=-1/0,o=u;if(typeof t!="function"&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a>o&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e>u&&(u=e,o=n)});return o}function Dt(n,t,e,r){if(!n)return e;var u=3>arguments.length;t=J.createCallback(t,r,4);var o=-1,i=n.length;if(typeof i=="number")for(u&&(e=n[++o]);++o<i;)e=t(e,n[o],o,n);else h(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)});return e}function $t(n,t,e,r){var u=3>arguments.length;return t=J.createCallback(t,r,4),Et(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)}),e}function Tt(n){var t=-1,e=n?n.length:0,r=Xt(typeof e=="number"?e:0);return St(n,function(n){var e=at(0,++t);r[t]=r[e],r[e]=n}),r}function Ft(n,t,e){var r;t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if(typeof u=="number")for(;++e<u&&!(r=t(n[e],e,n)););else h(n,function(n,e,u){return!(r=t(n,e,u))});return!!r}function Bt(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=-1;for(t=J.createCallback(t,e,3);++o<u&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[0]:v;return p(n,0,Se(Ie(0,r),u))}function Wt(t,e,r){if(typeof r=="number"){var u=t?t.length:0;r=0>r?Ie(0,u+r):r||0}else if(r)return r=zt(t,e),t[r]===e?r:-1;return n(t,e,r)}function qt(n,t,e){if(typeof t!="number"&&null!=t){var r=0,u=-1,o=n?n.length:0;for(t=J.createCallback(t,e,3);++u<o&&t(n[u],u,n);)r++}else r=null==t||e?1:Ie(0,t);return p(n,r)}function zt(n,t,e,r){var u=0,o=n?n.length:u;for(e=e?J.createCallback(e,r,1):Ut,t=e(t);u<o;)r=u+o>>>1,e(n[r])<t?u=r+1:o=r;return u}function Pt(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=typeof t!="function"&&r&&r[t]===n?null:t,t=false),null!=e&&(e=J.createCallback(e,r,3)),ft(n,t,e)}function Kt(){for(var n=1<arguments.length?arguments:arguments[0],t=-1,e=n?At(Ve(n,"length")):0,r=Xt(0>e?0:e);++t<e;)r[t]=Ve(n,t);return r}function Lt(n,t){var e=-1,r=n?n.length:0,u={};for(t||!r||Te(n[0])||(t=[]);++e<r;){var o=n[e];t?u[o]=t[e]:o&&(u[o[0]]=o[1])}return u}function Mt(n,t){return 2<arguments.length?ct(n,17,p(arguments,2),null,t):ct(n,1,null,null,t)}function Vt(n,t,e){function r(){c&&ve(c),i=c=p=v,(g||h!==t)&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null))}function u(){var e=t-(Ue()-f);0<e?c=_e(u,e):(i&&ve(i),e=p,i=c=p=v,e&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null)))}var o,i,a,f,l,c,p,s=0,h=false,g=true;if(!dt(n))throw new ie;if(t=Ie(0,t)||0,true===e)var y=true,g=false;else wt(e)&&(y=e.leading,h="maxWait"in e&&(Ie(t,e.maxWait)||0),g="trailing"in e?e.trailing:g);return function(){if(o=arguments,f=Ue(),l=this,p=g&&(c||!y),false===h)var e=y&&!c;else{i||y||(s=f);var v=h-(f-s),m=0>=v;m?(i&&(i=ve(i)),s=f,a=n.apply(l,o)):i||(i=_e(r,v))}return m&&c?c=ve(c):c||t===h||(c=_e(u,t)),e&&(m=true,a=n.apply(l,o)),!m||c||i||(o=l=null),a}}function Ut(n){return n}function Gt(n,t,e){var r=true,u=t&&bt(t);t&&(e||u.length)||(null==e&&(e=t),o=Q,t=n,n=J,u=bt(t)),false===e?r=false:wt(e)&&"chain"in e&&(r=e.chain);var o=n,i=dt(o);St(u,function(e){var u=n[e]=t[e];i&&(o.prototype[e]=function(){var t=this.__chain__,e=this.__wrapped__,i=[e];if(be.apply(i,arguments),i=u.apply(n,i),r||t){if(e===i&&wt(i))return this;i=new o(i),i.__chain__=t}return i})})}function Ht(){}function Jt(n){return function(t){return t[n]}}function Qt(){return this.__wrapped__}e=e?Y.defaults(G.Object(),e,Y.pick(G,A)):G;var Xt=e.Array,Yt=e.Boolean,Zt=e.Date,ne=e.Function,te=e.Math,ee=e.Number,re=e.Object,ue=e.RegExp,oe=e.String,ie=e.TypeError,ae=[],fe=re.prototype,le=e._,ce=fe.toString,pe=ue("^"+oe(ce).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),se=te.ceil,ve=e.clearTimeout,he=te.floor,ge=ne.prototype.toString,ye=vt(ye=re.getPrototypeOf)&&ye,me=fe.hasOwnProperty,be=ae.push,_e=e.setTimeout,de=ae.splice,we=ae.unshift,je=function(){try{var n={},t=vt(t=re.defineProperty)&&t,e=t(n,n,n)&&t}catch(r){}return e}(),ke=vt(ke=re.create)&&ke,xe=vt(xe=Xt.isArray)&&xe,Ce=e.isFinite,Oe=e.isNaN,Ne=vt(Ne=re.keys)&&Ne,Ie=te.max,Se=te.min,Ee=e.parseInt,Re=te.random,Ae={};Ae[$]=Xt,Ae[T]=Yt,Ae[F]=Zt,Ae[B]=ne,Ae[q]=re,Ae[W]=ee,Ae[z]=ue,Ae[P]=oe,Q.prototype=J.prototype;var De=J.support={};De.funcDecomp=!vt(e.a)&&E.test(s),De.funcNames=typeof ne.name=="string",J.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:N,variable:"",imports:{_:J}},ke||(nt=function(){function n(){}return function(t){if(wt(t)){n.prototype=t;var r=new n;n.prototype=null}return r||e.Object()}}());var $e=je?function(n,t){M.value=t,je(n,"__bindData__",M)}:Ht,Te=xe||function(n){return n&&typeof n=="object"&&typeof n.length=="number"&&ce.call(n)==$||false},Fe=Ne?function(n){return wt(n)?Ne(n):[]}:H,Be={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},We=_t(Be),qe=ue("("+Fe(We).join("|")+")","g"),ze=ue("["+Fe(Be).join("")+"]","g"),Pe=ye?function(n){if(!n||ce.call(n)!=q)return false;var t=n.valueOf,e=vt(t)&&(e=ye(t))&&ye(e);return e?n==e||ye(n)==e:ht(n)}:ht,Ke=lt(function(n,t,e){me.call(n,e)?n[e]++:n[e]=1}),Le=lt(function(n,t,e){(me.call(n,e)?n[e]:n[e]=[]).push(t)}),Me=lt(function(n,t,e){n[e]=t}),Ve=Rt,Ue=vt(Ue=Zt.now)&&Ue||function(){return(new Zt).getTime()},Ge=8==Ee(d+"08")?Ee:function(n,t){return Ee(kt(n)?n.replace(I,""):n,t||0)};return J.after=function(n,t){if(!dt(t))throw new ie;return function(){return 1>--n?t.apply(this,arguments):void 0}},J.assign=U,J.at=function(n){for(var t=arguments,e=-1,r=ut(t,true,false,1),t=t[2]&&t[2][t[1]]===n?1:r.length,u=Xt(t);++e<t;)u[e]=n[r[e]];return u},J.bind=Mt,J.bindAll=function(n){for(var t=1<arguments.length?ut(arguments,true,false,1):bt(n),e=-1,r=t.length;++e<r;){var u=t[e];n[u]=ct(n[u],1,null,null,n)}return n},J.bindKey=function(n,t){return 2<arguments.length?ct(t,19,p(arguments,2),null,n):ct(t,3,null,null,n)},J.chain=function(n){return n=new Q(n),n.__chain__=true,n},J.compact=function(n){for(var t=-1,e=n?n.length:0,r=[];++t<e;){var u=n[t];u&&r.push(u)}return r},J.compose=function(){for(var n=arguments,t=n.length;t--;)if(!dt(n[t]))throw new ie;return function(){for(var t=arguments,e=n.length;e--;)t=[n[e].apply(this,t)];return t[0]}},J.constant=function(n){return function(){return n}},J.countBy=Ke,J.create=function(n,t){var e=nt(n);return t?U(e,t):e},J.createCallback=function(n,t,e){var r=typeof n;if(null==n||"function"==r)return tt(n,t,e);if("object"!=r)return Jt(n);var u=Fe(n),o=u[0],i=n[o];return 1!=u.length||i!==i||wt(i)?function(t){for(var e=u.length,r=false;e--&&(r=ot(t[u[e]],n[u[e]],null,true)););return r}:function(n){return n=n[o],i===n&&(0!==i||1/i==1/n)}},J.curry=function(n,t){return t=typeof t=="number"?t:+t||n.length,ct(n,4,null,null,null,t)},J.debounce=Vt,J.defaults=_,J.defer=function(n){if(!dt(n))throw new ie;var t=p(arguments,1);return _e(function(){n.apply(v,t)},1)},J.delay=function(n,t){if(!dt(n))throw new ie;var e=p(arguments,2);return _e(function(){n.apply(v,e)},t)},J.difference=function(n){return rt(n,ut(arguments,true,true,1))},J.filter=Nt,J.flatten=function(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=typeof t!="function"&&r&&r[t]===n?null:t,t=false),null!=e&&(n=Rt(n,e,r)),ut(n,t)},J.forEach=St,J.forEachRight=Et,J.forIn=g,J.forInRight=function(n,t,e){var r=[];g(n,function(n,t){r.push(t,n)});var u=r.length;for(t=tt(t,e,3);u--&&false!==t(r[u--],r[u],n););return n},J.forOwn=h,J.forOwnRight=mt,J.functions=bt,J.groupBy=Le,J.indexBy=Me,J.initial=function(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else r=null==t||e?1:t||r;return p(n,0,Se(Ie(0,u-r),u))},J.intersection=function(){for(var e=[],r=-1,u=arguments.length,i=a(),f=st(),p=f===n,s=a();++r<u;){var v=arguments[r];(Te(v)||yt(v))&&(e.push(v),i.push(p&&v.length>=b&&o(r?e[r]:s)))}var p=e[0],h=-1,g=p?p.length:0,y=[];n:for(;++h<g;){var m=i[0],v=p[h];if(0>(m?t(m,v):f(s,v))){for(r=u,(m||s).push(v);--r;)if(m=i[r],0>(m?t(m,v):f(e[r],v)))continue n;y.push(v)}}for(;u--;)(m=i[u])&&c(m);return l(i),l(s),y},J.invert=_t,J.invoke=function(n,t){var e=p(arguments,2),r=-1,u=typeof t=="function",o=n?n.length:0,i=Xt(typeof o=="number"?o:0);return St(n,function(n){i[++r]=(u?t:n[t]).apply(n,e)}),i},J.keys=Fe,J.map=Rt,J.mapValues=function(n,t,e){var r={};return t=J.createCallback(t,e,3),h(n,function(n,e,u){r[e]=t(n,e,u)}),r},J.max=At,J.memoize=function(n,t){function e(){var r=e.cache,u=t?t.apply(this,arguments):m+arguments[0];return me.call(r,u)?r[u]:r[u]=n.apply(this,arguments)}if(!dt(n))throw new ie;return e.cache={},e},J.merge=function(n){var t=arguments,e=2;if(!wt(n))return n;if("number"!=typeof t[2]&&(e=t.length),3<e&&"function"==typeof t[e-2])var r=tt(t[--e-1],t[e--],2);else 2<e&&"function"==typeof t[e-1]&&(r=t[--e]);for(var t=p(arguments,1,e),u=-1,o=a(),i=a();++u<e;)it(n,t[u],r,o,i);return l(o),l(i),n},J.min=function(n,t,e){var u=1/0,o=u;if(typeof t!="function"&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a<o&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e<u&&(u=e,o=n)});return o},J.omit=function(n,t,e){var r={};if(typeof t!="function"){var u=[];g(n,function(n,t){u.push(t)});for(var u=rt(u,ut(arguments,true,false,1)),o=-1,i=u.length;++o<i;){var a=u[o];r[a]=n[a]}}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)||(r[e]=n)});return r},J.once=function(n){var t,e;if(!dt(n))throw new ie;return function(){return t?e:(t=true,e=n.apply(this,arguments),n=null,e)}},J.pairs=function(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;){var o=e[t];u[t]=[o,n[o]]}return u},J.partial=function(n){return ct(n,16,p(arguments,1))},J.partialRight=function(n){return ct(n,32,null,p(arguments,1))},J.pick=function(n,t,e){var r={};if(typeof t!="function")for(var u=-1,o=ut(arguments,true,false,1),i=wt(n)?o.length:0;++u<i;){var a=o[u];a in n&&(r[a]=n[a])}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)&&(r[e]=n)});return r},J.pluck=Ve,J.property=Jt,J.pull=function(n){for(var t=arguments,e=0,r=t.length,u=n?n.length:0;++e<r;)for(var o=-1,i=t[e];++o<u;)n[o]===i&&(de.call(n,o--,1),u--);return n},J.range=function(n,t,e){n=+n||0,e=typeof e=="number"?e:+e||1,null==t&&(t=n,n=0);var r=-1;t=Ie(0,se((t-n)/(e||1)));for(var u=Xt(t);++r<t;)u[r]=n,n+=e;return u},J.reject=function(n,t,e){return t=J.createCallback(t,e,3),Nt(n,function(n,e,r){return!t(n,e,r)})},J.remove=function(n,t,e){var r=-1,u=n?n.length:0,o=[];for(t=J.createCallback(t,e,3);++r<u;)e=n[r],t(e,r,n)&&(o.push(e),de.call(n,r--,1),u--);return o},J.rest=qt,J.shuffle=Tt,J.sortBy=function(n,t,e){var r=-1,o=Te(t),i=n?n.length:0,p=Xt(typeof i=="number"?i:0);for(o||(t=J.createCallback(t,e,3)),St(n,function(n,e,u){var i=p[++r]=f();o?i.m=Rt(t,function(t){return n[t]}):(i.m=a())[0]=t(n,e,u),i.n=r,i.o=n}),i=p.length,p.sort(u);i--;)n=p[i],p[i]=n.o,o||l(n.m),c(n);return p},J.tap=function(n,t){return t(n),n},J.throttle=function(n,t,e){var r=true,u=true;if(!dt(n))throw new ie;return false===e?r=false:wt(e)&&(r="leading"in e?e.leading:r,u="trailing"in e?e.trailing:u),L.leading=r,L.maxWait=t,L.trailing=u,Vt(n,t,L)},J.times=function(n,t,e){n=-1<(n=+n)?n:0;var r=-1,u=Xt(n);for(t=tt(t,e,1);++r<n;)u[r]=t(r);return u},J.toArray=function(n){return n&&typeof n.length=="number"?p(n):xt(n)},J.transform=function(n,t,e,r){var u=Te(n);if(null==e)if(u)e=[];else{var o=n&&n.constructor;e=nt(o&&o.prototype)}return t&&(t=J.createCallback(t,r,4),(u?St:h)(n,function(n,r,u){return t(e,n,r,u)})),e},J.union=function(){return ft(ut(arguments,true,true))},J.uniq=Pt,J.values=xt,J.where=Nt,J.without=function(n){return rt(n,p(arguments,1))},J.wrap=function(n,t){return ct(t,16,[n])},J.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var e=arguments[n];if(Te(e)||yt(e))var r=r?ft(rt(r,e).concat(rt(e,r))):e}return r||[]},J.zip=Kt,J.zipObject=Lt,J.collect=Rt,J.drop=qt,J.each=St,J.eachRight=Et,J.extend=U,J.methods=bt,J.object=Lt,J.select=Nt,J.tail=qt,J.unique=Pt,J.unzip=Kt,Gt(J),J.clone=function(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=t,t=false),Z(n,t,typeof e=="function"&&tt(e,r,1))},J.cloneDeep=function(n,t,e){return Z(n,true,typeof t=="function"&&tt(t,e,1))},J.contains=Ct,J.escape=function(n){return null==n?"":oe(n).replace(ze,pt)},J.every=Ot,J.find=It,J.findIndex=function(n,t,e){var r=-1,u=n?n.length:0;for(t=J.createCallback(t,e,3);++r<u;)if(t(n[r],r,n))return r;return-1},J.findKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),h(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},J.findLast=function(n,t,e){var r;return t=J.createCallback(t,e,3),Et(n,function(n,e,u){return t(n,e,u)?(r=n,false):void 0}),r},J.findLastIndex=function(n,t,e){var r=n?n.length:0;for(t=J.createCallback(t,e,3);r--;)if(t(n[r],r,n))return r;return-1},J.findLastKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),mt(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},J.has=function(n,t){return n?me.call(n,t):false},J.identity=Ut,J.indexOf=Wt,J.isArguments=yt,J.isArray=Te,J.isBoolean=function(n){return true===n||false===n||n&&typeof n=="object"&&ce.call(n)==T||false},J.isDate=function(n){return n&&typeof n=="object"&&ce.call(n)==F||false},J.isElement=function(n){return n&&1===n.nodeType||false},J.isEmpty=function(n){var t=true;if(!n)return t;var e=ce.call(n),r=n.length;return e==$||e==P||e==D||e==q&&typeof r=="number"&&dt(n.splice)?!r:(h(n,function(){return t=false}),t)},J.isEqual=function(n,t,e,r){return ot(n,t,typeof e=="function"&&tt(e,r,2))},J.isFinite=function(n){return Ce(n)&&!Oe(parseFloat(n))},J.isFunction=dt,J.isNaN=function(n){return jt(n)&&n!=+n},J.isNull=function(n){return null===n},J.isNumber=jt,J.isObject=wt,J.isPlainObject=Pe,J.isRegExp=function(n){return n&&typeof n=="object"&&ce.call(n)==z||false},J.isString=kt,J.isUndefined=function(n){return typeof n=="undefined"},J.lastIndexOf=function(n,t,e){var r=n?n.length:0;for(typeof e=="number"&&(r=(0>e?Ie(0,r+e):Se(e,r-1))+1);r--;)if(n[r]===t)return r;return-1},J.mixin=Gt,J.noConflict=function(){return e._=le,this},J.noop=Ht,J.now=Ue,J.parseInt=Ge,J.random=function(n,t,e){var r=null==n,u=null==t;return null==e&&(typeof n=="boolean"&&u?(e=n,n=1):u||typeof t!="boolean"||(e=t,u=true)),r&&u&&(t=1),n=+n||0,u?(t=n,n=0):t=+t||0,e||n%1||t%1?(e=Re(),Se(n+e*(t-n+parseFloat("1e-"+((e+"").length-1))),t)):at(n,t)},J.reduce=Dt,J.reduceRight=$t,J.result=function(n,t){if(n){var e=n[t];return dt(e)?n[t]():e}},J.runInContext=s,J.size=function(n){var t=n?n.length:0;return typeof t=="number"?t:Fe(n).length},J.some=Ft,J.sortedIndex=zt,J.template=function(n,t,e){var r=J.templateSettings;n=oe(n||""),e=_({},e,r);var u,o=_({},e.imports,r.imports),r=Fe(o),o=xt(o),a=0,f=e.interpolate||S,l="__p+='",f=ue((e.escape||S).source+"|"+f.source+"|"+(f===N?x:S).source+"|"+(e.evaluate||S).source+"|$","g");n.replace(f,function(t,e,r,o,f,c){return r||(r=o),l+=n.slice(a,c).replace(R,i),e&&(l+="'+__e("+e+")+'"),f&&(u=true,l+="';"+f+";\n__p+='"),r&&(l+="'+((__t=("+r+"))==null?'':__t)+'"),a=c+t.length,t}),l+="';",f=e=e.variable,f||(e="obj",l="with("+e+"){"+l+"}"),l=(u?l.replace(w,""):l).replace(j,"$1").replace(k,"$1;"),l="function("+e+"){"+(f?"":e+"||("+e+"={});")+"var __t,__p='',__e=_.escape"+(u?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}";try{var c=ne(r,"return "+l).apply(v,o)}catch(p){throw p.source=l,p}return t?c(t):(c.source=l,c)},J.unescape=function(n){return null==n?"":oe(n).replace(qe,gt)},J.uniqueId=function(n){var t=++y;return oe(null==n?"":n)+t},J.all=Ot,J.any=Ft,J.detect=It,J.findWhere=It,J.foldl=Dt,J.foldr=$t,J.include=Ct,J.inject=Dt,Gt(function(){var n={};return h(J,function(t,e){J.prototype[e]||(n[e]=t)}),n}(),false),J.first=Bt,J.last=function(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[u-1]:v;return p(n,Ie(0,u-r))},J.sample=function(n,t,e){return n&&typeof n.length!="number"&&(n=xt(n)),null==t||e?n?n[at(0,n.length-1)]:v:(n=Tt(n),n.length=Se(Ie(0,t),n.length),n)},J.take=Bt,J.head=Bt,h(J,function(n,t){var e="sample"!==t;J.prototype[t]||(J.prototype[t]=function(t,r){var u=this.__chain__,o=n(this.__wrapped__,t,r);return u||null!=t&&(!r||e&&typeof t=="function")?new Q(o,u):o})}),J.VERSION="2.4.1",J.prototype.chain=function(){return this.__chain__=true,this},J.prototype.toString=function(){return oe(this.__wrapped__)},J.prototype.value=Qt,J.prototype.valueOf=Qt,St(["join","pop","shift"],function(n){var t=ae[n];J.prototype[n]=function(){var n=this.__chain__,e=t.apply(this.__wrapped__,arguments);return n?new Q(e,n):e}}),St(["push","reverse","sort","unshift"],function(n){var t=ae[n];J.prototype[n]=function(){return t.apply(this.__wrapped__,arguments),this}}),St(["concat","slice","splice"],function(n){var t=ae[n];J.prototype[n]=function(){return new Q(t.apply(this.__wrapped__,arguments),this.__chain__)}}),J}var v,h=[],g=[],y=0,m=+new Date+"",b=75,_=40,d=" \t\v\f \ufeff\n\r\u2028\u2029 ᠎             　",w=/\b__p\+='';/g,j=/\b(__p\+=)''\+/g,k=/(__e\(.*?\)|\b__t\))\+'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,N=/<%=([\s\S]+?)%>/g,I=RegExp("^["+d+"]*0+(?=.$)"),S=/($^)/,E=/\bthis\b/,R=/['\n\r\t\u2028\u2029\\]/g,A="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",$="[object Array]",T="[object Boolean]",F="[object Date]",B="[object Function]",W="[object Number]",q="[object Object]",z="[object RegExp]",P="[object String]",K={};K[B]=false,K[D]=K[$]=K[T]=K[F]=K[W]=K[q]=K[z]=K[P]=true;var L={leading:false,maxWait:0,trailing:false},M={configurable:false,enumerable:false,value:null,writable:false},V={boolean:false,function:true,object:true,number:false,string:false,undefined:false},U={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},G=V[typeof window]&&window||this,H=V[typeof exports]&&exports&&!exports.nodeType&&exports,J=V[typeof module]&&module&&!module.nodeType&&module,Q=J&&J.exports===H&&H,X=V[typeof global]&&global;!X||X.global!==X&&X.window!==X||(G=X);var Y=s();typeof hy.define==="function"&&typeof hy.define.amd==="object"&&hy.define.amd?(G._=Y,hy.define("lodash",[],function(){return Y})):H&&J?Q?(J.exports=Y)._=Y:H._=Y:G._=Y}).call(this);hy.define("lodash.noconflict",["lodash"],function(_){return _.noConflict()});hy.define("utils.omitinvalid",["lodash.noconflict"],function(_){function isInvalid(property){return!_.isBoolean(property)&&!_.isNumber(property)&&_.isEmpty(property)}return function(properties){return _.omit(properties,isInvalid)}});hy.define("utils.embed",["module","lodash.noconflict","configuration"],function(module,_,configuration,undefined){var cssUrlRegex=/^(?:https?\:\/|\/)\/(?:[a-z]\.|[a-z][a-z0-9-]{0,61}[a-z0-9]\.)*?[\w\d\.\/_-]+\.css(?:\?[^?]*)?$/i,cssUrlHeightRegex=/_([0-9]+)\.css/i,isIOS=navigator.userAgent.match(/iP(od|ad|hone)/),moduleConfig=module.config();return{dotget:function(obj,desc,d){var value;if(obj&&desc){var arr=desc.split(".");while(obj&&arr.length){obj=obj[arr.shift()]}value=obj}return value!==undefined?value:d},checkLtiUserAccess:function(ltiContext,transitionPath){if(!ltiContext){return}var nextUrl=ltiContext.next_url,currentPath=window.location.pathname,applicationController=this.get("controller.controllers.application");var experienceId;if(nextUrl&&nextUrl.replace(location.protocol+hapyak.rootUrl,"")===currentPath||transitionPath==="experience.edit"&&ltiContext.createdNewExperience||currentPath==="/portal/lti/new"||!applicationController){return}experienceId=ltiContext.experience_id||applicationController.get("lti_context.experienceId");if(experienceId&&currentPath==="/portal/experiences/"+experienceId){return}applicationController.send("navAction","logout")},controlStyle:function(injectCss,nativePlayer){var controlBarHeight=59,controlStyle,editorControlStyle,controlStyleHeight,controlType,assetMap;controlStyle=moduleConfig.controlStyle||this.dotget(configuration,"player.viewer.controlStyle")||"bottom";editorControlStyle=this.dotget(configuration,"player.editor.controlStyle");controlType=controlStyle;assetMap={overlay:"/css/generated/control_overlay.css",light_bottom:"/css/generated/control_bottom.css",default:"/css/generated/control_bottom.css"};if(isIOS&&nativePlayer){controlStyle=controlType="overlay"}if(!moduleConfig.edit){if(controlStyle==="overlay"){controlBarHeight=isIOS?37:0}else if(controlStyle==="light_bottom"){controlBarHeight=37}else if(controlStyle&&controlStyle.match(cssUrlRegex)){controlType="custom";controlStyleHeight=controlStyle.match(cssUrlHeightRegex);if(_.isArray(controlStyleHeight)&&controlStyleHeight.length===2){controlBarHeight=+controlStyleHeight[1]}}else{controlType="default"}if(moduleConfig.controlBarHeight!==undefined){controlBarHeight=moduleConfig.controlBarHeight}else{controlBarHeight=this.dotget(configuration,"player.viewer.controlBarHeight",controlBarHeight)}}else if(editorControlStyle){if(editorControlStyle&&editorControlStyle.match(cssUrlRegex)){controlType="custom";controlStyleHeight=editorControlStyle.match(cssUrlHeightRegex);if(_.isArray(controlStyleHeight)&&controlStyleHeight.length===2){controlBarHeight=+controlStyleHeight[1]}controlStyle=editorControlStyle}else{controlType="default"}}else{controlType="default"}if(injectCss){if(controlType==="custom"){hapyak.asset.css(controlStyle)}else{hapyak.asset.css(hapyak.assets+assetMap[controlType])}}return controlBarHeight},getQueryParams:function(url,keysStartingWith){var queryParams={},qPos=url&&url.indexOf("?");if(qPos!==undefined&&qPos!==-1){url.substr(qPos+1).split("&").forEach(function(param){var parts=param.split("="),key=parts[0];if(param&&keysStartingWith===undefined||key.indexOf(keysStartingWith)===0){if(keysStartingWith){key=key.replace(keysStartingWith,"")}if(parts.length===2){queryParams[key]=decodeURIComponent(parts[1].replace(/\+/g,"%20"))}}})}return queryParams},toSSL:function(url){if(url.indexOf("//")===0){return"https:"+url}else{return url}},shortDate:function(value,timeFormat){var hours,minutes,ampm,output;if(!value){return}
if(!(value instanceof Date)){value=new Date(value)}output=value.getMonth()+1+"/"+value.getDate()+"/"+value.getFullYear();if(typeof timeFormat!=="undefined"&&(+timeFormat===24||!timeFormat)){output+=" "+value.getHours()+":"+value.getMinutes()}else if(typeof timeFormat!=="undefined"){hours=value.getHours()%12;minutes=value.getMinutes();hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;ampm=value.getHours()<12?"AM":"PM";output+=" "+hours+":"+minutes+" "+ampm}return output}}});hy.define("logging",["require","module","configuration","raven.hapyak","cookie","utils.uuid","utils.omitinvalid","lodash.noconflict","utils.embed"],function(require,module,configuration,Raven,cookie,uuid,omitInvalid,_,utils){var isLogging=module.config().logLevel==="metrics",logLevel,configLogLevel;var logging={log:function(){if(arguments.length&&window.console&&window.console.log){var args=[].slice.apply(arguments);args[0]="hapyak: "+args[0];if(window.console.log.apply){window.console.log.apply(window.console,args)}else{window.console.log(args[0])}}},info:function(){if(logLevel>logging.logLevels.indexOf("info")){return}if(arguments.length&&window.console&&window.console.info){var args=[].slice.apply(arguments);args[0]="hapyak (i): "+args[0];if(window.console.info.apply){window.console.info.apply(window.console,args)}else{window.console.info(args[0])}}},error:function(){if(logLevel>logging.logLevels.indexOf("error")){return}if(arguments.length&&window.console&&window.console.error){var args=[].slice.apply(arguments);args[0]="hapyak (e): "+args[0];if(window.console.error.apply){window.console.error.apply(window.console,args)}else{window.console.error(args[0])}}},warn:function(){if(logLevel>logging.logLevels.indexOf("warn")){return}if(arguments.length&&window.console&&window.console.warn){var args=[].slice.apply(arguments);args[0]="hapyak (w): "+args[0];if(window.console.warn.apply){window.console.warn.apply(window.console,args)}else{window.console.warn(args[0])}}},trace:function(){if(logLevel>logging.logLevels.indexOf("trace")){return}if(arguments.length&&window.console&&window.console.trace){var args=[].slice.apply(arguments);args[0]="hapyak (t): "+args[0];if(window.console.trace.apply){window.console.trace.apply(window.console,args)}else{window.console.trace(args[0])}}},debug:function(){if(logLevel>logging.logLevels.indexOf("debug")){return}if(arguments.length&&window.console&&window.console.debug){var args=[].slice.apply(arguments);args[0]="hapyak (d): "+args[0];if(window.console.debug.apply){window.console.debug.apply(window.console,args)}else{window.console.debug(args[0])}}},dev:function(){if(module.config().environment!=="dev"){return}if(arguments.length&&window.console&&window.console.info){var args=[].slice.apply(arguments);args[0]="hapyak (!): "+args[0];if(window.console.info.apply){window.console.info.apply(window.console,args)}else{window.console.info(args[0])}}},logMethod:function logMethod(){if(!arguments.length||!isLogging){return}var args=Array.prototype.slice.call(arguments,0),eventName=args[1],properties=args[2];if(_.isString(args[0])){args[0]="HapyakAnalytics."+args[0]+"()"}logging.dev.apply(this,eventName&&properties?[args[0],eventName,properties]:args)},captureException:function(err){Raven.captureException(err)},captureMessage:function(message){logging.warn(message);Raven.captureMessage(message)},logLevels:["trace","metrics","debug","info","warn","error"]};if(typeof window!=="undefined"){Object.defineProperty(window,"haplog",{get:function(){logging.warn("Deprecation warning:  window.haplog.tracking is no longer supported.   Please use hapyak.tracking.getInstance() instead.");return{tracking:hapyak.tracking.getInstance()}}})}configLogLevel=logging.logLevels.indexOf(configuration.player.logLevel);if(configLogLevel>-1){logLevel=configLogLevel}else{logLevel=logging.logLevels.indexOf(module.config().logLevel)}logging.logLevel=logLevel;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&typeof window.console!=="undefined"){if(typeof window.console.log!=="undefined"&&logLevel<=logging.logLevels.indexOf("debug")){logging.log=window.console.log.bind(window.console,"hapyak:")}if(typeof window.console.trace!=="undefined"&&logLevel<=logging.logLevels.indexOf("trace")){logging.trace=window.console.trace.bind(window.console,"hapyak (t):")}if(typeof window.console.debug!=="undefined"&&logLevel<=logging.logLevels.indexOf("debug")){logging.debug=window.console.debug.bind(window.console,"hapyak (d):")}if(typeof window.console.info!=="undefined"&&logLevel<=logging.logLevels.indexOf("info")){logging.info=window.console.info.bind(window.console,"hapyak (i):");if(module.config().environment==="dev"){logging.dev=window.console.info.bind(window.console,"hapyak (!):")}}if(typeof window.console.warn!=="undefined"&&logLevel<=logging.logLevels.indexOf("warn")){logging.warn=window.console.warn.bind(window.console,"hapyak (w):")}if(typeof window.console.error!=="undefined"&&logLevel<=logging.logLevels.indexOf("error")){logging.error=window.console.error.bind(window.console,"hapyak (e):")}}return logging});!function(e,n){function r(e,n){var r,t,u=e.toLowerCase();for(n=[].concat(n),r=0;n.length>r;r+=1)if(t=n[r]){if(t.test&&t.test(e))return!0;if(t.toLowerCase()===u)return!0}}var t=n.prototype.trim,u=n.prototype.trimRight,i=n.prototype.trimLeft,l=function(e){return 1*e||0},o=function(e,n){if(1>n)return"";for(var r="";n>0;)1&n&&(r+=e),n>>=1,e+=e;return r},a=[].slice,c=function(e){return null==e?"\\s":e.source?e.source:"["+g.escapeRegExp(e)+"]"},s={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},f={};for(var p in s)f[s[p]]=p;f["'"]="#39";var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var r=o,t=function(){return t.cache.hasOwnProperty(arguments[0])||(t.cache[arguments[0]]=t.parse(arguments[0])),t.format.call(null,t.cache[arguments[0]],arguments)};return t.format=function(t,u){var i,l,o,a,c,s,f,p=1,g=t.length,d="",m=[];for(l=0;g>l;l++)if(d=e(t[l]),"string"===d)m.push(t[l]);else if("array"===d){if(a=t[l],a[2])for(i=u[p],o=0;a[2].length>o;o++){if(!i.hasOwnProperty(a[2][o]))throw new Error(h('[_.sprintf] property "%s" does not exist',a[2][o]));i=i[a[2][o]]}else i=a[1]?u[a[1]]:u[p++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw new Error(h("[_.sprintf] expecting number but found %s",e(i)));switch(a[8]){case"b":i=i.toString(2);break;case"c":i=n.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=n(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,s=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",f=a[6]-n(i).length,c=a[6]?r(s,f):"",m.push(a[5]?i+c:c+i)}return m.join("")},t.cache={},t.parse=function(e){for(var n=e,r=[],t=[],u=0;n;){if(null!==(r=/^[^\x25]+/.exec(n)))t.push(r[0]);else if(null!==(r=/^\x25{2}/.exec(n)))t.push("%");else{if(null===(r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(n)))throw new Error("[_.sprintf] huh?");if(r[2]){u|=1;var i=[],l=r[2],o=[];if(null===(o=/^([a-z_][a-z_\d]*)/i.exec(l)))throw new Error("[_.sprintf] huh?");for(i.push(o[1]);""!==(l=l.substring(o[0].length));)if(null!==(o=/^\.([a-z_][a-z_\d]*)/i.exec(l)))i.push(o[1]);else{if(null===(o=/^\[(\d+)\]/.exec(l)))throw new Error("[_.sprintf] huh?");i.push(o[1])}r[2]=i}else u|=2;if(3===u)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");t.push(r)}n=n.substring(r[0].length)}return t},t}(),g={VERSION:"2.3.0",isBlank:function(e){return null==e&&(e=""),/^\s*$/.test(e)},stripTags:function(e){return null==e?"":n(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e=null==e?"":n(e),e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,r){return null==e?[]:(e=n(e),r=~~r,r>0?e.match(new RegExp(".{1,"+r+"}","g")):[e])},clean:function(e){return g.strip(e).replace(/\s+/g," ")},count:function(e,r){if(null==e||null==r)return 0;e=n(e),r=n(r);for(var t=0,u=0,i=r.length;;){if(u=e.indexOf(r,u),-1===u)break;t++,u+=i}return t},chars:function(e){return null==e?[]:n(e).split("")},swapCase:function(e){return null==e?"":n(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return null==e?"":n(e).replace(/[&<>"']/g,function(e){return"&"+f[e]+";"})},unescapeHTML:function(e){return null==e?"":n(e).replace(/\&([^;]+);/g,function(e,r){var t;return r in s?s[r]:(t=r.match(/^#x([\da-fA-F]+)$/))?n.fromCharCode(parseInt(t[1],16)):(t=r.match(/^#(\d+)$/))?n.fromCharCode(~~t[1]):e})},escapeRegExp:function(e){return null==e?"":n(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,n,r,t){var u=g.chars(e);return u.splice(~~n,~~r,t),u.join("")},insert:function(e,n,r){return g.splice(e,n,0,r)},include:function(e,r){return""===r?!0:null==e?!1:-1!==n(e).indexOf(r)},join:function(){var e=a.call(arguments),n=e.shift();return null==n&&(n=""),e.join(n)},lines:function(e){return null==e?[]:n(e).split("\n")},reverse:function(e){return g.chars(e).reverse().join("")},startsWith:function(e,r){return""===r?!0:null==e||null==r?!1:(e=n(e),r=n(r),e.length>=r.length&&e.slice(0,r.length)===r)},endsWith:function(e,r){return""===r?!0:null==e||null==r?!1:(e=n(e),r=n(r),e.length>=r.length&&e.slice(e.length-r.length)===r)},succ:function(e){return null==e?"":(e=n(e),e.slice(0,-1)+n.fromCharCode(e.charCodeAt(e.length-1)+1))},titleize:function(e){return null==e?"":(e=n(e).toLowerCase(),e.replace(/(?:^|\s|-)\S/g,function(e){return e.toUpperCase()}))},camelize:function(e){return g.trim(e).replace(/[-_\s]+(.)?/g,function(e,n){return n?n.toUpperCase():""})},underscored:function(e){return g.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return g.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return g.titleize(n(e).replace(/[\W_]/g," ")).replace(/\s/g,"")},humanize:function(e){return g.capitalize(g.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,r){return null==e?"":!r&&t?t.call(e):(r=c(r),n(e).replace(new RegExp("^"+r+"+|"+r+"+$","g"),""))},ltrim:function(e,r){return null==e?"":!r&&i?i.call(e):(r=c(r),n(e).replace(new RegExp("^"+r+"+"),""))},rtrim:function(e,r){return null==e?"":!r&&u?u.call(e):(r=c(r),n(e).replace(new RegExp(r+"+$"),""))},truncate:function(e,r,t){return null==e?"":(e=n(e),t=t||"...",r=~~r,e.length>r?e.slice(0,r)+t:e)},prune:function(e,r,t){if(null==e)return"";if(e=n(e),r=~~r,t=null!=t?n(t):"...",r>=e.length)return e;var u=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},i=e.slice(0,r+1).replace(/.(?=\W*\w*$)/g,u);return i=i.slice(i.length-2).match(/\w\w/)?i.replace(/\s*\S+$/,""):g.rtrim(i.slice(0,i.length-1)),(i+t).length>e.length?e:e.slice(0,i.length)+t},words:function(e,n){return g.isBlank(e)?[]:g.trim(e,n).split(n||/\s+/)},pad:function(e,r,t,u){e=null==e?"":n(e),r=~~r;var i=0;switch(t?t.length>1&&(t=t.charAt(0)):t=" ",u){case"right":return i=r-e.length,e+o(t,i);case"both":return i=r-e.length,o(t,Math.ceil(i/2))+e+o(t,Math.floor(i/2));default:return i=r-e.length,o(t,i)+e}},lpad:function(e,n,r){return g.pad(e,n,r)},rpad:function(e,n,r){return g.pad(e,n,r,"right")},lrpad:function(e,n,r){return g.pad(e,n,r,"both")},sprintf:h,vsprintf:function(e,n){return n.unshift(e),h.apply(null,n)},toNumber:function(e,n){return e?(e=g.trim(e),e.match(/^-?\d+(?:\.\d+)?$/)?l(l(e).toFixed(~~n)):0/0):0},numberFormat:function(e,n,r,t){if(isNaN(e)||null==e)return"";e=e.toFixed(~~n),t="string"==typeof t?t:",";var u=e.split("."),i=u[0],l=u[1]?(r||".")+u[1]:"";return i.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+t)+l},strRight:function(e,r){if(null==e)return"";e=n(e),r=null!=r?n(r):r;var t=r?e.indexOf(r):-1;return~t?e.slice(t+r.length,e.length):e},strRightBack:function(e,r){if(null==e)return"";e=n(e),r=null!=r?n(r):r;var t=r?e.lastIndexOf(r):-1;return~t?e.slice(t+r.length,e.length):e},strLeft:function(e,r){if(null==e)return"";e=n(e),r=null!=r?n(r):r;var t=r?e.indexOf(r):-1;return~t?e.slice(0,t):e},strLeftBack:function(e,n){if(null==e)return"";e+="",n=null!=n?""+n:n;var r=e.lastIndexOf(n);return~r?e.slice(0,r):e},toSentence:function(e,n,r,t){n=n||", ",r=r||" and ";var u=e.slice(),i=u.pop();return e.length>2&&t&&(r=g.rtrim(n)+r),u.length?u.join(n)+r+i:i},toSentenceSerial:function(){var e=a.call(arguments);return e[3]=!0,g.toSentence.apply(g,e)},slugify:function(e){if(null==e)return"";var r="ąàáäâãåæăćęèéëêìíïîłńòóöôõøśșțùúüûñçżź",t="aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",u=new RegExp(c(r),"g");return e=n(e).toLowerCase().replace(u,function(e){var n=r.indexOf(e);return t.charAt(n)||"-"}),g.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,n){return[n,e,n].join("")},quote:function(e,n){return g.surround(e,n||'"')},unquote:function(e,n){return n=n||'"',e[0]===n&&e[e.length-1]===n?e.slice(1,e.length-1):e},exports:function(){var e={};for(var n in this)this.hasOwnProperty(n)&&!n.match(/^(?:include|contains|reverse)$/)&&(e[n]=this[n]);return e},repeat:function(e,r,t){if(null==e)return"";if(r=~~r,null==t)return o(n(e),r);for(var u=[];r>0;u[--r]=e);return u.join(t)},naturalCmp:function(e,r){if(e==r)return 0;if(!e)return-1;if(!r)return 1;for(var t=/(\.\d+)|(\d+)|(\D+)/g,u=n(e).toLowerCase().match(t),i=n(r).toLowerCase().match(t),l=Math.min(u.length,i.length),o=0;l>o;o++){var a=u[o],c=i[o];if(a!==c){var s=parseInt(a,10);if(!isNaN(s)){var f=parseInt(c,10);if(!isNaN(f)&&s-f)return s-f}return c>a?-1:1}}return u.length===i.length?u.length-i.length:r>e?-1:1},levenshtein:function(e,r){if(null==e&&null==r)return 0;if(null==e)return n(r).length;if(null==r)return n(e).length;e=n(e),r=n(r);for(var t,u,i=[],l=0;r.length>=l;l++)for(var o=0;e.length>=o;o++)u=l&&o?e.charAt(o-1)===r.charAt(l-1)?t:Math.min(i[o],i[o-1],t)+1:l+o,t=i[o],i[o]=u;return i.pop()},toBoolean:function(e,n,t){return"number"==typeof e&&(e=""+e),"string"!=typeof e?!!e:(e=g.trim(e),r(e,n||["true","1"])?!0:r(e,t||["false","0"])?!1:void 0)}};g.strip=g.trim,g.lstrip=g.ltrim,g.rstrip=g.rtrim,g.center=g.lrpad,g.rjust=g.lpad,g.ljust=g.rpad,g.contains=g.include,g.q=g.quote,g.toBool=g.toBoolean,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(module.exports=g),exports._s=g),"function"===typeof hy.define&&hy.define.amd&&hy.define("underscore.string",[],function(){return g}),e._=e._||{},e._.string=e._.str=g}(this,String);hy.define("underscore.pullAt",["module"],function(module){var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsUint=/^(?:0|[1-9]\d*)$/;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayMap(array,iteratee){var index=-1,length=array?array.length:0,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol=root.Symbol,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined;var nativeMax=Math.max;var Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create");var symbolProto=Symbol?Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAt(object,paths){var index=-1,isNil=object==null,length=paths.length,result=Array(length);while(++index<length){result[index]=isNil?undefined:get(object,paths[index])}return result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}function baseGet(object,path){path=isKey(path,object)?[path]:castPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1)}else if(!isKey(index,array)){var path=castPath(index),object=parent(array,path);if(object!=null){delete object[toKey(last(path))]}}else{delete array[toKey(index)]}}}return array}function baseRest(func,start){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=array;return apply(func,this,otherArgs)}}function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray(value)?value:stringToPath(value)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}function parent(object,path){return path.length==1?object:baseGet(object,baseSlice(path,0,-1))}var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}var pullAt=baseRest(function(array,indexes){indexes=baseFlatten(indexes,1);var length=array?array.length:0,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending));return result});function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString(value){return value==null?"":baseToString(value)}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}return pullAt});hy.define("lodash.extended.noconflict",["lodash","underscore.string","underscore.pullAt"],function(_,_str,_pullAt){function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1).toLowerCase()}_.str=_str;_.pullAt=_pullAt;_.mixin({capitalize:capitalize});return _.noConflict()});hy.define("utils.support",["lodash.extended.noconflict"],function(_){var email="info@hapyak.com";return{mailTo:function(body,subject){body=_.str.trim(body);subject=_.str.trim(subject);if(!subject.length){subject="HapYak Support Request"}return"mailto:"+email+"?subject="+encodeURIComponent(subject)+(body.length?"&body="+encodeURIComponent(body):"")},encodeHttpHeaderValue:function(value){try{return value.replace(/[^\x00-\x7F]+/gi,"-")}catch(e){return value}}}});hy.define("dao",["module","jquery.noconflict","crypto/md5","logging","lodash.noconflict","ember.noconflict","utils.support","utils.embed","configuration"],function(module,$,md5,logging,_,embed_placeholder,support,utils,config){var isJSONP=module.config().jsonp||window.location.href.indexOf(module.config().api)===-1,jsonpUsedCallbacks=[],queryCache=module.config().queryCache,cdn=module.config().apiCdn,cdnPrefix,cdnQueryString,cdnEnabledPrefixes=["/api/srt/"],readOnly=module.config().readOnly||false,AUTH_HEADERS={"X-Hapyak-Partner-Group":"groupId","X-Hapyak-Partner-Group-Token":"groupToken","X-Hapyak-Partner-User":"userId","X-Hapyak-Partner-Username":"username","X-Hapyak-Partner-User-Token":"userToken"},AUTH_QUERY_PARAMS={partner_group:"groupId",partner_group_token:"groupToken",partner_user:"userId",partner_username:"username",partner_user_token:"userToken"};function findUnusedJsonpCallbackName(name,uniqueCount){var newName=name+(uniqueCount||"");if(uniqueCount>=10){return newName}if(jsonpUsedCallbacks.indexOf(newName)===-1){jsonpUsedCallbacks.push(newName);return newName}if(!uniqueCount){uniqueCount=1}else{uniqueCount++}return findUnusedJsonpCallbackName(name,uniqueCount)}function createReferenceArrays(data){var objectTypes={Experience:[data.experience],Layout:[data.experience.layout],LayoutType:[data.experience.layout_type],Playlist:[data.experience.playlist],PlaylistToProject:data.playlist_to_project,Addon:data.addon,Project:[],Video:[]};var i;for(i=0;i<objectTypes.PlaylistToProject.length;i++){objectTypes.Project.push(objectTypes.PlaylistToProject[i].project);objectTypes.Video.push(objectTypes.PlaylistToProject[i].project.video)}return objectTypes}if(module.config().viewerMode){var referenceArrays=createReferenceArrays(module.config().experienceDataGraph)}if(cdn&&(cdn.enabled===undefined||cdn.enabled===true)){cdnPrefix=cdn.prefix;cdnQueryString=cdn.query}var Store=Ember.Object.extend(Ember.Evented,{model:null,nextRecordId:0,apiKey:module.config().apiKey,reportingKey:module.config().reportingKey,records:Ember.MapWithDefault.create({defaultValue:function(key){return Ember.Map.create()}}),changeList:[],backup:{},inTransaction:false,status:"ok",onStatusChange:Ember.observer(function(){if(hapyak.iframed){hapyak.displayOverlayMessage(null,"Something went wrong, please refresh.",null,{text:"Refresh",refresh:true})}},"status"),commitStatus:"ok",commitAttempts:1,commitIndex:1,autoSaveInterval:3e3,isDirty:false,isCommitting:false,shutdown:false,startTransaction:function(){var store=this;this.set("inTransaction",true);if(this.get("scheduledCommit")){clearTimeout(this.get("scheduledCommit"))}return{commit:function(callback){store.commit(callback,true)},abort:function(callback){store.abort(callback,true)}}},getNextId:function(){var cid="_"+this.get("nextRecordId");this.incrementProperty("nextRecordId");return cid},recordRecord:function(record){this.get("records").get(record.constructor).set(record.get("id"),record);this.notifyPropertyChange("records")},getRecord:function(type,id){return this.get("records").get(type).get(id)},removeRecord:function(type,id){var record=this.getRecord(type,id);if(record){this.get("records").get(type).remove(id);this.notifyPropertyChange("records")}return record},load:function(type,data){var resolveQueue=[];var result=this._load(type,data,resolveQueue);_.each(resolveQueue,function(fn){fn()});return result},_load:function(type,data,resolveQueue){var record;if(data instanceof Array){return _.map(data,function(item){return this._load(type,item,resolveQueue)},this)}else{record=this.getRecord(type,data.id);if(!record){record=type.create();record.set("id",data.id,false);this.recordRecord(record)}record.beginPropertyChanges();_.each(data,function(value,prop){if(prop in type.references){var sideloadedType=type.getPropertyType(prop);if(value instanceof Array){_.each(value,function(arrayEntry){if(typeof arrayEntry==="object"){this._load(sideloadedType,arrayEntry,resolveQueue)}},this)}else if(typeof value==="object"){this._load(sideloadedType,value,resolveQueue)}}},this);_.each(data,function(value,prop){var sideloadedType;if(prop==="deleted"){prop="isDeleted"}if(prop==="properties"){_.each(value,function(value,key){if(!this.hasChange(record,"properties."+key)){record.setCustomProperty(key,value,false)}else{logging.info("ignore load data b/c of pending change to key "+key)}},this)}else{if(this.hasChange(record,prop)){return}sideloadedType=type.getPropertyType(prop);if(prop in type.references){resolveQueue.push(_.bind(function(ignoreOld){var newVal;if(value instanceof Array){
record.set(prop,Ember.A(_.map(value,function(arrayEntry){if(typeof arrayEntry==="object"){return this.getRecord(sideloadedType,arrayEntry.id)}else if(typeof arrayEntry==="number"&&!isNaN(arrayEntry)){return this.getRecord(sideloadedType,arrayEntry)}else{return null}},this)),false)}else if(typeof value==="object"){newVal=this.getRecord(sideloadedType,value.id);if(typeof(record.get(prop)==="number")&&newVal){record.set(prop,null,false)}record.set(prop,newVal,false)}else if(typeof value==="number"&&!isNaN(value)){record.set(prop,this.getRecord(sideloadedType,value),false)}},this))}else if(prop!=="id"){if(sideloadedType===Date){value=new Date(value)}record.set(prop,value,false)}}},this);record.set("isLoaded",true,false);record.set("isSaved",true,false);record.endPropertyChanges();record.trigger("didLoad");record.resolve(record);return record}},find:function(type,id,errHandler){if(module.config().viewerMode){var typeArray=referenceArrays[type.typeName],newArray=[];var i,record,keys,modelArray;var newArray=typeArray.filter(function(obj){if(typeof id==="object"){return Object.keys(id).every(function(key){if(typeof obj[key]==="object"){return obj[key].id===id[key]}return obj[key]===id[key]})}else{return obj.id===id}});modelArray=RecordArray.create({});modelArray.set("content",Ember.A(this.load(type,newArray)));modelArray.set("isLoaded",true);return modelArray}return Ember.typeOf(id)==="object"?this.findQuery(type,id):this.findById(type,id,errHandler)},findById:function(type,id,errHandler){id=parseInt(id,10);if(isNaN(id)){throw new Error("id is NaN, cant findById")}var record=this.getRecord(type,id);if(record){return record}else{record=type.create();record.set("id",id,false);this.recordRecord(record);var url=Ember.String.fmt(type.getEndpoint()+"/%@/",[id]);this.getJSON(type,url,{},function(data){Ember.run(this,function(){this.load(type,data)})}.bind(this),errHandler);return record}},findOne:function(type,query,onLoad){this.findQuery(type,query).onLoad(function(results){onLoad(results.get("firstObject"))})},findMany:function(type,ids){return Ember.RSVP.all(_.map(ids,_.bind(this.find,this,type)))},findQuery:function(type,query){var modelArray=RecordArray.create({}),cached=null,onSuccess=function(data,status){Ember.run(this,function(){if(!data.meta&&data.id){modelArray.set("content",Ember.A([this.load(type,data)]))}else{var records=this.load(type,data.objects);modelArray.set("content",Ember.A(records));modelArray.setProperties({total:data.meta.total,pages:data.meta.pages,page:data.meta.page,hasPrevious:!!data.meta.previous,hasNext:!!data.meta.next});if(data.meta.next){modelArray.set("next",function(){var newQuery={};_.extend(newQuery,query,{page:data.meta.page+1});return this.find(type,newQuery)}.bind(this))}modelArray.set("loadPage",function(page){if(_.isNaN(+page)||page<=0){return}var newQuery={};_.extend(newQuery,query,{page:+page});return this.find(type,newQuery)}.bind(this));if(data.meta.previous){modelArray.set("previous",function(){var newQuery={};_.extend(newQuery,query,{page:data.meta.page-1});return this.find(type,newQuery)}.bind(this))}}modelArray.set("isLoaded",true);modelArray.trigger("didLoad");modelArray.resolve(modelArray)})}.bind(this),onError=function(){modelArray.set("isLoaded",true);modelArray.trigger("didLoad");modelArray.reject(modelArray)};if(query.query&&query.page===1){cached=queryCache[query.query];if(cached){delete queryCache[query.query];logging.info("loading query result for query "+query.query+" from cache");onSuccess(cached);return modelArray}}this.getJSON(type,type.getEndpoint()+"/",query,onSuccess,onError);return modelArray},filter:function(type,query,filter){if(arguments.length===3){this.findQuery(type,query)}else if(arguments.length===2){filter=query}return FilteredRecordArray.create({type:type,filterFunction:filter,content:Ember.A([])})},createRecord:function(type,p,isTransient){return type.createRecord(p,isTransient)},deleteRecord:function(record){return record.deleteRecord()},didCreate:function(record){if(readOnly){return}var cid=this.getNextId();record.set("id",cid,false);this.recordRecord(record);this.get("changeList").push({op:"create",type:record.constructor.typeName,id:cid});this.notifyPropertyChange("changeList");this.scheduleCommit()},beforeUpdate:function(record,key,value){if(readOnly){return}if(this.get("inTransaction")&&!(record.get("id")in this.get("backup"))){var data=record.get("data"),copy=_.clone(data);if("properties"in copy){copy.properties=_.cloneDeep(copy.properties)}this.get("backup")[record.get("id")]={data:copy,record:record}}},didUpdate:function(record,key,value){if(readOnly){return}if(value instanceof Ember.Object){value=value.get("id")}if(value===undefined){value=null}this.set("changeList",_.reject(this.get("changeList"),function(item){return"set"===item.op&&record.constructor.typeName===item.type&&record.get("id")===item.id&&key===item.key}));this.get("changeList").push({op:"set",type:record.constructor.typeName,id:record.get("id"),key:key,value:value});this.notifyPropertyChange("changeList");this.scheduleCommit()},didDelete:function(record){if(readOnly){return}this.set("changeList",_.reject(this.get("changeList"),function(item){return"delete"===item.op&&record.constructor.typeName===item.type&&record.get("id")===item.id}));this.get("changeList").push({op:"delete",type:record.constructor.typeName,id:record.get("id")});this.notifyPropertyChange("changeList");this.notifyPropertyChange("records");this.scheduleCommit()},hasChange:function(record,key){if(readOnly){return false}return _.find(this.get("changeList"),function(item){return"set"===item.op&&record.constructor.typeName===item.type&&record.get("id")===item.id&&key===item.key})},scheduleCommit:function(){if(readOnly||this.get("inTransaction")){return}if(this.get("scheduledCommit")){clearTimeout(this.get("scheduledCommit"))}this.set("scheduledCommit",setTimeout(this.commit.bind(this),this.get("autoSaveInterval")))},hasChanges:Ember.computed(function(){if(readOnly){return false}var hasChanges=this.get("changeList").length>0;this.set("isDirty",hasChanges||this.get("isCommitting"));return hasChanges}).property("changeList").cacheable(false),commit:function(onSuccess,flushTransaction,promise){promise=promise||Ember.Deferred.create();if(readOnly){logging.warn("in readOnly mode");promise.reject({status:"error",message:"DAO is readOnly",code:"read_only"});return promise}if(this.get("inTransaction")&&!flushTransaction){promise.reject({status:"error",message:"DAO is in transaction",code:"in_transaction"});return promise}if(!hapyak.auth().userId&&_.isEmpty(hapyak.auth().partner)){logging.warn("can not commit, not logged in");promise.reject({status:"error",message:"Not logged in",code:"not_logged_in"});return promise}if(!this.get("isCommitting")&&this.get("hasChanges")){this.set("isCommitting",true);logging.info("committing "+this.get("changeList").length+" changes",this.get("changeList"));if(this.get("scheduledCommit")){clearTimeout(this.get("scheduledCommit"));this.set("scheduledCommit",null)}var commitIndex=this.get("commitIndex");this.incrementProperty("commitIndex");var onCommit=function(committedIndex,isSuccess,result){if(committedIndex>=commitIndex){this.off("committed",onCommit);if(isSuccess){promise.resolve();if(onSuccess){onSuccess(result)}}else{promise.reject(result)}}}.bind(this);this.on("committed",onCommit);var changeList=this.get("changeList").slice(0);this.set("changeList",[]);this.sendChanges(changeList,commitIndex);this.set("backup",{});this.set("inTransaction",false)}else{if(this.get("hasChanges")){this.one("committed",this,function(){this.commit(onSuccess,promise)})}else{promise.resolve();if(onSuccess){onSuccess()}}}return promise},abort:function(callback,flushTransaction){if(this.get("inTransaction")&&!flushTransaction){throw new Error("Can not abort, in transaction")}var revertedRecords=[];_.each(this.get("backup"),function(value){var record=value["record"];var backupData=value["data"];logging.debug("rolling back data in record "+record.get("id"));record.set("data",backupData);revertedRecords.push(record)});this.set("backup",{});this.set("changeList",[]);this.set("inTransaction",false);this.trigger("aborted",revertedRecords);callback()},sendChanges:function(changeList,commitIndex){var model=this.get("model"),that=this;this.postJSON("/api/batch/",changeList,function(result){Ember.run(this,function(){this.set("status","ok");this.set("commitStatus","ok");this.set("commitAttempts",1);_.each(result.changed,function(object){var record,type=model[object.type];if(object.cid){record=this.removeRecord(type,object.cid);if(record){record.set("id",object.data.id);this.recordRecord(record)}_.each(this.get("changeList"),function(change){if(change.id===object.cid){change.id=object.data.id}if(change.value===object.cid){change.value=object.data.id}})}record=this.load(type,object.data);if(record.get("isDeleted")){record.trigger("didDelete")}else{record.trigger("didSave");if(!object.cid){record.trigger("didUpdate")}}},this);this.trigger("committed",commitIndex,true,result);this.set("isCommitting",false);this.commit()})},function(error){Ember.run(that,function(){var errorJson;if(error.status===429){this.set("isCommitting",false);try{errorJson=JSON.parse(error.responseText);logging.captureMessage("Limit exceeded ["+errorJson.id+"], "+errorJson.message);this.trigger("committed",commitIndex,false,errorJson);hapyak.displayOverlayMessage(null,"Request could not be completed. Rate limit exceeded. Please try again in a few minutes. Error ID: "+errorJson.id,null,{text:"DISMISS",title:"Rate limit exceeded",dismissible:true})}catch(e){logging.captureMessage("Limit exceeded");this.trigger("committed",commitIndex,false)}}else if(error.status!==200&&error.status!==400&&error.status!==403){this.set("status","connection-error");this.set("commitStatus","requeue");var attempts=this.get("commitAttempts");if(attempts%5===0){logging.error("connection error to hapyak servers, will continue to requeue changes, attempt="+attempts)}setTimeout(function(){this.incrementProperty("commitAttempts");this.sendChanges(changeList)}.bind(this),2e3*attempts)}else if(error.status===400){this.set("isCommitting",false);try{errorJson=JSON.parse(error.responseText);logging.captureMessage("Illegal argument exception for dao save, "+errorJson.message);this.trigger("committed",commitIndex,false,errorJson)}catch(e){logging.captureMessage("Illegal argument exception for dao save");this.trigger("committed",commitIndex,false)}}})})},getJSON:function(type,url,data,onSuccess,onError,attempts){var jsonp=isJSONP,cdnEnabled=(cdnEnabledPrefixes.indexOf(url.split("?")[0])>-1||type&&type.supportsCdnAccess)&&cdnPrefix,fullUrl,partnerAuth;var hash;attempts=attempts||1;data=data?_.clone(data):{};if(cdnEnabled){fullUrl=cdnPrefix+url;if(cdnQueryString){fullUrl+="?"+cdnQueryString}data.cdn=true;jsonp=true}else{fullUrl=module.config().api+url}if(jsonp){fullUrl+=(fullUrl.indexOf("?")===-1?"?":"&")+"callback=?";if(module.config().csrfToken){data.csrf=module.config().csrfToken}if(this.get("apiKey")){data.key=this.get("apiKey")}partnerAuth=hapyak.auth().partner;if(!_.isEmpty(partnerAuth)){_.each(AUTH_QUERY_PARAMS,function(variable,param){if(partnerAuth[variable]&&(!cdnEnabled||variable.indexOf("group")===0)){data[param]=partnerAuth[variable]}})}}if(fullUrl.indexOf("viewer/setup")>0){fullUrl=utils.toSSL(fullUrl)}hash=this.setupAjaxRequest(fullUrl,"GET");hash.data=data;hash.success=onSuccess;if(cdnEnabled){hash.jsonpCallback=findUnusedJsonpCallbackName("hap_"+md5($.param(data))+"_");hash.cache=true}hash.success=function(data){this.set("status","ok");if(onSuccess){onSuccess(data)}};hash.error=function(error,status){function hasText(str,searchString){if(!str||typeof str.indexOf!=="function"){return}return str.indexOf(searchString)>-1}this.set("isCommitting",false);if(error.status!==200&&error.status!==400&&error.status!==403&&error.status!==404&&attempts<10){this.set("status","connection-error");setTimeout(function(){this.incrementProperty("attempts");this.getJSON(type,url,data,onSuccess,onError,attempts+1)}.bind(this),2e3*attempts)}else if(utils.dotget(error,"status")===404&&hasText(error.responseText,"does_not_exist")&&hasText(url,"/api/experiences/")||hasText(url,"/api/projects/")){if(onError&&typeof onError==="function"){onError()}else{window.location="/portal/"}}else if(error.status===403){this.set("status","offline");if(onError&&typeof onError==="function"){onError(error)}}else if([0,400,404].indexOf(error.status)>-1){if(onError){onError(error)}}};return $.ajax(hash)},postJSON:function(url,data,onSuccess,onError,additionalHeaders){var hash=this.setupAjaxRequest(url,"POST",null,additionalHeaders);if(data){hash.data=JSON.stringify(data)}hash.success=onSuccess;hash.error=function(error){this.set("isCommitting",false);if([0,403].indexOf(error.status)>-1){this.set("status","offline")}if(typeof onError==="function"){onError(error)}};return $.ajax(hash)},setRequestHeaders:function(xhr,additionalHeaders,url){var auth=hapyak.auth(),partnerAuth=auth.partner,apiKey=this.context&&this.context.apiKey||this.get("apiKey");if(module.config().csrfToken){xhr.setRequestHeader("X-Hapyak-CSRF-Token",support.encodeHttpHeaderValue(module.config().csrfToken))}if(url.indexOf("hapyak.com/api/reports/")>0){xhr.setRequestHeader("X-Hapyak-API-Key",this.get("reportingKey"))}else if(apiKey){xhr.setRequestHeader("X-Hapyak-API-Key",apiKey)}if(additionalHeaders){Object.keys(additionalHeaders).forEach(function(key){xhr.setRequestHeader(key,additionalHeaders[key])})}if(!_.isEmpty(partnerAuth)){_.each(AUTH_HEADERS,function(variable,header){if(partnerAuth[variable]){xhr.setRequestHeader(header,support.encodeHttpHeaderValue(partnerAuth[variable]))}})}else if(auth.userId){xhr.setRequestHeader("X-Hapyak-User",support.encodeHttpHeaderValue(auth.userId))}},setupAjaxRequest:function(url,type,onSuccess,additionalHeaders){var that=this,hash={url:url,timeout:utils.dotget(config,"portal.connectionTimeout"),context:this};type=type||"GET";if(url.indexOf("?callback=?")!==-1){hash.dataType="jsonp";hash.async=false}else{hash.type=type;hash.contentType="application/json; charset=utf-8";hash.dataType="json";hash.beforeSend=function(xhr){that.setRequestHeaders(xhr,additionalHeaders,url)};hash.error=function(error){this.set("isCommitting",false);if([0,403].indexOf(error.status)>-1){this.set("status","offline")}};if(this.get("shutdown")){hash.async=false}if(onSuccess){hash.success=function(){if(typeof onSuccess==="function"){onSuccess()}}}}return hash},upload:function(options,callback){var xhr=new XMLHttpRequest,formData=new FormData||{},data=this.setupAjaxRequest(options.url);var received;if(!options.url){logging.captureException("Dao-Upload: No upload URL found. Please try again"+options.url);return}formData.append("file",options.file);formData.append("name",options.name);xhr.onreadystatechange=function(e){var response;if(this.readyState===4&&this.status===200&&!received){logging.info("xhr upload complete",e);received=true;try{response=JSON.parse(this.response)}catch(err){logging.captureException("Dao - Upload: There was something wrong with the response from the server."+response)}callback(response)}};xhr.open("post",options.url,true);xhr.setRequestHeader("Accept","application/json");data.beforeSend(xhr);xhr.send(formData)},isConnectionError:Ember.computed(function(){return this.get("status")==="connection-error"}).property("status"),isCommitStatusRequeue:Ember.computed(function(){return this.get("commitStatus")==="requeue"}).property("commitStatus")});var store=Store.create({});var RecordArray=Ember.ArrayProxy.extend(Ember.Evented,Ember.DeferredMixin,{isLoaded:false,onLoad:function(callback){if(this.get("isLoaded")){callback(this)}else{this.one("didLoad",this,function(){callback(this)})}return this}});var FilteredRecordArray=RecordArray.extend({type:null,filterFunction:null,init:function(){this.updateContent();store.addObserver("records",this,"updateContent")},updateContent:function(){var matches=Ember.A([]);store.records.get(this.get("type")).forEach(function(key,value){if(!value.get("isDeleted")){if(this.get("filterFunction")){if(this.get("filterFunction")(value)){matches.pushObject(value)}}else{matches.pushObject(value)}}},this);this.set("content",matches);this.set("isLoaded",true);this.trigger("didLoad");this.resolve(this)},willDestroy:function(){store.removeObserver("records",this,"updateContent")}});var ListOf=Ember.Object.extend({type:null});var DataRecord=Ember.Object.extend(Ember.Evented,Ember.DeferredMixin,{isLoaded:false,params:{},init:function(){if(this.get("endpoint")){this.getJSON(this.get("endpoint"),this.get("params"))}},getJSON:function(endpoint,params){var that=this;that.set("loading",true);store.getJSON(null,"/api"+endpoint,params,function(result){that.load(result);that.set("loading",false);that.set("isLoaded",true);that.trigger("didLoad");that.resolve(that)})},onLoad:function(context,callback){if(this.get("isLoaded")){callback.apply(context)}else{this.one("didLoad",this,function(){callback.apply(context)})}return this},load:function(data){_.each(data,function(value,key){if(key.indexOf(".")!==-1){key=key.replace(".","_")}if(value!==null){if(value instanceof Array){this.set(key,Ember.A(_.map(value,function(arrayEntry){if(typeof arrayEntry==="object"){return DataRecord.create({}).load(arrayEntry)}else{return arrayEntry}},this)))}else if(typeof value==="object"){this.set(key,DataRecord.create({}).load(value))}else{this.set(key,value)}}},this);return this}});DataRecord.reopenClass({find:function(endpoint,params){return DataRecord.create({endpoint:endpoint,params:params})}});return{store:store,RecordArray:RecordArray,ListOf:ListOf,DataRecord:DataRecord}});hy.define("configAPI",["logging","configuration","utils.embed"],function(logging,configuration,utils){configuration.isProvisioned=function isProvisioned(key,direct){if(this.constants["PROVISIONING"][key]===undefined){logging.error("Invalid provisioning constant: "+key)}return utils.dotget(this,(direct?"direct":"resolved")+".PROVISIONING."+key)};configuration.getProperty=function getProperty(key,direct){if(this.constants["CONFIGURATION"][key]===undefined){logging.error("Invalid configuration constant: "+key)}return utils.dotget(this,(direct?"direct":"resolved")+".CONFIGURATION."+key)};configuration.anySubPropIsProvisioned=function anySubPropIsProvisioned(pathToParent){var parentObject=utils.dotget(configuration,"provisioning."+pathToParent);var childObject;if(!parentObject){return false}for(childObject in parentObject){if(parentObject.hasOwnProperty(childObject)&&parentObject[childObject]){return true}}};return configuration});hy.define("analytics.integration",["logging","lodash.noconflict"],function(logging,_){function HapyakAnalyticsIntegration(){this.identify=function(){};this.track=function(){throw new Error('HapyakAnalyticsIntegration requires "track" function: (eventName, properties, options, callback)')};HapyakAnalyticsIntegration.eventMatchesFilter=function(filter,eventName,properties){if(filter===true){return true}else{var expr=filter[eventName];return expr===true||_.isObject(expr)&&_.isEqual(expr,_.pick(properties,_.keys(expr)))}};HapyakAnalyticsIntegration.shouldTrack=function(filter,eventName,properties){if(filter){if(filter.include&&!HapyakAnalyticsIntegration.eventMatchesFilter(filter.include,eventName,properties)){return false}if(filter.exclude&&HapyakAnalyticsIntegration.eventMatchesFilter(filter.exclude,eventName,properties)){return false}}return true}}return HapyakAnalyticsIntegration});hy.define("analytics",["require","module","configuration","utils.embed","lodash.noconflict","logging","analytics.integration"],function(require,module,configuration,utils,_,logging,AnalyticsIntegation){var integrations=utils.dotget(configuration,"analytics.modules")||["analytics.mixpanel"],moduleConfig=module.config(),config=configuration.analytics||{},localDebug=config.localDebug,isIframe=moduleConfig.iframed;function HapyakAnalytics(id){var registered={};this.id=id;this.first_flags={};logging.debug("[hapyak.analytics] HapyakAnalytics Created, id="+id);function multiplex(){var args=Array.prototype.slice.call(arguments,0);if(!args.length||!_.isString(args[0])){return}var methodName=args[0];_.each(integrations,function(moduleName){require([moduleName],function(integration){if(integration instanceof AnalyticsIntegation&&_.isFunction(integration[methodName])){integration[methodName].apply(integration,args.slice(1))}})});if(localDebug){this.debug(localDebug,args)}}this.debug=function(level,args){var method=args[0]||"n/a",event=args[1]||"n/a",properties=args[2]||{};if(level===1){logging.info("[hapyak.analytics#"+method+"]: [instance="+properties.instanceId+"] [e="+event+":"+properties.Type+":"+properties.Action+"]",properties)}else if(level===2){logging.info("[hapyak.analytics#"+method+"]: [instance="+properties.instanceId+"] [t="+properties["Project Title"]+"] [v="+properties["Video Source ID"]+"] [e="+event+":"+properties.Type+":"+properties.Action+"] [ps="+properties["Play Session"]+"]",properties)}else if(level===3){logging.info("[hapyak.analytics#"+method+"]: [instance="+properties.instanceId+"] "+JSON.stringify({name:event,properties:properties},null,2))}};this.register=function(properties){_.extend(registered,properties)};this.unregister=function(propertyName){registered=_.omit(registered,[propertyName])};this.getRegisteredProperty=function(propertyName){return registered[propertyName]};this.getRegisteredProperties=function(){return registered};this.identify=function(userId,traits,options,callback){multiplex.call(this,"identify",userId,traits,options,callback);if(_.isFunction(callback)){callback()}};this.is_annotation_action=function(eventName){return eventName==="Annotation Action"};this.is_first=function(key){return this.first_flags[key]===undefined};this.set_first=function(key){this.first_flags[key]=true};this.first=function(key){if(this.is_first(key)){this.set_first(key);return true}return null};this.firsts=function(eventName,properties){var first_action=properties?this.first_action(eventName,properties):null,first_action_by_type=properties?this.first_action_by_type(eventName,properties):null,first_action_by_id=properties?this.first_action_by_id(eventName,properties):null;return{is_first_action:first_action,is_first_action_by_type:first_action_by_type,is_first_action_by_id:first_action_by_id}};this.first_action=function(eventName,properties){var key=eventName+":*";return this.is_annotation_action(eventName)?this.first(key):null};this.first_action_by_type=function(eventName,properties){var key=eventName+":"+properties["Type"];return this.is_annotation_action(eventName)&&key?this.first(key):null};this.first_action_by_id=function(eventName,properties){var key=eventName+":"+properties["Annotation ID"];return this.is_annotation_action(eventName)&&key?this.first(key):null};this.track=function(eventName,properties,options,callback){var postMessageWindow=isIframe?window.parent:window,extended=_.extend({},properties,this.firsts(eventName,properties),registered);extended["Hapyak Version"]=hapyak.VERSION;multiplex.call(this,"track",eventName,extended,options,callback);if(postMessageWindow&&_.isFunction(postMessageWindow.postMessage)){postMessageWindow.postMessage(JSON.stringify({context:"hapyak-tracking",event:eventName,properties:extended}),"*")}if(_.isFunction(callback)){callback()}};this.on=function(methodName,callback){logging.logMethod("on",methodName);if(_.isFunction(callback)){callback()}};this.ready=function(callback){logging.logMethod("ready");if(_.isFunction(callback)){callback()}}}return HapyakAnalytics});hy.define("analytics.distinctids",["logging","configuration","module","cookie","lodash","utils.uuid","utils.embed"],function(logging,configuration,module,cookie,_,uuid,utils){var defaultProvider=CrossDomainCookieDistinctIdProvider,providers={CrossDomainCookieDistinctIdProvider:CrossDomainCookieDistinctIdProvider,NonPersistentDistinctIdProvider:NonPersistentDistinctIdProvider},config=configuration.analytics&&configuration.analytics.distinctids||{},moduleConfig=module.config(),env=moduleConfig.environment||"production",instance=null;function makeUUID(){return uuid().replace(/\-/g,"")}function makeUserInfoTemplate(){return{uid:null,ru:0,iu:0}}function CrossDomainCookieDistinctIdProvider(){this._init()}CrossDomainCookieDistinctIdProvider.prototype={STATES:{UNLOADED:"UNLOADED",LOADING:"LOADING",LOADED:"LOADED",TIMEDOUT:"TIMEDOUT"},_init:function _init(){this._userInfo=makeUserInfoTemplate();this._state=this.STATES.UNLOADED;this._callbacks={};this._timeoutId=null;this._iframeElement=null;this._iframeId=makeUUID();this._iframeStyle=utils.dotget(config,"provider.iframeStyle")||"position: absolute; width:0; height:0; border:0; border:none";this._timeoutDurationMs=utils.dotget(config,"provider.iframeTimeout")||2e3;this._host=this._getDistinctIdHost(env);this._distinctIdStubPage=utils.dotget(config,"provider.distinctIdStubPage")||this._host+"/static/js/pages/distinct-id/index.html";this._activatedThisSession=false;logging.debug("distinctids _init",moduleConfig)},_getDistinctIdHost:function _getDistinctIdHost(env){var distinctIdDomains={dev:"dev.hapyak.com",feature:"d3g4pn3iuq3qu.cloudfront.net",staging:"d3bo0fj9s1pd3n.cloudfront.net",production:"d2qrdklrsxowl2.cloudfront.net"};return window.location.protocol+"//"+distinctIdDomains[env]||distinctIdDomains["production"]},_load:function _load(){logging.debug("[distinctids] _load "+this._distinctIdStubPage);var that=this;this._timeoutId=window.setTimeout(function timeout(){logging.error("[distinctids] Load Timeout");that._onLoadTimeout()},this._timeoutDurationMs);window.addEventListener("message",function(event){var data;if(that._state===that.STATES.TIMEDOUT){logging.debug("[distinctids] ignoring message on timeout");return}if(that._iframeElement.contentWindow!==event.source){return}try{data=JSON.parse(event.data)}catch(e){logging.error("[distinctids] Error parsing data",e,event.data)}if(that._timeoutId){window.clearInterval(that._timeoutId)}that._userInfo=data;that._state=that.STATES.LOADED;that._invokeCallbacks("getIdInfo",null,that._userInfo)});this._state=this.STATES.LOADING;this._injectIFrame()},_onLoadTimeout:function _onLoadTimeout(){this._state=this.STATES.TIMEDOUT;this._userInfo=makeUserInfoTemplate();this._userInfo.uid=makeUUID();this._invokeCallbacks("getIdInfo",{code:"timeout",message:"Load timedout after "+this._timeoutDurationMs},this._userInfo)},_injectIFrame:function _injectIFrame(){logging.debug("[distinctids] _injectIFrame");this._iframeElement=document.createElement("iframe");this._iframeElement.setAttribute("id",this._iframeId);this._iframeElement.setAttribute("style",this._iframeStyle);document.body.appendChild(this._iframeElement);this._iframeElement.setAttribute("src",this._distinctIdStubPage)},_invokeCallbacks:function _invokeCallbacks(type,err,data){logging.debug("[distinctids] _invokeCallbacks");var callbacks=this._callbacks[type];_.forEach(callbacks,function(fn){fn(err,data)})},getIdInfo:function getIdInfo(callback){var that=this;logging.debug("[distinctids] getIdInfo, state= "+this._state);if(this._state===this.STATES.LOADED||this._state===this.STATES.TIMEDOUT){window.setTimeout(function(){callback(null,that._userInfo)},0);return}if(this._state===this.STATES.LOADING||this._state===this.STATES.UNLOADED){this._callbacks["getIdInfo"]=this._callbacks["getIdInfo"]||[];this._callbacks["getIdInfo"].push(callback)}if(this._state===this.STATES.UNLOADED){this._load()}},setActivatedUser:function setActivatedUser(){logging.debug("[distinctids] setActivatedUser");if(this._activatedThisSession){return}else{this._activatedThisSession=true}this._userInfo.iu++;if(this._iframeElement.contentWindow&&this._state===this.STATES.LOADED){this._iframeElement.contentWindow.postMessage(JSON.stringify({source:"hapyak-distinct-id",command:"set_iu"}),this._host)}else{logging.warn("Unable to set activated user")}}};function NonPersistentDistinctIdProvider(){this._userInfo=makeUserInfoTemplate()}NonPersistentDistinctIdProvider.prototype={getIdInfo:function getIdInfo(callback){var that=this;this._userInfo.uid=makeUUID();window.setTimeout(function(){callback(null,that._userInfo)},0)},setActivatedUser:function setActivatedUser(){logging.debug("[distinctids] setActivatedUser")}};function getInstance(){logging.debug("[distinctids] getInstance");if(instance===null){instance=createInstance()}return instance}function createInstance(){var provider=providers[utils.dotget(config,"provider.name")]||defaultProvider;logging.debug("[distinctids] Creating new instance using "+provider);return new provider}return{getInstance:getInstance}});hy.define("analytics.geo",["logging","configuration","module","cookie","lodash","utils.uuid","utils.embed","jquery.noconflict"],function(logging,configuration,module,cookie,_,uuid,utils,$){var config=configuration.analytics&&configuration.analytics.geo||{},moduleConfig=module.config(),env=moduleConfig.environment||"production";function GeoClient(){}GeoClient.prototype={_getGeoServiceUrl:function _getGeoServiceUrl(env){return hapyak.microserviceHost+"/api/geo/resolve/"},_setupRequest:function _setupRequest(env,token){var requestOptions={type:"GET",url:this._getGeoServiceUrl(env),data:{},headers:{"X-Hapyak-MicroserviceAccessToken":token},xhrFields:{withCredentials:true}};return requestOptions},resolveLocation:function resolveLocation(cb,token){if(typeof cb!=="function"){logging.warn("a callback is required");return false}var options=this._setupRequest(env,token);$.ajax(options).done(function(data,text,response){logging.debug(data,text,response);cb(data,response)}).fail(function(response,text,error){logging.error(response,text,error)})}};return new GeoClient});hy.define("tracking",["require","module","configAPI","raven.hapyak","cookie","utils.uuid","utils.omitinvalid","lodash.noconflict","analytics","analytics.distinctids","logging","utils.embed","analytics.geo"],function(require,module,configuration,Raven,cookie,uuid,omitInvalid,_,analytics,distinctids,logging,utils,geo){function Tracking(id){logging.debug("[hapyak.tracking] Tracking Created, id="+id);this.instanceId=id;this.eventOrder=1;this.currentVideo=null;this.currentTrack=null;this.videoDuration=null;this.player=null;this.reportTimeEvery=0;this.lastTimeReport=0;this.nextTimeReport=0;this.sessionTimeout=null;this.streamStarted=false;this.lastTrackingEvent;this.lastTrackingData;this.lastTrackingTime=0;this.analytics=new analytics(id);this.distinctIdProvider=null;this.queue=[];this.queueEvents=true;this.microserviceAccessToken=null;this.progressInterval=+configuration.getProperty("ANALYTICS__PROGRESS_INTERVAL")||10;this.init()}Tracking.prototype={init:function(){var that=this;this.updateAuthTracking(hapyak.auth());hapyak.addEventListener("auth",function updateAuthTrackingCallback(auth){that.updateAuthTracking(auth)});this.register({instanceId:this.instanceId});this.distinctIdProvider=distinctids.getInstance();this.distinctIdProvider.getIdInfo(function callback(err,info){logging.debug("[tracking] in callback from distinctids getIdInfo",err,info);if(err){that.track("Custom Action","System",err.code||"unknown",null,{})}if(info&&info.uid){that.onDisinctId(info)}else{logging.error("Unexpected empty tracking info")}})},onDisinctId:function onDisinctId(info){this.register({user:{id:info.uid,returned:info.ru,interacted:info.iu}});this.flushEventQueue();this.queueEvents=false},flushEventQueue:function flushEventQueue(){logging.debug("[hapyak.tracking] flushEventQueue, length="+this.queue.length);var event;while((event=this.queue.shift())!==undefined){this.trackAnalyticsEvent(event.name,event.properties,event.callback,event.eventData)}},identify:function identify(user){this.analytics.identify(user)},register:function register(properties){this.analytics.register(properties)},registerPartnerProperties:function registerPartnerProperties(properties,prefix){var bigQueryPartnerData,prefixedProperties,that=this;if(properties){prefixedProperties={}
;bigQueryPartnerData={excludeKeys:[],"Partner Data":[]};prefix=prefix||"Partner / ";_.each(properties,function(value,key){if(key!="Response Data"){if(value&&key!=="cdn"&&key!=="tracking"&&key!=="context"){if(_.isObject(value)){that.registerPartnerProperties(value,prefix+key+".")}else{prefixedProperties[prefix+key]=value;bigQueryPartnerData.excludeKeys.push(prefix+key);bigQueryPartnerData["Partner Data"].push({key:String(key),value:String(value)})}}}});this.register(omitInvalid(bigQueryPartnerData));this.register(prefixedProperties)}},getRegisteredProperty:function getRegisteredProperty(propertyName){if(this.analytics){return this.analytics.getRegisteredProperty(propertyName)}else{return undefined}},unregister:function unregister(propertyName){this.analytics.unregister(propertyName)},setSessionTimeout:function setSessionTimeout(){var fiveHours=18e6,that=this;this.sessionTimeout=setTimeout(function(){that.startContext({"Play Session":uuid().replace(/\-/g,"")})},Math.min((this.videoDuration||fiveHours)*5,fiveHours))},clearSessionTimeout:function clearSessionTimeout(){clearTimeout(this.sessionTimeout)},updateAuthTracking:function updateAuthTracking(auth){var partnerAuth=auth.partner;if(!_.isEmpty(partnerAuth)){this.register({"Partner User ID":partnerAuth.userId,"Partner Username":partnerAuth.username,"Partner Email":partnerAuth.email})}},restartEventOrder:function restartEventOrder(){this.eventOrder=1},startContext:function startContext(p){this.register(p)},startPageContext:function startPageContext(page){this.startContext({Page:page})},endPageContext:function endPageContext(){this.endContext(["Page"])},startUserContext:function startUserContext(user){this.startContext({"User ID":user.get("id"),Username:user.get("username")})},startLTIContext:function startLTIContext(ltiContext){var filteredLtiContext=null,custom=null;_.forEach(ltiContext,function(value,key){if(key.indexOf("lti_")===0){filteredLtiContext=filteredLtiContext||{};filteredLtiContext[key.replace(/^lti_/,"")]=value}if(key.indexOf("custom_")===0){custom=custom||{};custom[key.replace(/^custom_/,"")]=value}});if(filteredLtiContext){this.startContext({"LTI Context":filteredLtiContext})}if(custom){this.registerPartnerProperties(custom)}if(ltiContext.lti_req_user_id||ltiContext.lis_person_name_full||ltiContext.lis_person_contact_email_primary){this.updateAuthTracking({partner:{userId:ltiContext.lti_req_user_id||null,username:ltiContext.lis_person_name_full||null,email:ltiContext.lis_person_contact_email_primary||null}})}},endLTIContext:function endLTIContext(){this.endContext(["LTI Context"])},startExperienceContext:function startExperienceContext(experienceData){var EXPERIENCE_VIEW_ID_COOKIE="hapyak_evid",experienceViewId=cookie.get(EXPERIENCE_VIEW_ID_COOKIE);if(!experienceViewId||experienceData.generateExperienceViewId){experienceViewId=uuid().replace(/\-/g,"")}cookie.set(EXPERIENCE_VIEW_ID_COOKIE,experienceViewId,1/48);var trackingData={Experience:{view_id:experienceViewId,id:utils.dotget(experienceData,"experience.id",null),title:utils.dotget(experienceData,"experience.title",null)},Playlist:{id:utils.dotget(experienceData,"playlist.id",null),name:utils.dotget(experienceData,"playlist.name",null)},Layout:{id:utils.dotget(experienceData,"layout.id",null),name:utils.dotget(experienceData,"layout.name",null),type_id:utils.dotget(experienceData,"layout.type_id",null),type_name:utils.dotget(experienceData,"layout.type_name",null)}};this.startContext(trackingData)},endExperienceContext:function endExperienceContext(){this.endContext(["Experience","Playlist","Layout"])},startProjectContext:function startProjectContext(project){var trackingData={"Project ID":project.get("id"),"Project Title":project.get("title")},tags=project.get("tags"),templates=project.get("templates");if(tags){trackingData["Project Tags"]=tags}if(templates){trackingData["Templates"]=templates}this.startContext(trackingData)},endProjectContext:function endProjectContext(){this.endContext(["Project ID","Project Title"])},startVideoContext:function startVideoContext(video,config){var that=this;this.currentVideo=video;this.lastTimeReport=0;this.nextTimeReport=0;this.reportTimeEvery=0;this.streamStarted=false;this.videoDuration=video.get("duration")*1e3;this.restartEventOrder();this.startContext({"Play Session":uuid().replace(/\-/g,""),"Player Type":config?config.playerType||video.get("source"):video.get("source"),"Video ID":video.get("id"),"Video Title":video.get("title"),"Video Category":video.get("source_category"),"Video Source":video.get("source"),"Video Source ID":video.get("source_id"),"Video Offset":0,"Video Accrued":0,"Video Percent Complete":0});if(configuration.isProvisioned("GEO_SERVICE")){geo.resolveLocation(function cb(location){that.track("Profile Data","Geo",null,{geo:location})},this.microserviceAccessToken)}},endVideoContext:function endVideoContext(){this.endContext(["Video ID","Video Title","Video Category","Video Source","Video Source ID","Video Offset","Video Accrued","Video Percent Complete"]);this.currentVideo=null},startTrackContext:function startTrackContext(track,comments){this.currentTrack=track;var trackingData={"Track ID":track.get("id"),"Num Annotations":comments?comments.length:track.get("num_annotations"),"Annotation Types":track.get("num_annotations_by_type")},templates=track.get("templates");if(templates){trackingData["Templates"]=templates}this.startContext(trackingData)},endTrackContext:function endTrackContext(){this.endContext(["Track ID"]);this.currentTrack=null},startAnnotationContext:function startAnnotationContext(annotation){if(!annotation){return}this.startContext({"Annotation ID":annotation.get("id"),"Annotation Type":annotation.get("type")})},endAnnotationContext:function endAnnotationContext(){this.endContext(["Annotation ID"])},startCategoryContext:function startCategoryContext(category){this.startContext({"Category ID":category.get("id"),"Category Title":category.get("label")})},endCategoryContext:function endCategoryContext(){this.endContext(["Category ID","Category Title"])},startVisitUserContext:function startVisitUserContext(user){this.startContext({"Visited Username":user.get("username"),"Visited User ID":user.get("id")})},endVisitUserContext:function endVisitUserContext(){this.endContext(["Visited Username","Visited User ID"])},startPlayerContext:function startPlayerContext(p,options){this.startContext({"Playlist ID":options.playlistId,"Playlist Name":options.playlistName,"Video Title":options.videoTitle});this.player=p},endPlayerContext:function endPlayerContext(){this.endContext(["Playlist ID","Playlist Name","Video Title"]);this.player=null},endContext:function endContext(fields){var that=this;_.each(fields,function(field){that.unregister(field)})},trackAnalyticsEvent:function trackAnalyticsEvent(name,properties,callback){var cookieState=null;if(this.getRegisteredProperty("Session")){if(this.getRegisteredProperty("Session")===cookie.get("hapyak_psid")){cookieState=1}else{cookieState=0}}var psid=this.getRegisteredProperty("Session")||cookie.get("hapyak_psid");if(!psid){psid=uuid().replace(/\-/g,"")}cookie.set("hapyak_psid",psid,1/48);this.register({Session:psid});this.register({"Cookie State":cookieState});this.clearSessionTimeout();this.setSessionTimeout();this.analytics.track(name,properties,undefined,callback);if(name==="Custom Action"||name==="Annotation Action"){this.distinctIdProvider.setActivatedUser()}},enQueueAnalyticsEvent:function queueAnalyticsEvent(name,properties,callback,eventData){var event={name:name,properties:properties,callback:callback,eventData:eventData};this.queue.push(event);logging.debug("[hapyak.tracking] events queued "+this.queue.length)},track:function track(event,type,action,p,customEventData){if(event==="Load"){return}p=_.extend({Type:type},p);if(action){p.Action=action}p["Event Order"]=this.eventOrder++;if(customEventData){p=_.extend({"Custom Event Data":customEventData},p)}if(!this.queueEvents){this.trackAnalyticsEvent(event,p,null)}else{this.enQueueAnalyticsEvent(event,p,null)}if(action!=="Progress"){if(event===this.lastTrackingEvent&&_.isEqual(p,this.lastTrackingData)&&(new Date).getTime()-this.lastTrackingTime<150){logging.warn("Duplicate analytics tracking detected, "+"event="+event+", type="+type+", action="+action)}this.lastTrackingEvent=event;this.lastTrackingData=p;this.lastTrackingTime=(new Date).getTime()}},resolveAnnotationType:function resolveAnnotationType(annotation,field){var subtype=annotation.get("properties.popcorn.customWidget"),type=annotation.get("type");type=subtype&&type==="iframe"?"widget":type;if(field==="type"){return type}else if(field==="subtype"){return subtype}else{logging.warn("Unexpected value for field "+field+" in resolveAnnotationType")}},customAction:function customAction(type,action,p,customEventData){this.track("Custom Action",type,action,p,customEventData)},pageView:function pageView(page,p){this.track("Page View",page,null,p);this.startPageContext(page)},pageAction:function pageAction(type,action,p){this.track("Page Action",type,action,p)},playerView:function playerView(type,p){this.track("Player View",type,null,p)},playerAction:function playerAction(type,action,p){this.track("Player Action",type,action,p)},setupAnnotationEvent:function setupAnnotationEvent(annotation,p){var duration,position,gating,iframe_source,link,navigation,pausing,startTime,type,subtype;if(!annotation){return}type=this.resolveAnnotationType(annotation,"type");subtype=this.resolveAnnotationType(annotation,"subtype");startTime=annotation.get("start_time");duration=annotation.get("duration");pausing=!!annotation.get("properties.popcorn.pause");gating=annotation.get("properties.popcorn.gate");iframe_source=annotation.get("properties.popcorn.src");position=this.player.annotationPosition(annotation);if(typeof duration==="undefined"){duration=3}p=_.extend({"Annotation ID":annotation.get("id"),"Annotation Type":type,"Annotation Start Time":startTime,"Annotation Duration":duration,Pausing:pausing,Gating:gating,"Extension Source":iframe_source,"Annotation Position":position[0],"Annotation Coordinates":position[1]},p);if(subtype){p["Annotation Subtype"]=subtype}if(type==="pop"||type==="image"||type==="hotlink"){link=annotation.get("properties.popcorn.onClick.gotoLink")||annotation.get("properties.popcorn.link");p.Rollup=p.Rollup||[];if(link){p.Target=link;p.Rollup.push("link")}navigation=annotation.get("properties.popcorn.onClick.gotoTrack");if(navigation){p.Rollup.push("navigation")}}if(type==="quiz"){p.Rollup=p.Rollup||[];p.Rollup.push("response")}if(type==="pop"){if(annotation.get("properties.popcorn.text")){p.Text=annotation.get("properties.popcorn.text")}}else if(type==="bookmark"&&annotation.get("properties.popcorn.text")){p.Text=annotation.get("properties.popcorn.text")}p=this.setupOnTimeAnnotationEvent(annotation,p);return p},setupOnTimeAnnotationEvent:function setupOnTimeAnnotationEvent(annotation,p){if(annotation.get("type")==="ontime"){p.annotation_subtype=annotation.get("properties.popcorn.addonTypeId");p.annotation_addon_command=annotation.get("properties.popcorn.addonCommand");p.annotation_addon_command_json=JSON.stringify(annotation.get("properties.popcorn.addonCommandData"))}return p},annotationView:function annotationView(annotation,p){if(!annotation||this.player&&this.player.editMode()){return}var type=this.resolveAnnotationType(annotation,"type");p=this.setupAnnotationEvent(annotation,p);this.updateVideoPlayback(true);this.track("Annotation View",type,null,p)},annotationEnded:function annotationEnded(annotation,p){if(!annotation||this.player&&this.player.editMode()){return}var type=this.resolveAnnotationType(annotation,"type");p=this.setupAnnotationEvent(annotation,p);this.track("Annotation Ended",type,null,p)},annotationAction:function annotationAction(annotation,action,p){var type;if(!annotation||this.player&&this.player.editMode()){return}type=this.resolveAnnotationType(annotation,"type");this.updateVideoPlayback(true);this.track("Annotation Action",type,action,_.extend({"Annotation ID":annotation.get("id"),"Annotation Type":type},p))},annotationActionById:function annotationActionById(annotationId,annotationType,action,p,eventData){if(!annotationId||annotationId.toString().indexOf("_")>-1||this.player&&this.player.editMode()){return}var model=require("model"),dao=require("dao"),annotation=model&&dao&&dao.store.find(model.Comment,annotationId);if(annotation&&annotation.get("id")){p=this.setupAnnotationEvent(annotation,p);annotationType=this.resolveAnnotationType(annotation,"type")}this.updateVideoPlayback(true);if(annotationType==="toc"){annotationType="contents"}this.track("Annotation Action",annotationType,action,_.extend({"Annotation ID":annotationId,"Annotation Type":annotationType},p),eventData)},updateVideoPlayback:function updateVideoPlayback(force){var player=this.player;if(!player){return}var currentTime=Math.round(player.currentTime()),elapsedTime=Math.round(player.elapsedTime()),playTime=Math.round(player.playTime()*100)/100,videoDuration=Math.round(player.duration()),isLive=player.mediaType()==="live",obj=null,reportTimeEvery=this.reportTimeEvery;obj={"Play Time Accrued":playTime,"Video Accrued":elapsedTime,"Live Video":isLive};if(!isLive&&currentTime<=videoDuration){_.extend(obj,{"Video Offset":currentTime,"Video Duration":videoDuration,"Video Percent Complete":Math.round(currentTime/videoDuration*100)})}this.register(obj);if(isLive&&!reportTimeEvery){reportTimeEvery=30}else if(!reportTimeEvery&&videoDuration){reportTimeEvery=this.progressInterval}if(playTime>0){if(!this.streamStarted){this.track("Player Action","Video","Play");this.streamStarted=true}if(this.lastTimeReport!==playTime&&(playTime>=this.nextTimeReport||force)){this.track("Player Action","Video","Progress",{"Video Elapsed Difference":playTime-this.lastTimeReport,"Video Slice Play Time Accrued":player.slicePlayTime(false),"Progress Interval":reportTimeEvery});this.lastTimeReport=playTime;this.nextTimeReport=playTime+reportTimeEvery}}}};var factory={_instances:{},_register:function(id,instance){this._instances[id]=instance},getInstance:function(id,forceNew){if(id==null){id=1}var instance=this._instances[id];if(!instance||forceNew){instance=new Tracking(id);this._register(id,instance)}return instance}};if(!window.hapyak.tracking){window.hapyak.tracking=factory}return factory});hy.define("model",["module","jquery.noconflict","ember.noconflict","dao","configAPI","utils.embed","tracking","lodash.noconflict","ember.noconflict"],function(module,$,Ember,dao,configuration,utils,tracking,_){var trackingInstance=tracking.getInstance(null);var Model=Ember.Object.extend(Ember.Evented,Ember.DeferredMixin,{data:null,isTransient:false,fireChange:true,init:function(){this.data={isLoaded:false,isSaved:false,isDeleted:false}},shouldFireChange:function(){return!this.get("isTransient")&&!this.get("isDeleted")},onLoad:function(callback){if(this.get("isLoaded")){callback(this)}else{this.one("didLoad",this,function(){callback(this)})}return this},onSave:function(callback){this.one("didSave",this,function(){callback(this)});return this},onDelete:function(callback){if(this.get("isDeleted")){callback(this)}else{this.one("didDelete",this,function(){callback(this)})}return this},unknownProperty:function(key){return Ember.get(this.data,key)},setUnknownProperty:function(key,value){if(this.get(key)!==value){var fireChange=key!=="id"&&this.fireChange&&this.shouldFireChange();if(fireChange){dao.store.beforeUpdate(this,key,value)}this.propertyWillChange(key);Ember.set(this.data,key,value);this.propertyDidChange(key);if(fireChange){dao.store.didUpdate(this,key,value)}}},set:function(key,value,fireChange){var existingValue=this.get(key),valueToCheck=value,oldFireChange=this.fireChange;if(_.isNumber(value)&&_.isNumber(existingValue)&&Math.abs(value-existingValue)<1e-8){return this}if((value===null||value===undefined)&&(existingValue===null||existingValue===undefined)){return this}if(valueToCheck instanceof Ember.Object){valueToCheck=valueToCheck.get("id")}if(existingValue instanceof Ember.Object){existingValue=existingValue.get("id")}if(!_.isEqual(existingValue,valueToCheck)){this.fireChange=fireChange!==false;try{this._super(key,value)}finally{this.fireChange=oldFireChange}}return this},setProperties:function(properties){var key,value;if(typeof properties==="object"){for(key in properties){if(properties.hasOwnProperty(key)){value=properties[key];this.set(key,value)}}}return this},setCustomProperty:function(name,value,fireChange){var props=this.get("properties");if(!props){this.set("properties",props={},false)}var existingValue=Ember.get(props,name);if(_.isNumber(value)&&_.isNumber(existingValue)&&Math.abs(value-existingValue)<1e-8){return this}if((value===null||value===undefined)&&(existingValue===null||existingValue===undefined)){return this}if(!_.isEqual(existingValue,value)){fireChange=fireChange!==false&&this.shouldFireChange();if(fireChange){dao.store.beforeUpdate(this,"properties."+name,value)}Ember.set(props,name,value);if(fireChange){dao.store.didUpdate(this,"properties."+name,value)}}return this},setNestedCustomProperty:function(path,value,fireChange){var props=this.get("properties"),pathNodes=path.split(".");var lastObj,lastProp,propertyExists,existingValue;if(!props){this.set("properties",props={},false)}lastObj=props;propertyExists=this.getCustomProperty(path);if(propertyExists){existingValue=Ember.get(props,path);if(_.isNumber(value)&&_.isNumber(existingValue)&&Math.abs(value-existingValue)<1e-8){return this}if((value===null||value===undefined)&&(existingValue===null||existingValue===undefined)){return this}if(_.isEqual(existingValue,value)){return this}}for(var i=0;i<pathNodes.length-1;i++){if(!lastObj[pathNodes[i]]){lastObj[pathNodes[i]]={}}lastObj=lastObj[pathNodes[i]]}lastObj[pathNodes[pathNodes.length-1]]=value;fireChange=fireChange!==false&&this.shouldFireChange();if(fireChange){dao.store.beforeUpdate(this,"properties",props)}Ember.set(this,"properties",props);if(fireChange){dao.store.didUpdate(this,"properties",props)}return this},getCustomProperty:function(name){return this.get("properties."+name)},deleteCustomProperty:function(path,fireChange){var props=this.get("properties");var lastObj,lastProp,safeToDelete;safeToDelete=path.split(".").reduce(function(prev,curr){lastObj=prev;lastProp=curr;return prev?prev[curr]:undefined},props);if(safeToDelete===undefined){console.warn("The property",path,"doesn't exist or part of it's path doesn't exist, nothing to delete here ");return}delete lastObj[lastProp];fireChange=fireChange!==false&&this.shouldFireChange();if(fireChange){dao.store.beforeUpdate(this,"properties",props)}Ember.set(this,"properties",props);if(fireChange){dao.store.didUpdate(this,"properties",props)}return this},deleteRecord:function(){if(!this.get("isDeleted")){var shouldFireChange=this.shouldFireChange();this.set("isDeleted",true,false);if(shouldFireChange){dao.store.didDelete(this)}}},hasPermission:function(perm){if(this.get("isDeleted")){return false}var permissions=this.get("permissions");if(permissions){return permissions[perm]===true}else if(!this.get("isSaved")){return true}return false},permissions:Ember.computed(function(){return{owner:this.get("isOwner"),edit:this.get("hasEditPermission"),delete:this.get("hasDeletePermission"),view:this.get("hasViewPermission")}}).property().cacheable(false),getOwner:function(){if(this.constructor.ownerField){return this.get(this.constructor.ownerField)}return null},isOwner:Ember.computed(function(){if(this.constructor.ownerField){var owner=this.getOwner();if(owner){return window.HapyakApp&&owner&&owner.get("id")===window.HapyakApp.get("currentUser.id")}}return false}).property().cacheable(false),hasEditPermission:Ember.computed(function(){var user=window.HapyakApp&&window.HapyakApp.get("currentUser"),group;if(user){if(this.get("isOwner")||user.get("role")==="admin"){return true}group=this.get("group");if(group&&user.get("membership."+group)==="admin"){return true}}return false}).property().cacheable(false),hasDeletePermission:Ember.computed(function(){return this.get("hasEditPermission")}).property().cacheable(false),hasViewPermission:Ember.computed(function(){return this.constructor.ownerField?this.get("hasEditPermission"):true}).property().cacheable(false),trigger:function(name){Ember.tryInvoke(this,name,[].slice.call(arguments,1));this._super.apply(this,arguments)},isEqual:function(obj){return this.constructor===obj.constructor&&this.get("id")===obj.get("id")},didLoad:Ember.K,didSave:Ember.K,didCreate:Ember.K,didUpdate:Ember.K,didDelete:Ember.K});Model.reopenClass({ownerField:"user",fields:{created:Date,modified:Date},references:{},supportsCdnAccess:false,find:function(id,errHandler){return dao.store.find(this,id,errHandler)},filter:function(query,filter){return dao.store.filter(this,query,filter)},findOne:function(query,onLoad){dao.store.findOne(this,query,onLoad)},createRecord:function(p,isTransient){var record=this.create();record.set("isLoaded",true,false);if(isTransient===true){record.set("isTransient",true,false)}else{dao.store.didCreate(record)}if(p){_.each(p,function(value,key){record.set(key,value)})}record.trigger("didCreate");record.resolve(record);return record},getPropertyType:function(prop){var type=this.references[prop];if(!type){type=this.fields[prop]}if(type instanceof dao.ListOf){type=type.get("type")}return type},getEndpoint:function(){var name=Ember.String.decamelize(this.typeName).toLowerCase();return"/api/"+name+"s"},toString:function(){return"."+this.typeName}});var model={};model.User=Model.extend({full_name:Ember.computed(function(){var firstName=this.get("first_name");var lastName=this.get("last_name");if(firstName&&lastName){return firstName+" "+lastName}else if(firstName){return firstName}else{return this.get("username")}}).property("first_name","last_name","username"),avatarImageUrl:Ember.computed(function(){return this.get("image")}).property("image"),permissions:Ember.computed(function(){var permissions=this._super();permissions.create_named_tracks=Ember.A(["admin","producer","editor"]).contains(this.get("role"));permissions.create_official_tracks=Ember.A(["admin","producer","editor"]).contains(this.get("role"));permissions.create_featured_videos=Ember.A(["admin","editor","partner_admin","partner_editor"]).contains(this.get("role"));return permissions}).property().cacheable(false),isOwner:Ember.computed(function(){return window.HapyakApp&&window.HapyakApp.get("currentUser.id")===this.get("id")}).property().cacheable(false),hasViewPermission:Ember.computed(function(){return true}).property().cacheable(false),hasDeletePermission:Ember.computed(function(){return false}).property().cacheable(false),accountAssociations:Ember.computed(function(){var associations=Ember.Object.create({allConnected:false,isLoaded:false});dao.store.find(model.AccountAssociation,{username:this.get("username")}).onLoad(function(data){var facebook=data.findProperty("service","facebook"),google=data.findProperty("service","google");associations.set("facebook",facebook);associations.set("google",google);if(facebook&&google){associations.set("allConnected",true)}associations.set("isLoaded",true)});return associations}).property()});model.AccountAssociation=Model.extend({});model.Video=Model.extend({category:Ember.computed(function(){return model.VideoCategory.find(this.get("source_category"))}).property("content","content.isLoaded"),hasEditPermission:Ember.computed(function(){if(this._super()){return true}var user=window.HapyakApp&&window.HapyakApp.get("currentUser"),group;if(user){group=this.get("group");if(group){return user.get("membership."+group)==="editor"}else if(user.get("role")==="editor"){return true}}return false}).property().cacheable(false)});model.Track=Model.extend({init:function(){this._super();this.data.numLikes=0},didCreate:function(){this._super();this.onSave(function(){trackingInstance.playerAction("Track","Create",{"Track ID":this.get("id")})}.bind(this))},didUpdate:function(){this._super();trackingInstance.playerAction("Track","Update",{"Track ID":this.get("id")})},didDelete:function(){this._super();trackingInstance.playerAction("Track","Delete",{"Track ID":this.get("id")})},official:Ember.computed(function(){return this.get("privacy")==="official"}).property("privacy"),permissions:Ember.computed(function(){var permissions=this._super();permissions.add_annotations=this.get("hasEditPermission");return permissions}).property().cacheable(false),hasAddAnnotationsPermission:Ember.computed(function(){return this.get("hasEditPermission")}).property().cacheable(false),hasEditPermission:Ember.computed(function(){if(this._super()){return true}var user=window.HapyakApp&&window.HapyakApp.get("currentUser"),group;if(user){group=this.get("group");if(group){return user.get("membership."+group)==="editor"}else if(user.get("role")==="editor"){return true}}return false}).property().cacheable(false),hasViewPermission:Ember.computed(function(){if(this._super()){return true}return this.get("privacy")!=="private"}).property().cacheable(false),copiedFromUser:Ember.computed(function(){var user=this.get("copied_from_user");if(user){return model.User.find(user)}}).property("copied_from_user")});model.Comment=Model.extend({didCreate:function(){this._super();this.onSave(function(){trackingInstance.playerAction("Annotation","Create",{"Annotation ID":this.get("id"),"Annotation Type":this.get("type")})}.bind(this))},isValid:function(){return this.hasContent()},hasContent:function(){if(this.get("type")==="pop"){return!Ember.isNone(this.get("properties.content"))&&!Ember.isEmpty($.trim(this.get("properties.content")))}else if(this.get("type")==="drawing"){return!Ember.isNone(this.get("properties.drawing"))&&!Ember.isEmpty($.trim(this.get("properties.drawing")))}else if(this.get("type")==="audio-note"){return!Ember.empty(this.get("properties.audio_src"))}else{return false}},setDrawing:function(strokes){this.setCustomProperty("drawing",strokes)},getDrawing:function(){return this.get("properties.drawing")},hasEditPermission:Ember.computed(function(){if(this._super()){return true}var user=window.HapyakApp&&window.HapyakApp.get("currentUser"),group;if(user){group=this.get("group");if(group){return user.get("membership."+group)==="editor"}else if(user.get("role")==="editor"){return true}}return false}).property().cacheable(false),hasViewPermission:Ember.computed(function(){if(this._super()){return true}return this.get("privacy")!=="private"}).property().cacheable(false)});model.TrackRating=Model.extend({hasViewPermission:Ember.computed(function(){return true}).property().cacheable(false)});model.TrackReaction=Model.extend({hasViewPermission:Ember.computed(function(){return true}).property().cacheable(false)});model.Follow=Model.extend({});model.UserVideo=Model.extend({});model.FeaturedVideo=Model.extend({});model.Related=Model.extend({});model.ViewerSetup=Model.extend({});model.Config=Model.extend({});model.Group=Model.extend({});model.GroupMember=Model.extend({});model.Project=Model.extend({});model.Code=Model.extend({});model.Experience=Model.extend({});model.Layout=Model.extend({});model.LayoutType=Model.extend({});model.Playlist=Model.extend({});model.PlaylistToProject=Model.extend({});model.Addon=Model.extend({});model.AddonType=Model.extend({});model.Widget=Model.extend({});model.Workflow=Model.extend({});model.WorkflowState=Model.extend({});model.Workflow.reopenClass({typeName:"Workflow"});model.WorkflowState.reopenClass({typeName:"WorkflowState"});model.Widget.reopenClass({typeName:"Widget"});model.Addon.reopenClass({typeName:"Addon",references:{layout:model.Layout,addon_type:model.AddonType}});model.AddonType.reopenClass({typeName:"AddonType"});model.Experience.reopenClass({typeName:"Experience",references:{layout:model.Layout,playlist:model.Playlist}});model.Layout.reopenClass({typeName:"Layout",references:{layout_type:model.LayoutType}});model.LayoutType.reopenClass({typeName:"LayoutType"});model.Playlist.reopenClass({typeName:"Playlist"});model.PlaylistToProject.reopenClass({typeName:"PlaylistToProject",references:{playlist:model.Playlist,project:model.Project}});model.AccountAssociation.reopenClass({typeName:"AccountAssociation"});model.User.reopenClass({typeName:"User",fields:{created:Date,modified:Date,last_import_start:Date,last_import_finish:Date}});model.Group.reopenClass({typeName:"Group",references:{parent:model.Group}});model.GroupMember.reopenClass({typeName:"GroupMember",references:{user:model.User,group:model.Group},allParentGroupsEnabled:function(userId,callback){$.get(hapyak.rootUrl+"/api/group_members_enabled",function(result){if(typeof callback==="function"){callback(result)}})}});model.Video.reopenClass({typeName:"Video",references:{tracks:dao.ListOf.create({type:model.Track})}});model.Track.reopenClass({ownerField:"owner",typeName:"Track",fields:{created:Date,modified:Date,annotation_modified:Date},references:{owner:model.User,video:model.Video}});model.Comment.reopenClass({typeName:"Comment",references:{user:model.User,track:model.Track}});model.TrackRating.reopenClass({typeName:"TrackRating",references:{user:model.User,track:model.Track}});model.TrackReaction.reopenClass({typeName:"TrackReaction",references:{user:model.User,track:model.Track}});model.UserVideo.reopenClass({typeName:"UserVideo",references:{user:model.User,video:model.Video,tracks:dao.ListOf.create({type:model.Track})}});model.FeaturedVideo.reopenClass({typeName:"FeaturedVideo",references:{owner:model.User,video:model.Video,track:model.Track}});model.Follow.reopenClass({typeName:"Follow",references:{user:model.User,follow:model.User}});model.Related.reopenClass({typeName:"Related",references:{videos:dao.ListOf.create({type:model.Video}),tracks:dao.ListOf.create({type:model.Track})},getEndpoint:function(){return"/api/related"}});model.Project.reopenClass({typeName:"Project",references:{owner:model.User,video:model.Video,track:model.Track,group:model.Group},tryBcUpload:function(projectId,projectData,writeKey){if(!projectData||!projectId){return}if(utils.dotget(configuration,"provisioning.hosting.video.brightcove")){dao.store.postJSON(hapyak.microserviceHost+"/api/brightcoveUpload/notify_project",{projectId:projectId,groupId:projectData.group,userId:projectData.owner,writeKey:writeKey},function(result){dao.store.postJSON(hapyak.microserviceHost+"/api/brightcoveUpload/video/ingest",{url:projectData.input,apiKey:dao.store.get("apiKey"),sessionKey:result.sessionKey})})}}});model.Code.reopenClass({typeName:"Code"});model.ViewerSetup.reopenClass({supportsCdnAccess:true,typeName:"ViewerSetup",references:{project:model.Project,video:model.Video,track:model.Track,comments:dao.ListOf.create({type:model.Comment})},getEndpoint:function(){var isPortal=window.location.pathname.indexOf("/portal/")===0;return configuration.isProvisioned("EMBED_WHITELIST")&&!isPortal?"/r/api/viewer/setup":"/api/viewer/setup"}});model.Config.reopenClass({typeName:"Config"});model.VideoCategory=Ember.Object.extend({id:null,label:null,hidden:false});model.VideoCategory.reopenClass({find:function(id){return allCategories.findProperty("id",id)},findAll:function(){return allCategories}});var allCategories=Ember.A([model.VideoCategory.create({label:"All",id:"All"}),model.VideoCategory.create({label:"Animals",id:"Animals"}),model.VideoCategory.create({label:"Autos",id:"Autos",hidden:true}),model.VideoCategory.create({label:"Comedy",id:"Comedy"}),model.VideoCategory.create({label:"Education",id:"Education"}),model.VideoCategory.create({label:"Entertainment",id:"Entertainment"}),model.VideoCategory.create({label:"Film",id:"Film"}),model.VideoCategory.create({label:"Games",id:"Games"}),model.VideoCategory.create({label:"How To",id:"Howto"}),model.VideoCategory.create({label:"Music",id:"Music"}),model.VideoCategory.create({label:"News",id:"News"}),model.VideoCategory.create({label:"Nonprofit",id:"Nonprofit",hidden:true}),model.VideoCategory.create({label:"People",id:"People",hidden:true
}),model.VideoCategory.create({label:"Shows",id:"Shows",hidden:true}),model.VideoCategory.create({label:"Sports",id:"Sports"}),model.VideoCategory.create({label:"Tech",id:"Tech"}),model.VideoCategory.create({label:"Trailers",id:"Trailers",hidden:true}),model.VideoCategory.create({label:"Travel",id:"Travel"})]);dao.store.set("model",model);return model});hy.define("utils.sanitizeparams",["lodash.noconflict"],function(_){var configParams=["apiKey","createdTrack","csrfToken","element","environment","external","groupId","loadData","logLevel","aspectRatio","keepAnnotationAspectRatio","safestream","messages","nls","onLoad","player","plugins","queryCache","rootUrl","trackId","projectId","workflow","projectName","user","userId","username","version","videoId","videoType","videoUrl","hideCtrlbarSkipfwd","hideCtrlbarTimeline","hideCtrlbarLogo","hideCtrlbarAnnotationMarkers"],viewerParams=["annotationSources","duration","autoplay","captions","contentTracks","controls","controlStyle","cuePoints","height","hideEndAnnotations","hidePlayerUIWhenInteracting","isEditable","minimalRootCss","minHeight","minWidth","muted","playerParameters","playerType","playlistId","playlistName","projectId","remotes","resetVariables","signature","time","trackInfo","variables","videoTitle","width","forceUpdateDimensionsOnResize"].concat(configParams),embedParams=["aspectRatio","annotationBlacklist","autoEditDialog","contentTracks","controlBarHeight","disableInlineTextEdit","edit","embed","enableAltControls","hostWindow","isTemplate","nativeControls","signature","startInEditMode"].concat(viewerParams);configParams=configParams.sort();viewerParams=viewerParams.sort();embedParams=embedParams.sort();return{config:function(o,e){var p=_.pick(_.extend({},o,e),configParams);return _.omit(p,function(value){return value===undefined})},viewer:function(o,e){var p=_.pick(_.extend({},o,e),viewerParams);return _.omit(p,function(value){return value===undefined})},embed:function(o,e){var p=_.pick(_.extend({},o,e),embedParams);return _.omit(p,function(value){return value===undefined})},iframeApi:function(){return["customClasses","durationFormat","pause","durationValue","end","left","noscale","height","start","startTimeFormat","customConfig","startTimeValue","top","width","_duration","gate","precondition","displayedName","projectId","isEditable"]}}});hy.define("utils.samedomain",[],function(){return{test:function(value){if(hapyak.iframed){return false}if(typeof value!=="string"){return false}var host=location.host.split("."),l=host.length;var domain,localDomain;if(l>1){localDomain=host[l-2]+"."+host[l-1]}else{localDomain=host[0]}if(!localDomain){return false}domain=/(?:https?:)?\/\/([^\/]+)/i.exec(value);if(domain&&domain[1]){value=domain[1]}return value.indexOf(localDomain)!==-1}}});hy.define("utils.validatelink",["configuration","logging"],function(configuration,logging){var linkBlacklist,linkWhitelist,firstTime=true;return function(link){if(firstTime){if(configuration.player){if(configuration.player.linkBlacklist&&configuration.player.linkBlacklist.length){try{linkBlacklist=new RegExp(configuration.player.linkBlacklist.join("|"),"i")}catch(e){logging.warn("Invalid regular expression: "+configuration.player.linkBlacklist)}}if(configuration.player.linkWhitelist&&configuration.player.linkWhitelist.length){try{linkWhitelist=new RegExp(configuration.player.linkWhitelist.join("|"),"i")}catch(e){logging.warn("Invalid regular expression: "+configuration.player.linkWhitelist)}}}firstTime=false}if(linkWhitelist&&!linkWhitelist.test(link)){return false}if(linkBlacklist&&linkBlacklist.test(link)){return false}return true}});(function(root,factory){if(typeof hy.define==="function"&&hy.define.amd){hy.define("utils",["configuration","dao","module","utils.samedomain","utils.validatelink","logging","jquery.noconflict","utils.embed","lodash.noconflict"],factory)}else{root.hapyakUtils=factory(root)}})(this,function(configuration,dao,module,sameDomain,validateLink,logging,$,embedUtils,_){var moduleConfig=module.config(),playerConfig=configuration&&configuration.player;var localLinks=playerConfig.localLinks||moduleConfig.localLinks||false;var addClass,hasClass,removeClass,supportsPlaceholder;function inputPlaceholder(input,color){var default_color,placeholder;if(!input){return null}if(supportsPlaceholder===undefined){supportsPlaceholder="placeholder"in document.createElement(input.tagName)}if(input.placeholder&&supportsPlaceholder){return input}color=color||"#AAA";default_color=input.style.color;placeholder=input.getAttribute("placeholder");if(input.value===""||input.value===placeholder){input.value=placeholder;input.style.color=color;input.setAttribute("data-placeholder-visible","true")}input.addEventListener("focus",function(){input.style.color=default_color;if(input.getAttribute("data-placeholder-visible")){input.setAttribute("data-placeholder-visible","");if(input.value===placeholder){input.value=""}}},false);input.addEventListener("blur",function(){if(input.value===""){input.setAttribute("data-placeholder-visible","true");input.value=placeholder;input.style.color=color}else{input.style.color=default_color;input.setAttribute("data-placeholder-visible","")}},false);if(input.form){input.form.addEventListener("submit",function(){if(input.getAttribute("data-placeholder-visible")&&input.value===placeholder){input.value=""}},false)}return input}function getImageName(url){var match;if(!url){return""}match=url.match(/([A-Z0-9_-]{1,}\.(?:png|jpg|gif|jpeg|svg))/i);if(!match||!match[0]){return"Image URL has no filetype."}return match[0]}function microTemplate(container,obj,lookup){var element,key,val,eventHandler;function replace(str,pre,capital){return pre+"-"+capital.toLowerCase()}function makeEventListener(fn,element,obj){return function(evt){fn.call(element,evt,obj)}}if(!container){container=document.createDocumentFragment()}if(!lookup){lookup={}}if(Array.isArray(obj)){for(key=0;key<obj.length;key++){microTemplate(container,obj[key],lookup)}return lookup}if(typeof obj==="object"){element=document.createElement(obj[""]||"div");for(key in obj){if(obj.hasOwnProperty(key)&&key&&key!=="#"&&key!==">"){val=obj[key];if(key==="."){key="class"}if(key==="@"){key="placeholder"}if(typeof val==="function"){eventHandler=/^on([a-z]+)/i.exec(key);if(eventHandler){element.addEventListener(eventHandler[1].toLowerCase(),makeEventListener(val,element,obj),false);continue}val=val.call(element,obj)}if(typeof val==="string"||val.toString){element.setAttribute(key,val)}}}if(obj["#"]){if(!obj["."]){element.className="hapyak-"+obj["#"].replace(/([a-z])([A-Z])/g,replace)}lookup[obj["#"]]=element}if(obj[">"]){microTemplate(element,obj[">"],lookup)}container.appendChild(element);return lookup}if(typeof obj==="string"){element=document.createElement("div");element.innerHTML=obj;while(element.childNodes.length){container.appendChild(element.firstChild)}return lookup}}if(document===undefined||!document.createElement("a").classList){addClass=function(element,c){if(!element){return}var curClasses=element.getAttribute("class")||"";curClasses=curClasses.split(" ");if(curClasses.indexOf(c)<0){curClasses.push(c)}element.setAttribute("class",curClasses.join(" "))};removeClass=function(element,c){if(!element){return}var i,curClasses=element.getAttribute("class")||"";curClasses=curClasses.split(" ");i=curClasses.indexOf(c);if(i>=0){curClasses.splice(i,1)}element.setAttribute("class",curClasses.join(" "))};hasClass=function(element,c){if(!element){return false}var curClasses=element.getAttribute("class")||"";curClasses=curClasses.split(" ");return curClasses.indexOf(c)>-1}}else{addClass=function(element,c){if(!element){return}element.classList.add(c)};removeClass=function(element,c){if(!element){return}element.classList.remove(c)};hasClass=function(element,c){if(!element){return false}return element.classList.contains(c)}}return{binarySearchByKey:function(array,key,val){var high=array&&array.length-1,low=0,lowVal,highVal,midVal,mid;if(isNaN(high)||high<0){return-1}lowVal=array[0][key];if(val<lowVal){return-1}if(lowVal===val){return 0}highVal=array[high][key];if(val>=highVal){return high}while(high>low){mid=low+(high-low)/2>>>0;midVal=array[mid][key];if(midVal>val){high=mid-1;highVal=array[high][key];if(highVal<=val){return high}}else{if(midVal===val||low===mid){return mid}low=mid}}return low},getCloudfrontUrlForS3Resource:function(url,group,env,creationEnv,type,isEditMode){var awsBucketPrefix,cloudfrontUrlEnv,creationEnv=url.indexOf("dev")>-1?"dev":creationEnv,creationEnv=creationEnv===""?"production":creationEnv,cloudfrontUrl="";if(creationEnv!==env&&isEditMode){console.log("The resource you are trying to alter was not created in the current environment. You are not allowed to overwrite it.");return}if(isEditMode){return}if(creationEnv==="dev"){cloudfrontUrlEnv="dev.";awsBucketPrefix="_dev_"}else if(env==="feature"){cloudfrontUrlEnv="";awsBucketPrefix="_"}else if(env==="staging"){cloudfrontUrlEnv="";awsBucketPrefix="_"}else if(creationEnv==="production"){cloudfrontUrlEnv="";awsBucketPrefix="_"}cloudfrontUrl=url.replace("hapyak"+awsBucketPrefix+"uploads.s3.amazonaws",group+"."+cloudfrontUrlEnv+"hapyak-hosted");return cloudfrontUrl},isValidJson:function(str){try{JSON.parse(str)}catch(e){return false}return true},copyToClipboardById:function(id){try{var el=document.getElementById(id),input=document.createElement("input");input.style.position="absolute";input.style.opacity="0";input.value=el.textContent;document.body.appendChild(input);input.select();var success=document.execCommand("copy");document.body.removeChild(input);if(!success){logging.captureMessage("Copy was unsuccessful, please try manually selecting and copying to your clipboard.")}}catch(err){logging.captureException(err)}},dispatchEvent:function(eventName){var evt;try{evt=new Event(eventName);window.dispatchEvent(evt)}catch(e){evt=document.createEvent("Event");evt.initEvent(eventName,true,true)}},observeOneTime:function(object,field,waitForValue,callback){var value,observer;if(!callback){callback=waitForValue;waitForValue=null}value=object.get(field);if(value&&(!waitForValue||waitForValue(value))){callback(object.get(field));return}observer=function(){var val=object.get(field);if(val&&(!waitForValue||waitForValue(val))){object.removeObserver(field,observer);callback(val)}};object.addObserver(field,observer)},getPagerText:function(type,data,max){var total=data.get("total"),end=data.get("page")*max,start=end-(max-1),displayEnd=Math.min(end,total);if(start===1&&displayEnd===1){return"One "+type+" found"}if(start===displayEnd){return"Last of "+total+" "+type+"s found"}return start+" to "+displayEnd+" of "+total+" "+type+"s found"},instanceOfElement:function(element,proto){var result;if(!element||typeof element!=="object"&&typeof element!=="function"){return false}if(!proto){proto="Element"}else if(typeof proto!=="string"){return element instanceof proto}if(element instanceof window[proto]){return true}if(!element.ownerDocument||!element.ownerDocument.defaultView){return false}result=element instanceof element.ownerDocument.defaultView[proto];if(!result){result=element instanceof element.ownerDocument.defaultView.HTMLElement}return result},startsWith:String.prototype.startsWith||function(str){return this.substring(0,str.length)===str},listenForPostMessage:function(listener){var addEventMethod=window.addEventListener?"addEventListener":"attachEvent",addEventFunction=window[addEventMethod],postMessage=addEventMethod==="addEventListener"?"message":"onmessage";addEventFunction(postMessage,listener)},removePostMessageListener:function(listener){var removeEventMethod=window.removeEventListener?"removeEventListener":"detachEvent",removeEventFunction=window[removeEventMethod],postMessage=removeEventMethod==="removeEventListener"?"message":"onmessage";removeEventFunction(postMessage,listener)},measurePopText:function(trackEvent,baseWidth){var canvas=document.createElement("canvas"),container=trackEvent.container,ctx=canvas.getContext("2d"),fontMod,hasLink,style,text,width=0;style=window.getComputedStyle&&window.getComputedStyle(container.firstChild||container);if(style){ctx.font=(style.getPropertyValue("font-size")||"18px")+" "+(style.getPropertyValue("font-family")||"Open Sans");fontMod=style.getPropertyValue("font-weight");if(fontMod&&fontMod!=="normal"){ctx.font=fontMod+" "+ctx.font}fontMod=style.getPropertyValue("font-style");if(fontMod&&fontMod!=="normal"){ctx.font=fontMod+" "+ctx.font}}else{ctx.font="18px Open Sans"}text=trackEvent.text||"";text=text.split("\n");hasLink=trackEvent.link||trackEvent.onClick&&trackEvent.onClick.gotoLink;Popcorn.forEach(text,function(t){width=Math.max(width,ctx.measureText(t).width+2+(hasLink?28:0))});width+=container.offsetWidth-container.firstChild.offsetWidth;width=Math.min(width,450*baseWidth/800);return width},regex:{escape:function(value){return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},patterns:{subdomain:"(?:[a-z]\\.|[a-z][a-z0-9-]{0,61}[a-z0-9]\\.)*?"},cssRegex:/^[\-\w]+$/,linkRegex:/^[\t ]*(((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,6}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))|mailto:|tel:)/i,onClickVariables:/(?:,|;|^)\s*([a-z_\$]+[a-z_\$0-9]*)(?:(\+\+|\-\-)|\(([0-9]*)\)|(?:\s*=\s*(?:(true|false|undefined|null)|'((?:[^'\\]|\\.)*)'|"((?:[^"\\]|\\.)*)"|([-+]?[0-9]*\.?[0-9]+))))\s*/gi,validEmail:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,validDomain:/((?:[a-z]\.|[a-z][a-z0-9-]{0,61}[a-z0-9]\.)*(?:[a-z]|[a-z][a-z0-9-]{0,61}[a-z0-9])(?:\.[a-z]{2,63}))/gi,validDomainFilter:/((?:\*\.|[a-z0-9]\.|[a-z0-9][a-z0-9-]{0,61}[a-z0-9]\.)*(?:[a-z0-9]|[a-z0-9][a-z0-9-]{0,61}[a-z0-9])(?:\.[a-z0-9]{2,63}))/gi,timeRegex:/^(?:([0-9]+):)?([0-9]+(?:\.[0-9]+)?)$/,trackRegex:/^\d+$/,templateVarsRegex:function(){return/\{\{([a-zA-Z_][a-zA-Z0-9_\.]*)(?:\|([^\}]*))?\}\}/g}},getTrackTime:function(val){var item;if(!val||!Popcorn.isArray(val)){return}item=val[3];if(item){item=item.replace("id=","")}return{time:parseInt(val[2]||0,10)*60+parseFloat(val[3]),annotationId:item?item:undefined,track:parseInt(val[1],10)}},validateOnClick:function(linkElements){var regex=this.regex,valid=true;function validateUrl(){var link=linkElements.linkInput.value;if(!link.length||regex.linkRegex.test(link)){if(link&&!validateLink(link)){removeClass(linkElements.linkInput,"valid");return false}addClass(linkElements.linkInput,"valid");return true}removeClass(linkElements.linkInput,"valid");return false}function validateTrack(){if(!linkElements.trackInput.value||regex.trackRegex.test(linkElements.trackInput.value)){addClass(linkElements.trackInput,"valid");return true}removeClass(linkElements.trackInput,"valid");return false}function validateTime(){var element=hasClass(linkElements.timeInput,"hide")?linkElements.timeInputSelect:linkElements.timeInput,parsedTime,isDefaultSelectOption=element.nodeName==="SELECT"&&element.options[element.selectedIndex].value==="default",value=element.nodeName==="SELECT"?element.options[element.selectedIndex].value:element.value;parsedTime=regex.timeRegex.exec(value);if(!value||isDefaultSelectOption||parsedTime&&(parsedTime[1]===undefined||parseFloat(parsedTime[2])<60)||value.indexOf("id=")>-1){addClass(element,"valid");return true}removeClass(element,"valid");return false}function validateBranchTime(){var element=linkElements.branchTimeInput,selectElement=linkElements.branchInputSelect,branchPointSelected=selectElement[selectElement.selectedIndex].value!=="-";if(!selectElement){return false}return true}function validateCss(){if(!linkElements.cssInput.value||regex.cssRegex.test(linkElements.cssInput.value)){addClass(linkElements.cssInput,"valid");return true}removeClass(linkElements.cssInput,"valid");return false}function validateVariable(){addClass(linkElements.varInput,"valid");return true}if(linkElements.linkInput!==undefined){valid=validateUrl();if(!valid){valid=regex.templateVarsRegex().test(linkElements.linkInput.value)}}if(linkElements.trackInput!==undefined){valid=validateTrack()&&valid}if(linkElements.cssInput!==undefined){valid=validateCss()&&valid}if(linkElements.varInput!==undefined){valid=validateVariable()&&valid}if(linkElements.branchTimeInput!==undefined){valid=validateBranchTime()&&valid}else{if(linkElements.timeInputSelect!==undefined){valid=validateTime()&&valid}if(linkElements.timeInput!==undefined){valid=validateTime()&&valid}}return valid},navigateToUrl:function(url,target){var iframe,newWindow;if(typeof url==="string"&&url.length){if(this.startsWith.call(url,"mailto:")){iframe=document.createElement("iframe");iframe.width=0;iframe.height=0;document.body.appendChild(iframe);iframe.src=url;setTimeout(function(){document.body.removeChild(iframe)},10)}else{if(target){newWindow=window.open(url,target)}else if(!localLinks||!sameDomain.test(url)){newWindow=window.open(url,"_blank")}else{window.location.href=url}if(newWindow){newWindow.focus()}}}return false},microTemplate:microTemplate,addClass:addClass,hasClass:hasClass,removeClass:removeClass,inputPlaceholder:inputPlaceholder,sendEmail:function(data,cb){var tryCount=0;dao.store.postJSON("/api/send_mail",data,function(msg,status){if(typeof cb==="function"){if(msg.status!==200){cb(msg.status,msg.code)}else{cb(msg)}}},function(xhr,desc,err){logging.error(err);if(desc==="timeout"&&tryCount<1){logging.info("Error: Connection timeout. Trying again.");tryCount++;$.ajax(this)}else{if(typeof cb==="function"){cb("Error",err)}}})},getImageName:getImageName,getAnnotationMessage:function(props){var typeCounts={};function formatData(str){if(!str||str.length<=90){return str||""}return str.slice(0,90)+"..."}return function(type,useFormatted,customConfig,props){var message,formattedType;var messageMap={basic360:function(){var base="360 "+props.inputType.toUpperCase();var content;if(props.inputType==="image"){content=props.preview||getImageName(props.text)}else if(props.inputType==="hotspot"){content=props.preview}else{content=props.text}if(content){base+=" - "+content}return base},iframe:function(){return props.displayedName||props.customWidget||props.src},contents:function(){return props.title},quiz:function(){var pages=embedUtils.dotget(props,"quiz.pages"),page=pages&&pages[0],content=page&&page.content&&page.content[0],text=content&&content.text;return text?text:"Quiz"},image:function(){return getImageName(props.url)},response:function(){var pollData=customConfig&&customConfig.pollData||props&&props.pollData;if(pollData){return pollData.questionSection.question||pollData.answerSection.answerType}return"Response"},social:function(){var twitterUrl,facebookUrl,linkedinUrl;if(!props){return""}twitterUrl=embedUtils.dotget(props,"twitter.url");if(twitterUrl){return"Twitter: "+twitterUrl}facebookUrl=embedUtils.dotget(props,"facebook.url");if(facebookUrl){return"Facebook: "+facebookUrl}linkedinUrl=embedUtils.dotget(props,"linkedin.url");if(linkedinUrl){return"Linkedin: "+linkedinUrl}return""},ontime:function(){var preview="";if(props){preview+=props.addonTypeId?props.addonTypeId+" ":"";preview+=props.addonCommand?"- "+props.addonCommand+" ":"";if(props.addonTypeId&&props.addonTypeId==="slidesync"){preview+=props.addonCommandData.page?"- "+props.addonCommandData.page+" ":"";preview+=props.addonCommandData.asset?"- "+props.addonCommandData.asset+" ":""}}return preview||"On Time Event"}};typeCounts[type]=typeCounts[type]||0;typeCounts[type]++;formattedType=type.charAt(0).toUpperCase()+type.slice(1)+" - ";if(messageMap[type]){message=messageMap[type]()}if(!message){if(!useFormatted){message=props.text||""}else{message=props.text||typeCounts[type]}}if(["pop","hotlink","bookmark"].indexOf(type)>-1){message=formatData(""+message)}if(useFormatted){return formattedType+message}return message}}(),uploadToS3:function(files,callback,path){var formData=new FormData,folder=path||"unspecified";var i,file;for(i=0;i<files.length;i++){file=files[i];formData.append("file",file)}formData.append("folder",folder);var xhr=new XMLHttpRequest;xhr.open("POST",hapyak.microserviceHost+"/api/upload/s3");xhr.onload=function(){var responseText;if(xhr.status===200){responseText=JSON.parse(xhr.responseText);if(typeof callback==="function"){callback(responseText.paths[0])}}};xhr.send(formData)}}});hy.define("player.wrappers",["utils","jquery.noconflict"],function(utils,$){var regex={dailymotion:/dailymotion\.com\/(embed\/)?video\/([a-z0-9]+)/i,dailymotioninternal:/dmcdn\.net([a-zA-Z0-9\/\-]+\.swf)/,brightcoveVideo:/bctid=([0-9]+)/,brightcovePlayer:/bcpid([0-9]+)/,vimeo1:/player.vimeo.com\/video\/\d+/,vimeo2:/vimeo.com\/\d+/,wistia:/https?:\/\/(.+)?(wistia\.com|wi\.st)\/(medias|embed)\/.*/,youtube:/^(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu)/,youtubeEmbed:/^https?:\/\/(?:www\.)?youtube\.com\/embed\/([A-Z0-9\-]+)($|\?.*)/i,vzaar:/^https?:\/\/(\w[\w_\-]*\.)*vzaar\.com\/videos\/(\d+)\/?[^\?]*(\?[^#]*)?/i,ustream:/^https?:\/\/(\w[\w_\-]*\.)*ustream\.tv\/embed\/recorded\/(\d+)/i,limelightv2:/LVPPlayerStandard/i},vjsNames=["videojs","vjs","_V_","VideoJS"],detectors={brightcove:function(src){var bc=window.brightcove,tempElem;if(bc&&bc.experiences&&src&&src.experience&&bc.experiences[src.experience.id]){return src}if(!regex.brightcoveVideo.test(src)||!regex.brightcovePlayer.test(src)){return false}tempElem=document.createElement("a");tempElem.href=src;return tempElem.hostname==="link.brightcove.com"},dailymotion:function(src){var DM=window.DM,player;if(DM&&DM.Player&&DM.Player._INSTANCES){for(player in DM.Player._INSTANCES){if(DM.Player._INSTANCES[player]===src){return src}}}return window.DailymotionPlayer&&src instanceof window.DailymotionPlayer||window.DailymotionPlayerFlash&&src instanceof window.DailymotionPlayerFlash||window.DailymotionPlayerHTML&&src instanceof window.DailymotionPlayerHTML||regex.dailymotion.test(src)},dailymotioninternal:function(src){var pgv=window.Pg_Video,data;if(pgv&&pgv.videoPlayer&&pgv.videoPlayer===src){return"probably"}if(src&&src.tagName==="OBJECT"&&src.getAttribute){data=src.getAttribute("data");if(data&&regex.dailymotioninternal.test(data)){return"probably"}}return src&&src.tagName==="OBJECT"&&src.playVideo&&"maybe"},dailymotionv5:function(src,guess){return guess==="dailymotionv5"},flowplayer:function(src){var flowplayer=window.flowplayer;if(flowplayer&&src&&src.conf&&src.video&&src.video.url){return src}return false},jplayer:function(src){var jQuery;if(typeof src!=="string"){jQuery=$;if(!jQuery.jPlayer){return false}src=jQuery(src);if(src.data&&src.data("jPlayer")&&jQuery.jPlayer.prototype.instances[src.data("jPlayer").internal.instance]){return src}}return false},mediaelement:function(src){var MediaElement=window.MediaElement,mejs=window.mejs,player;if(MediaElement&&mejs&&mejs.players){for(player in mejs.players){if(mejs.players[player]===src){return src}}}return false},skeleton:function(src){return src},ustream:function(src){if(window.UstreamEmbed&&src.host==="http://ustream.tv"){return src}return regex.ustream.test(src)?src:false},videojs:function(src){var vjs,name,i,byName,id,playerObject,player;if(!src){return false}for(i=0;i<vjsNames.length;i++){name=vjsNames[i];if(window[name]&&typeof window[name].Player==="function"){vjs=window[name];if(src instanceof vjs.Player){return src}break}}if(!vjs){return}byName=typeof src==="string";if(byName){id=src}else if(typeof src.id==="function"){id=src.id()}else{id=src.id}playerObject=vjs.players;if(playerObject){player=playerObject[id]}if(player&&(byName||src===player)){return player}if(typeof src!=="object"||!(vjs.Player&&src instanceof vjs.Player)||!playerObject){return false}for(id in playerObject){if(playerObject.hasOwnProperty(id)&&playerObject[id]===src){return src}}return false},vimeo:function(src){return regex.vimeo1.test(src)||regex.vimeo2.test(src)?src:false},vzaar:function(src){if(window.vzPlayer&&src instanceof window.vzPlayer){return src}return regex.vzaar.test(src)?src:false},wistia:function(src){var Wistia=window.Wistia;if(Wistia&&Wistia._data&&Wistia._data.video&&Wistia._data.video[src.uuid]){return src}if(typeof src!=="string"){return false}return regex.wistia.test(src)?src:false},youtube:function(src){if(utils.instanceOfElement(src,"HTMLIFrameElement")&&src.src&&regex.youtubeEmbed.test(src.src)){return src}if(!window.YT||!src||!window.YT.Player){return false}if(src instanceof window.YT.Player){return src}return false},limelightv2:function(src){return regex.limelightv2.test(src)},vrviewer:function(src){return/mp4$/.test(src)}};function WrapperRegistry(){}WrapperRegistry.prototype.detect=function(src,guess){var i,result;result=guess&&detectors[guess]&&detectors[guess](src,guess);if(result){return guess}for(i in detectors){if(detectors.hasOwnProperty(i)){result=detectors[i](src);if(result===true||result==="probably"){return i}}}return false};return new WrapperRegistry});(function(global,document){if(!document.addEventListener){global.Popcorn={isSupported:false};var methods=("byId forEach extend effects error guid sizeOf isArray nop position disable enable destroy"+"addTrackEvent removeTrackEvent getTrackEvents getTrackEvent getLastTrackEventId "+"timeUpdate plugin removePlugin compose effect xhr getJSONP getScript").split(/\s+/);while(methods.length){global.Popcorn[methods.shift()]=function(){}}return}var AP=Array.prototype,OP=Object.prototype,forEach=AP.forEach,slice=AP.slice,hasOwn=OP.hasOwnProperty,toString=OP.toString,_Popcorn=global.Popcorn,readyStack=[],readyBound=false,readyFired=false,internal={events:{hash:{},apis:{}}},requestAnimFrame=function(){return global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame||function(callback,element){global.setTimeout(callback,16)}}(),getKeys=function(obj){return Object.keys?Object.keys(obj):function(obj){var item,list=[];for(item in obj){if(hasOwn.call(obj,item)){list.push(item)}}return list}(obj)},Abstract={put:function(dictionary){Object.getOwnPropertyNames(dictionary).forEach(function(key){this[key]=dictionary[key]},this)}},Popcorn=function(entity,options){return new Popcorn.p.init(entity,options||null)};Popcorn.version="@VERSION";Popcorn.isSupported=true;Popcorn.instances=[];Popcorn.p=Popcorn.prototype={init:function(entity,options){var matches,nodeName,self=this;if(typeof entity==="function"){if(document.readyState==="complete"){entity(document,Popcorn);return}readyStack.push(entity);if(!readyBound){readyBound=true;var DOMContentLoaded=function(){readyFired=true;document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);for(var i=0,readyStackLength=readyStack.length;i<readyStackLength;i++){readyStack[i].call(document,Popcorn)}readyStack=null};document.addEventListener("DOMContentLoaded",DOMContentLoaded,false)}return}if(typeof entity==="string"){try{matches=document.querySelector(entity)}catch(e){throw new Error("Popcorn.js Error: Invalid media element selector: "+entity)}}this.media=matches||entity;nodeName=this.media.nodeName&&this.media.nodeName.toLowerCase()||"video";this[nodeName]=this.media;this.options=options||{};this.id=this.options.id||Popcorn.guid(nodeName);if(Popcorn.byId(this.id)){throw new Error("Popcorn.js Error: Cannot use duplicate ID ("+this.id+")")}this.isDestroyed=false;this.data={running:{cue:[]},timeUpdate:Popcorn.nop,disabled:{},events:{},hooks:{},history:[],state:{volume:this.media.volume},trackRefs:{},trackEvents:new TrackEvents};Popcorn.instances.push(this);var isReady=function(){if(self.media.currentTime<0){self.media.currentTime=0}self.media.removeEventListener("loadedmetadata",isReady,false);var duration,videoDurationPlus,runningPlugins,runningPlugin,rpLength,rpNatives;duration=self.media.duration;videoDurationPlus=duration!=duration?Number.MAX_VALUE:duration+1;Popcorn.addTrackEvent(self,{start:videoDurationPlus,end:videoDurationPlus});if(self.options.frameAnimation){self.data.timeUpdate=function(){Popcorn.timeUpdate(self,{});Popcorn.forEach(Popcorn.manifest,function(key,val){runningPlugins=self.data.running[val];if(runningPlugins){rpLength=runningPlugins.length;for(var i=0;i<rpLength;i++){runningPlugin=runningPlugins[i];rpNatives=runningPlugin._natives;rpNatives&&rpNatives.frame&&rpNatives.frame.call(self,{},runningPlugin,self.currentTime())}}});self.emit("timeupdate");!self.isDestroyed&&requestAnimFrame(self.data.timeUpdate)};!self.isDestroyed&&requestAnimFrame(self.data.timeUpdate)}else{self.data.timeUpdate=function(event){Popcorn.timeUpdate(self,event)};if(!self.isDestroyed){self.media.addEventListener("timeupdate",self.data.timeUpdate,false)}}};Object.defineProperty(this,"error",{get:function(){return self.media.error}});if(self.media.readyState>=1){isReady()}else{self.media.addEventListener("loadedmetadata",isReady,false)}return this}};Popcorn.p.init.prototype=Popcorn.p;Popcorn.byId=function(str){var instances=Popcorn.instances,length=instances.length,i=0;for(;i<length;i++){if(instances[i].id===str){return instances[i]}}return null};Popcorn.forEach=function(obj,fn,context){if(!obj||!fn){return{}}context=context||this;var key,len;if(forEach&&obj.forEach===forEach){return obj.forEach(fn,context)}if(toString.call(obj)==="[object NodeList]"){for(key=0,len=obj.length;key<len;key++){fn.call(context,obj[key],key,obj)}return obj}for(key in obj){if(hasOwn.call(obj,key)){fn.call(context,obj[key],key,obj)}}return obj};Popcorn.extend=function(obj){var dest=obj,src=slice.call(arguments,1);Popcorn.forEach(src,function(copy){for(var prop in copy){dest[prop]=copy[prop]}});return dest};Popcorn.extend(Popcorn,{noConflict:function(deep){if(deep){global.Popcorn=_Popcorn}return Popcorn},error:function(msg){throw new Error(msg)},guid:function(prefix){Popcorn.guid.counter++;return(prefix?prefix:"")+(+new Date+Popcorn.guid.counter)},sizeOf:function(obj){var size=0;for(var prop in obj){size++}return size},isArray:Array.isArray||function(array){return toString.call(array)==="[object Array]"},nop:function(){},position:function(elem){var clientRect=elem.getBoundingClientRect(),bounds={},doc=elem.ownerDocument,docElem=document.documentElement,body=document.body,clientTop,clientLeft,scrollTop,scrollLeft,top,left;clientTop=docElem.clientTop||body.clientTop||0;clientLeft=docElem.clientLeft||body.clientLeft||0;scrollTop=global.pageYOffset&&docElem.scrollTop||body.scrollTop;scrollLeft=global.pageXOffset&&docElem.scrollLeft||body.scrollLeft;top=Math.ceil(clientRect.top+scrollTop-clientTop);left=Math.ceil(clientRect.left+scrollLeft-clientLeft);for(var p in clientRect){bounds[p]=Math.round(clientRect[p])}return Popcorn.extend({},bounds,{top:top,left:left})},disable:function(instance,plugin){if(instance.data.disabled[plugin]){return}instance.data.disabled[plugin]=true;if(plugin in Popcorn.registryByName&&instance.data.running[plugin]){for(var i=instance.data.running[plugin].length-1,event;i>=0;i--){event=instance.data.running[plugin][i];event._natives.end.call(instance,null,event);instance.emit("trackend",Popcorn.extend({},event,{plugin:event.type,type:"trackend",track:event}))}}return instance},enable:function(instance,plugin){if(!instance.data.disabled[plugin]){return}instance.data.disabled[plugin]=false;if(plugin in Popcorn.registryByName&&instance.data.running[plugin]){for(var i=instance.data.running[plugin].length-1,event;i>=0;i--){event=instance.data.running[plugin][i];event._natives.start.call(instance,null,event);instance.emit("trackstart",Popcorn.extend({},event,{plugin:event.type,type:"trackstart",track:event}))}}return instance},destroy:function(instance){var events=instance.data.events,trackEvents=instance.data.trackEvents,singleEvent,item,fn,plugin;for(item in events){singleEvent=events[item];for(fn in singleEvent){delete singleEvent[fn]}events[item]=null}for(plugin in Popcorn.registryByName){Popcorn.removePlugin(instance,plugin)}trackEvents.byStart.length=0;trackEvents.byEnd.length=0;if(!instance.isDestroyed){
instance.data.timeUpdate&&instance.media.removeEventListener("timeupdate",instance.data.timeUpdate,false);instance.isDestroyed=true}Popcorn.instances.splice(Popcorn.instances.indexOf(instance),1)}});Popcorn.guid.counter=1;Popcorn.extend(Popcorn.p,function(){var methods="load play pause currentTime playbackRate volume duration preload playbackRate "+"autoplay loop controls muted buffered readyState seeking paused played seekable ended",ret={};Popcorn.forEach(methods.split(/\s+/g),function(name){ret[name]=function(arg){var previous;if(typeof this.media[name]==="function"){if(arg!=null&&/play|pause/.test(name)){this.media.currentTime=Popcorn.util.toSeconds(arg)}this.media[name]();return this}if(arg!=null){previous=this.media[name];this.media[name]=arg;if(previous!==arg){this.emit("attrchange",{attribute:name,previousValue:previous,currentValue:arg})}return this}return this.media[name]}});return ret}());Popcorn.forEach("enable disable".split(" "),function(method){Popcorn.p[method]=function(plugin){return Popcorn[method](this,plugin)}});Popcorn.extend(Popcorn.p,{roundTime:function(){return Math.round(this.media.currentTime)},exec:function(id,time,fn){var length=arguments.length,trackEvent,sec;try{sec=Popcorn.util.toSeconds(id)}catch(e){}if(typeof sec==="number"){id=sec}if(typeof id==="number"&&length===2){fn=time;time=id;id=Popcorn.guid("cue")}else{if(length===1){time=-1}else{trackEvent=this.getTrackEvent(id);if(trackEvent){if(typeof id==="string"&&length===2){if(typeof time==="number"){fn=trackEvent._natives.start}if(typeof time==="function"){fn=time;time=trackEvent.start}}}else{if(length>=2){if(typeof time==="string"){try{sec=Popcorn.util.toSeconds(time)}catch(e){}time=sec}if(typeof time==="number"){fn=fn||Popcorn.nop()}if(typeof time==="function"){fn=time;time=-1}}}}}Popcorn.addTrackEvent(this,{id:id,start:time,end:time+1,_running:false,_natives:{start:fn||Popcorn.nop,end:Popcorn.nop,type:"cue"}});return this},mute:function(toggle){var event=toggle==null||toggle===true?"muted":"unmuted";if(event==="unmuted"){this.media.muted=false;this.media.volume=this.data.state.volume}if(event==="muted"){this.data.state.volume=this.media.volume;this.media.muted=true}this.emit(event);return this},unmute:function(toggle){return this.mute(toggle==null?false:!toggle)},position:function(){return Popcorn.position(this.media)},toggle:function(plugin){return Popcorn[this.data.disabled[plugin]?"enable":"disable"](this,plugin)},defaults:function(plugin,defaults){if(Popcorn.isArray(plugin)){Popcorn.forEach(plugin,function(obj){for(var name in obj){this.defaults(name,obj[name])}},this);return this}if(!this.options.defaults){this.options.defaults={}}if(!this.options.defaults[plugin]){this.options.defaults[plugin]={}}Popcorn.extend(this.options.defaults[plugin],defaults);return this}});Popcorn.Events={UIEvents:"blur focus focusin focusout load resize scroll unload",MouseEvents:"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave click dblclick",Events:"loadstart progress suspend emptied stalled play pause error "+"loadedmetadata loadeddata waiting playing canplay canplaythrough "+"seeking seeked timeupdate ended ratechange durationchange volumechange"};Popcorn.Events.Natives=Popcorn.Events.UIEvents+" "+Popcorn.Events.MouseEvents+" "+Popcorn.Events.Events;internal.events.apiTypes=["UIEvents","MouseEvents","Events"];(function(events,data){var apis=internal.events.apiTypes,eventsList=events.Natives.split(/\s+/g),idx=0,len=eventsList.length,prop;for(;idx<len;idx++){data.hash[eventsList[idx]]=true}apis.forEach(function(val,idx){data.apis[val]={};var apiEvents=events[val].split(/\s+/g),len=apiEvents.length,k=0;for(;k<len;k++){data.apis[val][apiEvents[k]]=true}})})(Popcorn.Events,internal.events);Popcorn.events={isNative:function(type){return!!internal.events.hash[type]},getInterface:function(type){if(!Popcorn.events.isNative(type)){return false}var eventApi=internal.events,apis=eventApi.apiTypes,apihash=eventApi.apis,idx=0,len=apis.length,api,tmp;for(;idx<len;idx++){tmp=apis[idx];if(apihash[tmp][type]){api=tmp;break}}return api},all:Popcorn.Events.Natives.split(/\s+/g),fn:{trigger:function(type,data){var eventInterface,evt,clonedEvents,events=this.data.events[type];if(events){eventInterface=Popcorn.events.getInterface(type);if(eventInterface){evt=document.createEvent(eventInterface);evt.initEvent(type,true,true,global,1);this.media.dispatchEvent(evt);return this}clonedEvents=events.slice();while(clonedEvents.length){clonedEvents.shift().call(this,data)}}return this},listen:function(type,fn){var self=this,hasEvents=true,eventHook=Popcorn.events.hooks[type],origType=type,clonedEvents,tmp;if(typeof fn!=="function"){throw new Error("Popcorn.js Error: Listener is not a function")}if(!this.data.events[type]){this.data.events[type]=[];hasEvents=false}if(eventHook){if(eventHook.add){eventHook.add.call(this,{},fn)}if(eventHook.bind){type=eventHook.bind}if(eventHook.handler){tmp=fn;fn=function wrapper(event){eventHook.handler.call(self,event,tmp)}}hasEvents=true;if(!this.data.events[type]){this.data.events[type]=[];hasEvents=false}}this.data.events[type].push(fn);if(!hasEvents&&Popcorn.events.all.indexOf(type)>-1){this.media.addEventListener(type,function(event){if(self.data.events[type]){clonedEvents=self.data.events[type].slice();while(clonedEvents.length){clonedEvents.shift().call(self,event)}}},false)}return this},unlisten:function(type,fn){var ind,events=this.data.events[type];if(!events){return}if(typeof fn==="string"){for(var i=0;i<events.length;i++){if(events[i].name===fn){events.splice(i--,1)}}return this}else if(typeof fn==="function"){while(ind!==-1){ind=events.indexOf(fn);if(ind!==-1){events.splice(ind,1)}}return this}this.data.events[type]=null;return this}},hooks:{canplayall:{bind:"canplaythrough",add:function(event,callback){var state=false;if(this.media.readyState){callback.call(this,event);state=true}this.data.hooks.canplayall={fired:state}},handler:function canplayall(event,callback){if(!this.data.hooks.canplayall.fired){callback.call(this,event);this.data.hooks.canplayall.fired=true}}}}};Popcorn.forEach([["trigger","emit"],["listen","on"],["unlisten","off"]],function(key){Popcorn.p[key[0]]=Popcorn.p[key[1]]=Popcorn.events.fn[key[0]]});function TrackEvent(track){Abstract.put.call(this,track)}function TrackEvents(){this.byStart=[{start:-1,end:-1}];this.byEnd=[{start:-1,end:-1}];this.animating=[];this.startIndex=0;this.endIndex=0;this.previousUpdateTime=-1}function addToArray(obj,track){var byStart=obj.data.trackEvents.byStart,byEnd=obj.data.trackEvents.byEnd,startIndex,endIndex;if(track&&track._id){obj.data.history.push(track._id)}track.start=Popcorn.util.toSeconds(track.start,obj.options.framerate);track.end=Popcorn.util.toSeconds(track.end,obj.options.framerate);for(startIndex=byStart.length-1;startIndex>=0;startIndex--){if(track.start>=byStart[startIndex].start){byStart.splice(startIndex+1,0,track);break}}for(endIndex=byEnd.length-1;endIndex>=0;endIndex--){if(track.end>byEnd[endIndex].end){byEnd.splice(endIndex+1,0,track);break}}if(startIndex<=obj.data.trackEvents.startIndex&&track.start<=obj.data.trackEvents.previousUpdateTime){obj.data.trackEvents.startIndex++}if(endIndex<=obj.data.trackEvents.endIndex&&track.end<obj.data.trackEvents.previousUpdateTime){obj.data.trackEvents.endIndex++}if(track.end>obj.media.currentTime&&track.start<=obj.media.currentTime){track._running=true;obj.data.running[track._natives.type].push(track);if(!obj.data.disabled[track._natives.type]){track._natives.start.call(obj,null,track);obj.emit("trackstart",Popcorn.extend({},track,{plugin:track._natives.type,type:"trackstart",track:track}))}}}function removeFromArray(obj,removeId){var start,end,animate,historyLen,length=obj.data.trackEvents.byStart.length,index=0,indexWasAt=0,byStart=[],byEnd=[],animating=[],history=[],track,runningPlugins;while(--length>-1){start=obj.data.trackEvents.byStart[index];end=obj.data.trackEvents.byEnd[index];if(!start._id){byStart.push(start);byEnd.push(end)}if(start._id){if(start._id!==removeId){byStart.push(start)}if(end._id!==removeId){byEnd.push(end)}if(start._id===removeId){indexWasAt=index;track=start}}index++}track=obj.getTrackEvent(removeId);if(track){runningPlugins=obj.data.running[track._natives.type];index=runningPlugins.indexOf(track);if(index>-1){runningPlugins.splice(index,1)}}length=obj.data.trackEvents.animating.length;index=0;if(length){while(--length>-1){animate=obj.data.trackEvents.animating[index];if(!animate._id){animating.push(animate)}if(animate._id&&animate._id!==removeId){animating.push(animate)}index++}}if(indexWasAt<=obj.data.trackEvents.startIndex){obj.data.trackEvents.startIndex--}if(indexWasAt<=obj.data.trackEvents.endIndex){obj.data.trackEvents.endIndex--}obj.data.trackEvents.byStart=byStart;obj.data.trackEvents.byEnd=byEnd;obj.data.trackEvents.animating=animating;historyLen=obj.data.history.length;for(var i=0;i<historyLen;i++){if(obj.data.history[i]!==removeId){history.push(obj.data.history[i])}}obj.data.history=history}Popcorn.addTrackEvent=function(obj,track){var trackEvent,isUpdate,eventType,id;track=new TrackEvent(track);id=track.id||track._id;if(id){trackEvent=obj.getTrackEvent(id)}if(trackEvent){isUpdate=true;track=Popcorn.extend({},trackEvent,track);obj.removeTrackEvent(id)}if(track&&track._natives&&track._natives.type&&(obj.options.defaults&&obj.options.defaults[track._natives.type])){track=Popcorn.extend({},obj.options.defaults[track._natives.type],track)}if(track._natives){track._id=track.id||track._id||Popcorn.guid(track._natives.type);if(track._natives._setup){track._natives._setup.call(obj,track);obj.emit("tracksetup",Popcorn.extend({},track,{plugin:track._natives.type,type:"tracksetup",track:track}))}}addToArray(obj,track);this.timeUpdate(obj,null,true);if(track._id){Popcorn.addTrackEvent.ref(obj,track)}if(isUpdate){if(track._natives.type==="cue"){eventType="cuechange"}else{eventType="trackchange"}obj.emit(eventType,{id:track.id,previousValue:{time:trackEvent.start,fn:trackEvent._natives.start},currentValue:{time:track.start,fn:track._natives.start},track:track})}else if(track._natives){obj.emit("trackadded",Popcorn.extend({},track,{plugin:track._natives.type,type:"trackadded",track:track}))}};Popcorn.addTrackEvent.ref=function(obj,track){obj.data.trackRefs[track._id]=track;return obj};Popcorn.removeTrackEvent=function(obj,removeId){var track=obj.getTrackEvent(removeId);if(!track){return}if(track._natives._teardown){track._natives._teardown.call(obj,track)}removeFromArray(obj,removeId);runningPlugins=obj.data.running[track._natives.type];index=runningPlugins.indexOf(track);if(index>=0){track._running=false;runningPlugins.splice(index,1);if(!obj.data.disabled[track._natives.type]){track._natives.end.call(obj,null,track);obj.emit("trackend",Popcorn.extend({},track,{plugin:track.type,type:"trackend",track:track}))}}};Popcorn.addTrackEvent=function(obj,track){var trackEvent,isUpdate,eventType,id;track=new TrackEvent(track);id=track.id||track._id;if(id){trackEvent=obj.getTrackEvent(id)}if(trackEvent){isUpdate=true;track=Popcorn.extend({},trackEvent,track);obj.removeTrackEvent(id)}if(track&&track._natives&&track._natives.type&&(obj.options.defaults&&obj.options.defaults[track._natives.type])){track=Popcorn.extend({},obj.options.defaults[track._natives.type],track)}if(track._natives){track._id=track.id||track._id||Popcorn.guid(track._natives.type);if(track._natives._setup){track._natives._setup.call(obj,track);obj.emit("tracksetup",Popcorn.extend({},track,{plugin:track._natives.type,type:"tracksetup",track:track}))}}addToArray(obj,track);this.timeUpdate(obj,null,true);if(track._id){Popcorn.addTrackEvent.ref(obj,track)}if(isUpdate){if(track._natives.type==="cue"){eventType="cuechange"}else{eventType="trackchange"}obj.emit(eventType,{id:track.id,previousValue:{time:trackEvent.start,fn:trackEvent._natives.start},currentValue:{time:track.start,fn:track._natives.start},track:track})}else if(track._natives){obj.emit("trackadded",Popcorn.extend({},track,{plugin:track._natives.type,type:"trackadded",track:track}))}};Popcorn.addTrackEvent.ref=function(obj,track){obj.data.trackRefs[track._id]=track;return obj};Popcorn.removeTrackEvent=function(obj,removeId){var track=obj.getTrackEvent(removeId);if(!track){return}if(track._natives._teardown){track._natives._teardown.call(obj,track)}removeFromArray(obj,removeId);Popcorn.removeTrackEvent.ref(obj,removeId);if(track._natives){obj.emit("trackremoved",Popcorn.extend({},track,{plugin:track._natives.type,type:"trackremoved"}))}};Popcorn.removeTrackEvent.ref=function(obj,removeId){delete obj.data.trackRefs[removeId];return obj};Popcorn.getTrackEvents=function(obj){var trackevents=[],refs=obj.data.trackEvents.byStart,length=refs.length,idx=0,ref;for(;idx<length;idx++){ref=refs[idx];if(ref._id){trackevents.push(ref)}}return trackevents};Popcorn.getTrackEvents.ref=function(obj){return obj.data.trackRefs};Popcorn.getTrackEvent=function(obj,trackId){return obj.data.trackRefs[trackId]};Popcorn.getTrackEvent.ref=function(obj,trackId){return obj.data.trackRefs[trackId]};Popcorn.getLastTrackEventId=function(obj){return obj.data.history[obj.data.history.length-1]};Popcorn.timeUpdate=function(obj,event){var currentTime=obj.media.currentTime,previousTime=obj.data.trackEvents.previousUpdateTime,tracks=obj.data.trackEvents,end=tracks.endIndex,start=tracks.startIndex,byStartLen=tracks.byStart.length,byEndLen=tracks.byEnd.length,registryByName=Popcorn.registryByName,trackstart="trackstart",trackend="trackend",byEnd,byStart,byAnimate,natives,type,runningPlugins;if(previousTime<=currentTime){while(tracks.byEnd[end]&&tracks.byEnd[end].end<=currentTime){byEnd=tracks.byEnd[end];natives=byEnd._natives;type=natives&&natives.type;if(!natives||(!!registryByName[type]||!!obj[type])){if(byEnd._running===true){byEnd._running=false;runningPlugins=obj.data.running[type];runningPlugins.splice(runningPlugins.indexOf(byEnd),1);if(!obj.data.disabled[type]){natives.end.call(obj,event,byEnd);obj.emit(trackend,Popcorn.extend({},byEnd,{plugin:type,type:trackend,track:byEnd}))}}end++}else{Popcorn.removeTrackEvent(obj,byEnd._id);return}}while(tracks.byStart[start]&&tracks.byStart[start].start<=currentTime){byStart=tracks.byStart[start];natives=byStart._natives;type=natives&&natives.type;if(!natives||(!!registryByName[type]||!!obj[type])){if(byStart.end>currentTime&&byStart._running===false){byStart._running=true;obj.data.running[type].push(byStart);if(!obj.data.disabled[type]){natives.start.call(obj,event,byStart);obj.emit(trackstart,Popcorn.extend({},byStart,{plugin:type,type:trackstart,track:byStart}))}}start++}else{Popcorn.removeTrackEvent(obj,byStart._id);return}}}else if(previousTime>currentTime){while(tracks.byStart[start]&&tracks.byStart[start].start>currentTime){byStart=tracks.byStart[start];natives=byStart._natives;type=natives&&natives.type;if(!natives||(!!registryByName[type]||!!obj[type])){if(byStart._running===true){byStart._running=false;runningPlugins=obj.data.running[type];runningPlugins.splice(runningPlugins.indexOf(byStart),1);if(!obj.data.disabled[type]){natives.end.call(obj,event,byStart);obj.emit(trackend,Popcorn.extend({},byStart,{plugin:type,type:trackend,track:byEnd}))}}start--}else{Popcorn.removeTrackEvent(obj,byStart._id);return}}while(tracks.byEnd[end]&&tracks.byEnd[end].end>currentTime){byEnd=tracks.byEnd[end];natives=byEnd._natives;type=natives&&natives.type;if(!natives||(!!registryByName[type]||!!obj[type])){if(byEnd.start<=currentTime&&byEnd._running===false){byEnd._running=true;obj.data.running[type].push(byEnd);if(!obj.data.disabled[type]){natives.start.call(obj,event,byEnd);obj.emit(trackstart,Popcorn.extend({},byEnd,{plugin:type,type:trackstart,track:byEnd}))}}end--}else{Popcorn.removeTrackEvent(obj,byEnd._id);return}}}tracks.endIndex=end;tracks.startIndex=start;tracks.previousUpdateTime=currentTime;tracks.byStart.length<byStartLen&&tracks.startIndex--;tracks.byEnd.length<byEndLen&&tracks.endIndex--};Popcorn.extend(Popcorn.p,{getTrackEvents:function(){return Popcorn.getTrackEvents.call(null,this)},getTrackEvent:function(id){return Popcorn.getTrackEvent.call(null,this,id)},getLastTrackEventId:function(){return Popcorn.getLastTrackEventId.call(null,this)},removeTrackEvent:function(id){Popcorn.removeTrackEvent.call(null,this,id);return this},removePlugin:function(name){Popcorn.removePlugin.call(null,this,name);return this},timeUpdate:function(event){Popcorn.timeUpdate.call(null,this,event);return this},destroy:function(){Popcorn.destroy.call(null,this);return this}});Popcorn.manifest={};Popcorn.registry=[];Popcorn.registryByName={};Popcorn.plugin=function(name,definition,manifest){if(Popcorn.protect.natives.indexOf(name.toLowerCase())>=0){Popcorn.error("'"+name+"' is a protected function name");return}var isfn=typeof definition==="function",blacklist=["start","end","type","manifest"],methods=["_setup","_teardown","start","end","frame"],plugin={},setup;var combineFn=function(first,second){first=first||Popcorn.nop;second=second||Popcorn.nop;return function(){first.apply(this,arguments);second.apply(this,arguments)}};Popcorn.manifest[name]=manifest=manifest||definition.manifest||{};methods.forEach(function(method){definition[method]=safeTry(definition[method]||Popcorn.nop,name)});var pluginFn=function(setup,options){if(!options){return this}if(options.ranges&&Popcorn.isArray(options.ranges)){Popcorn.forEach(options.ranges,function(range){var opts=Popcorn.extend({},options,range);delete opts.ranges;this[name](opts)},this);return this}var natives=options._natives={},compose="",originalOpts,manifestOpts;Popcorn.extend(natives,setup);options._natives.type=name;options._running=false;natives.start=natives.start||natives["in"];natives.end=natives.end||natives["out"];if(options.once){natives.end=combineFn(natives.end,function(){this.removeTrackEvent(options._id)})}natives._teardown=combineFn(function(){var args=slice.call(arguments),runningPlugins=this.data.running[natives.type];args.unshift(null);args[1]._running&&runningPlugins.splice(runningPlugins.indexOf(options),1)&&natives.end.apply(this,args)},natives._teardown);natives._teardown=combineFn(natives._teardown,function(){this.emit("trackteardown",Popcorn.extend({},options,{plugin:name,type:"trackteardown"}))});options.compose=options.compose&&options.compose.split(" ")||[];options.effect=options.effect&&options.effect.split(" ")||[];options.compose=options.compose.concat(options.effect);options.compose.forEach(function(composeOption){compose=Popcorn.compositions[composeOption]||{};methods.forEach(function(method){natives[method]=combineFn(natives[method],compose[method])})});options._natives.manifest=manifest;if(!("start"in options)){options.start=options["in"]||0}if(!options.end&&options.end!==0){options.end=options["out"]||Number.MAX_VALUE}if(!hasOwn.call(options,"toString")){options.toString=function(){var props=["start: "+options.start,"end: "+options.end,"id: "+(options.id||options._id)];if(options.target!=null){props.push("target: "+options.target)}return name+" ( "+props.join(", ")+" )"}}if(!options.target){manifestOpts="options"in manifest&&manifest.options;options.target=manifestOpts&&"target"in manifestOpts&&manifestOpts.target}if(options._natives){options._id=Popcorn.guid(options._natives.type)}Popcorn.addTrackEvent(this,options);Popcorn.forEach(setup,function(callback,type){if(blacklist.indexOf(type)===-1){this.on(type,callback)}},this);return this};Popcorn.p[name]=plugin[name]=function(id,options){var length=arguments.length,trackEvent,defaults,mergedSetupOpts;if(id&&!options){options=id;id=null}else{trackEvent=this.getTrackEvent(id);if(!trackEvent){options.id=id}else{if(trackEvent._natives._update){if(options.hasOwnProperty("start")){trackEvent.start=options.start}if(options.hasOwnProperty("end")){trackEvent.end=options.end}trackEvent._natives._update.call(this,trackEvent,options);removeFromArray(this,trackEvent._id);addToArray(this,trackEvent);var eventType;if(trackEvent._natives.type==="cue"){eventType="cuechange"}else{eventType="trackchange"}this.emit(eventType,{id:trackEvent.id||trackEvent._id,previousValue:{time:trackEvent.start,fn:trackEvent._natives.start},currentValue:{time:trackEvent.start,fn:trackEvent._natives.start},track:trackEvent})}else{options=Popcorn.extend({},trackEvent,options);Popcorn.addTrackEvent(this,options)}return this}}this.data.running[name]=this.data.running[name]||[];defaults=this.options.defaults&&this.options.defaults[name]||{};mergedSetupOpts=Popcorn.extend({},defaults,options);return pluginFn.call(this,isfn?definition.call(this,mergedSetupOpts):definition,mergedSetupOpts)};if(manifest){Popcorn.extend(definition,{manifest:manifest})}var entry={fn:plugin[name],definition:definition,base:definition,parents:[],name:name};Popcorn.registry.push(Popcorn.extend(plugin,entry,{type:name}));Popcorn.registryByName[name]=entry;return plugin};Popcorn.plugin.errors=[];function safeTry(fn,pluginName){return function(){if(Popcorn.plugin.debug){return fn.apply(this,arguments)}try{return fn.apply(this,arguments)}catch(ex){Popcorn.plugin.errors.push({plugin:pluginName,thrown:ex,source:fn.toString()});this.emit("pluginerror",Popcorn.plugin.errors)}}}Popcorn.plugin.debug=Popcorn.version==="@"+"VERSION";Popcorn.removePlugin=function(obj,name){if(!name){name=obj;obj=Popcorn.p;if(Popcorn.protect.natives.indexOf(name.toLowerCase())>=0){Popcorn.error("'"+name+"' is a protected function name");return}var registryLen=Popcorn.registry.length,registryIdx;for(registryIdx=0;registryIdx<registryLen;registryIdx++){if(Popcorn.registry[registryIdx].name===name){Popcorn.registry.splice(registryIdx,1);delete Popcorn.registryByName[name];delete Popcorn.manifest[name];delete obj[name];return}}}var byStart=obj.data.trackEvents.byStart,byEnd=obj.data.trackEvents.byEnd,animating=obj.data.trackEvents.animating,idx,sl;for(idx=0,sl=byStart.length;idx<sl;idx++){if(byStart[idx]&&byStart[idx]._natives&&byStart[idx]._natives.type===name){byStart[idx]._natives._teardown&&byStart[idx]._natives._teardown.call(obj,byStart[idx]);byStart.splice(idx,1);idx--;sl--;if(obj.data.trackEvents.startIndex<=idx){obj.data.trackEvents.startIndex--;obj.data.trackEvents.endIndex--}}if(byEnd[idx]&&byEnd[idx]._natives&&byEnd[idx]._natives.type===name){byEnd.splice(idx,1)}}for(idx=0,sl=animating.length;idx<sl;idx++){if(animating[idx]&&animating[idx]._natives&&animating[idx]._natives.type===name){animating.splice(idx,1);idx--;sl--}}};Popcorn.compositions={};Popcorn.compose=function(name,definition,manifest){Popcorn.manifest[name]=manifest=manifest||definition.manifest||{};Popcorn.compositions[name]=definition};Popcorn.plugin.effect=Popcorn.effect=Popcorn.compose;var rnaiveExpr=/^(?:\.|#|\[)/;Popcorn.dom={debug:false,find:function(selector,context){var node=null;context=context||document;if(selector){if(!rnaiveExpr.test(selector)){node=document.getElementById(selector);if(node!==null){return node}}try{node=context.querySelector(selector)}catch(e){if(Popcorn.dom.debug){throw new Error(e)}}}return node}};var rparams=/\?/,setup={url:"",data:"",dataType:"",success:Popcorn.nop,type:"GET",async:true,xhr:function(){return new global.XMLHttpRequest}};Popcorn.xhr=function(options){options.dataType=options.dataType&&options.dataType.toLowerCase()||null;if(options.dataType&&(options.dataType==="jsonp"||options.dataType==="script")){Popcorn.xhr.getJSONP(options.url,options.success,options.dataType==="script");return}var settings=Popcorn.extend({},setup,options);settings.ajax=settings.xhr();if(settings.ajax){if(settings.type==="GET"&&settings.data){settings.url+=(rparams.test(settings.url)?"&":"?")+settings.data;settings.data=null}settings.ajax.open(settings.type,settings.url,settings.async);settings.ajax.send(settings.data||null);return Popcorn.xhr.httpData(settings)}};Popcorn.xhr.httpData=function(settings){var data,json=null,parser,xml=null;settings.ajax.onreadystatechange=function(){if(settings.ajax.readyState===4){try{json=JSON.parse(settings.ajax.responseText)}catch(e){}data={xml:settings.ajax.responseXML,text:settings.ajax.responseText,json:json};if(!data.xml||!data.xml.documentElement){data.xml=null;try{parser=new DOMParser;xml=parser.parseFromString(settings.ajax.responseText,"text/xml");if(!xml.getElementsByTagName("parsererror").length){data.xml=xml}}catch(e){}}if(settings.dataType){data=data[settings.dataType]}settings.success.call(settings.ajax,data)}};return data};Popcorn.xhr.getJSONP=function(url,success,isScript){var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,script=document.createElement("script"),isFired=false,params=[],rjsonp=/(=)\?(?=&|$)|\?\?/,replaceInUrl,prefix,paramStr,callback,callparam;if(!isScript){callparam=url.match(/(callback=[^&]*)/);if(callparam!==null&&callparam.length){prefix=callparam[1].split("=")[1];if(prefix==="?"){prefix="jsonp"}callback=Popcorn.guid(prefix);url=url.replace(/(callback=[^&]*)/,"callback="+callback)}else{callback=Popcorn.guid("jsonp");if(rjsonp.test(url)){url=url.replace(rjsonp,"$1"+callback)}params=url.split(/\?(.+)?/);url=params[0]+"?";if(params[1]){url+=params[1]+"&"}url+="callback="+callback}window[callback]=function(data){success&&success(data);isFired=true}}script.addEventListener("load",function(){if(isScript){success&&success()}if(isFired){delete window[callback]}head.removeChild(script)},false);script.src=url;head.insertBefore(script,head.firstChild);return};Popcorn.getJSONP=Popcorn.xhr.getJSONP;Popcorn.getScript=Popcorn.xhr.getScript=function(url,success){return Popcorn.xhr.getJSONP(url,success,true)};Popcorn.util={toSeconds:function(timeStr,framerate){var validTimeFormat=/^([0-9]+:){0,2}[0-9]+([.;][0-9]+)?$/,errorMessage="Invalid time format",digitPairs,lastIndex,lastPair,firstPair,frameInfo,frameTime;if(typeof timeStr==="number"){return timeStr}if(typeof timeStr==="string"&&!validTimeFormat.test(timeStr)){Popcorn.error(errorMessage)}digitPairs=timeStr.split(":");lastIndex=digitPairs.length-1;lastPair=digitPairs[lastIndex];if(lastPair.indexOf(";")>-1){frameInfo=lastPair.split(";");frameTime=0;if(framerate&&typeof framerate==="number"){frameTime=parseFloat(frameInfo[1],10)/framerate}digitPairs[lastIndex]=parseInt(frameInfo[0],10)+frameTime}firstPair=digitPairs[0];return{1:parseFloat(firstPair,10),2:parseInt(firstPair,10)*60+parseFloat(digitPairs[1],10),3:parseInt(firstPair,10)*3600+parseInt(digitPairs[1],10)*60+parseFloat(digitPairs[2],10)}[digitPairs.length||1]}};Popcorn.p.cue=Popcorn.p.exec;Popcorn.protect={natives:getKeys(Popcorn.p).map(function(val){return val.toLowerCase()})};Popcorn.forEach({listen:"on",unlisten:"off",trigger:"emit",exec:"cue"},function(recommend,api){var original=Popcorn.p[api];Popcorn.p[api]=function(){if(typeof console!=="undefined"&&console.warn){console.warn("Deprecated method '"+api+"', "+(recommend==null?"do not use.":"use '"+recommend+"' instead."));Popcorn.p[api]=original}return Popcorn.p[recommend].apply(this,[].slice.call(arguments))}});global.Popcorn=Popcorn})(window,window.document);hy.define("popcorn",function(global){return function(){var ret,fn;return ret||global.Popcorn}}(this));hy.define("utils.accruedTime",["module","utils.embed","lodash.noconflict"],function(module,embedUtils,_,undefined){var lastAccruedTimeUpdate=Date.now(),moduleConfig=module.config(),enabled=embedUtils.dotget(moduleConfig,"enabled");var accruedTimeUtil={post:function(player){if(!player||!enabled||Date.now()-lastAccruedTimeUpdate<500||typeof player.slicePlayTime!=="function"||typeof player.duration!=="function"){return}var postMessageWindow=window.self!==window.top?window.parent:window;if(postMessageWindow&&_.isFunction(postMessageWindow.postMessage)){postMessageWindow.postMessage(JSON.stringify({context:"hapyak-timing",event:"Accrued Time",properties:{"Video Duration":player.duration(),"Video Slice Play Time Accrued":player.slicePlayTime(false)}}),"*")}lastAccruedTimeUpdate=Date.now()}};return accruedTimeUtil});hy.define("utils.mobile",["configAPI"],function(configuration){var BASE_WIDTH=1200,fullscreen=false;return{mobileCheck:function(){var check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true})(navigator.userAgent||navigator.vendor||window.opera);return check},isIpad:function(){return navigator.userAgent.match(/iPad/i)!==null},isLandscape:function(){return Math.abs(window.orientation)===90},setElementStyles:function(element,styles){Object.assign(element.style,styles)},initFullscreenChange:function(player,container){fullscreen=!fullscreen;this.resize(player,container)},resize:function(player,container){var width=player.videoWidth()||player.width(),height=player.videoHeight()||player.height(),annotationContainers=document.querySelectorAll(".hapyak-annotation-container"),videoEl=container.querySelector("video"),that=this;var item,hapyakVideoContainer;if(!videoEl){return}function setPortraitDimensions(videoEl,container){}function setLandscapeDimensions(videoEl,container){that.setElementStyles(videoEl,{left:"0",top:"0",height:"100%"});if(document.querySelector("div.hapyak-player")){hapyakVideoContainer=document.querySelector("div.hapyak-player");that.setElementStyles(hapyakVideoContainer,{padding:"0px"})}}if(!annotationContainers||!this.mobileCheck()&&!this.isIpad()){return}for(item in annotationContainers){container=annotationContainers[+item];if(typeof container!=="object"){return}if(fullscreen&&this.isLandscape()||!fullscreen){this.setElementStyles(videoEl,{top:"0",height:"100%",width:""});this.setElementStyles(container,{top:"0",left:"auto"})}if(fullscreen){if(!this.isLandscape()){setPortraitDimensions(videoEl,container)}if(this.isLandscape()){setLandscapeDimensions(videoEl,container)}}}}}});hy.define("utils.externalContentManager",[],function(){function ExternalContentObject(element){this.element=element;this.x=0;this.y=0;this.top=0;this.bottom=0;this.left=0;this.right=0;this.width=0;this.height=0;this.updatePosition=function(){var clientRect=this.element.getBoundingClientRect();this.x=clientRect.x;this.y=clientRect.y;this.top=clientRect.top;this.bottom=clientRect.bottom;this.left=clientRect.left
;this.right=clientRect.right;this.width=clientRect.width;this.height=clientRect.height};this.updatePosition()}function ExternalContentManager(){var contentObjects=[];this.elements=function(){return contentObjects};this.update()}ExternalContentManager.prototype.getCumulativeOffsets=function(annotationContainer){var clientRect=annotationContainer.getBoundingClientRect(),contentObjects=this.elements();this.update();return contentObjects.reduce(function(offsets,contentObject){contentObject.updatePosition();if(contentObject.x<clientRect.x){offsets.left+=clientRect.x-contentObject.x}if(contentObject.x+contentObject.width>clientRect.x+clientRect.width){offsets.right+=contentObject.x+contentObject.width-(clientRect.x+clientRect.width)}if(contentObject.y<clientRect.y){offsets.top+=clientRect.y-contentObject.y}if(contentObject.y+contentObject.height>clientRect.y+clientRect.height){offsets.bottom+=contentObject.y+contentObject.height-(clientRect.y+clientRect.height)}return offsets},{top:0,bottom:0,left:0,right:0})};ExternalContentManager.prototype.update=function(){var elements=document.querySelectorAll(".hapyak-external-content"),that=this;Array.prototype.forEach.call(elements,function(element){var contentObject=that.findContentObject(element);if(!contentObject){that.elements().push(new ExternalContentObject(element));return}contentObject.updatePosition()})};ExternalContentManager.prototype.findContentObject=function(element){var contentObjects=this.elements();idx=-1;contentObjects.some(function(contentObject,index){if(contentObject.element===element){idx=index;return true}});if(idx===-1){return}return contentObjects[idx]};return new ExternalContentManager});hy.define("touch",[],function(){function Touch(element,down,move,up,options){var started=0,opts=options||{};function mouseMove(e){var x,y;if(!isNaN(e.pageX)){x=e.pageX;y=e.pageY}else{x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}move(e||window.event,x,y)}function mouseUp(e){started=0;if(up){up(e||window.event)}document.removeEventListener("mousemove",mouseMove,false);document.removeEventListener("mouseup",mouseUp,false);document.removeEventListener("mouseenter",mouseUp,false)}function mouseDown(e){var go=true,prevStarted=started,x,y;if(!opts.rightClick&&(e.which===3||e.button===2||e.ctrlKey)){return false}if(e.button===1&&!opts.middleClick){return false}started=1;if(down){if(!e){e=window.event}if(!isNaN(e.pageX)){x=e.pageX;y=e.pageY}else{x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}go=down(e||window.event,x,y);if((go||go===undefined)&&e.preventDefault){e.preventDefault()}else{started=prevStarted;return}}if(move){document.addEventListener("mousemove",mouseMove,false)}document.addEventListener("mouseup",mouseUp,false);document.addEventListener("mouseenter",mouseUp,false)}function touchMove(e){var touch=e.changedtouches&&e.changedtouches.length&&e.changedtouches[0]||e.touches&&e.touches.length&&e.touches[0]||e||window.event;move(touch,touch.pageX,touch.pageY);return false}function touchEnd(e){started=0;if(up){up(e&&e.changedtouches?e.changedtouches[0]:e)}document.removeEventListener("touchmove",touchMove,false);document.removeEventListener("touchend",touchEnd,false)}function touchStart(e){var go,touch;started=2;if(e.preventDefault){e.preventDefault()}element.removeEventListener("mousedown",mouseDown,false);if(down){touch=e.touches[0];go=down(touch||window.event,touch.pageX,touch.pageY);if((go||go===undefined)&&e.preventDefault){e.preventDefault()}else{return}}if(move){document.addEventListener("touchmove",touchMove,false)}document.addEventListener("touchend",touchEnd,false)}element.addEventListener("mousedown",mouseDown,true);element.addEventListener("touchstart",touchStart,false);this.remove=function(){element.removeEventListener("mousedown",mouseDown,false);element.removeEventListener("touchstart",touchStart,false);if(started>1){touchEnd()}else if(started){mouseUp()}};this.target=function(){return element}}return Touch});hy.define("environment",["lodash","logging"],function(_,logging){function nop(){logging.warn("This Environment scope has been destroyed. Don't use it anymore.")}function Environment(data,opts){var scopeData={children:{}},mainScope,options=opts||{},storage=options.storage||{},loading=false,clearQueue=[];function Scope(scopeName,parent,data){var state,dirty=true,i,j;function setChildValue(state,name,valueRef,clear){var oldValueRef=state.values[name];if(!clear&&oldValueRef&&oldValueRef!==valueRef&&oldValueRef.owner===state){return}if(valueRef){state.values[name]=valueRef}else if(state.values.hasOwnProperty(name)){state.values[name]=undefined}state.keys=null;_.each(state.children,function(child){setChildValue(child,name,valueRef,clear)});_.each(state.observers,function(observers,key){if(key===name||key.indexOf(name+".")===0){_.each(_.clone(observers),function(observer){observer(state.obj,name,valueRef&&valueRef.value)})}});if(name&&state.observers.hasOwnProperty("")){_.each(_.clone(state.observers[""]),function(observer){observer(state.obj,name,valueRef&&valueRef.value)})}}state={obj:this,parent:parent,children:{},values:{},observers:{},methods:{},frozen:false,name:scopeName,keys:null};parent.children[scopeName]=state;_.extend(state.values,parent.values);_.extend(state.methods,parent.methods);this.name=function(){return state.name};this.set=function(name,value,temp){var valueRef,path,child,nameComponents,propertyName;if(!name){return}else if(Object.prototype.toString.call(name)==="[object Array]"){path=name}else{path=name.split("/")}if(path.length>1){path=path.slice(0);child=path.shift();this.scope(child).set(path,value);return}if(state.frozen){return this}nameComponents=path[0].split(".");name=nameComponents[0];propertyName=nameComponents[1];valueRef=state.values[name];if(valueRef&&valueRef.owner===state){if(propertyName!==undefined){if(typeof valueRef.value!=="object"){logging.error('Environment cannot set property "'+propertyName+'" on non-object "'+name+'"');return}if(valueRef.value[propertyName]===value){return}valueRef.value[propertyName]=value}else{if(valueRef.value===value){return}valueRef.value=value}if(temp!==undefined){valueRef.temp=!!temp}}else{valueRef={name:name,owner:state,value:value,temp:!!temp};if(propertyName!==undefined){valueRef.value={};valueRef.value[propertyName]=value}}if(!valueRef.temp){dirty=true}setChildValue(state,name,valueRef);if(!loading&&!temp&&options.autosave){if(Array.isArray(options.autosave)){this.save.apply(this,options.autosave)}else{this.save(options.autosave)}}return this};this.get=function(name){var valueRef,path,child,nameComponents;if(!name){return}else if(Object.prototype.toString.call(name)==="[object Array]"){path=name}else{path=name.split("/")}if(path.length>1){child=path.shift();if(!state.children[child]){return}return state.children[child].obj.get(path)}nameComponents=path[0].split(".");name=nameComponents.shift();valueRef=state.values[name];if(nameComponents.length&&valueRef){valueRef=valueRef.value;while(nameComponents.length&&valueRef&&typeof valueRef==="object"){name=nameComponents.shift();valueRef=valueRef[name]}return valueRef}return valueRef&&valueRef.value};this.clear=function(name,blocksave){var valueRef,nameComponents,propertyName;if(!name){return}nameComponents=name.split(".");name=nameComponents[0];propertyName=nameComponents[1];valueRef=state.values[name];if(valueRef&&valueRef.owner===state){if(propertyName!==undefined){if(typeof valueRef.value==="object"){delete valueRef.value[propertyName]}}dirty=true;setChildValue(state,name,parent.values&&parent.values[name],true)}if(options.autosave&&!blocksave){if(Array.isArray(options.autosave)){this.save.apply(this,options.autosave)}else{this.save(options.autosave)}}};this.freeze=function(){state.frozen=true};this.unfreeze=function(){state.frozen=false};this.frozen=function(){return state.frozen};this.observe=function(name,callback){if(callback===undefined){callback=name;name=""}else if(!name){name=""}if(typeof callback!=="function"){throw new Error("Environment observe callback must a function.")}if(state.observers[name]){if(state.observers[name].indexOf(callback)>=0){return this}}else{state.observers[name]=[]}state.observers[name].push(callback);return this};this.unobserve=function(name,callback){var i;if(!state.observers[name]){return}i=state.observers[name].indexOf(callback);if(i>=0){state.observers[name].splice(i,1)}return this};this.notify=function(name){var observers;if(state.observers.hasOwnProperty(name)){observers=state.observers[name];for(j=0;j<observers.length;j++){observers[j](state.obj)}}return this};this.register=function(name,method){var methodRef;function setMethod(state,name,methodRef,clear){var i,oldMethodRef;oldMethodRef=state.methods[name];if(!clear&&oldMethodRef&&oldMethodRef!==methodRef&&oldMethodRef.owner===state){return}if(methodRef){state.methods[name]=methodRef}else{delete state.methods[name]}for(i in state.children){if(state.children.hasOwnProperty(i)){setMethod(state.children[i],name,methodRef,clear)}}}methodRef=state.methods[name];if(methodRef&&methodRef.owner===state){if(methodRef.method===method){return}methodRef.method=method}else{methodRef={name:name,owner:state,method:method}}setMethod(state,name,methodRef);return this};this.execute=function(name){var args=Array.prototype.slice.call(arguments,0),methodRef;methodRef=state.methods[name];if(!methodRef){return}args[0]=this;return methodRef.method.apply(this,args)};this.scope=function(name,data,noCreate){var scope,path,child,i;if(!name){return}else if(Object.prototype.toString.call(name)==="[object Array]"){path=name}else{path=name.split("/")}if(path.length>1){path=path.slice(0);child=this.scope(path.shift());if(path.length){return child.scope(path,data)}}name=path[0];scope=state.children[name];if(scope){if(data){for(i in data){if(data.hasOwnProperty(i)){scope.obj.set(i,data[i])}}}return scope.obj}if(noCreate){return undefined}scope=new Scope(name,state,data);return scope};this.rename=function(name){var oldName;if(state.name===name){return}oldName=state.name;state.name=name;parent.children[name]=state;delete parent.children[oldName];if(options.autosave){if(Array.isArray(options.autosave)){this.clear.apply(this,options.autosave)}else{this.clear(options.autosave)}}else{clearQueue.push({name:oldName,parent:parent})}return this};this.destroy=function(){var i,list;dirty=true;for(i in state.children){if(state.children.hasOwnProperty(i)){state.children[i].obj.destroy();delete state.children[i]}}for(i in state.values){if(state.values.hasOwnProperty(i)){this.clear(i,true)}}for(i in state.observers){if(state.observers.hasOwnProperty(i)){list=state.observers[i];while(list.length){this.unobserve(i,list[0])}}}if(options.autosave){if(Array.isArray(options.autosave)){this.save.apply(this,options.autosave)}else{this.save(options.autosave)}}else{clearQueue.push({name:name,parent:parent})}for(i in this){if(this.hasOwnProperty(i)&&typeof this[i]==="function"){this[i]=nop}}delete parent.children[state.name]};this.save=function(){var args=Array.prototype.slice.call(arguments,0),key;if(!dirty){return this}if(storage.save){args.unshift(state);storage.save.apply(this,args)}dirty=false;for(key in state.children){if(state.children.hasOwnProperty(key)){state.children[key].obj.save.apply(state.children[key].obj,arguments)}}if(!state.parent&&storage.clear){while(clearQueue.length){if(Array.isArray(options.autosave)){this.clear.apply(this,options.autosave)}else{this.clear(options.autosave)}}}return this};this.load=function(){var data;function loadData(scope,data){var i,child,val;for(i in data){if(data.hasOwnProperty(i)){val=data[i];if(val&&typeof val==="object"){child=scope.scope(i);loadData(child,val)}else if(val!==undefined){scope.set(i,val)}}}}if(!storage.load){return}loading=true;data=storage.load.apply(this,arguments);loadData(mainScope,data);dirty=false;loading=false;return this};this.keys=function(index){var i;if(!state.keys){state.keys=[];for(i in state.values){if(state.values.hasOwnProperty(i)&&state.values[i]!==undefined){state.keys.push(i)}}}if(index===undefined){return state.keys.slice(0)}return state.keys[index]};this.children=function(index){if(!state.scopeKeys){state.scopeKeys=Object.keys(state.children)}if(index===undefined){return state.scopeKeys.slice(0)}return state.scopeKeys[index]};Object.defineProperty(this.keys,"count",{get:function(){if(!state.keys){state.keys=Object.keys(state.values)}return state.keys.length}});Object.defineProperty(this.children,"count",{get:function(){if(!state.scopeKeys){state.scopeKeys=Object.keys(state.children)}return state.scopeKeys.length}});if(data){for(i in data){if(data.hasOwnProperty(i)){this.set(i,data[i])}}}}mainScope=new Scope("",scopeData,data);this.name=function(){return""};this.set=function(name,value,temp){mainScope.set(name,value,temp);return this};this.get=function(name){return mainScope.get(name)};this.clear=function(name,blocksave){mainScope.clear(name,blocksave)};this.scope=function(name,data,noCreate){return mainScope.scope(name,data,noCreate)};this.freeze=function(){return mainScope.freeze()};this.unfreeze=function(){return mainScope.unfreeze()};this.frozen=function(){mainScope.frozen()};this.observe=function(name,callback){return mainScope.observe(name,callback)};this.unobserve=function(name,callback){return mainScope.unobserve(name,callback)};this.notify=function(name){return mainScope.notify(name)};this.register=function(name,method){return mainScope.register(name,method)};this.execute=function(){return mainScope.execute.apply(mainScope,arguments)};this.rename=function(){logging.warn("Cannot rename top-level Environment scope.")};this.destroy=function(){mainScope.destroy()};this.save=function(){return mainScope.save.apply(mainScope,arguments)};this.load=function(){return mainScope.load.apply(mainScope,arguments)};this.keys=function(index){return mainScope.keys(index)};this.children=function(index){return mainScope.children(index)};Object.defineProperty(this.keys,"count",{get:function(){return mainScope.keys.count}});if(options.migrate&&options.storage){options.storage.migrate.call(this,typeof options.migrate==="string"?options.migrate:options.autosave)}}Environment.localStorage={move:function(from,to){var i,key,val,newKey,keys=[];try{for(i=0;i<localStorage.length;i++){key=localStorage.key(i);if(from.test(key)){keys.push(key)}}for(i=0;i<keys.length;i++){key=keys[i];val=localStorage.getItem(keys[i]);newKey=key.replace(from,to);if(!localStorage.hasOwnProperty(newKey)){localStorage.setItem(newKey,val);localStorage.removeItem(key)}}}catch(e){return}},migrate:function(name){var version=0,prefix=name+".",len=prefix.length,i,keys=[],key,json,r;try{version=parseFloat(localStorage.getItem((name||"localStorage")+"-version"))}catch(e){return}if(version){return}for(i=0;i<localStorage.length;i++){key=localStorage.key(i);if(key.length>len&&key.substr(0,len)===prefix){keys.push(key)}}r=/\./g;for(i=0;i<keys.length;i++){key=keys[i];try{json=localStorage.getItem(key);localStorage.setItem(key.replace(r,"/"),json);localStorage.removeItem(key)}catch(e){}}try{localStorage.setItem((name||"localStorage")+"-version",1)}catch(e){}},clear:function(state,name){var parent,path,key;parent=state;while(parent&&parent.name){path.unshift(parent.name);parent=parent.parent}path.unshift(name);key=path.join("/");try{localStorage.removeItem(key)}catch(err){}},save:function(state,name){var valueRef,key,data={},parent,path=[],empty=true;for(key in state.values){if(state.values.hasOwnProperty(key)){valueRef=state.values[key];if(valueRef&&!valueRef.temp&&valueRef.owner===state&&valueRef.value!==undefined){try{if(typeof valueRef.value==="object"){JSON.stringify(valueRef.value)}data[key]=valueRef.value;empty=false}catch(e){}}}}parent=state;while(parent&&parent.name){path.unshift(parent.name);parent=parent.parent}path.unshift(name);key=path.join("/");try{if(empty){localStorage.removeItem(key)}else{localStorage.setItem(key,JSON.stringify(data));localStorage.setItem((name||"localStorage")+"-version",1)}}catch(err){}},load:function(name,path,delimiter){var me=this,prefix=name+(delimiter||"/"),len=prefix.length,i,key;function loadKey(key,scope){var json,obj,i;try{json=localStorage.getItem(key)}catch(localStorageError){return}if(json&&json!=="{}"){try{obj=JSON.parse(json);if(scope){me.scope(scope,obj)}else{for(i in obj){if(obj.hasOwnProperty(i)){me.set(i,obj[i])}}}}catch(jsonError){}}}if(!delimiter){delimiter="/"}if(path!==undefined){loadKey(name+(path?delimiter+path:""),path);return}loadKey(name,"");for(i=0;i<localStorage.length;i++){key=localStorage.key(i);if(key.length>len&&key.substr(0,len)===prefix){loadKey(key,key.substr(len))}}}};window.addEventListener("storage",function(evt){},false);return Environment});hy.define("hapyak.player.timer",["logging","configuration","module"],function(logging,configuration,module){var DEFAULT_RUN_INTERVAL=.5,SEEK_FORWARD_THRESHOLD=.5,SEEK_BACKWARD_THRESHOLD=.25,VIDEO_SLICE_COUNT=10;var PLAY_STATES=makeEnum(["INDETERMINATE","PLAYING","PAUSED","SEEK_FORWARD","SEEK_BACKWARD"]);var config=module.config();if(config.ltiContext&&config.ltiContext.resolved_role==="student"){DEFAULT_RUN_INTERVAL=.25}function makeEnum(names){var result={};for(var i=0,l=names.length;i<l;i++){if(result[names[i]]===undefined){result[names[i]]=names[i]}else{logging.error("duplicate name ("+names[i]+") in enum")}}return result}function HapyakPlayerTimer(options){this._running=false;this._timerId=null;this._runIntervalMs=(configuration.player&&configuration.player.runInterval||DEFAULT_RUN_INTERVAL)*1e3;this._previousTimeData={clock:null,playhead:null};this._playTime=0;this._slicePlayTime=this._resetSlicePlayTime();this._currentPlayState=PLAY_STATES.INDETERMINATE;this._previousPlayState=PLAY_STATES.INDETERMINATE;this._timeDataProvider=null;this._duration=null;this._sliceSize=null;logging.dev("Timer Created")}HapyakPlayerTimer.prototype={setTimeDataProvider:function(timeDataProvider){if(typeof timeDataProvider==="function"){this._timeDataProvider=timeDataProvider;return this}else{logging.error("timeDataProvider must be a function")}},setDuration:function(duration){if(duration&&!isNaN(duration)&&typeof duration==="number"){logging.dev("timer: duration="+duration);this._duration=duration;this._sliceSize=this._getSliceSize(duration)}else{duration=Infinity;this._duration=duration;this._sliceSize=this._getSliceSize(duration);logging.warn("invalid duration passed to timer")}},start:function(){logging.dev("starting hapyak.player.timer, interval ("+this._runIntervalMs+"ms)");this._running=true;this._run();return this},stop:function(){this._running=false;if(this._timerId){window.clearInterval(this._timerId)}return this},getPlayTime:function(){return this._playTime},getSlicePlayTime:function(reset){var copy={};for(var key in this._slicePlayTime){copy[key]=this._slicePlayTime[key]}if(reset){this._resetSlicePlayTime()}return copy},getPlayState:function(){return this._currentPlayState},dispose:function(){this.stop()},_run:function(){var that=this;if(that._running){if(that._duration>0){that._update()}that._timerId=window.setTimeout(function nextRun(){that._run()},that._runIntervalMs)}},_update:function(){var currentTimeData=this._getCurrentTimeData(),previousTimeData=this._previousTimeData,playheadDelta=currentTimeData.playhead-previousTimeData.playhead,clockDelta=currentTimeData.clock-previousTimeData.clock;if(previousTimeData!==null){if(playheadDelta>clockDelta+SEEK_FORWARD_THRESHOLD){this._setState(PLAY_STATES.SEEK_FORWARD)}else if(playheadDelta>0){this._setState(PLAY_STATES.PLAYING);this._updatePlayTime(currentTimeData.playhead,previousTimeData.playhead)}else if(playheadDelta===0){this._setState(PLAY_STATES.PAUSED)}else if(playheadDelta<-SEEK_BACKWARD_THRESHOLD){this._setState(PLAY_STATES.SEEK_BACKWARD)}else{this._setState(PLAY_STATES.INDETERMINATE)}}this._previousTimeData=currentTimeData},_updatePlayTime:function(currentTime,previousTime){var playheadDelta=currentTime-previousTime,currentSlice=this._getSliceForTime(currentTime,this._sliceSize),previousSlice=this._getSliceForTime(previousTime,this._sliceSize),boundaryTime=null;if(isNaN(currentSlice)||isNaN(previousSlice)){logging.captureException(new TypeError("currentSlice or previousSlice is NaN. currentTime:"+currentTime+", previousTime:"+previousTime+", sliceSize:"+this._sliceSize+"."));return}this._playTime+=playheadDelta;if(currentSlice===previousSlice){this._slicePlayTime["s"+currentSlice]=Math.ceil((this._slicePlayTime["s"+currentSlice]+playheadDelta)*100)/100}else{logging.dev("before update current slice ("+currentSlice+") = ("+this._slicePlayTime["s"+currentSlice]+")");logging.dev("before update previous slice ("+previousSlice+") = ("+this._slicePlayTime["s"+previousSlice]+")");boundaryTime=this._getTimeForSlice(previousSlice);this._slicePlayTime["s"+currentSlice]=Math.ceil((this._slicePlayTime["s"+currentSlice]+currentTime-boundaryTime)*100)/100;this._slicePlayTime["s"+previousSlice]=Math.ceil((this._slicePlayTime["s"+previousSlice]+boundaryTime-previousTime)*100)/100;logging.dev("currentTime="+currentTime+", previousTime="+previousTime+", boundaryTime="+boundaryTime+", sliceSize="+this._sliceSize);logging.dev("   current slice ("+currentSlice+") = ("+this._slicePlayTime["s"+currentSlice]+") "+"previous slice ("+previousSlice+") = ("+this._slicePlayTime["s"+previousSlice]+")")}},_setState:function(state){if(state!=this._previousPlayState){if(!PLAY_STATES[state]){logging.error("Unknown state ("+state+")")}this._currentPlayState=state;logging.dev("State change: previous ("+this._previousPlayState+"), new ("+this._currentPlayState+")")}this._previousPlayState=this._currentPlayState},_getCurrentTimeData:function(){var data;try{data=this._timeDataProvider()}catch(e){logging.error(e);data={clock:null,playhead:null}}return data},_getSliceSize:function(duration){return duration/VIDEO_SLICE_COUNT},_getSliceForTime:function(time,sliceSize){return Math.min(Math.floor(time/sliceSize)+1,VIDEO_SLICE_COUNT)},_getTimeForSlice:function(slice){return slice*this._sliceSize},_resetSlicePlayTime:function(){logging.dev("[ Reset begin");this._slicePlayTime={};for(var i=1;i<=VIDEO_SLICE_COUNT;i++){this._slicePlayTime["s"+i]=0}logging.dev("] Reset end");return this._slicePlayTime}};return HapyakPlayerTimer});(function(){var nlsRegExp=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;function addPart(locale,master,needed,toLoad,prefix,suffix){if(master[locale]){needed.push(locale);if(master[locale]===true||master[locale]===1){toLoad.push(prefix+locale+"/"+suffix)}}}function addIfExists(req,locale,toLoad,prefix,suffix){var fullName=prefix+locale+"/"+suffix;if(require._fileExists(req.toUrl(fullName+".js"))){toLoad.push(fullName)}}function mixin(target,source,force){var prop;for(prop in source){if(source.hasOwnProperty(prop)&&(!target.hasOwnProperty(prop)||force)){target[prop]=source[prop]}else if(typeof source[prop]==="object"){if(!target[prop]){target[prop]={}}mixin(target[prop],source[prop],force)}}}hy.define("vendor/i18n",["module"],function(module){var masterConfig=module.config?module.config():{};return{version:"2.0.3",load:function(name,req,onLoad,config){config=config||{};if(config.locale){masterConfig.locale=config.locale}var masterName,match=nlsRegExp.exec(name),prefix=match[1],locale=match[4],suffix=match[5],parts=locale.split("-"),toLoad=[],value={},i,part,current="";if(match[5]){prefix=match[1];masterName=prefix+suffix}else{masterName=name;suffix=match[4];locale=masterConfig.locale;if(!locale){locale=masterConfig.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()}parts=locale.split("-")}if(config.isBuild){toLoad.push(masterName);addIfExists(req,"root",toLoad,prefix,suffix);for(i=0;i<parts.length;i++){part=parts[i];current+=(current?"-":"")+part;addIfExists(req,current,toLoad,prefix,suffix)}req(toLoad,function(){onLoad()})}else{req([masterName],function(master){var needed=[],part;addPart("root",master,needed,toLoad,prefix,suffix);for(i=0;i<parts.length;i++){part=parts[i];current+=(current?"-":"")+part;addPart(current,master,needed,toLoad,prefix,suffix)}req(toLoad,function(){var i,partBundle,part;for(i=needed.length-1;i>-1&&needed[i];i--){part=needed[i];partBundle=master[part];if(partBundle===true||partBundle===1){partBundle=req(prefix+part+"/"+suffix)}mixin(value,partBundle)}onLoad(value)})})}}}})})();hy.define("nls/ui",{root:{annotation:{quiz:{actions:{thanks:"Thank you message",link:"Load URL",time:"Jump to video time",track:"Load track ID"},button:{cancel:"Cancel",back:"Back",next:"Next",done:"Done",submit:"Submit",save:"Save",new_choice:"Choice",new_input:"Input",previous_page:"Prev",next_page:"Next",show_answer:"Show Answer",retry:"Retry"},menu:{new_item:{new_question:"Question"},set_option:{menu_label:"Options",randomizeAnswers:"Randomize choices",cancel:"Show cancel button",passFail:"Pass/Fail actions",question:"Answer types",reviewScreen:"Review screen"}},text:{label:{answer:"Correct answer",page:"Page",of:"of",out_of:"out of",correct:"correct",incorrect:"Incorrect"},placeholder:{new_question:"Enter Question",new_choice:"Enter Answer",new_input:"Enter Correct Text Answer"},title:{thanks:"Enter Thank You Text"},warning:{delete_page:"Are you sure you want to delete the current page?"}},dialog:{passFail:{actions:{link:"Load URL",threshold:"Set custom pass/fail threshold",time:"Jump to video time",branch:"Branch to video",branchtime:"Time",branchtimewarning:"This field is used in an experience can only be edited there.",track:"Load track ID",passingMark:"Passing score",reset:"Reset questions",pause:"Pause video on click",javascript:"JavaScript"},tabs:{fail:"On Fail",pass:"On Pass"},title:"Pass/Fail Actions"},onSubmit:{actions:{retry:"Allow retry",show_answer:"Allow viewer to see correct answer(s)",thanks:"Message",review:"Show review screen"},thankYouText:"Review your answers",reviewScreenMessage:"Review screen message",title:"Review Screen"},questions:{actions:{multipleAnswers:"Allow multiple correct choices per question",multipleRequired:"Require all correct answers to be chosen"},title:"Answer Types"}}}},overlay:{common:{button:{cancel:"Cancel",ok:"OK",submit:"Submit"}},action:{chapter_text:{title:"Text"},comment_text:{title:"Text"},delete_annotation:{title:"Delete Annotation",message:"Are you sure you want to delete this annotation?"},set_duration:{title:"Set Duration",text:{label:{maxDuration:"Until the end of the video",infiniteDuration:"Until action",hours:"Hours",minutes:"Minutes",seconds:"Seconds"}}}}}},custom:true});hy.define("utils.hms",["jquery.noconflict"],function($){function formatHmsPart(num){return num<10?"0"+num:num}function formatMilliseconds(millisecs){var ms=Math.abs(millisecs)%1e3;ms=""+ms;ms="000".substring(ms.length)+ms;return ms}var hms={fromSeconds:function(value){var hours=0,minutes=0,seconds=0,milliseconds=0,negative=false;if($.isNumeric(value)){if(value<0){negative=true;value=Math.abs(value)}milliseconds=value%1;seconds=(value-milliseconds)%60;minutes=(value-seconds-milliseconds)/60;if(minutes%60===0){minutes=0}else if(minutes>60){minutes=minutes-Math.floor(value/3600)*60}hours=(value-minutes*60-seconds-milliseconds)/3600;milliseconds=Math.floor(Math.round(milliseconds*1e3))}return{negative:negative,hours:hours,minutes:minutes,seconds:seconds,milliseconds:milliseconds}},toSeconds:function(o){if($.isNumeric(o)){return+o}else if(typeof o!=="object"||!o){return 0}var seconds=($.isNumeric(o.hours)&&+o.hours||0)*3600+($.isNumeric(o.minutes)&&+o.minutes||0)*60+($.isNumeric(o.seconds)&&+o.seconds||0)+($.isNumeric(o.milliseconds)&&+o.milliseconds/1e3||0);if(o.negative){seconds=-seconds}return seconds},toString:function(value){if($.isNumeric(value)){value=hms.fromSeconds(value)}return(value.negative?"-":"")+(value.hours?formatHmsPart(value.hours)+":":"")+formatHmsPart(value.minutes)+":"+formatHmsPart(value.seconds)+"."+formatMilliseconds(value.milliseconds)},fromString:function(value){var timeValues,measuresOfTime=["hours","minutes","seconds"],timeObject={},len;if(value.indexOf("-")===0){value=value.substring(1);timeObject.negative=true}timeValues=value.split(/[.:]/);len=timeValues.length;if(value.indexOf(".")>-1){measuresOfTime.push("milliseconds")}for(;len>0;len--){timeObject[measuresOfTime.pop()]=timeValues.pop()}if(timeObject.milliseconds){timeObject.milliseconds=+("0."+timeObject.milliseconds)*1e3}return timeObject}};return hms});hy.define("hapyak.overlay",["jquery.noconflict","lodash","vendor/i18n!nls/ui","utils.hms","logging","bootstrap.modal"],function($,_,nls,hms,logging){var overlayNls=nls.overlay,durationNls=overlayNls.action.set_duration,modalDOM=$('<div class="hapyak-overlay-modal modal">'+'<div class="modal-dialog">'+'<div class="modal-content">'+'<div class="modal-header">'+'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'+"</div>"+'<div class="modal-body"></div>'+'<div class="modal-footer">'+'<a href="#" data-dismiss="modal" class="btn modal-failure bcov-button-flat">'+_.escape(overlayNls.common.button.cancel)+"</a>"+'<a href="#" class="btn btn-primary modal-success bcov-button">'+_.escape(overlayNls.common.button.ok)+"</a>"+"</div>"+"</div>"+"</div>"+"</div>"),showOptions={backdrop:"static",show:true},setupOptions={},isSetup=false,options,element,confirmModal,durationModal,tabsModal,textInputModal;function centerDialog(){_.forEach([confirmModal,durationModal,tabsModal,textInputModal],function(modal){var elem=modal?modal.el:undefined;if(!elem||!elem.hasClass("in")){return}if(window.innerHeight<=600){if(elem.outerHeight()){elem.css("margin-top","-"+elem.outerHeight()/2+"px")}if(elem.outerWidth()){elem.css("margin-left","-"+elem.outerWidth()/2+"px")}}if(elem.outerHeight()>window.innerHeight){elem.css("overflow-y","scroll")}else{elem.css("overflow-y","visible")}})}function confirm(o){if(!element){return}var body=o.body,message=o.message||"",title=o.title;if(confirmModal){logging.debug("hapyak.overlay [confirm]: Reuse built modal",o);confirmModal.dismissed=true;confirmModal.title.text(title);confirmModal.message.text(message);if(confirmModal.body){confirmModal.body.empty();if(body&&body.callbacks&&typeof body.callbacks.didInsertElement==="function"){body.callbacks.didInsertElement(confirmModal.el)}}confirmModal.callbacks=o.callbacks;confirmModal.el.modal(showOptions);centerDialog();return}logging.debug("hapyak.overlay [confirm]: Create new modal",o);confirmModal={dismissed:true,callbacks:o.callbacks};confirmModal.el=modalDOM.clone().addClass("hapyak-overlay-confirm");confirmModal.title=$('<h3 class="modal-title" />').text(title).appendTo(confirmModal.el.find(".modal-header:first"));if(body){confirmModal.body=$('<section class="active"/>').appendTo(confirmModal.el.find(".modal-body:first"));if(body.callbacks&&typeof body.callbacks.didInsertElement==="function"){body.callbacks.didInsertElement(confirmModal.el)}}confirmModal.message=$('<p class="modal-message" />').text(message).appendTo(confirmModal.el.find(".modal-body:first"));confirmModal.success=confirmModal.el.find(".modal-footer .modal-success:last").click(function(e){e.preventDefault();logging.debug("hapyak.overlay [confirm]: Confirmed");confirmModal.dismissed=false;if(confirmModal.callbacks&&typeof confirmModal.callbacks.success==="function"){confirmModal.callbacks.success()}confirmModal.el.modal("hide")});confirmModal.el.on("hide",function(){if(!confirmModal.dismissed){return}logging.debug("hapyak.overlay [confirm]: Aborted");if(confirmModal.callbacks&&typeof confirmModal.callbacks.failure==="function"){confirmModal.callbacks.failure()}confirmModal.el.remove()});confirmModal.el.modal(showOptions);confirmModal.el.appendTo(element);centerDialog()}function duration(o){if(!element){return}
var title=typeof o.title==="string"&&o.title||durationNls.title,value=typeof o.value==="function"?o.value():o.value,format=typeof o.format==="function"?o.format():o.format,maxValue=typeof o.maxValue==="function"?o.maxValue():o.maxValue,isPause=typeof o.isPause==="function"?o.isPause():o.isPause,parsed;value=$.isNumeric(value)&&value>0&&+value||0;maxValue=$.isNumeric(maxValue)&&maxValue>0&&+maxValue||Number.MAX_VALUE;parsed=hms.fromSeconds(value);if(durationModal){logging.debug("hapyak.overlay [duration]: Reuse built modal",o);durationModal.dismissed=true;durationModal.title.text(title);durationModal.maxDuration.prop("checked",["percent","infinite"].indexOf(format)>-1);durationModal.hours.val(parsed.hours);durationModal.minutes.val(parsed.minutes);durationModal.seconds.val(parsed.seconds+parsed.milliseconds/1e3);durationModal.maxDuration.parent().contents().get(0).nodeValue=_.escape(isPause?durationNls.text.label.infiniteDuration:durationNls.text.label.maxDuration);if(["percent","infinite"].indexOf(format)>-1){durationModal.hoursMinutesSecondsSection.hide()}else{durationModal.hoursMinutesSecondsSection.show()}durationModal.callbacks=o.callbacks;durationModal.el.modal(showOptions);centerDialog();return}logging.debug("hapyak.overlay [duration]: Create new modal",o);durationModal={dismissed:true,callbacks:o.callbacks};durationModal.el=modalDOM.clone().addClass("hapyak-overlay-duration");durationModal.title=$('<h3 class="modal-title" />').text(title).appendTo(durationModal.el.find(".modal-header:first"));durationModal.modalBody=durationModal.el.find(".modal-body:first");durationModal.maxDuration=$('<input type="checkbox" class="modal-checkbox-max"/> ').prop("checked",["percent","infinite"].indexOf(format)>-1).appendTo(durationModal.modalBody).change(function(){durationModal.hoursMinutesSecondsSection.toggle()});durationModal.hoursMinutesSecondsSection=$('<div class="hours-minutes-seconds-section"></div>').appendTo(durationModal.modalBody);durationModal.hours=$('<input class="modal-input-time" />').val(parsed.hours).appendTo(durationModal.hoursMinutesSecondsSection);durationModal.minutes=$('<input class="modal-input-time" />').val(parsed.minutes).appendTo(durationModal.hoursMinutesSecondsSection);durationModal.seconds=$('<input class="modal-input-time" />').val(parsed.seconds+parsed.milliseconds/1e3).appendTo(durationModal.hoursMinutesSecondsSection);durationModal.maxDuration.wrap("<div><label>"+_.escape(isPause?durationNls.text.label.infiniteDuration:durationNls.text.label.maxDuration)+"</label></div>");durationModal.hours.wrap("<label>"+_.escape(durationNls.text.label.hours)+"</label>");durationModal.minutes.wrap("<label>"+_.escape(durationNls.text.label.minutes)+"</label>");durationModal.seconds.wrap("<label>"+_.escape(durationNls.text.label.seconds)+"</label>");if(["percent","infinite"].indexOf(format)>-1){durationModal.hoursMinutesSecondsSection.hide()}durationModal.success=durationModal.el.find(".modal-footer .modal-success:last").text(overlayNls.common.button.submit).click(function(e){e.preventDefault();var duration,format;var pauseIsTrue=durationModal.maxDuration.parent().contents().get(0).nodeValue===durationNls.text.label.infiniteDuration;if(durationModal.maxDuration.is(":checked")){duration=pauseIsTrue?-1:100;format=pauseIsTrue?"infinite":"percent"}else{duration=Math.min(hms.toSeconds({hours:+durationModal.hours.val(),minutes:+durationModal.minutes.val(),seconds:+durationModal.seconds.val()}),maxValue);format="seconds"}logging.debug("hapyak.overlay [duration]: Confirmed",duration,format);durationModal.dismissed=false;if(durationModal.callbacks&&typeof durationModal.callbacks.success==="function"){durationModal.callbacks.success(duration,format)}durationModal.el.modal("hide")});durationModal.el.on("hide",function(){if(!durationModal.dismissed){return}logging.debug("hapyak.overlay [duration]: Aborted");if(durationModal.callbacks&&typeof durationModal.callbacks.failure==="function"){durationModal.callbacks.failure()}durationModal.el.remove()});durationModal.el.modal(showOptions);durationModal.el.appendTo(element);centerDialog()}function textInput(o){if(!element){return}var title=typeof o.title==="string"&&o.title||"Update Text",value=typeof o.value==="function"?o.value():o.value;value=typeof value==="string"&&value||"";if(textInputModal){logging.debug("hapyak.overlay [textInput]: Reuse built modal",o);textInputModal.dismissed=true;textInputModal.title.text(title);textInputModal.input.val(value);textInputModal.callbacks=o.callbacks;textInputModal.el.modal(showOptions);centerDialog();return}logging.debug("hapyak.overlay [textInput]: Create new modal",o);textInputModal={dismissed:true,callbacks:o.callbacks};textInputModal.el=modalDOM.clone().addClass("hapyak-overlay-textinput");textInputModal.title=$('<h3 class="modal-title" />').text(title).appendTo(textInputModal.el.find(".modal-header:first"));textInputModal.input=$('<textarea class="modal-input" />').val(value).appendTo(textInputModal.el.find(".modal-body:first"));textInputModal.success=textInputModal.el.find(".modal-footer .modal-success:last").text("Submit").click(function(e){e.preventDefault();logging.debug("hapyak.overlay [textInput]: Confirmed",textInputModal.input.val());textInputModal.dismissed=false;if(textInputModal.callbacks&&typeof textInputModal.callbacks.success==="function"){textInputModal.callbacks.success(textInputModal.input.val())}textInputModal.el.modal("hide")});textInputModal.el.on("hide",function(){if(!textInputModal.dismissed){return}logging.debug("hapyak.overlay [textInput]: Aborted");if(textInputModal.callbacks&&typeof textInputModal.callbacks.failure==="function"){textInputModal.callbacks.failure()}textInputModal.el.remove()});textInputModal.el.modal(showOptions);textInputModal.el.appendTo(element);centerDialog()}function tabs(o){if(!element){return}var title=typeof o.title==="string"&&o.title||"";function createTabs(){_.each(o.tabs,function(options,index){var tabBody,tabHeader;tabBody=$("<section />").appendTo(tabsModal.body);tabHeader=$('<li class="hapyak-tab"><a><span>'+options.title+"</span></a></li>").appendTo(tabsModal.tabs);if(index===0){tabHeader.addClass("active");tabBody.addClass("active")}tabHeader.on("click",function(){$("li",tabsModal.tabs).removeClass("active");tabHeader.addClass("active");$("section",tabsModal.body).removeClass("active");tabBody.addClass("active");centerDialog()});if(options.callbacks&&typeof options.callbacks.didInsertElement==="function"){options.callbacks.didInsertElement(tabsModal.el)}})}logging.debug("hapyak.overlay [tabs] Create new modal",o);tabsModal={dismissed:true,callbacks:o.callbacks};tabsModal.el=modalDOM.clone().addClass("hapyak-overlay-tabs");tabsModal.body=tabsModal.el.find(".modal-body:first");tabsModal.title=$('<h3 class="modal-title" />').text(title).appendTo(tabsModal.el.find(".modal-header:first"));tabsModal.tabs=$('<ul class="nav nav-tabs" />').appendTo(tabsModal.body);createTabs();tabsModal.success=tabsModal.el.find(".modal-footer .modal-success:last").text("Submit").click(function(e){e.preventDefault();_.each(o.tabs,function(options){if(options.callbacks&&typeof options.callbacks.success==="function"){options.callbacks.success()}});if(tabsModal.callbacks&&typeof tabsModal.callbacks.success==="function"){tabsModal.callbacks.success()}tabsModal.dismissed=false;tabsModal.el.modal("hide")});tabsModal.el.on("hide",function(){if(!tabsModal.dismissed){return}logging.debug("hapyak.overlay [tabs]: Aborted");if(tabsModal.callbacks&&typeof tabsModal.callbacks.failure==="function"){tabsModal.callbacks.failure()}tabsModal.el.remove()});tabsModal.el.modal(showOptions);tabsModal.el.appendTo(element);centerDialog()}return{setup:function(el,o){if(el instanceof HTMLElement){element=$(el)}else{throw new Error("First argument in setup() must be an HTML element")}if(typeof o==="object"){options=$.extend(setupOptions,o)}else if(typeof o!=="undefined"){throw new Error("Second argument in setup() must be an object")}logging.debug("hapyak.overlay: Setup");element.on("click",function(e){e.stopPropagation()});$(window).on("resize",centerDialog);isSetup=true},center:centerDialog,confirm:confirm,duration:duration,tabs:tabs,textInput:textInput}});!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"===typeof hy.define&&hy.define.amd?hy.define("i18next",e):t.i18next=e()}(this,function(){function t(t){return null==t?"":""+t}function e(t,e,n){t.forEach(function(t){e[t]&&(n[t]=e[t])})}function n(t,e,n){function o(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}function r(){return!t||"string"==typeof t}for(var i="string"!=typeof e?[].concat(e):e.split(".");i.length>1;){if(r())return{};var s=o(i.shift());!t[s]&&n&&(t[s]=new n),t=t[s]}return r()?{}:{obj:t,k:o(i.shift())}}function o(t,e,o){var r=n(t,e,Object),i=r.obj,s=r.k;i[s]=o}function r(t,e,o,r){var i=n(t,e,Object),s=i.obj,a=i.k;s[a]=s[a]||[],r&&(s[a]=s[a].concat(o)),r||s[a].push(o)}function i(t,e){var o=n(t,e),r=o.obj,i=o.k;if(r)return r[i]}function s(t,e,n){for(var o in e)o in t?"string"==typeof t[o]||t[o]instanceof String||"string"==typeof e[o]||e[o]instanceof String?n&&(t[o]=e[o]):s(t[o],e[o],n):t[o]=e[o];return t}function a(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function l(t){return"string"==typeof t?t.replace(/[&<>"'\/]/g,function(t){return R[t]}):t}function u(t){return t.charAt(0).toUpperCase()+t.slice(1)}function c(){var t={};return P.forEach(function(e){e.lngs.forEach(function(n){t[n]={numbers:e.nr,plurals:A[e.fc]}})}),t}function p(t,e){for(var n=t.indexOf(e);n!==-1;)t.splice(n,1),n=t.indexOf(e)}function f(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(t){var e={};return t[1]&&(e.defaultValue=t[1]),t[2]&&(e.tDescription=t[2]),e},interpolation:{escapeValue:!0,format:function(t,e,n){return t},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",maxReplaces:1e3}}}function g(t){return"string"==typeof t.ns&&(t.ns=[t.ns]),"string"==typeof t.fallbackLng&&(t.fallbackLng=[t.fallbackLng]),"string"==typeof t.fallbackNS&&(t.fallbackNS=[t.fallbackNS]),t.whitelist&&t.whitelist.indexOf("cimode")<0&&(t.whitelist=t.whitelist.concat(["cimode"])),t}function h(){}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},m=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},b=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},x=function(){function t(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},S={type:"logger",log:function(t){this.output("log",t)},warn:function(t){this.output("warn",t)},error:function(t){this.output("error",t)},output:function(t,e){var n;console&&console[t]&&(n=console)[t].apply(n,k(e))}},w=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(this,t),this.init(e,n)}return t.prototype.init=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=e.prefix||"i18next:",this.logger=t||S,this.options=e,this.debug=e.debug},t.prototype.setDebug=function(t){this.debug=t},t.prototype.log=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"log","",!0)},t.prototype.warn=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"warn","",!0)},t.prototype.error=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"error","")},t.prototype.deprecate=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"warn","WARNING DEPRECATED: ",!0)},t.prototype.forward=function(t,e,n,o){return o&&!this.debug?null:("string"==typeof t[0]&&(t[0]=""+n+this.prefix+" "+t[0]),this.logger[e](t))},t.prototype.create=function(e){return new t(this.logger,y({prefix:this.prefix+":"+e+":"},this.options))},t}(),O=new w,L=function(){function t(){v(this,t),this.observers={}}return t.prototype.on=function(t,e){var n=this;t.split(" ").forEach(function(t){n.observers[t]=n.observers[t]||[],n.observers[t].push(e)})},t.prototype.off=function(t,e){var n=this;this.observers[t]&&this.observers[t].forEach(function(){if(e){var o=n.observers[t].indexOf(e);o>-1&&n.observers[t].splice(o,1)}else delete n.observers[t]})},t.prototype.emit=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];if(this.observers[t]){var r=[].concat(this.observers[t]);r.forEach(function(t){t.apply(void 0,n)})}if(this.observers["*"]){var i=[].concat(this.observers["*"]);i.forEach(function(e){var o;e.apply(e,(o=[t]).concat.apply(o,n))})}},t}(),R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},j=function(t){function e(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};v(this,e);var r=b(this,t.call(this));return r.data=n||{},r.options=o,r}return m(e,t),e.prototype.addNamespaces=function(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)},e.prototype.removeNamespaces=function(t){var e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)},e.prototype.getResource=function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=o.keySeparator||this.options.keySeparator;void 0===r&&(r=".");var s=[t,e];return n&&"string"!=typeof n&&(s=s.concat(n)),n&&"string"==typeof n&&(s=s.concat(r?n.split(r):n)),t.indexOf(".")>-1&&(s=t.split(".")),i(this.data,s)},e.prototype.addResource=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},s=this.options.keySeparator;void 0===s&&(s=".");var a=[t,e];n&&(a=a.concat(s?n.split(s):n)),t.indexOf(".")>-1&&(a=t.split("."),r=e,e=a[1]),this.addNamespaces(e),o(this.data,a,r),i.silent||this.emit("added",t,e,n,r)},e.prototype.addResources=function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var r in n)"string"==typeof n[r]&&this.addResource(t,e,r,n[r],{silent:!0});o.silent||this.emit("added",t,e,n)},e.prototype.addResourceBundle=function(t,e,n,r,a){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},u=[t,e];t.indexOf(".")>-1&&(u=t.split("."),r=n,n=e,e=u[1]),this.addNamespaces(e);var c=i(this.data,u)||{};r?s(c,n,a):c=y({},c,n),o(this.data,u,c),l.silent||this.emit("added",t,e,n)},e.prototype.removeResourceBundle=function(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)},e.prototype.hasResourceBundle=function(t,e){return void 0!==this.getResource(t,e)},e.prototype.getResourceBundle=function(t,e){return e||(e=this.options.defaultNS),"v1"===this.options.compatibilityAPI?y({},this.getResource(t,e)):this.getResource(t,e)},e.prototype.toJSON=function(){return this.data},e}(L),C={processors:{},addPostProcessor:function(t){this.processors[t.name]=t},handle:function(t,e,n,o,r){var i=this;return t.forEach(function(t){i.processors[t]&&(e=i.processors[t].process(e,n,o,r))}),e}},N=function(t){function n(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(this,n);var i=b(this,t.call(this));return e(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector"],o,i),i.options=r,i.logger=O.create("translator"),i}return m(n,t),n.prototype.changeLanguage=function(t){t&&(this.language=t)},n.prototype.exists=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},n=this.resolve(t,e);return n&&void 0!==n.res},n.prototype.extractFromKey=function(t,e){var n=e.nsSeparator||this.options.nsSeparator;void 0===n&&(n=":");var o=e.keySeparator||this.options.keySeparator||".",r=e.ns||this.options.defaultNS;if(n&&t.indexOf(n)>-1){var i=t.split(n);(n!==o||n===o&&this.options.ns.indexOf(i[0])>-1)&&(r=i.shift()),t=i.join(o)}return"string"==typeof r&&(r=[r]),{key:t,namespaces:r}},n.prototype.translate=function(t,e){var n=this;if("object"!==("undefined"==typeof e?"undefined":d(e))&&this.options.overloadTranslationOptionHandler&&(e=this.options.overloadTranslationOptionHandler(arguments)),e||(e={}),void 0===t||null===t||""===t)return"";"number"==typeof t&&(t=String(t)),"string"==typeof t&&(t=[t]);var o=e.keySeparator||this.options.keySeparator||".",r=this.extractFromKey(t[t.length-1],e),i=r.key,s=r.namespaces,a=s[s.length-1],l=e.lng||this.language,u=e.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l&&"cimode"===l.toLowerCase()){if(u){var c=e.nsSeparator||this.options.nsSeparator;return a+c+i}return i}var p=this.resolve(t,e),f=p&&p.res,g=p&&p.usedKey||i,h=Object.prototype.toString.apply(f),v=["[object Number]","[object Function]","[object RegExp]"],m=void 0!==e.joinArrays?e.joinArrays:this.options.joinArrays,b="string"!=typeof f&&"boolean"!=typeof f&&"number"!=typeof f;if(f&&b&&v.indexOf(h)<0&&(!m||"[object Array]"!==h)){if(!e.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,f,e):"key '"+i+" ("+this.language+")' returned an object instead of string.";if(e.keySeparator||this.options.keySeparator){var x="[object Array]"===h?[]:{};for(var k in f)if(Object.prototype.hasOwnProperty.call(f,k)){var S=""+g+o+k;x[k]=this.translate(S,y({},e,{joinArrays:!1,ns:s})),x[k]===S&&(x[k]=f[k])}f=x}}else if(m&&"[object Array]"===h)f=f.join(m),f&&(f=this.extendTranslation(f,t,e));else{var w=!1,O=!1;this.isValidLookup(f)||void 0===e.defaultValue||(w=!0,f=e.defaultValue),this.isValidLookup(f)||(O=!0,f=i);var L=e.defaultValue&&e.defaultValue!==f&&this.options.updateMissing;if(O||w||L){this.logger.log(L?"updateKey":"missingKey",l,a,i,L?e.defaultValue:f);var R=[],j=this.languageUtils.getFallbackCodes(this.options.fallbackLng,e.lng||this.language);if("fallback"===this.options.saveMissingTo&&j&&j[0])for(var C=0;C<j.length;C++)R.push(j[C]);else"all"===this.options.saveMissingTo?R=this.languageUtils.toResolveHierarchy(e.lng||this.language):R.push(e.lng||this.language);var N=function(t,o){n.options.missingKeyHandler?n.options.missingKeyHandler(t,a,o,L?e.defaultValue:f,L,e):n.backendConnector&&n.backendConnector.saveMissing&&n.backendConnector.saveMissing(t,a,o,L?e.defaultValue:f,L,e),n.emit("missingKey",t,a,o,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&e.count?R.forEach(function(t){var e=n.pluralResolver.getPluralFormsOfKey(t,i);e.forEach(function(e){return N([t],e)})}):N(R,i))}f=this.extendTranslation(f,t,e),O&&f===i&&this.options.appendNamespaceToMissingKey&&(f=a+":"+i),O&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(f))}return f},n.prototype.extendTranslation=function(t,e,n){var o=this;n.interpolation&&this.interpolator.init(y({},n,{interpolation:y({},this.options.interpolation,n.interpolation)}));var r=n.replace&&"string"!=typeof n.replace?n.replace:n;this.options.interpolation.defaultVariables&&(r=y({},this.options.interpolation.defaultVariables,r)),t=this.interpolator.interpolate(t,r,n.lng||this.language),n.nest!==!1&&(t=this.interpolator.nest(t,function(){return o.translate.apply(o,arguments)},n)),n.interpolation&&this.interpolator.reset();var i=n.postProcess||this.options.postProcess,s="string"==typeof i?[i]:i;return void 0!==t&&null!==t&&s&&s.length&&n.applyPostProcessor!==!1&&(t=C.handle(s,t,e,n,this)),t},n.prototype.resolve=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=void 0,r=void 0;return"string"==typeof t&&(t=[t]),t.forEach(function(t){if(!e.isValidLookup(o)){var i=e.extractFromKey(t,n),s=i.key;r=s;var a=i.namespaces;e.options.fallbackNS&&(a=a.concat(e.options.fallbackNS));var l=void 0!==n.count&&"string"!=typeof n.count,u=void 0!==n.context&&"string"==typeof n.context&&""!==n.context,c=n.lngs?n.lngs:e.languageUtils.toResolveHierarchy(n.lng||e.language);a.forEach(function(t){e.isValidLookup(o)||c.forEach(function(r){if(!e.isValidLookup(o)){var i=s,a=[i],c=void 0;l&&(c=e.pluralResolver.getSuffix(r,n.count)),l&&u&&a.push(i+c),u&&a.push(i+=""+e.options.contextSeparator+n.context),l&&a.push(i+=c);for(var p=void 0;p=a.pop();)e.isValidLookup(o)||(o=e.getResource(r,t,p,n))}})})}}),{res:o,usedKey:r}},n.prototype.isValidLookup=function(t){return!(void 0===t||!this.options.returnNull&&null===t||!this.options.returnEmptyString&&""===t)},n.prototype.getResource=function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.resourceStore.getResource(t,e,n,o)},n}(L),E=function(){function t(e){v(this,t),this.options=e,this.whitelist=this.options.whitelist||!1,this.logger=O.create("languageUtils")}return t.prototype.getScriptPartFromCode=function(t){if(!t||t.indexOf("-")<0)return null;var e=t.split("-");return 2===e.length?null:(e.pop(),this.formatLanguageCode(e.join("-")))},t.prototype.getLanguagePartFromCode=function(t){if(!t||t.indexOf("-")<0)return t;var e=t.split("-");return this.formatLanguageCode(e[0])},t.prototype.formatLanguageCode=function(t){if("string"==typeof t&&t.indexOf("-")>-1){var e=["hans","hant","latn","cyrl","cans","mong","arab"],n=t.split("-");return this.options.lowerCaseLng?n=n.map(function(t){return t.toLowerCase()}):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),e.indexOf(n[1].toLowerCase())>-1&&(n[1]=u(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),e.indexOf(n[1].toLowerCase())>-1&&(n[1]=u(n[1].toLowerCase())),e.indexOf(n[2].toLowerCase())>-1&&(n[2]=u(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t},t.prototype.isWhitelisted=function(t){return("languageOnly"===this.options.load||this.options.nonExplicitWhitelist)&&(t=this.getLanguagePartFromCode(t)),!this.whitelist||!this.whitelist.length||this.whitelist.indexOf(t)>-1},t.prototype.getFallbackCodes=function(t,e){if(!t)return[];if("string"==typeof t&&(t=[t]),"[object Array]"===Object.prototype.toString.apply(t))return t;if(!e)return t.default||[];var n=t[e];return n||(n=t[this.getScriptPartFromCode(e)]),n||(n=t[this.formatLanguageCode(e)]),n||(n=t.default),n||[]},t.prototype.toResolveHierarchy=function(t,e){var n=this,o=this.getFallbackCodes(e||this.options.fallbackLng||[],t),r=[],i=function(t){t&&(n.isWhitelisted(t)?r.push(t):n.logger.warn("rejecting non-whitelisted language code: "+t))};return"string"==typeof t&&t.indexOf("-")>-1?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(t)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(t)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(t))):"string"==typeof t&&i(this.formatLanguageCode(t)),o.forEach(function(t){r.indexOf(t)<0&&i(n.formatLanguageCode(t))}),r},t}(),P=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","he","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21}],A={1:function(t){return Number(t>1)},2:function(t){return Number(1!=t)},3:function(t){return 0},4:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},5:function(t){return Number(0===t?0:1==t?1:2==t?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5)},6:function(t){return Number(1==t?0:t>=2&&t<=4?1:2)},7:function(t){return Number(1==t?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},8:function(t){return Number(1==t?0:2==t?1:8!=t&&11!=t?2:3)},9:function(t){return Number(t>=2)},10:function(t){return Number(1==t?0:2==t?1:t<7?2:t<11?3:4)},11:function(t){return Number(1==t||11==t?0:2==t||12==t?1:t>2&&t<20?2:3)},12:function(t){return Number(t%10!=1||t%100==11)},13:function(t){return Number(0!==t)},14:function(t){return Number(1==t?0:2==t?1:3==t?2:3)},15:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2)},16:function(t){return Number(t%10==1&&t%100!=11?0:0!==t?1:2)},17:function(t){return Number(1==t||t%10==1?0:1)},18:function(t){return Number(0==t?0:1==t?1:2)},19:function(t){return Number(1==t?0:0===t||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3)},20:function(t){return Number(1==t?0:0===t||t%100>0&&t%100<20?1:2)},21:function(t){return Number(t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0)}},M=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(this,t),this.languageUtils=e,this.options=n,this.logger=O.create("pluralResolver"),this.rules=c()}return t.prototype.addRule=function(t,e){this.rules[t]=e},t.prototype.getRule=function(t){return this.rules[t]||this.rules[this.languageUtils.getLanguagePartFromCode(t)]},t.prototype.needsPlural=function(t){var e=this.getRule(t);return e&&e.numbers.length>1},t.prototype.getPluralFormsOfKey=function(t,e){var n=this,o=[],r=this.getRule(t);return r?(r.numbers.forEach(function(r){var i=n.getSuffix(t,r);o.push(""+e+i)}),o):o},t.prototype.getSuffix=function(t,e){var n=this,o=this.getRule(t);if(o){var r=o.noAbs?o.plurals(e):o.plurals(Math.abs(e)),i=o.numbers[r];this.options.simplifyPluralSuffix&&2===o.numbers.length&&1===o.numbers[0]&&(2===i?i="plural":1===i&&(i=""));var s=function(){return n.options.prepend&&i.toString()?n.options.prepend+i.toString():i.toString()};return"v1"===this.options.compatibilityJSON?1===i?"":"number"==typeof i?"_plural_"+i.toString():s():"v2"===this.options.compatibilityJSON||2===o.numbers.length&&1===o.numbers[0]?s():2===o.numbers.length&&1===o.numbers[0]?s():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}return this.logger.warn("no plural rule found for: "+t),""},t}(),U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v(this,e),this.logger=O.create("interpolator"),this.init(t,!0)}return e.prototype.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];e&&(this.options=t,this.format=t.interpolation&&t.interpolation.format||function(t){return t},this.escape=t.interpolation&&t.interpolation.escape||l),t.interpolation||(t.interpolation={escapeValue:!0});var n=t.interpolation;this.escapeValue=void 0===n.escapeValue||n.escapeValue,this.prefix=n.prefix?a(n.prefix):n.prefixEscaped||"{{",this.suffix=n.suffix?a(n.suffix):n.suffixEscaped||"}}",this.formatSeparator=n.formatSeparator?n.formatSeparator:n.formatSeparator||",",this.unescapePrefix=n.unescapeSuffix?"":n.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":n.unescapeSuffix||"",this.nestingPrefix=n.nestingPrefix?a(n.nestingPrefix):n.nestingPrefixEscaped||a("$t("),this.nestingSuffix=n.nestingSuffix?a(n.nestingSuffix):n.nestingSuffixEscaped||a(")"),this.maxReplaces=n.maxReplaces?n.maxReplaces:1e3,this.resetRegExp()},e.prototype.reset=function(){this.options&&this.init(this.options)},e.prototype.resetRegExp=function(){var t=this.prefix+"(.+?)"+this.suffix;this.regexp=new RegExp(t,"g");var e=""+this.prefix+this.unescapePrefix+"(.+?)"+this.unescapeSuffix+this.suffix;this.regexpUnescape=new RegExp(e,"g");var n=this.nestingPrefix+"(.+?)"+this.nestingSuffix;this.nestingRegexp=new RegExp(n,"g")},e.prototype.interpolate=function(e,n,o){function r(t){return t.replace(/\$/g,"$$$$")}var s=this,a=void 0,l=void 0,u=void 0,c=function(t){if(t.indexOf(s.formatSeparator)<0)return i(n,t);var e=t.split(s.formatSeparator),r=e.shift().trim(),a=e.join(s.formatSeparator).trim();return s.format(i(n,r),a,o)};for(this.resetRegExp(),u=0;(a=this.regexpUnescape.exec(e))&&(l=c(a[1].trim()),e=e.replace(a[0],l),this.regexpUnescape.lastIndex=0,u++,!(u>=this.maxReplaces)););for(u=0;a=this.regexp.exec(e);){if(l=c(a[1].trim()),"string"!=typeof l&&(l=t(l)),!l)if("function"==typeof this.options.missingInterpolationHandler){var p=this.options.missingInterpolationHandler(e,a);l="string"==typeof p?p:""}else this.logger.warn("missed to pass in variable "+a[1]+" for interpolating "+e),l="";if(l=r(this.escapeValue?this.escape(l):l),e=e.replace(a[0],l),this.regexp.lastIndex=0,u++,u>=this.maxReplaces)break}return e},e.prototype.nest=function(e,n){function o(t,e){if(t.indexOf(",")<0)return t;var n=t.split(",");t=n.shift();var o=n.join(",");o=this.interpolate(o,a),o=o.replace(/'/g,'"');try{a=JSON.parse(o),e&&(a=y({},e,a))}catch(e){this.logger.error("failed parsing options string in nesting for key "+t,e)}return t}var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=void 0,s=void 0,a=y({},r);for(a.applyPostProcessor=!1;i=this.nestingRegexp.exec(e);){if(s=n(o.call(this,i[1].trim(),a),a),s&&i[0]===e&&"string"!=typeof s)return s;"string"!=typeof s&&(s=t(s)),s||(this.logger.warn("missed to resolve "+i[1]+" for nesting "+e),s=""),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e},e}(),H=function(t){function e(n,o,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};v(this,e);var s=b(this,t.call(this));return s.backend=n,s.store=o,s.languageUtils=r.languageUtils,s.options=i,s.logger=O.create("backendConnector"),s.state={},s.queue=[],s.backend&&s.backend.init&&s.backend.init(r,i.backend,i),s}return m(e,t),e.prototype.queueLoad=function(t,e,n){var o=this,r=[],i=[],s=[],a=[];return t.forEach(function(t){var n=!0;e.forEach(function(e){
var s=t+"|"+e;o.store.hasResourceBundle(t,e)?o.state[s]=2:o.state[s]<0||(1===o.state[s]?i.indexOf(s)<0&&i.push(s):(o.state[s]=1,n=!1,i.indexOf(s)<0&&i.push(s),r.indexOf(s)<0&&r.push(s),a.indexOf(e)<0&&a.push(e)))}),n||s.push(t)}),(r.length||i.length)&&this.queue.push({pending:i,loaded:{},errors:[],callback:n}),{toLoad:r,pending:i,toLoadLanguages:s,toLoadNamespaces:a}},e.prototype.loaded=function(t,e,n){var o=this,i=t.split("|"),s=x(i,2),a=s[0],l=s[1];e&&this.emit("failedLoading",a,l,e),n&&this.store.addResourceBundle(a,l,n),this.state[t]=e?-1:2,this.queue.forEach(function(n){r(n.loaded,[a],l),p(n.pending,t),e&&n.errors.push(e),0!==n.pending.length||n.done||(o.emit("loaded",n.loaded),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.queue=this.queue.filter(function(t){return!t.done})},e.prototype.read=function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:250,s=arguments[5];return t.length?this.backend[n](t,e,function(a,l){return a&&l&&o<5?void setTimeout(function(){r.read.call(r,t,e,n,o+1,2*i,s)},i):void s(a,l)}):s(null,{})},e.prototype.load=function(t,e,n){var o=this;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();var r=y({},this.backend.options,this.options.backend);"string"==typeof t&&(t=this.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]);var s=this.queueLoad(t,e,n);return s.toLoad.length?void(r.allowMultiLoading&&this.backend.readMulti?this.read(s.toLoadLanguages,s.toLoadNamespaces,"readMulti",null,null,function(t,e){t&&o.logger.warn("loading namespaces "+s.toLoadNamespaces.join(", ")+" for languages "+s.toLoadLanguages.join(", ")+" via multiloading failed",t),!t&&e&&o.logger.log("successfully loaded namespaces "+s.toLoadNamespaces.join(", ")+" for languages "+s.toLoadLanguages.join(", ")+" via multiloading",e),s.toLoad.forEach(function(n){var r=n.split("|"),s=x(r,2),a=s[0],l=s[1],u=i(e,[a,l]);if(u)o.loaded(n,t,u);else{var c="loading namespace "+l+" for language "+a+" via multiloading failed";o.loaded(n,c),o.logger.error(c)}})}):s.toLoad.forEach(function(t){o.loadOne(t)})):(s.pending.length||n(),null)},e.prototype.reload=function(t,e){var n=this;this.backend||this.logger.warn("No backend was added via i18next.use. Will not load resources.");var o=y({},this.backend.options,this.options.backend);"string"==typeof t&&(t=this.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]),o.allowMultiLoading&&this.backend.readMulti?this.read(t,e,"readMulti",null,null,function(o,r){o&&n.logger.warn("reloading namespaces "+e.join(", ")+" for languages "+t.join(", ")+" via multiloading failed",o),!o&&r&&n.logger.log("successfully reloaded namespaces "+e.join(", ")+" for languages "+t.join(", ")+" via multiloading",r),t.forEach(function(t){e.forEach(function(e){var s=i(r,[t,e]);if(s)n.loaded(t+"|"+e,o,s);else{var a="reloading namespace "+e+" for language "+t+" via multiloading failed";n.loaded(t+"|"+e,a),n.logger.error(a)}})})}):t.forEach(function(t){e.forEach(function(e){n.loadOne(t+"|"+e,"re")})})},e.prototype.loadOne=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=t.split("|"),r=x(o,2),i=r[0],s=r[1];this.read(i,s,"read",null,null,function(o,r){o&&e.logger.warn(n+"loading namespace "+s+" for language "+i+" failed",o),!o&&r&&e.logger.log(n+"loaded namespace "+s+" for language "+i,r),e.loaded(t,o,r)})},e.prototype.saveMissing=function(t,e,n,o,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.backend&&this.backend.create&&this.backend.create(t,e,n,o,null,y({},i,{isUpdate:r})),t&&t[0]&&this.store.addResource(t[0],e,n,o)},e}(L),T=function(t){function e(n,o,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};v(this,e);var s=b(this,t.call(this));return s.cache=n,s.store=o,s.services=r,s.options=i,s.logger=O.create("cacheConnector"),s.cache&&s.cache.init&&s.cache.init(r,i.cache,i),s}return m(e,t),e.prototype.load=function(t,e,n){var o=this;if(!this.cache)return n&&n();var r=y({},this.cache.options,this.options.cache),i="string"==typeof t?this.services.languageUtils.toResolveHierarchy(t):t;r.enabled?this.cache.load(i,function(t,e){if(t&&o.logger.error("loading languages "+i.join(", ")+" from cache failed",t),e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))for(var s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&"i18nStamp"!==s){var a=e[r][s];a&&o.store.addResourceBundle(r,s,a)}n&&n()}):n&&n()},e.prototype.save=function(){this.cache&&this.options.cache&&this.options.cache.enabled&&this.cache.save(this.store.data)},e}(L),V=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments[1];v(this,e);var r=b(this,t.call(this));if(r.options=g(n),r.services={},r.logger=O,r.modules={external:[]},o&&!r.isInitialized&&!n.isClone){var i;if(!r.options.initImmediate)return i=r.init(n,o),b(r,i);setTimeout(function(){r.init(n,o)},0)}return r}return m(e,t),e.prototype.init=function(){function t(t){return t?"function"==typeof t?new t:t:null}var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments[1];if("function"==typeof n&&(o=n,n={}),this.options=y({},f(),this.options,g(n)),this.format=this.options.interpolation.format,o||(o=h),!this.options.isClone){this.modules.logger?O.init(t(this.modules.logger),this.options):O.init(null,this.options);var r=new E(this.options);this.store=new j(this.options.resources,this.options);var i=this.services;i.logger=O,i.resourceStore=this.store,i.resourceStore.on("added removed",function(t,e){i.cacheConnector.save()}),i.languageUtils=r,i.pluralResolver=new M(r,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),i.interpolator=new U(this.options),i.backendConnector=new H(t(this.modules.backend),i.resourceStore,i,this.options),i.backendConnector.on("*",function(t){for(var n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];e.emit.apply(e,[t].concat(o))}),i.backendConnector.on("loaded",function(t){i.cacheConnector.save()}),i.cacheConnector=new T(t(this.modules.cache),i.resourceStore,i,this.options),i.cacheConnector.on("*",function(t){for(var n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];e.emit.apply(e,[t].concat(o))}),this.modules.languageDetector&&(i.languageDetector=t(this.modules.languageDetector),i.languageDetector.init(i,this.options.detection,this.options)),this.translator=new N(this.services,this.options),this.translator.on("*",function(t){for(var n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];e.emit.apply(e,[t].concat(o))}),this.modules.external.forEach(function(t){t.init&&t.init(e)})}var s=["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle"];s.forEach(function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}});var a=function(){e.changeLanguage(e.options.lng,function(t,n){e.isInitialized=!0,e.logger.log("initialized",e.options),e.emit("initialized",e.options),o(t,n)})};return this.options.resources||!this.options.initImmediate?a():setTimeout(a,0),this},e.prototype.loadResources=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h;if(this.options.resources)e(null);else{if(this.language&&"cimode"===this.language.toLowerCase())return e();var n=[],o=function(e){if(e){var o=t.services.languageUtils.toResolveHierarchy(e);o.forEach(function(t){n.indexOf(t)<0&&n.push(t)})}};if(this.language)o(this.language);else{var r=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);r.forEach(function(t){return o(t)})}this.options.preload&&this.options.preload.forEach(function(t){return o(t)}),this.services.cacheConnector.load(n,this.options.ns,function(){t.services.backendConnector.load(n,t.options.ns,e)})}},e.prototype.reloadResources=function(t,e){t||(t=this.languages),e||(e=this.options.ns),this.services.backendConnector.reload(t,e)},e.prototype.use=function(t){return"backend"===t.type&&(this.modules.backend=t),"cache"===t.type&&(this.modules.cache=t),("logger"===t.type||t.log&&t.warn&&t.error)&&(this.modules.logger=t),"languageDetector"===t.type&&(this.modules.languageDetector=t),"postProcessor"===t.type&&C.addPostProcessor(t),"3rdParty"===t.type&&this.modules.external.push(t),this},e.prototype.changeLanguage=function(t,e){var n=this,o=function(t,o){n.translator.changeLanguage(o),o&&(n.emit("languageChanged",o),n.logger.log("languageChanged",o)),e&&e(t,function(){return n.t.apply(n,arguments)})},r=function(t){t&&(n.language=t,n.languages=n.services.languageUtils.toResolveHierarchy(t),n.translator.language||n.translator.changeLanguage(t),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(t)),n.loadResources(function(e){o(e,t)})};t||!this.services.languageDetector||this.services.languageDetector.async?!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(r):r(t):r(this.services.languageDetector.detect())},e.prototype.getFixedT=function(t,e){var n=this,o=function t(e,o){for(var r=arguments.length,i=Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];var a=y({},o);return"object"!==("undefined"==typeof o?"undefined":d(o))&&(a=n.options.overloadTranslationOptionHandler([e,o].concat(i))),a.lng=a.lng||t.lng,a.lngs=a.lngs||t.lngs,a.ns=a.ns||t.ns,n.t(e,a)};return"string"==typeof t?o.lng=t:o.lngs=t,o.ns=e,o},e.prototype.t=function(){var t;return this.translator&&(t=this.translator).translate.apply(t,arguments)},e.prototype.exists=function(){var t;return this.translator&&(t=this.translator).exists.apply(t,arguments)},e.prototype.setDefaultNamespace=function(t){this.options.defaultNS=t},e.prototype.loadNamespaces=function(t,e){var n=this;return this.options.ns?("string"==typeof t&&(t=[t]),t.forEach(function(t){n.options.ns.indexOf(t)<0&&n.options.ns.push(t)}),void this.loadResources(e)):e&&e()},e.prototype.loadLanguages=function(t,e){"string"==typeof t&&(t=[t]);var n=this.options.preload||[],o=t.filter(function(t){return n.indexOf(t)<0});return o.length?(this.options.preload=n.concat(o),void this.loadResources(e)):e()},e.prototype.dir=function(t){if(t||(t=this.languages&&this.languages.length>0?this.languages[0]:this.language),!t)return"rtl";var e=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"];return e.indexOf(this.services.languageUtils.getLanguagePartFromCode(t))>=0?"rtl":"ltr"},e.prototype.createInstance=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return new e(t,n)},e.prototype.cloneInstance=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,r=y({},this.options,n,{isClone:!0}),i=new e(r),s=["store","services","language"];return s.forEach(function(e){i[e]=t[e]}),i.translator=new N(i.services,i.options),i.translator.on("*",function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];i.emit.apply(i,[t].concat(n))}),i.init(r,o),i.translator.options=i.options,i},e}(L),F=new V;return F});hy.define("i18.en",[],function(){return{srclang:"en",resources:{annotation:{}}}});hy.define("i18.zh",[],function(){return{srclang:"zh",resources:{annotation:{quiz:{button:{cancel:"跳过测验",back:"上一题",next:"下一题",done:"完成",submit:"发送",show_answer:"显示答案",retry:"重试",save:"保存",new_choice:"新的选择",new_input:"新输入",previous_page:"以前",next_page:"下一个"},text:{label:{answer:"答案",page:"页",of:"of",out_of:"out of",correct:"正确"}}}}}}});hy.define("i18.pt",[],function(){return{srclang:"pt",resources:{annotation:{quiz:{actions:{thanks:"Obrigado pela sua mensagem",link:"Carregue URL",time:"Pule para o tempo do vídeo",track:"Carregar faixa ID"},button:{cancel:"Cancelar",back:"Voltar",next:"Próximo",done:"Fim",submit:"Submeter",save:"Salvar",new_choice:"Escolha",new_input:"Input",previous_page:"Prev",next_page:"Próximo",show_answer:"Mostrar resposta",retry:"Tente novamente "},menu:{new_item:{new_question:"Pergunta"},set_option:{menu_label:"Opções",cancel:"Mostrar o botão de cancelar",passFail:"Passar/Falhou ações",submit:"Submeter",question:"Tipos de Resposta",reviewScreen:"Revisar tela"}},text:{label:{answer:"Resposta",page:"Página",of:"de",out_of:"fora de",correct:"correto",incorrect:"incorreto"},placeholder:{new_question:"Insira Pergunta",new_choice:"Insira Resposta",new_input:"Insira Texto Resposta Correto"},title:{thanks:"Insiro Texto de Agradecimento"},warning:{delete_page:"Tem certeza que quer deletar a página atual?"}},dialog:{passFail:{actions:{link:"Carregar URL",threshold:"Definir limite passar/falhou customizado",time:"Pule para o tempo do vídeo",track:"Carregar faixa ID",passingMark:"Passando ponto",reset:"Resetar perguntas",pause:"Pausar video ao clicar",javascript:"JavaScript"},tabs:{fail:"Falhou",pass:"Ao Passar"},title:"Passar/falhou Ações"},onSubmit:{actions:{retry:"Permitir tentar novamente",show_answer:"Permitir espectador ver resposta(s) correta",thanks:"Mensagem",review:"Mostrar tela de revisão"},title:"Revisão tela"},questions:{actions:{multipleAnswers:"Permitir múltiplas opções coreretas por pergunta",multipleRequired:"Requisitar que todas as respostas corretas sejam escolhidas"},thankYouText:"Revise suas respostas",reviewScreenMessage:"Revise mensagem da tela",title:"Revise tela"}}}},overlay:{common:{button:{cancel:"Cancelar",ok:"OK",submit:"Submeter"}},action:{chapter_text:{title:"Texto"},comment_text:{title:"Texto"},delete_annotation:{title:"Deletar Anotação",message:"Tem certeza que quer deletar esta anotação?"},set_duration:{title:"Set Duration",text:{label:{maxDuration:"Mantenham-se ativo até o final do vídeo",hours:"Horas",minutes:"Minutos",seconds:"Segundos"}}}}}}}});hy.define("language.manager",["i18next","i18.en","i18.zh","i18.pt"],function(i18next){var languages=Array.prototype.slice.call(arguments,1);function LanguageManager(){var currentResource={},resources={};this.changeLanguage=function changeLanguage(srclang){i18next.changeLanguage(srclang)};this.get=function get(namespace,key){var val=i18next.t(namespace+":"+key);if(key===val){return""}return val};languages.forEach(function(content){resources[content.srclang]=content.resources});i18next.init({returnObjects:true,resources:resources})}return LanguageManager});hy.define("annotation.variable.config",["lodash.noconflict","language.manager"],function(_,LanguageManager){var instances=[];function AnnotationVariableConfigProto(popcornInstance){var config={},listeners={},generators={},languageManager=new LanguageManager,popcorn=popcornInstance;function updateConfig(annotationId,annotationConfigData){_.forEach(annotationConfigData,function(value,key){if(value===config[key]){return}popcorn.setData(key,value);popcorn.unwatchData(key,listeners[annotationId]);popcorn.watchData(key,listeners[annotationId])});_.merge(config,annotationConfigData)}this.register=function register(type,generator){if(!type||!generator){return}if(!generators[type]){generators[type]=generator}};this.add=function add(type,annotation,onChange){var annotationConfigData,annotationId,configGenerator;function onVariableChange(scope,key,value){if(!value||!config[key]){return}onChange(scope,key,value);popcorn.setData("hapyak-internal-variable-update",true,true)}if(!type||!annotation||!onChange){return}annotationId=annotation.annotationId;if(!annotationId){annotationId=annotation.id}configGenerator=generators[type];if(configGenerator){annotationConfigData=configGenerator(annotationId,annotation)}if(!listeners[annotationId]){listeners[annotationId]=onVariableChange}updateConfig(annotationId,annotationConfigData)};this.update=function update(type,annotation){var configGenerator,annotationConfigData,annotationId,tempId;if(!type||!annotation){return}annotationId=annotation.annotationId;tempId=annotation.id;if(annotationId&&!listeners[annotationId]&&listeners[tempId]){listeners[annotationId]=listeners[tempId];delete listeners[tempId];this.remove(tempId)}if(!annotationId){annotationId=tempId}if(!listeners[annotationId]){return}configGenerator=generators[type];if(configGenerator){annotationConfigData=configGenerator(annotationId,annotation)}updateConfig(annotationId,annotationConfigData)};this.remove=function remove(id){var keys=_.map(config,function(value,key){if(key.indexOf(id)>-1){return key}});delete listeners[id];_.forEach(keys,function(key){if(!key){return}delete config[key];popcorn.unwatchData(key,listeners[key]);popcorn.clearData(key)})};this.load=function load(newConfig){function updateVariable(value,key){if(!_.isEqual(config[key],value)){popcorn.setData(key,value);config[key]=value}}_.chain(newConfig).pick(function(value,key){return key.indexOf("Bookmark")>-1}).forEach(function(value,key){updateVariable(value,key)});_.forEach(newConfig,function(value,key){if(key.indexOf("Bookmark")===-1){updateVariable(value,key)}})};Object.defineProperty(this,"config",{get:function(){return config}});Object.defineProperty(this,"languageManager",{get:function(){return languageManager}})}function AnnotationVariableConfig(popcornInstance){var instance=new AnnotationVariableConfigProto(popcornInstance);instances.push(instance);return instance}AnnotationVariableConfig.prototype=AnnotationVariableConfigProto;AnnotationVariableConfig.instances=instances;return AnnotationVariableConfig});hy.define("content.track.container",[],function(){function ContentTrack(options){var _kind,_src,_srclang,_label,_data,_default;var readyStates={NONE:0,LOADING:1,LOADED:2,ERROR:3};options=options||{};Object.defineProperty(this,"kind",{get:function(){return _kind},set:function(val){var supportedKinds=["annotation"];if(supportedKinds.indexOf(val)===-1){_kind="";return}_kind=val}});Object.defineProperty(this,"src",{get:function(){return _src},set:function(val){_src=val}});Object.defineProperty(this,"srclang",{get:function(){return _srclang},set:function(val){_srclang=val}});Object.defineProperty(this,"label",{get:function(){return _label},set:function(val){_label=val}});Object.defineProperty(this,"default",{get:function(){return _default},set:function(val){_default=val}});this.kind=options.kind||"";this.src=options.src||"";this.srclang=options.srclang||"";this.label=options.label||"";this.default=options.default||false;this.data=options.variables||{};this.active=false}function ContentTrackContainer(){this.tracks=[];this.add=function(options){var track=new ContentTrack(options);this.tracks.push(track);return track};this.remove=function(){}}return ContentTrackContainer});(function(window,Popcorn,undefined){var logging=window.console||{log:function(){},error:function(){},warn:function(){}};Popcorn.p.setData=function(id,name,value,temp){var scope,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}if(value===undefined||typeof name!=="string"){value=name;name=id;id=undefined}scope=this.options.getScope&&this.options.getScope(id)||trackScope;scope.set(name,value,temp);return this};Popcorn.p.clearData=function(id,name){var scope,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}if(typeof name!=="string"){name=id;id=undefined}scope=this.options.getScope&&this.options.getScope(id)||trackScope;scope.clear(name);return this};Popcorn.p.resetData=function(id){var scope,i,trackScope=this.options.environment;function clearScope(scope){var i,keys;keys=scope.keys();for(i=0;i<keys.length;i++){scope.clear(keys[i])}}if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}scope=this.options.getScope&&this.options.getScope(id)||trackScope;clearScope(scope);for(i=scope.children.count-1;i>=0;i--){clearScope(scope.scope(scope.children(i)))}return this};Popcorn.p.getData=function(id,name){var scope,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}if(name===undefined||typeof name!=="string"){name=id;id=undefined}scope=this.options.getScope&&this.options.getScope(id)||trackScope;return scope.get(name)};Popcorn.p.watchData=function(id,name,fn){var scope,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}if(fn===undefined||typeof name!=="string"){fn=name;name=id;id=undefined}scope=this.options.getScope&&this.options.getScope(id)||trackScope;scope.observe(name,fn);return this};Popcorn.p.unwatchData=function(id,name,fn){var scope,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}if(fn===undefined||typeof name!=="string"){name=id;id=undefined}scope=this.options.getScope&&this.options.getScope(id)||trackScope;scope.unobserve(name,fn);return this};Popcorn.p.notifyData=function(id,name){var scope,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}if(name===undefined||typeof name!=="string"){name=id;id=undefined}scope=this.options.getScope&&this.options.getScope(id)||trackScope;scope.notify(name);return this};Popcorn.p.dataMethod=function(id){var scope,args,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}scope=this.options.getScope&&this.options.getScope(id)||trackScope;args=Array.prototype.slice.call(arguments,1);return scope.execute.apply(scope,args)};Popcorn.p.dataKeys=function(id){var scope,trackScope=this.options.environment;if(!trackScope){logging.warn("No environment loaded for Popcorn.data");return}scope=this.options.getScope&&this.options.getScope(id)||trackScope;return scope.keys()}})(this,this.Popcorn);hy.define("popcorn.data",["popcorn"],function(global){return function(){var ret,fn;return ret||global.Popcorn.data}}(this));(function(root,factory){if(typeof exports==="object"){module.exports=factory(require("popcorn"))}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.filter",["popcorn"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,undefined){var popcornPlugins={},popcornInstances={},namedFilters={},routes={"":[],"*":[]},popcornPlugin=Popcorn.plugin,getTrackEvent=Popcorn.getTrackEvent,getTrackEvents=Popcorn.getTrackEvents,removeTrackEvent=Popcorn.removeTrackEvent,trigger=Popcorn.events.fn.trigger,trappedEvents={trackadded:true,tracksetup:true,trackstart:true,trackend:true,trackremoved:true,trackchange:true,trackteardown:true},propertyNameBlacklist=/^(_(natives|id|running)|id|target|effect|compose|toString)$/;function cleanOutNode(node,popcorn){var i,popcornInstance;Popcorn.forEach(node.children,function(child,i){child.destroyed=true;cleanOutNode(child,popcorn);delete node.children[i]});if(node.popcornId){removeTrackEvent(popcorn,node.popcornId);i=node.actualTrackEvents.indexOf(node.popcornId);if(i>=0){node.actualTrackEvents.splice(i,1)}popcornInstance=popcornInstances[popcorn.id];delete popcornInstance.trackEventsByChildId[node.popcornId]}if(node.teardown){node.teardown.call(popcorn,node)}if(node.routeObj){delete node.routeObj.nodes[node.uid]}}function combine(first,second){if(!first){return second}if(!second){return first}return function(){first.apply(this,arguments);second.apply(this,arguments)}}function executeFilter(popcorn,route,id,options){var popcornInstance,routesList,child,track,newEvent=false,previousValues;function makeNextCallback(routesList,i,parent,useVirtualEventId){return function(branchId,opts,newRoute){var pluginFn,nextRoute,child,trackEvent,key,defaults,teardownFn,node;if(typeof branchId==="object"){newRoute=opts;opts=branchId;branchId=""}if(!newRoute){newRoute=parent.route}useVirtualEventId=useVirtualEventId&&newRoute===route&&(!parent.virtualEventId||branchId==="");child=parent.children[branchId];if(child){if(child.destroyed){return null}if(!i){child.updatingFromPopcorn=true}if(!opts){cleanOutNode(child,popcorn);delete parent.children[branchId];node=popcornInstance&&popcornInstance.children[child.virtualEventId];if(node&&!node.updatingFromPopcorn){trigger.call(popcorn,"trackchange",Popcorn.extend({},{id:node.id,type:"trackchange",track:node.fakeTrackEvent,previousValue:node.options,currentValue:node.options}));delete node.fakeTrackEvent.container}return null}for(key in opts){if(opts.hasOwnProperty(key)&&!propertyNameBlacklist.test(key)){child.options[key]=opts[key]}}}else{if(!opts){return null}child={id:typeof branchId==="string"?branchId:Popcorn.guid(newRoute),uid:Popcorn.guid(newRoute)+"-"+i,popcornId:null,options:opts||parent.options,teardown:null,route:newRoute,routeObj:null,children:{},destroyed:false,actualTrackEvents:parent.actualTrackEvents||[],virtualEventId:parent.virtualEventId,fakeTrackEvent:parent.fakeTrackEvent,updatingFromPopcorn:!i};if(!child.virtualEventId){child.virtualEventId=child.id;defaults=popcorn.options.defaults&&popcorn.options.defaults[route]||{};child.options=Popcorn.extend({},defaults,opts||parent.options||options)}if(!child.options.start&&child.options.start!==0){child.options.start=parent.options?parent.options.start:options.start;if(child.options.start===undefined){delete child.options.start}}if(!child.options.end&&child.options.end!==0){child.options.end=parent.options?parent.options.end:options.end;if(child.options.end===undefined){delete child.options.end}}parent.children[child.id]=child}if(newRoute!==parent.route){child.route=newRoute;if(routes[child.route]){routesList=routes[""].concat(routes[child.route],routes["*"])}else{routesList=routes[""].concat(routes["*"])}i=Math.min(i,routes[""].length)}if(!child.fakeTrackEvent&&(routesList.length||!useVirtualEventId)){child.fakeTrackEvent={_id:child.virtualEventId,id:child.virtualEventId,_natives:{plugin:route,type:route,start:Popcorn.nop,end:Popcorn.nop,_teardown:Popcorn.nop,mainfest:{}},_running:false,effect:[],compose:[]};Popcorn.extend(child.fakeTrackEvent,child.options)}if(i<routesList.length){nextRoute=routesList[i];child.routeObj=nextRoute;if(nextRoute){nextRoute.nodes[child.uid]=child}useVirtualEventId=false;teardownFn=nextRoute.fn.call(popcorn,child.route,child.options,makeNextCallback(routesList,i+1,child,useVirtualEventId),child);child.teardown=combine(teardownFn,child.routeObj&&child.routeObj.teardown);return child}pluginFn=popcornPlugins[child.route];if(!pluginFn){return child}if(child.popcornId){child.options.id=child.popcornId;child.options._id=child.popcornId;if(!child.trackEvent||!child.trackEvent._natives||!child.trackEvent._natives._update){removeTrackEvent(popcorn,child.popcornId);pluginFn.call(popcorn,child.popcornId,child.options)}else{pluginFn.call(popcorn,child.popcornId,child.options)}}else{child.popcornId=useVirtualEventId?child.virtualEventId:Popcorn.guid(child.route);child.options.id=child.popcornId;child.options._id=child.popcornId;child.actualTrackEvents.push(child.popcornId);popcornInstance.trackEventsByChildId[child.popcornId]=popcornInstance.children[child.virtualEventId];pluginFn.call(popcorn,child.popcornId,child.options)}trackEvent=getTrackEvent(popcorn,child.popcornId);child.trackEvent=trackEvent;if(!child.fakeTrackEvent){child.fakeTrackEvent=trackEvent}else if(useVirtualEventId||!child.fakeTrackEvent.container){child.fakeTrackEvent.container=trackEvent&&trackEvent.container}node=popcornInstance&&popcornInstance.children[child.virtualEventId];if(node&&!node.updatingFromPopcorn){trigger.call(popcorn,"trackchange",Popcorn.extend({},{id:node.id,type:"trackchange",track:node.fakeTrackEvent,previousValue:node.options,currentValue:node.options}))}return child}}if(id&&!options){options=id;id=options.id||options._id||null}else if(!options){return}popcornInstance=popcornInstances[popcorn.id];if(!popcornInstance){popcornInstance=popcornInstances[popcorn.id]={popcorn:popcorn,contextOptions:popcorn.options.context||{},history:[],children:{},trackEventsByChildId:{}};newEvent=true}else if(!id||!popcornInstance.children[id]){newEvent=true}if(newEvent){if(id){options._id=id}}else{previousValues=Popcorn.extend({},popcornInstance.children[id].options)}child=makeNextCallback(routesList,0,popcornInstance,true)(id||false,options,route);if(!child){return}track=popcorn.getTrackEvent(child.id);child.updatingFromPopcorn=false;if(newEvent){popcornInstance.history.push(child.id);trigger.call(popcorn,"tracksetup",Popcorn.extend({},track,{plugin:route,type:"tracksetup",track:track}));trigger.call(popcorn,"trackadded",Popcorn.extend({},track,{plugin:route,type:"trackadded",track:track}))}else{trigger.call(popcorn,"trackchange",Popcorn.extend({},{id:child.id,type:"trackchange",track:track,previousValue:previousValues,currentValue:popcornInstance.children[child.id].options}))}}Popcorn.filterRoutes={};Popcorn.filter=function(name,route,fn,beginning,teardown){var routed=[],routeObjects,filterReference={};if(typeof route==="function"){teardown=beginning;beginning=fn;fn=route;route=name;name=null}else if(name){if(namedFilters){Popcorn.removeFilter(name)}routeObjects=[];namedFilters[name]=routeObjects}if(Popcorn.isArray(route)){if(route.length>1&&route.indexOf("*")>=0){route=["*"]}}else{route=[route]}Popcorn.forEach(route,function(r){var obj;if(beginning&&r==="*"){r=""}if(routed.indexOf(r)>=0){return}if(!routes[r]){routes[r]=[]}obj={name:name,route:r,fn:fn,nodes:{},teardown:teardown};if(routeObjects){routeObjects.push(obj)}if(beginning){routes[r].unshift(obj)}else{routes[r].push(obj)}Popcorn.filterRoutes[r]=true;if(!Popcorn.p[r]){Popcorn.p[r]=function(id,options){executeFilter(this,r,id,options)}}})};Popcorn.removeFilter=function(name){var affectedRoutes=[]};Popcorn.plugin=function(name,definition,manifest){popcornPlugin(name,definition,manifest);popcornPlugins[name]=Popcorn.p[name];Popcorn.p[name]=function(id,options){executeFilter(this,name,id,options);return this}};Popcorn.plugin.effect=Popcorn.effect=Popcorn.compose;Popcorn.getLastTrackEventId=function(obj){var popcornInstance;popcornInstance=popcornInstances[obj.id];if(popcornInstance&&popcornInstance.history.length){return popcornInstance.history[popcornInstance.history.length-1]}};Popcorn.getTrackEvent=function(obj,id){var popcornInstance,node;popcornInstance=popcornInstances[obj.id];node=popcornInstance&&popcornInstance.children[id];if(!node){return getTrackEvent(obj,id)}return node.fakeTrackEvent};Popcorn.getTrackEvent.ref=getTrackEvent.ref;Popcorn.getTrackEvents=function(obj){var trackEvents=[],popcornInstance=popcornInstances[obj.id],listAllEvents=obj.options.context&&obj.options.context.listAllEvents,i,events,evt;if(popcornInstance&&popcornInstance.children){Popcorn.forEach(popcornInstance.children,function(child,id){trackEvents.push(Popcorn.getTrackEvent(obj,id))})}events=obj.data.trackEvents.byStart;for(i=0;i<events.length;i++){evt=events[i];if(evt._id&&(listAllEvents||evt._natives&&evt._natives.type==="cue")&&(!popcornInstance||!popcornInstance.children||!popcornInstance.children[evt._id])){trackEvents.push(evt)}}trackEvents.sort(function(a,b){if(a.start===b.start){return a.end-b.end}return a.start-b.start});return trackEvents};Popcorn.getTrackEvents.ref=getTrackEvents.ref;Popcorn.removeTrackEvent=function(obj,removeId){var popcornInstance=popcornInstances[obj.id],popcorn,node,i,track,plugin,data;node=popcornInstance&&popcornInstance.children[removeId];if(node){popcorn=popcornInstance.popcorn;track=popcorn.getTrackEvent(node.id);plugin=node.route;cleanOutNode(node,popcornInstance.popcorn);delete popcornInstance.children[removeId];i=popcornInstance.history.indexOf(removeId);if(i>=0){popcornInstance.history.splice(i,1)}data=Popcorn.extend({},track,{plugin:plugin,type:"trackteardown",track:track})
;trigger.call(popcorn,"trackteardown",data);data=Popcorn.extend({},track,{plugin:plugin,type:"trackremoved",track:track});trigger.call(popcorn,"trackremoved",data)}else{track=obj.data.trackRefs[removeId];if(track){removeTrackEvent(obj,removeId)}}};Popcorn.removeTrackEvent.ref=removeTrackEvent.ref;Popcorn.events.fn.trigger=function(type,data){var popcornInstance,popcorn,virtualEvent,track,timedEvent=false,i;if(!trappedEvents[type]||!popcornInstances[this.id]){return trigger.call(this,type,data)}popcornInstance=popcornInstances[this.id];virtualEvent=popcornInstance.children[data.id]||popcornInstance.trackEventsByChildId[data.id];if(type==="trackstart"||type==="trackend"||type==="trackremoved"||type==="trackteardown"){if(virtualEvent){popcorn=popcornInstance.popcorn;if(type==="trackstart"){if(virtualEvent.fakeTrackEvent){virtualEvent.fakeTrackEvent._running=true}if(!virtualEvent.started){virtualEvent.started=true;timedEvent=true}}else{if(virtualEvent.fakeTrackEvent){virtualEvent.fakeTrackEvent._running=false}if(virtualEvent.started){timedEvent=true;virtualEvent.started=false;for(i=0;i<virtualEvent.actualTrackEvents.length;i++){track=getTrackEvent(popcorn,virtualEvent.actualTrackEvents[i]);if(track&&track._running){timedEvent=false;virtualEvent.started=true;break}}}}}if(timedEvent){track=popcorn.getTrackEvent(virtualEvent.id)||data.track||data;if(type==="trackstart"&&getTrackEvent(popcorn,virtualEvent.id)!==track){if(virtualEvent.fakeTrackEvent){virtualEvent.fakeTrackEvent.container=data.track.container}}trigger.call(popcorn,type==="trackstart"?type:"trackend",Popcorn.extend({},track,{plugin:virtualEvent.route,type:type,track:track}));return}}if(popcornInstance.contextOptions.allTriggers||!virtualEvent){return trigger.call(this,type,data)}return this};Popcorn.p.emit=Popcorn.events.fn.trigger;Popcorn.p.trigger=Popcorn.events.fn.trigger;Popcorn.forEach(Popcorn.registryByName,function(plugin,name){popcornPlugins[name]=Popcorn.p[name];Popcorn.p[name]=function(id,options){executeFilter(this,name,id,options);return this}})});(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.filter");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.classes",["popcorn","popcorn.filter"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,popcornfilter,undefined){var originalClasses={};Popcorn.filter("classes","",function(name,options,next,node){var container,nodeData,originals,classes,addClass=Popcorn.basePlugin.addClass,removeClass=Popcorn.basePlugin.removeClass;next(options);container=node.fakeTrackEvent.container;if(container&&container.parentNode&&options.hasOwnProperty("customClasses")){nodeData=originalClasses[node.uid];if(nodeData){if(nodeData.customClasses===options.customClasses){return}originals=nodeData.originals;Popcorn.forEach(nodeData.customClasses.split(" "),function(c){if(originals.indexOf(c)<0){removeClass(container,c)}});originals=container.className.split(" ");nodeData.customClasses=options.customClasses}else{originals=container.className.split(" ");originalClasses[node.uid]={customClasses:options.customClasses,originals:originals}}classes=options.customClasses.split(" ");classes=originals.concat(classes);Popcorn.forEach(classes,function(c){addClass(container,c)})}},false,function(node){delete originalClasses[node.uid]})});(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.filter");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.datafilter",["popcorn","popcorn.filter"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,undefined){var nodes={},trackEvents={};Popcorn.dataFilter=function(dataFields,name,route,fn,beginning,teardown){var newFilterFn,fields,hash,i,k;if(!Popcorn.isArray(dataFields)){fields=[dataFields]}else if(dataFields.length===1){fields=[dataFields[0]]}else{hash={};fields=[];for(i=0;i<dataFields.length;i++){k=dataFields[i];if(!hash.hasOwnProperty(k)){hash[k]=true;fields.push(k)}}}newFilterFn=function(name,options,next,node){var popcorn=this,nodeRef,trackEventRef,newNext,dfTeardown;if(!popcorn.getData){fn(name,options,next,node);return}nodeRef=nodes[node.uid];if(!nodeRef){nodeRef=nodes[node.uid]={uid:node.uid,node:node,fields:{},dataFilters:{},dirty:true,name:name,options:options,next:false,wrapper:function(name,options,next,node){var i,args;if(nodeRef.dirty){nodeRef.dirty=false;args=[name,options,next,node];for(i=0;i<fields.length;i++){args.push(popcorn.getData(node.virtualEventId,fields[i]))}return fn.apply(popcorn,args)}}}}else{nodeRef.dirty=true}Popcorn.forEach(fields,function(field){trackEventRef=trackEvents[field+"/"+node.virtualEventId];if(!trackEventRef){trackEventRef=trackEvents[field+"/"+node.virtualEventId]={field:field,id:node.virtualEventId,nodes:[nodeRef],observer:function(){var i,nodeRef;for(i=0;i<trackEventRef.nodes.length;i++){trackEventRef.nodes[i].dirty=true}for(i=0;i<trackEventRef.nodes.length;i++){nodeRef=trackEventRef.nodes[i];nodeRef.wrapper(nodeRef.name,nodeRef.options,nodeRef.next,nodeRef.node)}}};popcorn.watchData(node.virtualEventId,field,trackEventRef.observer);nodeRef.dataFilters[field]=trackEventRef}else if(trackEventRef.nodes.indexOf(nodeRef)<0){trackEventRef.nodes.push(nodeRef);nodeRef.dataFilters[field]=trackEventRef}});newNext=nodeRef.next;if(!newNext){newNext=nodeRef.next=function(branchId,opts,newRoute){nodeRef.dirty=false;next(branchId,opts,newRoute)}}nodeRef.name=name;nodeRef.options=options;dfTeardown=nodeRef.wrapper(name,options,newNext,node);return function(node){var ref=nodes[node.uid];if(!ref){return}Popcorn.forEach(ref.dataFilters,function(trackEventRef){var i;if(!trackEventRef){return}i=trackEventRef.nodes.indexOf(nodeRef);if(i>=0){trackEventRef.nodes.splice(i,1)}if(!trackEventRef.nodes.length){popcorn.unwatchData(node.virtualEventId,trackEventRef.field,trackEventRef.observer);delete trackEvents[trackEventRef.field+"/"+trackEventRef.id]}});delete nodes[node.uid];nodeRef.deleted=false;if(dfTeardown){dfTeardown(node)}}};Popcorn.filter(name,route,newFilterFn,beginning,teardown)};return Popcorn.dataFilter});hy.define("player.playereval",["popcorn","lodash.noconflict","logging"],function(Popcorn,_,logging){function TemplateEvaluator(plugin,options){var templateVars=[];this.watchTemplateVars=function(text,onChange){if(plugin.getData){Popcorn.forEach(templateVars,function(name){plugin.unwatchData(options.dataId||options.id,name,onChange)});if(text){templateVars=plugin.dataMethod(options.dataId||options.id,"templateVars",text)||text;Popcorn.forEach(templateVars,function(name){plugin.watchData(options.dataId||options.id,name,onChange)})}}};this.evaluate=function(text,encode){if(text&&plugin.dataMethod&&!plugin.getData(options.dataId||options.id,"hapyak-editing")){text=plugin.dataMethod(options.dataId||options.id,"render",text,encode)||text}return text}}return{TemplateEvaluator:TemplateEvaluator,playereval:function playereval(popcorn,expression,annotationId){var nop=function(){},scope={},resetVariables=function(){popcorn.resetData()},resetCondition=function(id){popcorn.setData(null,"event-"+id+"/condition",false)},resetQuiz=function(id){var keys,key;keys=popcorn.dataKeys();key="quiz_"+id+"_";_.each(keys,function(k){if(k.substr(0,key.length)===key){popcorn.clearData(k)}});popcorn.setData(null,"event-"+id+"/condition",false)},annotation=popcorn.getTrackEvent(annotationId);var playlistInstance={back:nop,isFirst:nop,isLast:nop,first:nop,last:nop,next:nop,pause:nop,play:nop,previous:nop,viewer:nop,volume:nop};var playerType,playlistId;if(typeof hapyak.playlist==="object"&&typeof hapyak.playlist.get==="function"){playerType=popcorn.getData("playerType");playlistId=popcorn.getData("playlistId");logging.dev("[playereval] Look up playlist",playerType,playlistId);if(playerType&&playlistId){playlistInstance=hapyak.playlist.get(playerType+"_"+playlistId)||playlistInstance}}else if(expression.indexOf("playlist")!==-1){logging.dev("[playereval] HapYak Playlist API not available: "+expression)}expression=expression.replace(/([\w_\$]+\s?=\s?['"]?[\w_\$\/]+['"]?)/g,"scope.$1").replace(/([\w_\$]+)\+\+/g,'scope.$1 = player.getData("$1") + 1');new Function("window","self","top","document","_","scope","player","playlist","resetVariables","resetCondition","resetQuiz","annotation"," "+expression)(undefined,undefined,undefined,undefined,undefined,scope,popcorn.options.hapyakPlayer,playlistInstance,resetVariables,resetCondition,resetQuiz,annotation);_.each(scope,function(val,key){popcorn.setData(key,val)})}}});hy.define("playlist.addon",[],function(){var playlistItems,currentVideo;function playlistItemsChanged(playlistItems,currentVideo){hapyak.message.send(window,"playlistItemsChanged",{playlistItems:playlistItems,currentVideo:currentVideo})}hapyak.addon("getPlaylist",{init:function(){},setup:function(data){playlistItems=data.data.playlistItems;currentVideo=data.data.currentVideo},add:function(data){playlistItems=data.data.playlistItems;currentVideo=data.data.currentVideo;playlistItemsChanged(playlistItems,currentVideo)},remove:function(data){playlistItems=data.data.playlistItems;currentVideo=data.data.currentVideo;playlistItemsChanged(playlistItems,currentVideo)},move:function(data){playlistItems=data.data.playlistItems;currentVideo=data.data.currentVideo;playlistItemsChanged(playlistItems,currentVideo)},goTo:function(data){playlistItems=data.data.playlistItems;currentVideo=data.data.currentVideo;playlistItemsChanged(playlistItems,currentVideo)}});return{getVideos:function(){return playlistItems},currentVideo:function(){return currentVideo},goTo:function(projectId,autoplay,seekTime){var index=-1;projectId=projectId.split("id=")[1]||"";if(!playlistItems){return}playlistItems.some(function getIndexFromId(item,idx){if(item.data.id===+projectId){index=idx;return true}});if(index>=0){hapyak.message.send(window.parent,"goTo",{index:index,customContext:"playlist",autoplay:autoplay,seekTime:seekTime})}}}});hy.define("popcorn.onclick",["module","popcorn","dao","lodash.noconflict","utils","utils.embed","utils.samedomain","utils.validatelink","configAPI","popcorn.datafilter","popcorn.data","player.playereval","playlist.addon"],function(module,Popcorn,dao,_,utils,embedUtils,sameDomain,validateLink,configuration,datafilter,popcorndata,playereval,playlistAddon){var moduleConfig=module.config(),playerConfig=configuration&&configuration.player;var apiAnnotationProvisioned=configuration.isProvisioned("API__ANNOTATION"),filterClass="hapyak-filter-onclick",localLinks=playerConfig.localLinks||moduleConfig.localLinks||false,onclickData={};var addClass,removeClass;function addClickAndKeyPressHandler(target,handler,useCapture){target.addEventListener("click",handler,useCapture);target.addEventListener("keypress",function(event){if(event.key==="Enter"){handler(event)}},useCapture)}function setFilterData(uid,key,value){if(typeof value!=="undefined"&&value!==null){if(!onclickData[uid]){onclickData[uid]={}}onclickData[uid][key]=value}else{unsetFilterData(uid,key)}return value}function getFilterData(uid,key){if(onclickData[uid]){if(typeof key!=="undefined"){return onclickData[uid][key]}return onclickData[uid]}}function unsetFilterData(uid,key){if(onclickData[uid]){if(typeof key!=="undefined"){delete onclickData[uid][key];return}delete onclickData[uid]}}function getOnClick(options,key){if(!options||!options.hasOwnProperty("onClick")||!options.onClick){return}var value=options.onClick[key];if(typeof value!=="undefined"){return value}}function onMouseOver(evt){addClass(evt.target.parentNode,"hapyak-link-focused")}function onMouseOut(evt){removeClass(evt.target.parentNode,"hapyak-link-focused")}Popcorn.dataFilter(["hapyak-editing","hapyak-internal-variable-update"],"onclick",["image","pop","hotlink","basic360"],function(name,options,next,node,hapyakEditing){var isUpdate=false,isActive=false,linkHandler=getFilterData(node.uid,"linkHandler"),trackHandler=getFilterData(node.uid,"trackHandler"),cssHandler=getFilterData(node.uid,"cssHandler"),varHandler=getFilterData(node.uid,"varHandler"),addonHandler=getFilterData(node.uid,"addonHandler"),loopbackHandler=getFilterData(node.uid,"loopbackHandler"),releaseGateHandler=getFilterData(node.uid,"releaseGateHandler"),trackingHandler=getFilterData(node.uid,"trackingHandler"),branchingHandler=getFilterData(node.uid,"branchingHandler"),pauseHandler=getFilterData(node.uid,"pauseHandler"),gateHandler=getFilterData(node.uid,"gateHandler"),templateEvaluator=new playereval.TemplateEvaluator(this,options),addonData={},popcorn=this,loadTrackTime=this.options.loadTrackTime,rotateToAnnotation=options.onClick&&options.onClick.rotateToAnnotation,isEditing,target,link,linkTarget,track,goToVideo,trackTime,cssClass,expression,loopback,pause;function applyPause(){popcorn.emit("clearactivepauses");popcorn.pause()}addClass=Popcorn.basePlugin.addClass;removeClass=Popcorn.basePlugin.removeClass;isEditing=hapyakEditing||false;if(node.actualTrackEvents.length){isUpdate=true}next(options);setFilterData(node.uid,"pause",getOnClick(options,"pause"));setFilterData(node.uid,"releaseGate",getOnClick(options,"releaseGate"));setFilterData(node.uid,"gate",options.gate);if(typeof node.fakeTrackEvent.container==="object"){target=node.fakeTrackEvent.container;if(!pauseHandler){pauseHandler=setFilterData(node.uid,"pauseHandler",function(uid){return function(event){event.preventDefault();if(!isEditing){if(getFilterData(uid,"pause")){applyPause()}}}}(node.uid));addClickAndKeyPressHandler(target,pauseHandler,false)}if(!releaseGateHandler){releaseGateHandler=setFilterData(node.uid,"releaseGateHandler",function(uid){return function(event){var trgt=uid||this.dataset&&this.dataset.popcornId;event.preventDefault();if(isEditing||!trgt){return}if(getFilterData(uid,"releaseGate")){popcorn.setData(trgt,"condition",true)}if(getFilterData(uid,"pause")){applyPause()}}}(node.uid));addClickAndKeyPressHandler(target,releaseGateHandler,false)}if(getFilterData(node.uid,"gate")){isActive=true;if(!gateHandler){gateHandler=setFilterData(node.uid,"gateHandler",function(uid){return function(event){if(event&&event.preventDefault){event.preventDefault()}if(pauseHandler){target.removeEventListener("click",pauseHandler,false)}if(getFilterData(uid,"gate")){popcorn.setData(options.dataId||options.id,"condition",true)}}}(node.uid));addClickAndKeyPressHandler(target,gateHandler,true)}}if(!trackingHandler){trackingHandler=setFilterData(node.uid,"trackingHandler",function(uid){return function(event){var link=getFilterData(uid,"link"),props,trackTime=utils.getTrackTime(getFilterData(uid,"trackTime")),variables=getOnClick(options,"setVariables");if(event&&!(event.target instanceof HTMLAnchorElement)&&event.preventDefault){event.preventDefault()}if(node.options.annotationId){props={Remaining:popcorn.duration()-popcorn.currentTime(),Rollup:[]};if(link){link=templateEvaluator.evaluate(link,true);props.Target=link;props.Rollup.push("link")}if(trackTime){props.Rollup.push("navigation");if(+trackTime.time>=0){props["Target Time"]=trackTime.time}if(+trackTime.track>=0){props["Target Track"]=trackTime.track}if(+trackTime.annotationId>=0&&isNaN(trackTime.time)){var model=dao.store.model,annotation=dao.store.find(model.Comment,trackTime.annotationId);props["Target Annotation"]=trackTime.annotationId;props["Target Time"]=annotation.get("start_time")}}if(variables){props["Target Expression"]=variables}if(node.options.text){props.Text=node.options.text}popcorn.options.hapyakPlayer.tracking.annotationActionById(node.options.annotationId,name,link?"External Click":"Click",props)}}}(node.uid));addClickAndKeyPressHandler(target,trackingHandler,false)}if(linkHandler){target.removeEventListener("click",linkHandler)}link=setFilterData(node.uid,"link",getOnClick(options,"gotoLink")||options.link);if(link&&!validateLink(link)){link=null}if(link){link=templateEvaluator.evaluate(link,true);target.setAttribute("title",link);addClass(target,"hapyak-linked");if(target.nodeName.toLowerCase()==="a"){target.setAttribute("href",link);linkTarget=setFilterData(node.uid,"linkTarget",getOnClick(options,"gotoLinkTarget")||options.target);if(linkTarget){target.setAttribute("target",linkTarget)}else if(!localLinks||!sameDomain.test(link)){target.setAttribute("target","_new")}}isActive=true;linkHandler=setFilterData(node.uid,"linkHandler",function(uid){var link=getFilterData(uid,"link");return function(event){var proposedLink,targetLink,shouldDecode;var id=node&&embedUtils.dotget(node,"options.annotationId"),varConfig=node&&embedUtils.dotget(node,"options.annotationVariableConfig.config")||{},numericOnlyKey=function(val){varConfig[val.replace(/\D/g,"")]=varConfig[val]};Object.keys(varConfig).forEach(numericOnlyKey);proposedLink=varConfig&&varConfig[id]&&varConfig[id].link;targetLink=proposedLink?proposedLink:link;shouldDecode=utils.regex.templateVarsRegex().test(targetLink);event.preventDefault();targetLink=templateEvaluator.evaluate(targetLink,true);if(!isEditing&&targetLink){if(shouldDecode){targetLink=decodeURIComponent(targetLink)}utils.navigateToUrl(targetLink,linkTarget)}}}(node.uid));addClickAndKeyPressHandler(target,linkHandler);target.addEventListener("mouseover",onMouseOver,true);target.addEventListener("mouseout",onMouseOut,true)}else{removeClass(target,"hapyak-linked");target.removeAttribute("title");target.removeEventListener("mouseover",onMouseOver,true);target.removeEventListener("mouseout",onMouseOut,true)}if(branchingHandler){target.removeEventListener("click",branchingHandler)}goToVideo=setFilterData(node.uid,"goToVideo",getOnClick(options,"goToVideo"));if(goToVideo){isActive=true;branchingHandler=setFilterData(node.uid,"branchingHandler",function callBranchingHandler(uid){return function branchToVideo(event){var track=setFilterData(node.uid,"track",getOnClick(options,"branchTimeInput")||getOnClick(options,"gotoTrack")),seekTime=0;if(track){seekTime=options.branchTimeInput?track:track.substr(1)}else{unsetFilterData(node.uid,"track")}if(!isEditing){if(getFilterData(uid,"goToVideo")){playlistAddon.goTo(goToVideo,true,seekTime)}}}}(node.uid));addClickAndKeyPressHandler(target,branchingHandler,false)}else{unsetFilterData(node.uid,"goToVideo")}if(trackHandler){target.removeEventListener("click",trackHandler)}track=setFilterData(node.uid,"track",getOnClick(options,"gotoTrack"));if(rotateToAnnotation){isActive=true;addClickAndKeyPressHandler(target,function(){var video=popcorn.video.parentNode.getElementsByTagName("VIDEO")[0],Css360Sphere=hapyak.Css360.getSphereByContainerId(embedUtils.dotget(video,"dataset.videoId")),rotateTarget=rotateToAnnotation==="recenter"?null:popcorn.options.hapyakPlayer.annotations.get(rotateToAnnotation),transform=rotateTarget===null?"[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1]":embedUtils.dotget(rotateTarget,"properties.transform"),vector=transform&&JSON.parse(transform);if(Css360Sphere&&typeof Css360Sphere.setRotation==="function"&&vector){Css360Sphere.setRotation(-vector[0],vector[1],vector[2],true)}})}if(loadTrackTime&&track){trackTime=setFilterData(node.uid,"trackTime",/^([0-9]+)?(?:#(?:([0-9]+):)?([0-9id\=]+(?:\.[0-9]+)?))?$/.exec(track));if(trackTime){isActive=true;trackHandler=setFilterData(node.uid,"trackHandler",function(uid){var trackTime=utils.getTrackTime(getFilterData(uid,"trackTime"));return function(event){event.preventDefault();if(!isEditing&&trackTime){popcorn.on("seeked",function onSeek(){popcorn.off("seeked",onSeek);if(!getFilterData(uid,"pause")){popcorn.play()}});loadTrackTime(trackTime.track,trackTime.time,trackTime.annotationId,null)}}}(node.uid));if(!options.goToVideo||options.goToVideo==="-"){addClickAndKeyPressHandler(target,trackHandler)}}}else{unsetFilterData(node.uid,"trackTime")}if(cssHandler){target.removeEventListener("click",cssHandler)}cssClass=setFilterData(node.uid,"cssClass",getOnClick(options,"addClasses"));if(cssClass){isActive=true;cssHandler=setFilterData(node.uid,"cssHandler",function(uid){var cssClass=getFilterData(uid,"cssClass");return function(event){event.preventDefault();if(!isEditing){addClass(target,cssClass)}}}(node.uid));addClickAndKeyPressHandler(target,cssHandler)}if(varHandler){target.removeEventListener("click",varHandler)}expression=setFilterData(node.uid,"expression",getOnClick(options,"setVariables"));if(expression&&apiAnnotationProvisioned){isActive=true;varHandler=setFilterData(node.uid,"varHandler",function(node){return function(event){event.preventDefault();if(!isEditing){var expression=getFilterData(node.uid,"expression");playereval.playereval(popcorn,expression,node.options.id)}}}(node));addClickAndKeyPressHandler(target,varHandler)}addonData.addonCommand=setFilterData(node.uid,"addonCommand",options.addonCommand);addonData.addonTypeId=setFilterData(node.uid,"addonTypeId",options.addonTypeId);addonData.addonCommandData=setFilterData(node.uid,"addonCommandData",options.addonCommandData);if(addonData.addonCommand&&addonData.addonTypeId){isActive=true;addonHandler=setFilterData(node.uid,"addonHandler",function(uid){return function(event){event.preventDefault();var messageData={customContext:addonData.addonTypeId,addonCommand:addonData.addonCommand};_.forEach(addonData.addonCommandData,function(val,key){if(messageData[key]){return}messageData[key]=val});hapyak.message.send(parent.window,addonData.addonCommand,messageData)}}(node.uid));addClickAndKeyPressHandler(target,addonHandler);target.addEventListener("mouseover",onMouseOver,true);target.addEventListener("mouseout",onMouseOut,true)}}loopback=setFilterData(node.uid,"loopback",getOnClick(options,"loopback"));if(loopback==="loop"){if(!loopbackHandler){loopbackHandler=setFilterData(node.uid,"loopbackHandler",function(){var continueVideo=false;return{trackEnd:function(trackEvent){var currentTime;if(trackEvent.id===node.fakeTrackEvent._id&&!continueVideo){currentTime=popcorn.currentTime();if(Math.abs(currentTime-trackEvent.end)<1){popcorn.currentTime(trackEvent.start)}}continueVideo=false},click:function(){continueVideo=true}}}());addClickAndKeyPressHandler(target,loopbackHandler.click);popcorn.on("trackend",loopbackHandler.trackEnd)}}else{if(loopbackHandler){popcorn.off("trackend",loopbackHandler.trackEnd);target.removeEventListener("click",loopbackHandler.click);unsetFilterData(node.uid,"loopbackHandler")}}if(isActive){addClass(target,filterClass)}else{removeClass(target,filterClass)}},false,function(node){var uid=node.uid,data=getFilterData(uid),target=node.fakeTrackEvent.container;if(target&&data){if(data.trackingHandler){target.removeEventListener("click",data.trackingHandler,false)}if(data.linkHandler){target.removeEventListener("click",data.linkHandler);target.removeEventListener("mouseover",onMouseOver,true);target.removeEventListener("mouseout",onMouseOut,true)}if(data.trackHandler){target.removeEventListener("click",data.trackHandler)}if(data.cssHandler){target.removeEventListener("click",data.cssHandler)}if(data.varHandler){target.removeEventListener("click",data.varHandler)}if(data.loopbackHandler){this.off("trackend",data.loopbackHandler.trackEnd);target.removeEventListener("click",data.loopbackHandler.click)}if(data.pauseHandler){target.removeEventListener("click",data.pauseHandler)}if(data.goToVideo){target.removeEventListener("click",data.branchingHandler)}if(data.addonHandler){target.removeEventListener("click",data.addonHandler);target.removeEventListener("mouseover",onMouseOver,true);target.removeEventListener("mouseout",onMouseOut,true)}removeClass(target,filterClass);removeClass(target,"hapyak-linked");if(data.cssClass){removeClass(target,data.cssClass)}unsetFilterData(uid)}});return true});(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.datafilter");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.precondition",["popcorn","popcorn.datafilter"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,datafilter,undefined){var nodeFields={},varNameRegex=/\b[a-z_$][a-z_$0-9]*\b/gim,reservedWords=/^(break|case|catch|const|continue|debugger|default|delete|do|else|false|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|with|class|enum|export|extends|import|super|implements|interface|let|package|private|protected|public|static|yield|Infinity|Intl|JSON|Math|NaN|undefined|null|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|eval|isFinite|isNaN|parseFloat|parseInt|true|uneval|Error|EvalError|InternalError|RangeError|ReferenceError|StopIteration|SyntaxError|TypeError|URIError|Intl|ArrayBuffer|DataView|Float32Array|Float64Array|Int16Array|Int32Array|Int8Array|Uint16Array|Uint32Array|Uint8Array|Uint8ClampedArray|Array|Boolean|Date|Function|Iterator|Number|Object|RegExp|String|Proxy|ParallelArray)$/;function makeFunction(args,fnString){var a=args.slice(0);a.push(fnString);return Function.apply(null,a)}Popcorn.dataFilter(["editMode","condition"],"precondition","",function(name,options,next,node,editMode,condition){var key,nodeRef,popcorn=this,expr,match,fields={},oldFields={},foundVar=false,expressionChanged=true;if(!editMode&&options.precondition===true&&condition){next(null);return}expr=typeof options.precondition==="string"?options.precondition:"";nodeRef=nodeFields[node.uid];if(nodeRef){expressionChanged=nodeRef.expr!==expr;if(expressionChanged){nodeRef.expr=expr;oldFields=nodeRef.fields;nodeRef.fields=fields}}else if(!expr){next(options);return}if(expressionChanged){match=varNameRegex.exec(expr);while(match){key=match[0];if(!reservedWords.test(key)){fields[key]=true;foundVar=true}match=varNameRegex.exec(expr)}for(key in oldFields){if(oldFields.hasOwnProperty(key)&&!fields.hasOwnProperty(key)){popcorn.unwatchData(node.virtualEventId,key,nodeRef.observer)}}}if(!expr){next(options);return}if(!nodeRef){nodeRef=nodeFields[node.uid]={expr:expr,fields:fields,params:null,evalFn:null,observer:function(){var paramValues=[],key,success=true,i;for(i=0;i<nodeRef.params.length;i++){key=nodeRef.params[i];paramValues.push(popcorn.getData(node.virtualEventId,key))}try{success=nodeRef.evalFn.apply(null,paramValues)}catch(e){success=true}if(success){next(options)}else{next(null)}}}}if(expressionChanged){try{nodeRef.params=Object.keys(fields);nodeRef.evalFn=makeFunction(nodeRef.params,"return !!("+expr+")")}catch(e){nodeRef.evalFn=function(){return true}}for(key in fields){if(fields.hasOwnProperty(key)&&!oldFields.hasOwnProperty(key)){popcorn.watchData(node.virtualEventId,key,nodeRef.observer)}}nodeRef.params=Object.keys(fields)}if(editMode){next(options);return}nodeRef.observer()},true,function(node){var nodeRef=nodeFields[node.uid],popcorn=this,key;if(!nodeRef){return}for(key in nodeRef.fields){if(nodeRef.fields.hasOwnProperty(key)){popcorn.unwatchData(node.virtualEventId,key,nodeRef.observer)}}delete nodeFields[node.uid]})});(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.filter");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.transitions",["popcorn","popcorn.filter"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,popcornfilter,undefined){var supportedPlugins=["pop","image"];Popcorn.filter("transitions",supportedPlugins,function(name,options,next,node){var container,addClass=Popcorn.basePlugin.addClass,removeClass=Popcorn.basePlugin.removeClass;options.transitionClass=options.transition||options.transitionClass||"hapyak-transition-none";delete options.transition;next(options);container=node.fakeTrackEvent.container;if(supportedPlugins.indexOf(node.fakeTrackEvent._natives.type)>-1&&node.actualTrackEvents.indexOf(node.options.id)>-1&&container&&container.parentNode){Popcorn.forEach(["hapyak-transition-none","hapyak-transition-fade","hapyak-transition-pop","hapyak-transition-slide-up"],function(transition){removeClass(container,transition)});addClass(container,options.transitionClass)}},false)});(function(window,Popcorn,undefined){var document=window.document,pluginFn,incompatible={},fallbacks={},nullFallback,addEventListener,media;pluginFn=Popcorn.plugin;nullFallback={start:function(){},end:function(){}};function getFallback(popcorn,name,options){var fallback=popcorn.data.fallbacks&&(popcorn.data.fallbacks[name]||popcorn.data.fallbacks[""])||fallbacks[name]||fallbacks[""]||nullFallback;if(typeof fallback==="function"){fallback=fallback.call(popcorn,options)}return fallback}Popcorn.plugin=function(name,definition,manifest){var newDefinition,testFn;testFn=manifest&&manifest.incompatible||definition.incompatible;if(typeof testFn==="function"){incompatible[name]=testFn();if(!incompatible[name]){newDefinition=definition;pluginFn(name,newDefinition,manifest);return}newDefinition=function(options){return getFallback(this,name,options)}}else if(typeof definition!=="function"){newDefinition=definition}else{newDefinition=function(options){var def=definition.call(this,options),incomp;incomp=incompatible[name];if(incomp===undefined&&typeof def.incompatible==="function"){incomp=def.incompatible.call(this,options);incompatible[name]=incomp;if(incomp&&def._teardown){def._teardown.call(this,options)}}if(!incomp){return def}return getFallback(this,name,options)}}pluginFn(name,newDefinition,manifest)};Popcorn.incompatible=function(hook){var elem;if(hook){return incompatible[hook]||false}if(addEventListener===undefined){addEventListener=!document.addEventListener}if(addEventListener){return"Obsolete browser: No support for addEventListener"}if(media===undefined){media=false;if(!Popcorn._MediaElementProto){elem=document.createElement("video");if(!elem||!elem.canPlayType){media=true}}}if(media){return"Obsolete browser: No support for HTML5 video"}return false};Popcorn.prototype.incompatible=function(hook){var failure,obj,i,events,evt,t,count=0;failure=Popcorn.incompatible(hook);if(failure){return failure}obj={};events=this.data.trackEvents.byStart;for(i=0;i<events.length&&count<Popcorn.registry.length;i++){evt=events[i];t=evt._natives&&evt._natives.type;if(t&&obj[t]===undefined){obj[t]=Popcorn.incompatible(t);count++}}return!!count&&obj};Popcorn.fallback=function(hook,definition){if(typeof hook==="object"||typeof hook==="function"){definition=hook;hook=""}fallbacks[hook]=definition};Popcorn.prototype.fallback=function(hook,definition){if(!this.data.fallbacks){this.data.fallbacks={"":nullFallback}}if(typeof hook==="object"||typeof hook==="function"){definition=hook;hook=""}this.data.fallbacks[hook]=definition}})(this,this.Popcorn);hy.define("popcorn.compatible",function(){});(function(window,Popcorn){var document=window.document,console=window.console,popcornInstances={},BasePopcorn,PopcornBasePlugin,PopcornBaseEvent,allTargets=[],timing,numRegex=/[\-+]?[0-9]*\.?[0-9]+/g,styleHyphenRegex=/\-([a-z])/g,stylePrefixRegex=/^\-\*\-([a-z\-]+)/,browserPrefixes=["","-moz-","-webkit-","-o-","-ms-"],colorRegex=/#(([0-9a-fA-F]{3,8}))/g,rgbaRegex=/(rgba?)\(\s*([0-9]*\.?[0-9]+)\s*,\s*([0-9]*\.?[0-9]+)\s*,\s*([0-9]*\.?[0-9]+)\s*(,([0-9]*\.?[0-9]+))?\)/gi,timingRegex=/^([A-Za-z\-]+)(\((([\-+]?[0-9]*\.?[0-9]+)(,\s*([\-+]?[0-9]*\.?[0-9]+))*)\))?$/,updatePropertyBlacklist=/^(_(natives|id|running)|id|target|effect|compose|toString|container)$/;window.a11yListener=function($el,callback){$el.keypress(function(event){if(event.keyCode===13){callback(event)}});$el.click(callback);return $el};if(!console){console={log:function(){}}}function logError(err){if(err){console.log(err.stack||err.stacktrace||err.message||err)}}BasePopcorn=function(popcorn){var base,resume,me=this,hasPlayed=false;if(window===this||!(this instanceof BasePopcorn)){base=BasePopcorn.find(popcorn);if(!base){base=new BasePopcorn(popcorn)}return base}this.popcorn=popcorn;this.id=Popcorn.guid();popcornInstances[this.id]=this};BasePopcorn.find=function(instance){var id,bp;for(id in popcornInstances){if(popcornInstances.hasOwnProperty(id)){bp=popcornInstances[id];if(bp&&bp.popcorn===instance){
return bp}}}};BasePopcorn.plugins={};BasePopcorn.register=function(pluginName,basePlugin){BasePopcorn.plugins[pluginName]=basePlugin};PopcornBasePlugin=function(pluginName,plugin,manifest){var definition,me=this;this.name=pluginName;this.pluginFn=plugin;this.events={};definition=function(options){var popcorn=this,event=new PopcornBaseEvent(popcorn,me,options);return event.definition()};Popcorn.forEach(plugin,function(val,key){definition[key]=val});Popcorn.forEach(plugin,function(val,key){definition[key]=val});Popcorn.plugin(pluginName,definition,manifest);BasePopcorn.register(pluginName,this)};PopcornBaseEvent=function(popcorn,basePlugin,options){var current=false,started=false,setupFn,updateFn,startFn,frameFn,endFn,teardownFn,me=this,instanceId,allEvents,allEventsByTarget,basePopcorn=BasePopcorn(popcorn),animatedProperties={},setStyles=[],animations=[],definition,i;function runCallbackFunction(fn,time){if(fn&&typeof fn==="string"){fn=window[fn]}if(fn&&typeof fn==="function"){try{fn.call(me,options,time)}catch(e){logError(e)}}}function updateAnimations(fraction){function findPreviousKeyframe(keyframes,t){var i;if(!keyframes.length){return}if(keyframes[0].t>t){return-1}for(i=1;i<keyframes.length;i++){if(keyframes[i].t>=t){return i-1}}return i-1}function join(vals,str){var i,out=[];for(i=0;i<vals.length;i++){out.push(str[i]);out.push(vals[i])}out.push(str[i]);return out.join("")}function rgbaRound(match,rgba,r,g,b,x,a){var params=[r,g,b],i;for(i=0;i<3;i++){params[i]=Math.round(parseFloat(params[i]))}if(x){params.push(a)}return rgba+"("+params.join(",")+")"}var i,j,f,prop,val,from,to,delta,current,timingFn;for(i in animatedProperties){if(animatedProperties.hasOwnProperty(i)){prop=animatedProperties[i];from=findPreviousKeyframe(prop.keyframes,fraction);to=prop.keyframes[from+1];from=prop.keyframes[from];if(!from){from=to}if(!to||from===to){val=prop.str?join(from.val,prop.str):from.val[0]}else{delta=to.t-from.t;timingFn=from.timing||prop.timing;f=timingFn((fraction-from.t)/delta);from=from.val;to=to.val;current=[];for(j=0;j<from.length;j++){current.push(from[j]+(to[j]-from[j])*f)}if(prop.str){val=join(current,prop.str);val=val.replace(rgbaRegex,rgbaRound)}else{val=current[0]}}me.options[i]=val;if(prop.callback){prop.callback.call(me,val)}}}}function insertContainer(){var i,evt,nextElement=null;if(allEventsByTarget){for(i=allEventsByTarget.length-1;i>=0;i--){evt=allEventsByTarget[i];if(evt===me||evt.options.start<me.options.start||evt.options.start===me.options.start&&evt.options.end<me.options.end){break}if(evt.container&&evt.container.parentNode===me.target){nextElement=evt.container}}}if(me.pluginName==="basic360"){return}me.target.insertBefore(me.container,nextElement)}function insertInPlace(target){var evt,i,t;if(allEvents){i=allEvents.indexOf(me);if(i>=0){allEvents.splice(i,1)}}else{allEvents=basePlugin.events[instanceId]}for(i=allEvents.length-1;i>=0;i--){evt=allEvents[i].options;if(evt.start<=options.start||evt.start===options.start&&evt.end<=options.end){break}}allEvents.splice(i+1,0,me);me.allEvents=allEvents;if(target!==undefined){if(!(target instanceof window.Element||target instanceof window.HTMLElement)){target=null}if(allEventsByTarget){i=allEventsByTarget.indexOf(me);if(i>=0){allEventsByTarget.splice(i)}}if(!target){delete me.target;return}if(target!==me.target){me.target=target;for(i=0;i<allTargets.length;i++){t=allTargets[i];if(t.target===me.target){allEventsByTarget=t.events;break}}if(!allEventsByTarget){allEventsByTarget=[me];allTargets.push({target:me.target,events:allEventsByTarget});return}}}if(!allEventsByTarget){return}for(i=allEventsByTarget.length-1;i>=0;i--){evt=allEventsByTarget[i].options;if(evt.start<options.start||evt.start===options.start&&evt.end<=options.end){break}}allEventsByTarget.splice(i+1,0,me)}this.popcorn=popcorn;this.pluginName=basePlugin.name;if(typeof options.start==="string"){options.start=Popcorn.util.toSeconds(options.start,popcorn.options.framerate)}if(!options.start&&options.start!==0){options.start=options["in"]||0}if(typeof options.end==="string"){options.end=Popcorn.util.toSeconds(options.end,popcorn.options.framerate)}if(!options.end&&options.end!==0){options.end=options.out||popcorn.duration()||Number.MAX_VALUE}this.options={};for(i in options){if(options.hasOwnProperty(i)){this.options[i]=options[i]}}instanceId=basePopcorn.id;if(!basePlugin.events[instanceId]){basePlugin.events[instanceId]=[]}insertInPlace(typeof options.target==="string"?document.getElementById(options.target):options.target);this.definition=function(){return definition};this.makeContainer=function(tag,insert){if(insert===undefined){insert=true}if(!tag){tag="div"}var container=document.createElement(tag);this.container=container;this.addClass(container,"popcorn-"+this.pluginName);container.ariaModal="true";if(insert&&this.target){insertContainer()}return container};this.animate=function(name,opts){var callback,animated=false,i,styles={},animation;function animateOption(name,callback){function fixColors(str){function makeRGBA(hex){var nums,n,i;n=hex.length;if(n===4||n===5){nums=hex.match(/[0-9A-Fa-f]/g);for(i=0;i<nums.length;i++){nums[i]=parseInt(nums[i]+nums[i],16)}}else if(n===7||n===9){nums=hex.match(/[0-9A-Fa-f]{2}/g);for(i=0;i<nums.length;i++){nums[i]=parseInt(nums[i],16)}}if(nums.length>3){nums[3]/=255;return"rgba("+nums.join(",")+")"}return"rgb("+nums.join(",")+")"}if(typeof str!=="string"){return str}return str.replace(colorRegex,makeRGBA,"g")}function kfSort(a,b){return a.t-b.t}function makeTimingFunction(fn){var parsed,args=[],i,x;if(!fn){return timing.linear()}if(typeof fn==="function"){return fn}parsed=timingRegex.exec(fn);if(!parsed){return timing.linear()}fn=timing[parsed[1]];if(!fn){return timing.linear()}if(parsed[3]){args=parsed[3].split(",")}for(i=0;i<args.length;i++){args[i]=parseFloat(args[i])}x=fn.apply(null,args);if(typeof x==="function"){return x}return fn}var prop,opt,i,j,val,vals,str,count=1,timingFn,keyframe,keyframes=[];if(!name||!options[name]){return false}opt=options[name];if(typeof opt!=="object"){me.options[name]=opt;return false}prop={name:name,keyframes:keyframes,timing:makeTimingFunction(opt.timing)};for(i in opt){if(opt.hasOwnProperty(i)){val=opt[i];if(i==="from"&&opt[0]===undefined){i=0}else if(i==="to"&&opt[1]===undefined){i=1}else{i=parseFloat(i)}if(typeof val==="object"){timingFn=val[1]||val.timing;val=val[0]===undefined?val.val:val[0];if(timingFn===opt.timing){timingFn=prop.timingFn}else{timingFn=makeTimingFunction(timingFn)}}else{timingFn=false}if(typeof val==="string"){val=fixColors(val);vals=val.match(numRegex)}else if(typeof val==="number"){vals=[val]}if(vals&&!isNaN(i)){if(!str&&typeof val==="string"){str=val.split(numRegex);count=vals.length;if(str.length<count){str.push("")}}if(vals.length===count){for(j=0;j<vals.length;j++){vals[j]=parseFloat(vals[j],10)}keyframe={t:i,val:vals};if(timingFn&&timingFn!==prop.timing){keyframe.timing=timingFn}keyframes.push(keyframe)}}}}if(!keyframes.length){me.options[name]=opt;return false}if(keyframes.length===1){me.options[name]=keyframes[0].val;return false}prop.str=str;keyframes.sort(kfSort);if(typeof callback==="function"){prop.callback=callback}animatedProperties[name]=prop;animation.props.push(name);return true}function animateStyle(name,element){function isStyle(element,name){function replaceStyleHyphen(str,letter){return letter.toUpperCase()}var style,lower;if(name==="src"||name==="toString"||typeof element.style[name]==="function"){return false}if(element.style.hasOwnProperty(name)){return name}if(window.getComputedStyle){style=window.getComputedStyle(element);if(!style){style=window.getComputedStyle(document.body);if(!style){return false}}lower=name.toLowerCase();if(style.hasOwnProperty(name)||style[name]!==undefined||style.getPropertyValue(name)){return name.replace(styleHyphenRegex,replaceStyleHyphen)||false}if(style.hasOwnProperty(lower)||style[lower]!==undefined||style.getPropertyValue(lower)){return lower}}}var callback,animated=false,backup,jsName,prefixed,prefixedName,i;prefixed=stylePrefixRegex.exec(name);if(prefixed){prefixed=prefixed[1];for(i=0;i<browserPrefixes.length&&!jsName;i++){prefixedName=browserPrefixes[i]+prefixed;jsName=isStyle(element,prefixedName);if(styles[jsName]||jsName&&prefixedName!==name&&options[prefixedName]){return false}}}else{jsName=isStyle(element,name)}if(!jsName){return false}if(name==="top"||name==="left"||name==="right"||name==="bottom"){element.style.position="absolute"}callback=function(val){element.style[jsName]=val};styles[jsName]=true;backup={e:element,name:jsName};animated=animateOption(name,callback);if(!animated){backup.val=options[name]}setStyles.push(backup);return animated}if(!name){if(this.container){name=this.container}}name=name||"";for(i=animations.length-1;i>=0;i--){animation=animations[i];if(animation.name===name){while(animation.props.length){delete animatedProperties[animation.props.pop()]}animations.splice(i,1);break}}animation={name:name,opts:opts,props:[]};animations.push(animation);if(name instanceof window.HTMLElement){for(i in options){if(options.hasOwnProperty(i)){animated=animateStyle(i,name)||animated}}return animated}if(opts instanceof window.HTMLElement){return animateStyle(name,opts)}if(typeof opts==="function"){callback=opts}else if(typeof opts==="object"){callback=opts}return animateOption(name,callback)};definition=basePlugin.pluginFn.call(popcorn,options,this);if(!definition){definition={}}setupFn=definition._setup;definition._setup=function(options){if(typeof setupFn==="function"){setupFn.call(me,options)}runCallbackFunction(options.onSetup)};startFn=definition.start;definition.start=function(event,options){var i,s;if(!started){for(i=0;i<setStyles.length;i++){s=setStyles[i];s.backup=s.e.style[s.name];s.e.style[s.name]=s.val}}current=true;started=true;updateAnimations.call(me,0);if(typeof startFn==="function"){startFn.call(me,event,options)}runCallbackFunction(options.onStart);definition.frame(event,options,popcorn.currentTime())};frameFn=definition.frame;definition.frame=function(event,options,time){var i,p,start,end;if(started){updateAnimations.call(me,(time-me.options.start)/(me.options.end-me.options.start));if(typeof frameFn==="function"){frameFn.call(me,event,options,time)}runCallbackFunction(options.onFrame,time)}};updateFn=definition._update;if(updateFn){definition._update=function(trackEvent,changes){var i,j,s,target,reSort=false,animationList=[];if(changes.start===undefined){changes.start=options.start}else{changes.start=Popcorn.util.toSeconds(changes.start,popcorn.options.framerate)}if(changes.end===undefined){changes.end=options.end}else{changes.end=Popcorn.util.toSeconds(changes.end,popcorn.options.framerate)}if(changes.start!==options.start||changes.end!==options.end){reSort=true;options.start=changes.start;options.end=changes.end;me.options.start=options.start;me.options.end=options.end}if(changes.hasOwnProperty("target")){target=changes.target;if(target&&typeof target==="string"){target=document.getElementById(target)}if(target!==me.target){reSort=true}}if(reSort){insertInPlace(target);if(me.container){insertContainer()}}if(typeof updateFn==="function"){updateFn.call(me,options,changes)}for(j in changes){if(changes.hasOwnProperty(j)&&!updatePropertyBlacklist.test(j)){me.options[j]=changes[j];options[j]=changes[j];trackEvent[j]=changes[j]}}while(setStyles.length){s=setStyles.shift();s.e.style[s.name]=s.backup||""}for(i=0;i<animations.length;i++){animationList.push(animations[i])}for(i=0;i<animations.length;i++){me.animate(animations[i].name,animations[i].opts)}if(trackEvent._running){for(i=0;i<setStyles.length;i++){s=setStyles[i];s.backup=s.e.style[s.name];s.e.style[s.name]=s.val}}runCallbackFunction(trackEvent.onUpdate)}}endFn=definition.end;definition.end=function(event,options){if(started){var i,s;updateAnimations.call(me,1);runCallbackFunction(options.onEnd);if(typeof endFn==="function"){endFn.call(me,event,options)}for(i=0;i<setStyles.length;i++){s=setStyles[i];s.e.style[s.name]=s.backup}started=false}current=false};teardownFn=definition._teardown;definition._teardown=function(options){var parent,i;runCallbackFunction(options.onTeardown);if(typeof teardownFn==="function"){teardownFn.call(me,options)}if(me.container){parent=me.container.parentNode;if(parent){parent.removeChild(me.container)}delete me.container}i=allEvents.indexOf(me);if(i>=0){allEvents.splice(i,1)}}};PopcornBaseEvent.prototype.toArray=function(data,delimiters){var out;if(data===undefined){return[]}if(Object.prototype.toString.call(data)==="[object Array]"){return data}try{out=JSON.parse(data);if(Object.prototype.toString.call(out)!=="[object Array]"){out=[out]}}catch(e){out=data}if(delimiters&&typeof out==="string"){try{out=out.split(delimiters)}catch(er){}}if(out!==undefined&&out!==null&&Object.prototype.toString.call(out)!=="[object Array]"){return[out]}return out};PopcornBaseEvent.prototype.toObject=function(data){if(typeof data==="object"){return data}try{return JSON.parse(data)}catch(e){return data}};if(document!==undefined&&!document.createElement("a").classList){PopcornBaseEvent.prototype.hasClass=function(element,classes){var curClasses,i;if(!classes||!element||!element.getAttribute){return}curClasses=element.getAttribute("class")||"";curClasses=curClasses.split(/[\s\t\r\n ]+/);for(i=0;i<curClasses.length;i++){if(curClasses[i]===classes){return true}}return false};PopcornBaseEvent.prototype.addClass=function(element,classes){var curClasses,i;if(!classes||!element||!element.getAttribute){return}classes=PopcornBaseEvent.prototype.toArray(classes,/[\s\t\r\n ]+/);curClasses=element.getAttribute("class")||"";curClasses=curClasses.split(/[\s\t\r\n ]+/);for(i=0;i<classes.length;i++){if(curClasses.indexOf(classes[i])<0){curClasses.push(classes[i])}}element.setAttribute("class",curClasses.join(" "))};PopcornBaseEvent.prototype.removeClass=function(element,classes){var curClasses,i,index;if(!classes||!element||!element.getAttribute){return}classes=PopcornBaseEvent.prototype.toArray(classes,/[\s\t\r\n ]+/);curClasses=element.getAttribute("class")||"";curClasses=curClasses.split(/[\s\t\r\n ]+/);for(i=0;i<classes.length;i++){index=curClasses.indexOf(classes[i]);if(index>=0){curClasses.splice(index,1)}}element.setAttribute("class",curClasses.join(" "))}}else{PopcornBaseEvent.prototype.hasClass=function(element,classes){var i;if(!element||!element.classList){return}for(i=0;i<element.classList.length;i++){if(element.classList[i]===classes){return true}}return false};PopcornBaseEvent.prototype.addClass=function(element,classes){var c,i;if(!element||!element.classList){return}c=PopcornBaseEvent.prototype.toArray(classes,/[\s\t\r\n ]+/);for(i=0;i<c.length;i++){try{element.classList.add(c[i])}catch(e){}}};PopcornBaseEvent.prototype.removeClass=function(element,classes){var c,i;if(!element||!element.classList){return}c=PopcornBaseEvent.prototype.toArray(classes,/[\s\t\r\n ]+/);for(i=0;i<c.length;i++){try{element.classList.remove(c[i])}catch(e){}}}}PopcornBaseEvent.prototype.nop=function(){};Popcorn.basePlugin=function(name,plugin,manifest){var bp=new PopcornBasePlugin(name,plugin,manifest)};Popcorn.basePlugin.toArray=PopcornBaseEvent.prototype.toArray;Popcorn.basePlugin.toObject=PopcornBaseEvent.prototype.toObject;Popcorn.basePlugin.addClass=PopcornBaseEvent.prototype.addClass;Popcorn.basePlugin.removeClass=PopcornBaseEvent.prototype.removeClass;timing={"step-start":function(n){function f(t){return Math.floor(t*n)/n}if(n<1){return timing.linear()}return f},"step-end":function(n){function f(t){return Math.ceil(t*n)/n}if(n<1){return timing.linear()}return f},linear:function(){function f(t){return t}return f},"cubic-bezier":function(p1,p2,p3,p4){var cx,bx,ax,cy,by,ay;function bezierX(t){return t*(cx+t*(bx+t*ax))}function bezierY(t){return t*(cy+t*(by+t*ay))}function bezierXDeriv(t){return cx+t*(2*bx+3*ax+t)}function findX(t){var x=t,i=0,z;while(i<10){z=bezierX(x)-t;if(Math.abs(z)<1e-4){break}x=x-z/bezierXDeriv(x);i++}return x}if(isNaN(p1)){p1=.25}if(isNaN(p2)){p2=.1}if(isNaN(p3)){p3=.25}if(isNaN(p4)){p4=1}p2=Math.min(Math.max(p2,0),1);p4=Math.min(Math.max(p4,0),1);cx=3*p1;bx=3*(p3-p1)-cx;ax=1-cx-bx;cy=3*p2;by=3*(p4-p2)-cy;ay=1-cy-by;return function(t){return bezierY(findX(t))}},ease:function(){return timing["cubic-bezier"](.25,.1,.25,1)},"ease-in":function(){return timing["cubic-bezier"](.42,0,1,1)},"ease-in-out":function(){return timing["cubic-bezier"](.42,0,.58,1)},"ease-out":function(){return timing["cubic-bezier"](0,0,.58,1)},"ease-in-power":function(power){function f(t){return Math.pow(t,power)}if(isNaN(power)||power<0){return timing.linear()}return f},"ease-in-out-power":function(power){function f(t){if(t<.5){return.5*Math.pow(t*2,power)}return-.5*(Math.pow(Math.abs(t*2-2),power)-2)}if(isNaN(power)||power<0){return timing.linear()}return f},"ease-out-power":function(power){function f(t){return 1-Math.pow(Math.abs(t-1),power)}if(isNaN(power)||power<0){return timing.linear()}return f},"ease-in-quad":function(){return timing["ease-in-power"](2)},"ease-in-out-quad":function(){return timing["ease-in-out-power"](2)},"ease-out-quad":function(){return timing["ease-out-power"](2)},"ease-in-cubic":function(){return timing["ease-in-power"](3)},"ease-in-out-cubic":function(){return timing["ease-in-out-power"](3)},"ease-out-cubic":function(){return timing["ease-out-power"](3)},"ease-in-quart":function(){return timing["ease-in-power"](4)},"ease-in-out-quart":function(){return timing["ease-in-out-power"](4)},"ease-out-quart":function(){return timing["ease-out-power"](4)},"ease-in-quint":function(){return timing["ease-in-power"](5)},"ease-in-out-quint":function(){return timing["ease-in-out-power"](5)},"ease-out-quint":function(){return timing["ease-out-power"](5)},"ease-in-sine":function(){function f(t){return-Math.cos(t*Math.PI/2)+1}return f},"ease-in-out-sine":function(){function f(t){return-.5*(Math.cos(Math.PI*t)-1)}return f},"ease-out-sine":function(){function f(t){return Math.sin(t*Math.PI/2)}return f},"ease-in-exp":function(){function f(t){return!t?0:Math.pow(2,10*(t-1))}return f},"ease-in-out-exp":function(){function f(t){if(!t){return 0}if(t===1){return 1}if(t<.5){return.5*Math.pow(2,10*(t*2-1))}return.5*(-Math.pow(2,-10*(t*2-1))+2)}return f},"ease-out-exp":function(){function f(t){return t===1?1:-Math.pow(2,-10*t)+1}return f},"ease-in-circ":function(){function f(t){return 1-Math.sqrt(1-t*t)}return f},"ease-out-circ":function(){function f(t){return Math.sqrt(1-Math.pow(t-1,2))}return f},"ease-in-out-circ":function(){function f(t){if(t<.5){return-.5*(Math.sqrt(1-Math.pow(t*2,2))-1)}return.5*(Math.sqrt(1-Math.pow(t*2-2,2))+1)}return f},bounce:function(gravity,bounce){var bounces,i,b,diff;if(!gravity||gravity<=0){gravity=9.8*4}if(isNaN(bounce)||bounce<0){bounce=.5625}bounces=[{t0:0,h:1,t:Math.sqrt(2/gravity),x0:0}];b=bounces[0];for(i=1,diff=1;i<15&&diff>.005;i++){b={t0:b.t,h:b.h*bounce,t:b.t+2*Math.sqrt(2*bounce*b.h/gravity)};diff=b.t-b.t0;b.x0=(b.t+b.t0)/2;bounces.push(b)}return function(t){var i,b,x;for(i=0;i<bounces.length;i++){b=bounces[i];if(t<b.t){break}}if(t>b.t){return 1}x=t-b.x0;return.5*gravity*x*x-b.h+1}}};timing.step=timing["step-start"];Popcorn.basePlugin.timing=timing})(window,window.Popcorn);hy.define("popcorn.base",["popcorn","popcorn.compatible"],function(global){return function(){var ret,fn;return ret||global.Popcorn.basePlugin}}(this));(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.filter");require("popcorn.data");require("popcorn.datafilter");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.gates",["popcorn","popcorn.filter","popcorn.data","popcorn.datafilter"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,popcornfilter,undefined){var instances={};function checkGates(instance,update){var popcorn=instance.popcorn;var gatedClass="hapyak-is-gated",hapyakPlayer=popcorn.options&&popcorn.options.hapyakPlayer;function checkMinGate(){return popcorn.currentTime()-instance.minGate>=.4}if(update){instance.minGate=Infinity;Popcorn.forEach(popcorn.getTrackEvents(),function(trackEvent){var newGateValue=trackEvent.gateAtEnd?trackEvent.end-.5:trackEvent.start,hasLoopback=trackEvent.onClick&&trackEvent.onClick.loopback==="loop";if(trackEvent&&trackEvent.gate&&!popcorn.getData(trackEvent._id,"condition")){if(newGateValue<instance.minGate){instance.loopback=!!hasLoopback;instance.startTime=trackEvent.start;instance.minGate=newGateValue}else if(newGateValue===instance.minGate){if(!instance.loopback){instance.loopback=!!hasLoopback;instance.startTime=trackEvent.start}else{instance.startTime=Math.min(instance.start,trackEvent.start)}}}})}if(instance.editMode){if(hapyakPlayer){hapyakPlayer.removeClass(gatedClass)}return false}if(popcorn.currentTime()>=instance.minGate){if(hapyakPlayer){hapyakPlayer.addClass(gatedClass)}instance.gateLocked=true;if(instance.loopback){if(checkMinGate()){popcorn.currentTime(instance.startTime)}}else{popcorn.pause();if(checkMinGate()){popcorn.currentTime(instance.minGate)}}return true}if(instance.gateLocked){if(hapyakPlayer){hapyakPlayer.removeClass(gatedClass)}instance.gateLocked=false;popcorn.play()}return false}Popcorn.dataFilter(["editMode","condition"],"gates","",function(name,options,next,node,editMode){var instance=instances[this.id];if(instance){instance.editMode=editMode}else{instance={popcorn:this,minGate:Infinity,gateLocked:false,editMode:editMode,timeupdate:function(){checkGates(instance)}};instances[this.id]=instance;this.on("timeupdate",instance.timeupdate)}next(options);checkGates(instance,true)},true,function(){var instance=instances[this.id];if(!instance){return}if(this.data.trackEvents.byStart.length<2||this.data.trackEvents.byStart.length===2&&!this.data.trackEvents.byStart[1]._natives){this.off("timeupdate",instance.timeupdate);checkGates(instance,true);delete instances[this.id];return}checkGates(instance,true)});Popcorn.p.checkGates=function(update){var instance=instances[this.id];if(instance){return checkGates(instance,update)}return false}});hy.define("popcorn.pop",["module","popcorn","configuration","player.playereval","utils","utils.samedomain","popcorn.base","popcorn.gates"],function(module,Popcorn,configuration,playereval,utils,sameDomain){var moduleConfig=module.config(),playerConfig=configuration&&configuration.player;var linkRegex=/(\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’])))|(([0-9]+):([0-9]{2}(\.[0-9]+)?))/gi,protocolRegex=/^https?:\/\//i;var events=[],fonts={},isHovering=false,localLinks=playerConfig.localLinks||moduleConfig.localLinks||false,MAX_AUDIO_TIME=2,soundIndex=0,sounds={},webFontRequested=false,webFontPromises=[];function requireFont(provider,font,callback){function loadFont(){var p,f,loadObj,dummy;p=fonts[provider];if(!p){p=fonts[provider]={}}f=p[font];if(!f){f=p[font]={loaded:false,queue:[callback]};dummy=document.createElement("span");dummy.style.position="absolute";dummy.style.visibility="hidden";dummy.style.fontFamily=font;dummy.appendChild(document.createTextNode("loading font "+font+"..."));document.body.appendChild(dummy);loadObj={fontactive:function(){var fn,queue=f.queue;f.loaded=true;if(dummy&&dummy.parentNode){dummy.parentNode.removeChild(dummy)}dummy=null;while(queue.length){fn=queue.shift();fn()}}};loadObj[provider]={families:[font+(provider==="google"?"::latin":"")]};window.WebFont.load(loadObj)}else if(f.loaded){callback()}else{f.queue.push(callback)}}function checkWebFontLoaded(){var fn;if(window.WebFont){while(webFontPromises.length){fn=webFontPromises.shift();fn()}return}setTimeout(checkWebFontLoaded,20)}var script;if(window.WebFont){loadFont();return}webFontPromises.push(loadFont);if(webFontRequested){return}webFontRequested=true;script=document.createElement("script");script.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";script.async=true;document.head.appendChild(script);setTimeout(checkWebFontLoaded,0)}function drawThought(canvas,lineWidth,isLink,bgColor){var annotation=canvas.parentNode.parentNode,ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);if(!bgColor){ctx.strokeStyle=isLink&&isHovering?"#1892BF":"#000000"}else{annotation.style.borderColor=bgColor}ctx.save();ctx.translate(2,10);ctx.beginPath();ctx.moveTo(13.5,7);ctx.bezierCurveTo(13.5,10.6,10.6,13.5,7,13.5);ctx.bezierCurveTo(3.4,13.5,.5,10.6,.5,7);ctx.bezierCurveTo(.5,3.4,3.4,.5,7,.5);ctx.bezierCurveTo(10.6,.5,13.5,3.4,13.5,7);ctx.closePath();ctx.fillStyle=bgColor||window.getComputedStyle(annotation).backgroundColor;ctx.fill();if(!bgColor){ctx.lineWidth=lineWidth;ctx.stroke()}ctx.beginPath();ctx.moveTo(17.5,23.8);ctx.bezierCurveTo(17.5,26.1,15.6,28,13.2,28);ctx.bezierCurveTo(10.9,28,9,26.1,9,23.8);ctx.bezierCurveTo(9,21.4,10.9,19.5,13.2,19.5);ctx.bezierCurveTo(15.6,19.5,17.5,21.4,17.5,23.8);ctx.closePath();ctx.fill();if(!bgColor){ctx.lineWidth=lineWidth;ctx.stroke()}ctx.beginPath();ctx.moveTo(27.5,31.8);ctx.bezierCurveTo(27.5,33.5,26,35,24.2,35);ctx.bezierCurveTo(22.5,35,21,33.5,21,31.8);ctx.bezierCurveTo(21,30,22.5,28.5,24.2,28.5);ctx.bezierCurveTo(26,28.5,27.5,30,27.5,31.8);ctx.closePath();ctx.fill();if(!bgColor){ctx.lineWidth=lineWidth;ctx.stroke()}ctx.restore()}function drawSpeech(canvas,lineWidth,isLink,bgColor){var annotation=canvas.parentNode.parentNode,ctx=canvas.getContext("2d");if(!bgColor){ctx.strokeStyle=isLink&&isHovering?"#1892BF":"#000000"}else{annotation.style.borderColor=bgColor;canvas.style.borderTopColor=bgColor}ctx.clearRect(0,0,canvas.width,canvas.height);ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.bezierCurveTo(0,0,10.8,26.3,35,41.9);ctx.bezierCurveTo(35,41.9,19.2,26.3,23.4,0);ctx.fillStyle=bgColor||window.getComputedStyle(annotation).backgroundColor;ctx.fill();if(!bgColor){ctx.lineWidth=lineWidth;ctx.stroke()}ctx.restore()}Popcorn.basePlugin("pop",function(options,base){var popcorn=this,video,target,container,relative,textContainer,audio,canvas,pause,baseWidth,loaded=false,destroyed=false,shortenUrls,validateLink,templateEvaluator=new playereval.TemplateEvaluator(this,options),modes={thought:{drawFn:drawThought,className:"popcorn-pop-thought"},speech:{drawFn:drawSpeech,className:"popcorn-pop-speech"},outline:{className:"popcorn-pop-outline"},black:{className:"hapyak-theme-black"},white:{className:"hapyak-theme-white"},pop:{className:"hapyak-theme-pop"}};function onMouseOver(){isHovering=true;beforeDraw(modes[options.mode].drawFn,base.hasClass(container,"hapyak-linked"))}function onMouseOut(){isHovering=false;beforeDraw(modes[options.mode].drawFn,base.hasClass(container,"hapyak-linked"))}function setLinkState(){if(base.hasClass(container,"hapyak-linked")&&["speech","thought"].indexOf(options.mode)>-1){container.addEventListener("mouseover",onMouseOver,true);container.addEventListener("mouseout",onMouseOut,true)}else{container.removeEventListener("mouseover",onMouseOver,true);container.removeEventListener("mouseout",onMouseOut,true)}}function beforeDraw(drawFunc,isLink){if(drawFunc){if(!canvas){canvas=document.createElement("canvas");canvas.width=40;canvas.height=60;relative.appendChild(canvas)}if(options.arrow&&options.arrow.indexOf("right")>=0){base.addClass(canvas.parentNode,"right")}else{base.removeClass(canvas.parentNode,"right")}if(options.arrow&&options.arrow.indexOf("top")>=0){base.addClass(canvas.parentNode,"top")}else{base.removeClass(canvas.parentNode,"top")}if(options.flipTail){base.addClass(canvas.parentNode,"flip")}else{base.removeClass(canvas.parentNode,"flip")}drawFunc(canvas,2,isLink,options.backgroundColor)}else if(canvas){if(canvas.parentNode){canvas.parentNode.removeChild(canvas)}canvas=null}}function selectAudio(src){var i,j,event,diff,eligibleAudio,audio;function resetAudio(){audio.currentTime=0;audio.pause()}if(!sounds[src]){audio=document.createElement("audio");audio.src=src;audio.id="popcorn-pop-sound-"+soundIndex;soundIndex++;audio.preload=true;audio.style.display="none";audio.addEventListener("ended",resetAudio,false);document.body.appendChild(audio);sounds[src]=[audio];return audio}audio=sounds[src][0];if(audio.duration){diff=Math.min(audio.duration,MAX_AUDIO_TIME)}else{diff=MAX_AUDIO_TIME}eligibleAudio=sounds[src].slice(0);for(i=0;i<events.length;i++){event=events[i];if(event.sound===options.sound&&event.start<=options.start+diff&&event.start+diff>=options.start){j=eligibleAudio.indexOf(event.audio);if(j>=0){eligibleAudio.splice(j,1)}}}if(eligibleAudio.length){audio=eligibleAudio[0]}else{audio=sounds[src][0].cloneNode(true);audio.id="popcorn-pop-sound-"+soundIndex;soundIndex++;audio.removeEventListener("ended",resetAudio,false);audio.addEventListener("ended",resetAudio,false);document.body.appendChild(audio);sounds[src].push(audio)}return audio}function makeTimeLinkCallback(time){return function(event){event.preventDefault();if(time>=0&&time<popcorn.duration()){popcorn.currentTime(time)}}}function pauseMedia(){popcorn.media.pause()}function setText(){var i,j,s,text,link,url,urlString;text=templateEvaluator.evaluate(options.text);text=text.split(/[\n\r]/);textContainer.innerHTML="";textContainer.setAttribute("tabindex","0");for(i=0;i<text.length;i++){if(i){textContainer.appendChild(document.createElement("br"))}s=text[i];j=0;linkRegex.lastIndex=0;url=linkRegex.exec(s);while(url){textContainer.appendChild(document.createTextNode(s.substr(j,url.index-j)));if(url[1]){if(!protocolRegex.test(url[1])){url[1]="http://"+url[1]}if(!validateLink||validateLink(url[1])){link=document.createElement("a");link.className="popcorn-pop-link";if(!localLinks||!sameDomain.test(url[1])){link.setAttribute("target","_blank")}link.setAttribute("href",url[1]);link.setAttribute("data-hapyak-log",true);urlString=url[0];if(shortenUrls){urlString=urlString.replace(protocolRegex,"");if(urlString.length>20){urlString=urlString.substr(0,17)+"..."}}link.appendChild(document.createTextNode(urlString));link.addEventListener("click",pauseMedia,true);textContainer.appendChild(link)}else if(textContainer.lastChild.nodeType===3){textContainer.lastChild.nodeValue+=url[0]}else{textContainer.appendChild(document.createTextNode(url[0]))}}else if(url[7]){link=document.createElement("a");link.setAttribute("href","#");link.appendChild(document.createTextNode(url[0]));link.addEventListener("click",makeTimeLinkCallback((parseFloat(url[8])||0)*60+(parseFloat(url[9])||0)),true);textContainer.appendChild(link)}j=linkRegex.lastIndex;url=linkRegex.exec(s);if(link){link.setAttribute("title",link.href)}link=null}if(j<s.length){textContainer.appendChild(document.createTextNode(s.substr(j)))}}}function watchText(){if(!popcorn.getData(options.dataId||options.id,"hapyak-editing")){setText()}}function setMode(){var mode,drawFn;for(mode in modes){if(mode!==options.mode&&modes[mode].className){base.removeClass(container,modes[mode].className)}else{drawFn=modes[mode].drawFn;if(modes[mode].className){base.addClass(container,modes[mode].className)}}}setLinkState();if(options.mode==="outline"){if(document.createElement("div").style.webkitTextStroke===""){base.addClass(container,"popcorn-pop-outline-stroke")}else if(document.createElement("div").style.textShadow===""){base.addClass(container,"popcorn-pop-outline-shadow")}else{base.addClass(container,"popcorn-pop-outline-fallback")}}else{base.removeClass(container,"popcorn-pop-outline-stroke");base.removeClass(container,"popcorn-pop-outline-shadow");base.removeClass(container,"popcorn-pop-outline-fallback")}beforeDraw(drawFn)}function setFont(){base.addClass(container,"hide");if(destroyed){return}loaded=true;if(container){base.removeClass(container,"hide");if(typeof options.onLoad==="function"){options.onLoad(options)}popcorn.emit("resized")}}shortenUrls=popcorn.options&&popcorn.options.shortenUrls;if(shortenUrls===undefined){shortenUrls=true}validateLink=popcorn.options&&popcorn.options.validateLink
;base.target=base.target||options.target;if(!base.target){return{_update:function(){}}}if(!options.mode){options.mode="pop"}if(!options.text){options.text=""}video=popcorn.media;target=base.target;container=base.makeContainer();options.container=container;relative=document.createElement("div");container.appendChild(relative);base.animate();baseWidth=options.baseWidth||800;if(options.textContainer){relative.appendChild(options.textContainer)}else{textContainer=document.createElement("div");relative.appendChild(textContainer);setText()}setMode();setFont();templateEvaluator.watchTemplateVars(options.text,watchText);if(options.sound){if(options.sound===true){options.sound="/sounds/mouthpop.ogg"}else if(options.sound instanceof window.HTMLMediaElement){audio=options.sound;options.sound=audio.currentSrc}if(!audio){audio=selectAudio(options.sound);options.audio=audio}events.push(options)}options.annotationVariableConfig.add("pop",options,function(scope,key,data){if(data.link&&typeof data.link==="string"&&options.onClick){options.onClick.gotoLink=data.link}if(data.text){options.text=data.text}setText()});return{start:function(event,options){base.addClass(base.container,"active");setLinkState();if(audio&&audio.duration&&!video.paused&&video.currentTime-1<options.start){audio.volume=video.volume;audio.muted=video.muted;audio.play();if(!audio.duration||isNaN(audio.duration)||audio.duration>MAX_AUDIO_TIME){setTimeout(function(){audio.currentTime=0;audio.pause()},MAX_AUDIO_TIME)}}},end:function(){base.removeClass(base.container,"active")},_update:function(trackEvent,changes){var BASE_WIDTH,width;textContainer.innerHTML="";options.text=changes.text||"";templateEvaluator.watchTemplateVars(options.text,watchText);setText();if(changes.pause!==undefined&&options.pause!==changes.pause||changes.end!==options.end||changes.start!==options.start){options.pause=changes.pause}if(!trackEvent.width||!/[0-9\.]+px/i.test(trackEvent.width)){BASE_WIDTH=configuration.player.baseWidth||1200;width=utils.measurePopText(trackEvent,BASE_WIDTH);options.width=width/BASE_WIDTH*100+"%";container.style.width=options.width}if(changes.hasOwnProperty("mode")&&changes.mode!==options.mode||changes.hasOwnProperty("arrow")&&options.arrow!==changes.arrow||changes.hasOwnProperty("flipTail")&&changes.flipTail!==options.flipTail||changes.hasOwnProperty("backgroundColor")&&options.backgroundColor!==changes.backgroundColor){options.mode=changes.mode;options.arrow=changes.arrow;options.flipTail=changes.flipTail;options.backgroundColor=changes.backgroundColor;container.style.backgroundColor=options.backgroundColor;setMode()}if(changes.hasOwnProperty("fontFamily")&&options.fontFamily!==changes.fontFamily||changes.hasOwnProperty("fontProvider")&&options.fontProvider!==changes.fontProvider){options.fontFamily=changes.fontFamily;options.fontProvider=changes.fontProvider;setFont()}options.annotationVariableConfig.update("pop",options)},_teardown:function(){var i;destroyed=true;i=events.indexOf(options);if(i>=0){events.splice(i,1)}options.annotationVariableConfig.remove(options.annotationId)}}},{about:{name:"Popcorn Pop Plugin",version:.2,author:"Hapyak",website:"http://www.hapyak.com"},options:{start:{elem:"input",type:"number",label:"Start",units:"seconds"},end:{elem:"input",type:"number",label:"End",units:"seconds"},text:{elem:"input",type:"text",label:"Text"},link:{elem:"input",type:"url",label:"Link URL"},linkTarget:{elem:"input",type:"text",label:"Link Target"}}})});hy.define("player.normalizeonclick",["popcorn","utils","utils.validatelink"],function(Popcorn,utils,validateLink,undefined){var protocolRegex=/^(https?:\/\/|mailto:)/i,trackTimeRegex=/^([0-9]+)?(?:#((([0-9]+):)?([0-9]+(?:\.[0-9]+)?)))?$/,cssRegex=/^[\-\w]+$/,varListRegex=utils.regex.onClickVariables,normalize;normalize={gotoLink:function(link,trackEvent){var onClick;if(!link){onClick=Popcorn.extend({},trackEvent&&trackEvent.onClick);onClick.gotoLink=null}if(utils.regex.validDomain.test(link.replace(/(?:(mailto|https?):)?\/\//,""))&&validateLink(link)){onClick=Popcorn.extend({},trackEvent&&trackEvent.onClick);if(protocolRegex.test(link)){onClick.gotoLink=link}else{onClick.gotoLink="http://"+link}}utils.regex.validDomain.lastIndex=0;protocolRegex.lastIndex=0;return onClick?{onClick:onClick}:false},gotoTrack:function(trackTime,trackEvent,callback){var parse,duration,onClick,me=this;function evaluateTime(){var time=Popcorn.util.toSeconds(parse[2]);time=Math.min(duration,time);onClick.gotoTrack=(parse[1]||"")+"#"+time;return{onClick:onClick}}if(!trackTime){onClick=Popcorn.extend({},trackEvent&&trackEvent.onClick);onClick.gotoTrack=null;return{onClick:onClick}}parse=trackTimeRegex.exec(trackTime);if(parse){onClick=Popcorn.extend({},trackEvent&&trackEvent.onClick);if(!parse[2]){onClick.trackTime=trackTime;return{onClick:onClick}}duration=me.duration();if(duration){return evaluateTime()}me.on("durationchange",function(){duration=me.duration();callback(evaluateTime())});return undefined}trackTimeRegex.lastIndex=0;return false},addClasses:function(classes,trackEvent){var onClick;if(!classes||cssRegex.test(classes)){onClick=Popcorn.extend({},trackEvent&&trackEvent.onClick);onClick.addClasses=classes||null;return{onClick:onClick}}cssRegex.lastIndex=0;return false},setVariables:function(expr,trackEvent){var onClick;varListRegex.test("");if(!expr||varListRegex.test(expr)){onClick=Popcorn.extend({},trackEvent&&trackEvent.onClick);onClick.setVariables=expr||null;return{onClick:onClick}}varListRegex.lastIndex=0;return false},onClick:function(onClick,trackEvent,callback){var obj={},result;if(onClick.gotoLink){result=normalize.gotoLink.call(this,onClick.gotoLink,trackEvent,callback);if(result===false){return false}obj.gotoLink=result.onClick.gotoLink}if(onClick.addClasses){result=normalize.addClasses.call(this,onClick.addClasses,trackEvent,callback);if(result===false){return false}obj.addClasses=result.onClick.addClasses}if(onClick.setVariables){result=normalize.setVariables.call(this,onClick.setVariables,trackEvent,callback);if(result===false){return false}obj.setVariables=result.onClick.setVariables}if(onClick.gotoTrack){result=normalize.gotoTrack.call(this,onClick.gotoTrack,trackEvent,function(result){if(result===false){callback(false)}else{obj.gotoTrack=result.onClick.gotoTrack;callback({onClick:obj})}});if(result===false){return false}if(result!==undefined){obj.gotoTrack=result.onClick.gotoTrack;return{onClick:obj}}}else{return{onClick:obj}}}};return normalize});hy.define("player.normalizetransition",[],function(undefined){var transitionRegex=/^hapyak-transition-(none|fade|pop|slide-up)$/;return function(value){if(!value){return"hapyak-transition-none"}if(transitionRegex.test(value)){return value}return false}});hy.define("utils.parsecolor",[],function(){var rgbaRegex=/^rgba?\(\s*(\d+)(%?)\s*,\s*(\d+)(%?)\s*,\s*(\d+)(%?)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i,hexRegex=/^#([0-9a-fA-F]{3,6})/,hslaRegex=/^hsla?\(\s*(\d+(?:\.\d*)?)\s*,\s*(\d+)%?\s*,\s*(\d+)%?\s*(?:,\s*(\d+(?:\.\d*)?)\s*)?\)/i,colorRegex=/^[a-zA-Z]+/,colorNames={transparent:{r:0,g:0,b:0,a:0},black:{r:0,g:0,b:0,a:1},red:{r:255,g:0,b:0,a:1},green:{r:0,g:128,b:0,a:1},blue:{r:0,g:0,b:255,a:1},white:{r:255,g:255,b:255,a:1},silver:{r:192,g:192,b:192,a:1},gray:{r:128,g:128,b:128,a:1},maroon:{r:128,g:0,b:0,a:1},purple:{r:128,g:0,b:128,a:1},fuchsia:{r:255,g:0,b:255,a:1},lime:{r:0,g:255,b:0,a:1},olive:{r:128,g:128,b:0,a:1},yellow:{r:255,g:255,b:0,a:1},navy:{r:0,g:0,b:128,a:1},teal:{r:0,g:128,b:128,a:1},aqua:{r:0,g:255,b:255,a:1},orange:{r:255,g:165,b:0,a:1}},colorElement;function hslToRgb(h,s,l,a){function hueToRgb(m1,m2,h){h=h-Math.floor(h);if(h<1/6){return m1+(m2-m1)*h*6}if(h<1/2){return m2}if(h<2/3){return m1+(m2-m1)*(2/3-h)*6}return m1}var m1,m2;if(l<.5){m2=l*(s+1)}else{m2=l+s-l*s}m1=l*2-m2;return{r:Math.floor(hueToRgb(m1,m2,h+1/3)*255),g:Math.floor(hueToRgb(m1,m2,h)*255),b:Math.floor(hueToRgb(m1,m2,h-1/3)*255),a:a===undefined?1:a}}function parseHex(str){var parsed,color,s;parsed=hexRegex.exec(str);if(parsed&&parsed.length>=2){s=parsed[1];if(s.length<6){color={r:parseInt(s[0],16)*255/15,g:parseInt(s[1],16)*255/15,b:parseInt(s[2],16)*255/15,a:1}}else{color={r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:1}}return color}return false}function parseRGBA(str){var color,parsed=rgbaRegex.exec(str);if(parsed&&parsed.length){color={r:Math.round(parseFloat(parsed[1])*(parsed[2]?255/100:1)),g:Math.round(parseFloat(parsed[3])*(parsed[4]?255/100:1)),b:Math.round(parseFloat(parsed[5])*(parsed[6]?255/100:1))};if(parsed[8]){color.a=parseFloat(parsed[8])}else{color.a=1}return color}return false}function parseHSLA(str){var h,s,l,a,parsed;parsed=hslaRegex.exec(str);if(parsed&&parsed.length){h=parseFloat(parsed[1])/360;s=parseFloat(parsed[2])/100;l=parseFloat(parsed[3])/100;a=parsed[4]&&parseFloat(parsed[4]);return hslToRgb(h,s,l,a)}}function parseName(str){var color,computed,bg;if(colorRegex.test(str)){str=str.toLowerCase();color=colorNames[str];if(color){return{r:color.r,g:color.g,b:color.b,a:color.a}}if(!colorElement){colorElement=document.createElement("a")}colorElement.style.backgroundColor="";colorElement.style.backgroundColor=str;computed=window.getComputedStyle(colorElement);bg=computed.getPropertyValue("background-color")||computed.getPropertyValue("backgroundColor")||colorElement.style.backgroundColor;if(bg&&bg!==str){colorNames[str]=parseColor(bg);return colorNames[str]}}return false}function parseColor(str){var color;if(!str){return false}color=parseHex(str);if(color){return color}color=parseRGBA(str);if(color){return color}color=parseHSLA(str);if(color){return color}color=parseName(str);if(color){return color}return false}return parseColor});hy.define("player.normalizecolor",["utils.parsecolor"],function(parseColor){return function(value){var color=parseColor(value);function hexify(channelValue){var hex=Math.round(channelValue).toString(16).toUpperCase();if(hex.length===1){hex="0"+hex}return hex}if(!color){return false}if(!color.a){return"rgba(0, 0, 0, 0)"}if(color.a===1){return"#"+hexify(color.r)+hexify(color.g)+hexify(color.b)}return"rgba("+Math.round(color.r)+", "+Math.round(color.g)+", "+Math.round(color.b)+", "+color.a+")"}});hy.define("popcorn.profile.pop",["utils","popcorn","player.normalizeonclick","player.normalizetransition","player.normalizecolor","configuration","popcorn.pop"],function(utils,Popcorn,normalizeonclick,normalizeTransition,normalizeColor,configuration){var template={"":"textarea","#":"popText",".":"disabled",placeholder:"write pop comment here",title:"Any text you enter in the box below will show up as popup comment synchronized to the video."},modeRegex=/^(thought|speech|outline|black|white|pop)$/;function PopText(){var elements=utils.microTemplate(null,template),editor;function onKeyUp(e){if(editor&&e.keyCode===13&&!e.shiftKey&&!e.ctrlKey){editor.done();elements.popText.blur()}}utils.inputPlaceholder(elements.popText);this.width=150;this.id="popText";this.element=elements.popText;this.activate=function(){elements.popText.addEventListener("keyup",onKeyUp,false)};this.deactivate=function(){elements.popText.removeEventListener("keyup",onKeyUp,false)};this.editor=function(e){editor=e}}return{id:"pop",icon:"text_format",sortIndex:4,enableAltControls:false,title:"text overlay link",editor:["popcorn.quickedit.pop"],zIndex:7,normalize:{"onClick.gotoLink":normalizeonclick.gotoLink,"onClick.gotoTrack":normalizeonclick.gotoTrack,"onClick.addClasses":normalizeonclick.addClasses,"onClick.setVariables":normalizeonclick.setVariables,onClick:normalizeonclick.onClick,mode:function(value){if(!value){return""}if(modeRegex.test(value)){return value}return false},backgroundColor:normalizeColor,"background-color":normalizeColor,color:normalizeColor,transitionClass:normalizeTransition},variables:{populateConfig:function(id,options){var config={},data={},key="Pop_"+id;if(options.text){data.text=options.text}if(options.onClick&&options.onClick.gotoLink){data.link=options.onClick.gotoLink}config[key]=data;return config}},defaults:{text:"",onLoad:function(trackEvent){var BASE_WIDTH,width;if(trackEvent&&trackEvent.container){utils.removeClass(trackEvent.container,"hide")}if(!trackEvent._natives){delete trackEvent.onLoad;delete trackEvent.onStart;return}trackEvent._natives._loaded=true;if(trackEvent.text&&(!trackEvent.width||!/[0-9\.]+(?:px|%)/i.test(trackEvent.width))){BASE_WIDTH=configuration.player.baseWidth||1200;width=utils.measurePopText(trackEvent,BASE_WIDTH);trackEvent.width=width/BASE_WIDTH*100+"%";trackEvent.container.style.width=trackEvent.width}}},altControls:function(editor){return[new PopText(editor)]},filter:function(trackEvent,annotation){var text,wordCount,meta,dim;if(!isNaN(trackEvent.start)&&!trackEvent._duration&&(trackEvent.content||trackEvent.text)){text=trackEvent.content||trackEvent.text;wordCount=0;Popcorn.forEach(text.split(/[\n\r\s\t ]+/),function(word){if(word.length>2){wordCount++}});if(trackEvent.pause){if(trackEvent.pause!==-1){trackEvent.pause=Math.min(6,Math.max(2,.5*wordCount))}trackEvent.end=.5}else if(!trackEvent.end){trackEvent.end=trackEvent.start+Math.min(10,Math.max(3,.5*wordCount))}}if(!trackEvent.text&&trackEvent.content){trackEvent.text=trackEvent.content}if(!trackEvent.text){return false}delete trackEvent.content;delete trackEvent.maxWidth;delete trackEvent["max-width"];if(trackEvent.mode==="outline"&&trackEvent.fontFamily){meta=Popcorn.extend({},annotation.getCustomProperty("meta"));meta.fontFamily=trackEvent.fontFamily;annotation.setCustomProperty("meta",meta)}if(trackEvent.left===undefined||parseFloat(trackEvent.left)<0){trackEvent.left="0px"}if(trackEvent.top===undefined||parseFloat(trackEvent.top)<0){trackEvent.top="0px"}dim=/([\-+]?[0-9]*\.?[0-9]*)px/.exec(trackEvent.width);if(dim){trackEvent.width=parseFloat(dim[1])/800*100+"%"}},create:function(id,annotation,editor,alt){editor.setting(id,"textInput",alt&&alt[0].element);if(alt){alt[0].editor(editor)}}}});(function(root,factory){if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.captions",["popcorn","popcorn.filter","dao","utils","configuration","popcorn.pop","popcorn.profile.pop"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,popcornfilter,dao,utils,configuration,undefined){var ccOptions={},loaded=false,validVideoTypes=["jplayer","mediaelement","videojs","wistia"];function isMobile(){var userAgent=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(userAgent.substr(0,4))}function onCanPlay(){var popcorn=this,track,video=ccOptions.video;popcorn.off("canplay",onCanPlay);if(!video){video=popcorn.media.parentNode.querySelector("video")}if(video){track=document.createElement("track");track.setAttribute("kind","subtitles");track.setAttribute("label","English subtitles");track.setAttribute("srclang","en");track.setAttribute("default","default");track.setAttribute("src","/api/srt?url="+options.src+"&format=vtt");video.appendChild(track)}}Popcorn.dataFilter(["annotationsLoaded"],"closedcaptions","closedcaptions",function(name,options,next,node,annotationsLoaded){var popcorn=this,ccInstanceData;if(loaded){next(options);return}if(!Popcorn.getTrackEvent(this,node.options.id)||!annotationsLoaded||!node.options.src){next(options);return}function loadSubtitles(subtitleData){var branchId=0;if(subtitleData&&typeof subtitleData==="object"){Popcorn.forEach(subtitleData.data,function(data){next(branchId,Popcorn.extend({annotationVariableConfig:options.annotationVariableConfig,mode:"black",isSubtitle:true,onLoad:function(trackEvent){var BASE_WIDTH,container,left,parentNode,top,width;container=trackEvent.container;parentNode=container.parentNode;container.style.position="absolute";if(trackEvent&&trackEvent.container){utils.removeClass(trackEvent.container,"hide")}if(options.popTop){top=options.popTop}else{top=(parentNode.offsetHeight/2-container.firstChild.offsetHeight/2)/parentNode.offsetHeight*100+25+"%"}container.style.top=trackEvent.top=top;if(options.popLeft){left=options.popLeft}else{left=(parentNode.offsetWidth/2-container.firstChild.offsetWidth/2)/parentNode.offsetWidth*100+"%"}container.style.left=trackEvent.left=left;if(!trackEvent.width){BASE_WIDTH=configuration.player.baseWidth||1200;width=utils.measurePopText(trackEvent,BASE_WIDTH);trackEvent.width=width/BASE_WIDTH*100+"%";container.style.width=trackEvent.width}if(!node.options.captionsActiveByDefault){utils.addClass(trackEvent.container,"hide")}if(!trackEvent._natives){delete trackEvent.onLoad;delete trackEvent.onStart;return}trackEvent._natives._loaded=true}},data),"pop");branchId++})}options.subtitles=node.fakeTrackEvent.subtitles=null;ccInstanceData.subtitlesLoaded=true}loaded=true;if(ccOptions[popcorn.id]){ccInstanceData=ccOptions[popcorn.id]}else{ccInstanceData=ccOptions[popcorn.id]={}}if(ccInstanceData.captionAnnotationId!==options._id||ccInstanceData.src!==options.src){ccInstanceData.captionAnnotationId=options._id;ccInstanceData.subtitlesLoaded=false}ccInstanceData.src=options.src;if(!ccInstanceData.subtitlesLoaded&&options.src){if(!isMobile()||popcorn.media._util&&validVideoTypes.indexOf(popcorn.media._util.type)<0){dao.store.getJSON(null,"/api/srt/",{url:options.src},loadSubtitles)}else{ccInstanceData.video=popcorn.media.parentNode.querySelector("video");if(!ccInstanceData.video){popcorn.on("canplay",onCanPlay)}else{onCanPlay.call(popcorn)}}if(popcorn){}}next(options)},false,function(){var popcorn=this,instanceOptions=ccOptions[popcorn.id];loaded=false;popcorn.off("canplay",onCanPlay);if(instanceOptions){instanceOptions.subtitlesLoaded=false;instanceOptions.captionAnnotationId=undefined;instanceOptions.src=undefined;instanceOptions.video=undefined}})});hy.define("popcorn.skip",["utils","popcorn","logging"],function(utils,Popcorn){Popcorn.prototype.next=function(){var nextEvent,i,events=this.data.trackEvents.byStart,len=events.length,time=this.currentTime();if(!this.duration()){return}i=utils.binarySearchByKey(events,"start",time);while(i<len){nextEvent=events[i];if(nextEvent.start>time){break}i++}if(!nextEvent||nextEvent.start<=time||nextEvent.start>=this.duration()){return}this.currentTime(nextEvent.start+.01)};Popcorn.prototype.prev=function(){var prevEvent,i,events=this.data.trackEvents.byStart,time=this.currentTime();if(!this.duration()){return}i=utils.binarySearchByKey(events,"start",time);if(!i){this.currentTime(.01);return}prevEvent=events[i];prevEvent=!prevEvent._running?prevEvent:function(prevIndex){var currEvent=prevEvent;prevIndex=prevIndex>0?prevIndex:0;prevEvent=events[prevIndex];while(prevIndex>-1&&currEvent.start===prevEvent.start){currEvent=events[i--];prevEvent=events[prevIndex--]}return prevEvent}(i-1);this.currentTime(Math.max(.01,prevEvent.start))}});hy.define("popcorn.persist",["popcorn","cookie","utils.embed","configuration","module"],function(Popcorn,cookie,embedUtils,config,module){var trackId=module.config().trackId,cookieTime=cookie.get("cookieTime_"+trackId);Object.defineProperty(Popcorn.p,"persistTime",{configurable:false,enumerable:true,get:function(){return+cookieTime},set:function(time){var cookieTime="cookieTime_"+trackId;cookie.set(cookieTime,time,10)}})});hy.define("popcorn.pause",["utils","popcorn"],function(utils,Popcorn){var activePauseDuration=0;var pauseTimeout;function clearPause(evt){clearTimeout(pauseTimeout);activePauseDuration=0}Popcorn.prototype.clearAnnotationPause=clearPause;Popcorn.prototype.annotationPause=function(trackEvent){var pauseDuration=trackEvent.pause,instanceId=this.options.hapyakPlayer.instanceId,that=this;if(pauseDuration===-1||pauseDuration===true){clearPause();activePauseDuration=Infinity;this.pause();return}if(pauseDuration<=activePauseDuration){return}clearPause();activePauseDuration=pauseDuration;pauseTimeout=setTimeout(function(){clearPause();that.play()},pauseDuration*1e3);this.pause()}});hy.define("hapyak.player",["require","module","configuration","player.wrappers","popcorn","dao","model","logging","utils","utils.accruedTime","utils.embed","utils.uuid","utils.validatelink","utils.mobile","utils.externalContentManager","touch","environment","lodash.noconflict","hapyak.player.timer","hapyak.overlay","annotation.variable.config","content.track.container","popcorn.data","popcorn.classes","popcorn.onclick","popcorn.precondition","popcorn.transitions","popcorn.captions","popcorn.compatible","popcorn.skip","popcorn.persist","popcorn.filter","popcorn.datafilter","popcorn.pause"],function(require,module,configuration,wrappers,Popcorn,dao,model,logging,utils,accruedTimeUtils,embedUtils,uuid,validateLink,mobileUtils,ExternalContentManager,Touch,Environment,_,HapyakPlayerTimer,overlay,AnnotationVariableConfig,ContentTrackContainer){function isFullscreen(containerIsFullscreen){return document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||containerIsFullscreen}function getFullscreenDimensions(){var height,width;var hyBrowser=hapyak.browser,screen=window.screen;if(isIOS||hyBrowser.name==="MSIE"&&hyBrowser.version<=10){height=window.innerHeight;width=window.innerWidth}else{height=screen.height;width=screen.width}return{width:width,height:height}}var isEditMode;var document=window.document,moduleConfig=module.config(),playerConfig=configuration.player,hideCtrlbarSkipfwd=false,hideCtrlbarTimeline=false,hideCtrlbarLogo=false,annotationPauseTriggered=false,isPaused=true,isBlurred=false,debug=moduleConfig.debug||hapyak.debug,pluginsEnabled=configuration.provisioning&&configuration.provisioning.annotationTypes||{},defaultDuration=3,fullscreenDisabled=playerConfig&&playerConfig.fullScreenDisabled,fullscreenEnabled=!fullscreenDisabled&&hapyak.supports.fullscreen(),isIOS=navigator.userAgent.match(/iP(od|ad|hone)/),auth=hapyak.auth(),isMobileDevice=mobileUtils.mobileCheck()||mobileUtils.isIpad()?true:false,uploadAuth="csrf="+moduleConfig.csrfToken+(moduleConfig.apiKey?"&key="+moduleConfig.apiKey:"")+(auth.partner.groupId?"&partner_group="+auth.partner.groupId:"")+(auth.partner.groupToken?"&partner_group_token="+auth.partner.groupToken:"")+(auth.partner.userId?"&partner_user="+auth.partner.userId:"")+(auth.partner.username?"&partner_username="+auth.partner.username:"")+(auth.partner.userToken?"&partner_user_token="+auth.partner.userToken:""),addClass=utils.addClass,removeClass=utils.removeClass,instanceOfElement=utils.instanceOfElement,requestAnimationFrame,hiddenProperty,visibilityEvent,oldCurrentTime,oldPlay,currentTimeSeekedTimeout,currentTimeOnSeek,annotationTemplate=[{"#":"annotationContainer",".":"hapyak-annotation-container hapyak-root",">":[{"#":"contentsContainer"}]},{"#":"annotationNoscaleContainer",".":"hapyak-annotation-container hapyak-annotation-noscale-container hapyak-root"},{"#":"topLeftContainer",".":"hapyak-top-left-container hapyak-root",">":[{"#":"basic360EditContainer"},{"#":"audioNoteContainer"},{"#":"drawingEditContainer"},{"#":"ontimeEditContainer"}]},{"#":"editorContainer",".":"hapyak-editor-container hapyak-root"},{"#":"overlayContainer",".":"hapyak-overlay-container hapyak-root"}],rootBoxTemplate=[{"#":"rootBox",".":"hapyak-root-box",">":[annotationTemplate]}],controlBarTemplate={"#":"controlBar",".":"hapyak-control-bar hapyak-root",">":[{"":"canvas","#":"timeline",style:hideCtrlbarTimeline,height:6},{"#":"controls",">":[{"#":"groupStandard",".":"hapyak-group-standard group",">":[{">":{"":"span","#":"playButton",".":"hapyak-play-button ss-icon ss-standard",">":"&#x25B6;"}},{"#":"annotationSkipContainer",">":[{"":"span","#":"prevButton",".":"ss-skipback",title:"Skip back to previous comment"},{"":"span","#":"nextButton",".":"ss-skipforward",title:"Skip to next comment",style:hideCtrlbarSkipfwd}]},{"#":"volumeContainer",">":[{"":"span","#":"volume",".":"hapyak-volume ss-volumehigh"},{"#":"volumeSliderContainer",".":"hapyak-volume hapyak-volume-slider-container",">":[{"":"canvas","#":"volumeSlider",width:8,height:100}]}]}]},{"#":"groupCreate",".":"hapyak-group-create group loading",">":[{"#":"editControls",".":"hapyak-edit-controls",">":[{"#":"moreIcon",".":"hapyak-more-icon",">":['<div class="ss-icon">&hellip;</div>',{"#":"editMoreIcons",".":"hapyak-edit-more-icons dropdown-menu"}]},{"#":"modeSwitch",">":[{"#":"hideAnnotations","":"span",">":"hide"},{"#":"showAnnotations","":"span",">":"show"},{"#":"editAnnotations","":"span",">":"edit",style:"display: none;"}]}]}]},{"#":"groupInfo",".":"hapyak-group-info hapyak-group",">":[{"":"a","#":"tinyLogo",">":"&nbsp;",target:"_blank",style:hideCtrlbarLogo},{">":[{"":"span","#":"timeCode",">":"00:00"},{"":"div","#":"durationContainer",">":[{"":"span",">":"&nbsp;/&nbsp;"},{"":"span","#":"duration",">":"00:00"}]}],"#":"timeCodeContainer"},{"#":"fullScreen",".":"hapyak-full-screen ss-expand"}]}]}]},playerTemplate=[{"#":"playBox",".":"hapyak-play-box hapyak-root",">":[{"#":"videoContainer"},annotationTemplate,{"#":"trackInfo",">":{">":[{"":"img","#":"ownerProfileImage"},{"#":"trackInfoClose",".":"ss-delete"},{"#":"trackInfoDetails",">":[{">":[{"#":"ownerName","":"span"},"'s Commentary"]},{"#":"trackTitle"},{"#":"trackDescription"},{"#":"trackRating"},{"#":"trackDetails",">":[{"#":"trackMessage"},{"":"button","#":"trackReplayButton",style:"display: none;"}]}]}]}},{"#":"trackCapContent"},{"#":"warning"}]},controlBarTemplate],embedTemplate=[{"#":"playBox",".":"hapyak-play-box hapyak-root",">":[{"#":"videoContainer"},annotationTemplate,{"#":"warning"}]},controlBarTemplate],normalizeMethods={start:function(value,trackEvent,callback){var duration,me=this;function evaluate(){var originalStart,result={};try{result.start=Popcorn.util.toSeconds(value,30)}catch(e){return false}result.start=Math.min(result.start,duration);result.start=Math.max(result.start,0);if(trackEvent.end>0){originalStart=parseFloat(trackEvent.start)||0;if(trackEvent.end>trackEvent.start){result._duration=Math.max(trackEvent.end-originalStart,.5);result.end=result.start+result._duration;if(result.end>duration){result.end=duration;result._duration=result.end-result.start}return result}}if(trackEvent._duration>.5){result.end=result.start+result._duration;return result}result._duration=defaultDuration;result.end=result.start+defaultDuration}callback=typeof callback==="function"&&callback;duration=this.duration();if(duration){return evaluate()}if(callback){this.on("durationchange",function(){duration=me.duration();callback(evaluate())})}},end:function(value,trackEvent,callback){var duration,me=this;function evaluate(){var originalStart,result={};originalStart=parseFloat(trackEvent.start)||0;try{result.end=Popcorn.util.toSeconds(value,30)}catch(e){return false}if(result.end<originalStart){return false}result.start=originalStart;result.end=Math.max(originalStart+.5,result.end);result.end=Math.min(result.end,duration);result._duration=result.end-result.start;return result}callback=typeof callback==="function"&&callback;duration=this.duration();if(duration){return evaluate()}if(callback){this.on("durationchange",function(){duration=me.duration();callback(evaluate())})}},pause:function(value,trackEvent){var start,end;if(!value&&!trackEvent.pause){return{pause:false}}start=trackEvent.start||0;if(!value){if(trackEvent._duration>.5){end=start+trackEvent._duration}else{end=start+defaultDuration}return{pause:false,start:start,end:end}}value=parseFloat(value);if(value<0){return false}if(isNaN(value)){value=2}else{value=Math.max(value,.5)}return{pause:value,start:start,end:start+.5}}},blacklist={_id:1,_natives:1,_running:1,addClass:1,removeClass:1,startTimeValue:1,startTimeFormat:1,durationValue:1,durationFormat:1,hapyakPlayer:1,compose:1,effect:1,pluginData:1,id:1,toString:1,type:1,plugin:1,target:1,container:1,annotationId:1,annotationVariableConfig:1,customConfig:1,onResize:1},youTubeQualityLevels={small:240,medium:360,large:480,hd720:720,hd1080:1080,highres:1280},pluginOrder={},aTypeAliases={"audio-note":"audio",toc:"contents",pearsonLearningStudioQuizSubmit:"pearsonlssubmit"},activePlayers=0,BASE_WIDTH=playerConfig.baseWidth||1200,MIN_PLAYER_HEIGHT=playerConfig.minHeight||200,MIN_PLAYER_WIDTH=playerConfig.minWidth||300,defaultControlBarHeight=playerConfig.controlBarHeight!==null&&playerConfig.controlBarHeight>=0?parseInt(playerConfig.controlBarHeight,10):59,timeRegex=/^(?:([0-9]+):)?([0-9]+(?:\.[0-9]+)?)$/;function die(){var args=Array.prototype.slice.call(arguments,0);args.unshift("HapyakPlayer:");throw new Error(args.join(" "))}function safeTry(fn){if(debug){fn()}else{try{fn()}catch(e){logging.error(e);logging.captureException(e)}}}function timeToText(t){var hr,min,sec;t=Math.floor(t);sec=t%60;min=(t-sec)/60;if(sec<10){sec="0"+sec}if(min>59){hr=Math.floor(min/60);min=min%60;if(min<10){min="0"+min}return hr+":"+min+":"+sec}if(min<10){min="0"+min}return min+":"+sec}function setText(element,text){if(element.firstChild){if(element.firstChild.nodeType===3){element.firstChild.nodeValue=text||"";return}element.innerHTML=""}element.appendChild(document.createTextNode(text||""))}function setPrefixedStyle(element,attr,value){var style=element.style,cap=attr.replace(/^[a-z]/,function(match){return match.toUpperCase()});style["webkit"+cap]=value;style["khtml"+cap]=value;style["moz"+cap]=value;style["ms"+cap]=value;style["o"+cap]=value;style[attr]=value}oldCurrentTime=Popcorn.p.currentTime;oldPlay=Popcorn.p.play;Popcorn.p.play=function(time){this.clearAnnotationPause();oldPlay.call(this,time)};Popcorn.p.currentTime=function(time){var paused,previousDifference=1,media=this.media,that=this;if(_.isNaN(time)||!_.isNumber(time)||time<0){return oldCurrentTime.call(this)}this.clearAnnotationPause();if(media&&media._util&&["vidyard","wistia"].indexOf(media._util.type)>-1){oldCurrentTime.call(this,time);return}if(currentTimeSeekedTimeout){clearTimeout(currentTimeSeekedTimeout)}if(currentTimeOnSeek){this.off("seeked",currentTimeOnSeek)}currentTimeOnSeek=function(){clearTimeout(currentTimeSeekedTimeout);var currentTime=that.currentTime();if(currentTime<1||currentTime-previousDifference<1||currentTime<=time+.25){if(!paused&&!annotationPauseTriggered){that.play()}that.off("seeked",currentTimeOnSeek)}else{
currentTimeSeekedTimeout=setTimeout(function(){currentTimeOnSeek()},1e3);oldCurrentTime.call(that,time-previousDifference);previousDifference++}};currentTimeSeekedTimeout=setTimeout(function(){currentTimeOnSeek()},1e3);paused=this.paused();this.pause();this.on("seeked",currentTimeOnSeek);oldCurrentTime.call(this,time)};function HapyakPlayer(container,video,opts,viewerInstanceId,tracking){this.instanceId=viewerInstanceId;this.tracking=tracking;logging.debug("[hapyak.player] HapyakPlayer Created, id="+this.instanceId);var me=this,wrapper,src,popcorn,duration=0,source,sourceId,showIOSControls,existingVideo=false,playerType,options=opts||{},lastTimelineTime=-1,shuttlePaused=true,editorLocked=false,annotationsLoaded=true,annotationsToLoad=0,annotationBlacklist=options.annotationBlacklist||[],loadedMetadataFired=false,durationChangeVal=-1,destroyed=false,showAnnotations,playerTooSmall=false,showControls,showNativeControls=options.nativeControls,editMode=false,startEditMode=false,ended=false,loop=false,volume,pendingCreate=[],showTrackInfoTimeout,editControlsTimeout,sectionsViewed=[{start:0,end:0}],currentSection=sectionsViewed[0],currentSectionIndex=0,accumulatedViewTime=0,currentViewSection={start:0,end:0},targetAnnotation,qualityLevel,warnings={},played,playerScale=1,playerBelowThreshold=false,pageHideTime=document[hiddenProperty]||0,minPlayerWidth=Math.max(0,parseFloat(options.minWidth))||MIN_PLAYER_WIDTH,minPlayerHeight=Math.max(0,parseFloat(options.minHeight))||MIN_PLAYER_HEIGHT,controlBarHeight=options.controlBarHeight!==null&&options.controlBarHeight>=0?parseInt(options.controlBarHeight,10):embedUtils.controlStyle()||defaultControlBarHeight,hideEndAnnotations=options.hideEndAnnotations===undefined?playerConfig.hideEndAnnotations:options.hideEndAnnotations,annotationSources=Popcorn.extend(playerConfig.annotationSources||{},options.annotationSources),groupConfigCtrlBar=embedUtils.dotget(configuration,"player.defaults.playerbar")||false,hideCtrlbarSkipfwd=options.hideCtrlbarSkipfwd||groupConfigCtrlBar.hideSkipAnnotationBtn||false,hideCtrlbarTimeline=options.hideCtrlbarTimeline||groupConfigCtrlBar.hideTimeline||false,hideCtrlbarLogo=options.hideCtrlbarLogo||groupConfigCtrlBar.hideLogo||false,hideMarkers=options.hideCtrlbarAnnotationMarkers||groupConfigCtrlBar.hideAnnotationMarkers||false,fullscreenFunction=isMobileDevice?mobileFullscreenChange:fullScreenChange,queuedAnnotations,queuedAnnotationSources,annotationsWaitingForDuration=[],queuedTrackOpts,queuedPlaying=false,queuedFullscreen=false,queuedEditorCallbacks=[],queuedEditorRequested,profilesPending=0,environment=new Environment(null,{storage:Environment.localStorage,autosave:"hapyak-env",migrate:true}),trackSystemScope=environment,trackScope=environment,scopesByPopcornId={},dataChangeTimeout=0,variablesBackup={},annotationVariableConfig,elements,ctx,vctx,volumeTouch,timelineTouch,playerWidth,playerHeight,backupWidth,backupHeight,fullscreenContainerBackgroundColorBackup=null,annotationContainerMarginBackup=null,fullscreenContainerPositionBackup=null,fullscreenContainerPaddingBackup=null,containerIsFullscreen=false,canDisplayAnnotationContainer=false,fullscreenChangeHandled=false,preserveFullscreenStyles,fullscreenElement,resizeTimeout,lastResizeTime,autoResize=options.autoResize===undefined?playerConfig.autoResize:options.autoResize,autoResizeTimer,lastResizeWidth,lastResizeHeight,lastIntrinsicAspectRatio,activeTrack,editor,i,popOutWindow,annotationsById={},listeners={},emitQueue=[],editorLocks={},popcornAnnotations={},transientAnnotations={},activeTrackEvents={},trackStartTimes={},popcornEventsByType={},popcornIdLookup={},popcornDeleteQueue={},annotationBacklog={},provisionCallbacks={},annotationProfiles={},annotationEditorsLoaded={},editButtons=[],blockSave={},markers={},alternateControls={},remotes=options.remotes,seekedEventCount=0,seekedEventAlerted=false,hapyakPlayerTimer=setupPlayerTimer();options.controls=options.edit?true:options.controls;isEditMode=options.edit;annotationBlacklist.forEach(function(annotation){if(pluginsEnabled[annotation]){pluginsEnabled[annotation]=false}});if(Object.prototype.toString.call(window.operamini)==="[object OperaMini]"){return}function setupPlayerTimer(){return(new HapyakPlayerTimer).setTimeDataProvider(function timeDataProvider(){return{clock:(new Date).getTime()/1e3,playhead:getCurrentTime()}}).start()}function getScope(popcornId){if(!popcornId){return trackScope}return scopesByPopcornId[popcornId]||trackScope.scope("tmp-event-"+popcornId)}function updateAnnotationDisplay(annotationType){if(duration&&annotationsWaitingForDuration.length>0){Popcorn.forEach(annotationsWaitingForDuration,function(annotation){loadAnnotation(annotation)});annotationsWaitingForDuration=[]}if(!showAnnotations||configuration.provisioning.waitForCanplay&&popcorn.readyState()<3||ended&&hideEndAnnotations&&!editMode||playerTooSmall){Popcorn.forEach(Popcorn.registry,function(plugin){if(annotationType===plugin.name||!annotationType){popcorn.disable(plugin.name)}})}else{Popcorn.forEach(Popcorn.registry,function(plugin){if(annotationType===plugin.name||!annotationType){popcorn.enable(plugin.name)}})}}function drawVolume(){var width,height;if(!elements.volumeSlider){return}width=elements.volumeSlider.width;height=elements.volumeSlider.height;vctx.strokeStyle="#bbb";vctx.lineWidth=height;vctx.clearRect(0,0,width,height);if(volume&&!popcorn.muted()){vctx.beginPath();vctx.moveTo(width/2,100);vctx.lineTo(width/2,(1-volume)*height);vctx.stroke()}}function drawTimeline(){var width,height,currentTime,buffered,i,max,start,end;function drawProgressLine(end){var from=0,to=end/duration*width;ctx.beginPath();ctx.moveTo(from,height/2);ctx.lineTo(to,height/2);ctx.stroke()}if(destroyed||!showControls){return}currentTime=popcorn.currentTime();if(lastTimelineTime!==currentTime&&duration){lastTimelineTime=currentTime;width=elements.timeline.width;height=elements.timeline.height;ctx.clearRect(0,0,width,height);ctx.lineWidth=height;ctx.strokeStyle="rgba(255, 255, 255, 0.3)";buffered=popcorn.buffered();if(buffered){for(i=0,max=buffered.length;i<max;i++){start=buffered.start(i);end=buffered.end(i);if(start>duration||start<0){start=0}if(end>start){drawProgressLine(end)}}}else{drawProgressLine(duration)}if(currentTime){ctx.strokeStyle="rgba(0, 0, 0, 0.5)";drawProgressLine(currentTime)}elements.timeCode.firstChild.nodeValue=timeToText(currentTime);elements.duration.firstChild.nodeValue=timeToText(duration)}requestAnimationFrame(drawTimeline)}function mouseShuttle(evt,x){var posx,t,canvas=elements.timeline,parent;shuttlePaused=shuttlePaused&&popcorn.paused();posx=x-canvas.clientLeft-canvas.offsetLeft;parent=canvas.offsetParent;while(parent&&parent.nodeName!=="BODY"){posx-=parent.clientLeft+parent.offsetLeft;parent=parent.offsetParent}t=posx/elements.timeline.offsetWidth;if(t>=0&&t<=1){t*=duration;if(duration){popcorn.currentTime(t)}}popcorn.pause();return true}function dragVolume(evt,x,y){var posy,canvas=elements.volumeSlider,parent;posy=y-canvas.clientTop-canvas.offsetTop;parent=canvas.offsetParent;while(parent&&parent.nodeName!=="BODY"){posy-=parent.clientTop+parent.offsetTop;parent=parent.offsetParent}volume=Math.min(Math.max(0,posy/canvas.offsetHeight),1);popcorn.volume(1-volume);if(volume&&popcorn.muted()){popcorn.muted(false)}return true}function emit(hook,async){var args=Array.prototype.slice.call(arguments,2);function syncEmit(){var list=listeners[hook];if(!list){return}Popcorn.forEach(list,function(callback){callback.apply(this,args)})}function asyncEmit(){if(!emitQueue.length){setTimeout(function(){while(emitQueue.length){emitQueue.shift()()}},0)}emitQueue.push(syncEmit)}if(!hook){return}if(async){asyncEmit()}else{syncEmit()}}function controlPadding(name){var style=elements[name]&&window.getComputedStyle(elements[name]),value=0;if(style){value+=Math.round(parseFloat(style.getPropertyValue("padding-left"))||0);value+=Math.round(parseFloat(style.getPropertyValue("padding-right"))||0);value+=Math.round(parseFloat(style.getPropertyValue("border-left-width"))||0);value+=Math.round(parseFloat(style.getPropertyValue("border-right-width"))||0)}return value}function controlWidth(name){var style=elements[name]&&window.getComputedStyle(elements[name]),value=0;if(style){value=Math.round(parseFloat(style.getPropertyValue("width"))||0)}return value}function resizeControls(){var i=0,len=editButtons.length-1,showMore=false;var alt,element,obj,targetWidth,w,width;function isIE(){var browser=hapyak.browser;if(!browser){return false}return["MSIE","Trident"].indexOf(browser.name)>-1}function showHideAltControl(control){if(!alt&&control.width+width<=targetWidth){alt=control;control.element.style.display=""}else{control.element.style.display="none"}}if(!showControls||!elements.controlBar){return}elements.controls.style.display="";elements.timeline.width=elements.timeline.offsetWidth;targetWidth=controlWidth("controlBar");width=controlPadding("controls")+controlPadding("groupCreate")+controlPadding("editControls")+controlWidth("groupStandard")+controlWidth("groupInfo")+10;if(isIE()){width+=controlPadding("groupStandard")+controlPadding("groupInfo")}if(["play","viewer"].indexOf(showControls)>-1){elements.groupCreate.style.display="none";return}elements.groupCreate.style.display="";elements.moreIcon.style.display="";width+=controlWidth("modeSwitch")+controlWidth("moreIcon");if(width>targetWidth){elements.groupCreate.style.display="none";return}while(i<=len){obj=editButtons[i];element=elements[obj.id];if(element){alt=null;if(alternateControls[obj.alt]){Popcorn.forEach(alternateControls[obj.alt],showHideAltControl)}if(alt){element.style.display="none";element=alt.element}else{element.style.display=""}elements.editControls.insertBefore(element,elements.moreIcon);w=alt?alt.width:controlWidth(obj.id);if(isIE()){w+=controlPadding(obj.id)}if(width+w<=targetWidth){width+=w}else{break}}i++}if(i<len){len++;while(i<len){obj=editButtons[i];element=elements[obj.id];if(element){elements.editMoreIcons.appendChild(element);showMore=true}i++}}else if(i<editButtons.length){obj=editButtons[i];element=elements[obj.id];if(element){elements.editControls.insertBefore(element,elements.moreIcon)}}if(!showMore){elements.moreIcon.style.display="none"}}function visibilityChange(){var hidden=document[hiddenProperty],diff,i;if(hidden){if(!pageHideTime){pageHideTime=Date.now()}}else{if(pageHideTime){diff=Date.now()-pageHideTime;for(i in trackStartTimes){if(trackStartTimes.hasOwnProperty(i)&&trackStartTimes[i]){trackStartTimes[i]+=diff}}}pageHideTime=0}}function pauseOnWindowBlur(){if(isBlurred){isPaused=this.paused();this.pause();return}if(!isPaused){this.play()}}function orientationChange(event){if(!isMobileDevice&&!containerIsFullscreen){return}if(isMobileDevice&&isIOS){mobileUtils.resize(me,container)}else{fullScreenChange(null,true)}}function changeIframeStyles(event){if(event&&event.data){try{var parsed=JSON.parse(event.data);if(parsed.context!=="hapyak"){return}}catch(error){}}if(!isMobileDevice||!isIOS){return}if(containerIsFullscreen){emit("addstyles",false)}else{emit("removestyles",false)}}function trackingEvent(e){var data;try{data=JSON.parse(e.data)}catch(error){return}if(data.context!=="hapyak-tracking"){return}emit("customtrackingevent",false,data)}function resize(width,height,sync){function resizePlayer(){var width,height,maxWidth=options.maxWidth||Infinity,maxHeight=options.maxHeight||Infinity,aspectRatio,intrinsicAspectRatio,annotationContainer=elements.annotationContainer,noScaleContainer=elements.annotationNoscaleContainer,offsets=ExternalContentManager.getCumulativeOffsets(noScaleContainer),canChange=!existingVideo,qualityHeight,heightDifference,wrapperPluginHeight,margin,videoWidth,videoHeight,newHeight,newWidth,newQualityHeight=0;if(!wrapper){return}wrapperPluginHeight=showControls==="play"&&wrapper.pluginData?wrapper.pluginData.height:0;aspectRatio=+me.aspectRatio();videoWidth=wrapper.videoWidth||0;videoHeight=wrapper.videoHeight||0;intrinsicAspectRatio=+(videoWidth/videoHeight||0);if(!canChange){playerHeight=wrapper.offsetHeight||wrapper.height||wrapper.videoHeight;playerWidth=wrapper.offsetWidth||wrapper.width||wrapper.videoWidth;if(!(isFullscreen()||options.embed)&&(!playerHeight||!playerWidth)){return}}if(playerHeight>0){height=playerHeight;width=playerWidth>0?playerWidth:container.offsetWidth||height*aspectRatio}else{width=playerWidth>0?playerWidth:container.offsetWidth||640;height=width/aspectRatio}width=Math.round(width);height=Math.round(height);if(isFullscreen()||options.embed){maxWidth=window.innerWidth-(offsets.left+offsets.right);maxHeight=window.innerHeight-(offsets.top+offsets.bottom);maxHeight=showControls?maxHeight-controlBarHeight:maxHeight}else{maxWidth=Math.min(maxWidth,width);maxHeight=Math.min(maxHeight-(showControls?controlBarHeight:0),height);if(canChange){container.style.width=Math.round(maxWidth)+"px"}}if(width/maxWidth>height/maxHeight){height=Math.round(maxWidth*height/width);width=maxWidth}else{width=Math.round(maxHeight*width/height);height=maxHeight}if(width===lastResizeWidth&&height+wrapperPluginHeight===lastResizeHeight&&lastIntrinsicAspectRatio===intrinsicAspectRatio){popcorn.emit("showAnnotationContainer");canDisplayAnnotationContainer=true;return}else{lastResizeWidth=width;lastResizeHeight=height;lastIntrinsicAspectRatio=intrinsicAspectRatio}if(showControls&&elements){elements.tinyLogo.classList.toggle("hapyak-head",width<475)}if(showControls&&showControls!=="viewer"&&containerIsFullscreen&&width/maxWidth>height/maxHeight){heightDifference=window.innerHeight-(height+(showControls?controlBarHeight:0));fullscreenElement.style.padding=heightDifference/2+"px 0"}else if(showControls&&showControls!=="viewer"&&containerIsFullscreen){fullscreenElement.style.padding=0}if(canChange||opts.forceUpdateDimensionsOnResize){wrapper.width=width;wrapper.height=height}if(elements.playBox){elements.playBox.style.width=width+"px";elements.playBox.style.height=height+wrapperPluginHeight+"px"}if(showIOSControls&&isIOS&&!isFullscreen(containerIsFullscreen)&&options.controls==="viewer"){container.style.width=width+"px";container.style.height=height+wrapperPluginHeight+"px"}playerScale=width/BASE_WIDTH;annotationContainer.style.width=BASE_WIDTH+"px";if(intrinsicAspectRatio&&options.keepAnnotationAspectRatio){aspectRatio=width/height;if(intrinsicAspectRatio>aspectRatio){newHeight=width/intrinsicAspectRatio;margin=(height-newHeight)/2;annotationContainer.style.margin=margin+"px 0";annotationContainerMarginBackup=annotationContainer.style.margin;annotationContainer.style.height=BASE_WIDTH*newHeight/width+"px";noScaleContainer.style.margin=margin+"px 0";noScaleContainer.style.height=newHeight+"px"}else if(intrinsicAspectRatio<aspectRatio){newWidth=intrinsicAspectRatio*height;margin=(width-newWidth)/2;playerScale=newWidth/BASE_WIDTH;annotationContainer.style.margin="0 "+margin+"px";annotationContainerMarginBackup=annotationContainer.style.margin;annotationContainer.style.height=BASE_WIDTH*height/newWidth+"px";noScaleContainer.style.margin="0 "+margin+"px";noScaleContainer.style.height=height+"px"}else{annotationContainer.style.height=BASE_WIDTH*height/width+"px";annotationContainer.style.margin="0 auto";annotationContainerMarginBackup=annotationContainer.style.margin;noScaleContainer.style.height=height+"px";noScaleContainer.style.margin="0 auto"}}else{annotationContainer.style.height=BASE_WIDTH*height/width+"px";noScaleContainer.style.width=width+"px";noScaleContainer.style.height=height+"px"}if(embedUtils.dotget(wrapper,"_utils.resize")){wrapper._utils.resize(elements,playerScale,options)}setPrefixedStyle(elements.annotationContainer,"transform","scale("+playerScale+")");Popcorn.forEach(elements.annotationContainer.querySelectorAll(".popcorn-quickedit-edit"),function(e){setPrefixedStyle(e,"transform","scale("+1/playerScale+")")});if(video.get("source")==="youtube"){qualityHeight=youTubeQualityLevels[qualityLevel]||0;if(!qualityLevel||qualityHeight!==height){Popcorn.forEach(youTubeQualityLevels,function(h,level){if(h<=height&&h>newQualityHeight&&h>qualityHeight){newQualityHeight=h;qualityLevel=level}})}}resizeControls();if(width<minPlayerWidth||height<minPlayerHeight){playerTooSmall=true;if(!playerBelowThreshold){logging.log("Player size ("+width+" x "+height+") is too small to show annotations. Minimum size is "+minPlayerWidth+" x "+minPlayerHeight);playerBelowThreshold=true}}else{playerTooSmall=false;if(playerBelowThreshold){logging.log("Player is big enough. Resuming annotations.");playerBelowThreshold=false}}updateAnnotationDisplay();if(editor){editor.resize()}popcorn.emit("resized");emit("resized",true,{width:me.width(),height:me.height(),videoWidth:me.videoWidth(),videoHeight:me.videoHeight()});lastResizeTime=Date.now();clearTimeout(resizeTimeout)}if(playerType==="limelightv2"&&isFullscreen()&&!fullscreenChangeHandled){return}if(width&&typeof width!=="object"){width=parseFloat(width);playerWidth=width>0?width:false;height=parseFloat(height);playerHeight=height>0?height:false}if(sync||!lastResizeTime||Date.now()-lastResizeTime>100){resizePlayer();return}clearTimeout(resizeTimeout);resizeTimeout=setTimeout(resizePlayer,100)}function fullScreenChange(evt,force){var aspectRatio=me.aspectRatio().toFixed(2),playbox=document.querySelector(".hapyak-play-box");var dimensions,heightDifference,widthDifference;function fullscreenAspectRatio(){return(dimensions.width/(showControls?dimensions.height-controlBarHeight:dimensions.height)).toFixed(2)}fullscreenElement=fullscreenElement||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||container;if(force||isFullscreen()){dimensions=getFullscreenDimensions();if(playbox&&!backupWidth){backupWidth=playbox.offsetWidth||"";backupHeight=playbox.offsetHeight||""}else{backupWidth=fullscreenElement.style.width||"";backupHeight=fullscreenElement.style.height||""}if(annotationContainerMarginBackup===null){annotationContainerMarginBackup=elements.annotationContainer.style.margin||""}if(fullscreenContainerPositionBackup===null){fullscreenContainerPositionBackup=fullscreenElement.style.position||""}if(fullscreenContainerPaddingBackup===null){fullscreenContainerPaddingBackup=fullscreenElement.style.padding||""}if(fullscreenContainerBackgroundColorBackup===null){fullscreenContainerBackgroundColorBackup=fullscreenElement.style.backgroundColor||""}if(!containerIsFullscreen){containerIsFullscreen=true;addClass(container,"fullscreen");addClass(document.body,"hapyak-fullscreen");if(elements.fullScreen){addClass(elements.fullScreen,"ss-contract");removeClass(elements.fullScreen,"ss-expand")}fullscreenElement.style.width="100%";fullscreenElement.style.height="100%";fullscreenElement.style.backgroundColor="black";if(isIOS&&showIOSControls){fullscreenElement.style.position="fixed"}}if((!showControls||showControls==="viewer")&&dimensions&&fullscreenAspectRatio()!==aspectRatio&&!preserveFullscreenStyles){widthDifference=Math.abs(((dimensions.height-(showControls?controlBarHeight:0))*aspectRatio-dimensions.width)/2);heightDifference=Math.abs((dimensions.height-dimensions.width/aspectRatio)/2);if(+fullscreenAspectRatio()<+aspectRatio){widthDifference=0}else{heightDifference=0}if(showControls==="viewer"&&popcorn&&popcorn.media){popcorn.media.width=dimensions.width-widthDifference*2;popcorn.media.height=dimensions.height-(showControls?controlBarHeight:0)-heightDifference*2}elements.annotationContainer.style.margin=elements.annotationNoscaleContainer.style.margin=heightDifference+"px "+widthDifference+"px";if(embedUtils.dotget(popcorn,"media._util.fullscreenChange")){popcorn.media._util.fullscreenChange(elements.annotationContainer.style.margin)}}fullscreenChangeHandled=true}else if(containerIsFullscreen){removeClass(container,"fullscreen");removeClass(document.body,"hapyak-fullscreen");if(elements.fullScreen){removeClass(elements.fullScreen,"ss-contract");addClass(elements.fullScreen,"ss-expand")}if(annotationContainerMarginBackup!==null){elements.annotationContainer.style.margin=elements.annotationNoscaleContainer.style.margin=annotationContainerMarginBackup;annotationContainerMarginBackup=null}if(fullscreenContainerPaddingBackup!==null){fullscreenElement.style.padding=fullscreenContainerPaddingBackup;fullscreenContainerPaddingBackup=null}if(fullscreenContainerPositionBackup!==null){fullscreenElement.style.position=fullscreenContainerPositionBackup;fullscreenContainerPositionBackup=null}if(fullscreenContainerBackgroundColorBackup!==null){fullscreenElement.style.backgroundColor=fullscreenContainerBackgroundColorBackup;fullscreenContainerBackgroundColorBackup=null}if(embedUtils.dotget(popcorn,"media._util.fullscreenChange")){popcorn.media._util.fullscreenChange(elements.annotationContainer.style.margin)}if(backupWidth!==null){fullscreenElement.style.width=backupWidth;fullscreenElement.style.height=backupHeight;if(showControls==="viewer"&&popcorn&&popcorn.media){popcorn.media.width=fullscreenElement.offsetWidth;popcorn.media.height=fullscreenElement.offsetHeight-(showControls?controlBarHeight:0)}backupWidth=backupHeight=null}containerIsFullscreen=false;fullscreenElement=null;fullscreenChangeHandled=false}resize()}function mobileFullscreenChange(){mobileUtils.initFullscreenChange(me,container)}function removeTrackEvents(){Popcorn.forEach(popcornAnnotations,function(annotation,id){if(markers[id]){elements.controlBar.removeChild(markers[id]);delete markers[id]}delete popcornAnnotations[id];popcorn.removeTrackEvent(id)})}function unloadTrack(){if(!activeTrack){return}queuedAnnotations=null;queuedAnnotationSources=null;queuedTrackOpts=null;logging.debug("player: unloading track #"+activeTrack.get("id"));if(editor){editor.done()}Popcorn.forEach(annotationBacklog,function(obj,key){annotationBacklog[key].splice(0)});removeTrackEvents();activeTrack=null;annotationsToLoad=0;if(elements&&!destroyed){if(elements.editAnnotations){elements.editAnnotations.style.display="none";resizeControls()}updateTrackInfo()}trackScope.unobserve(trackDataObserver);trackSystemScope=environment;trackScope=environment}function lockEditor(name){editorLocks[name||""]=true;if(editorLocked||!elements||!elements.controlBar){return}editButtons.forEach(function(e){var element=elements[e.id];if(element){addClass(element,"disabled");element.disabled=true}});addClass(elements.moreIcon,"disabled");addClass(elements.modeSwitch,"disabled");editorLocked=true}function unlockEditor(name){var key;delete editorLocks[name||""];if(!editorLocked||!elements||!elements.controlBar){return}for(key in editorLocks){if(editorLocks.hasOwnProperty(key)&&editorLocks[key]){return}}editButtons.forEach(function(e){var element=elements[e.id];if(element){removeClass(element,"disabled");element.disabled=false}});removeClass(elements.moreIcon,"disabled");removeClass(elements.modeSwitch,"disabled");editorLocked=false}function updateMarkers(id){if(!isEditMode&&(hideCtrlbarTimeline||hideMarkers)){return}function updateMarker(id){var marker=markers[id],trackEvent=popcorn.getTrackEvent(id);if(!marker){marker=document.createElement("div");marker.className="hapyak-marker marker-"+embedUtils.dotget(trackEvent,"_natives.type");markers[id]=marker;elements.controlBar.appendChild(marker)}marker.style.left=100*trackEvent.start/duration+"%"}var i;if(duration&&elements.controlBar){if(id){updateMarker(id);return}for(i in popcornAnnotations){if(popcornAnnotations.hasOwnProperty(i)){updateMarker(i)}}}}function isAnnotationTypeOverMaxAllowed(profile){var count=0,type=profile.plugin||profile.id,events=popcornEventsByType[type],maxAllowed=profile.maxAllowed;var id;if(!maxAllowed||!events){return false}for(id in events){if(events.hasOwnProperty(id)){count++;if(count>=maxAllowed){return true}}}return false}function toggleAnnotationTypeEnabled(enabled,type){var el;if(!editMode||!type){return}el=document.querySelector(".hapyak-new-"+type);if(!enabled){addClass(el,"disabled");return}removeClass(el,"disabled")}function createButtonClick(profile,options,callback){var plugin,id,cb,commit,count=0,events,defaults;if(editorLocked){return}popcorn.pause();if(!me.editMode(true)){emit("requestCreateTrack");return}plugin=profile.plugin||profile.id;if(isAnnotationTypeOverMaxAllowed(profile)){toggleAnnotationTypeEnabled(false,plugin);return}if(typeof options==="function"){callback=options;options=null}if(!annotationEditorsLoaded[profile.id]){pendingCreate.push([profile,options,callback]);return}defaults={};if(profile.defaults){for(id in profile.defaults){if(profile.defaults.hasOwnProperty(id)){if(typeof profile.defaults[id]==="function"&&!utils.startsWith.call(id,"on")){defaults[id]=profile.defaults[id].call(null,video,popcorn,defaults,elements)}else{defaults[id]=profile.defaults[id]}}}}Popcorn.extend(defaults,options);if(typeof callback==="function"){cb=function(id,annotation,editor,altControl){if(profile.create){profile.create(id,annotation,editor,altControl)}if(isAnnotationTypeOverMaxAllowed(profile)){toggleAnnotationTypeEnabled(false,plugin)}callback(id,annotation)};commit=true}else{cb=function(id,annotation,editor,altControl){if(profile.create){profile.create(id,annotation,editor,altControl)}if(isAnnotationTypeOverMaxAllowed(profile)){toggleAnnotationTypeEnabled(false,plugin)}};commit=profile.commit}createAnnotation(plugin,defaults,cb,commit,profile.id)}function editButtonsSort(a,b){return a.index-b.index}function setUpAltControl(profile){var id=profile.id,alt;if(profile.altControls&&!alternateControls[id]){alt=profile.altControls();alternateControls[id]=alt;Popcorn.forEach(alt,function(control){var deactivate=control.deactivate,activate=control.activate;function focus(){var editing,trackEvent,plugin;if(editor){editing=editor.editing();for(i=0;i<editing.length;i++){trackEvent=editing[i];plugin=trackEvent._natives&&trackEvent._natives.type||trackEvent.plugin;if(plugin===profile.plugin){return}}}createButtonClick(profile);control.element.focus()}editButtons.push({index:profile.sortIndex,id:control.id});control.activate=function(){activate.call(this);control.element.removeEventListener("focus",focus,false)};control.deactivate=function(){deactivate.call(this);control.element.addEventListener("focus",focus,false)};control.deactivate()});editButtons.sort(editButtonsSort)}if(editor){Popcorn.forEach(alternateControls[id],function(control){control.editor(editor)})}}function doneLoadingAnnotations(){var contentTrackSources;trackSystemScope.set("annotationsLoaded",true,true);function activateAnnotationContainer(msg){popcorn.off("resized",activateAnnotationContainer);popcorn.off("showAnnotationContainer",activateAnnotationContainer);addClass(elements.annotationContainer,"active");addClass(elements.annotationNoscaleContainer,"active")}if(playerType==="limelightv2"&&canDisplayAnnotationContainer){activateAnnotationContainer()}else{popcorn.on("resized",activateAnnotationContainer);popcorn.on("showAnnotationContainer",activateAnnotationContainer)}annotationsLoaded=true;popcorn.emit("annotationsloaded");emit("annotationsloaded");contentTrackSources=_.map(options.contentTracks||{},function(src,label){return src.replace(/\\/g,"").replace("u002D","-")});require(contentTrackSources,function(){Array.prototype.forEach.call(arguments,function(trackContents,index){me.contentTracks.add(_.merge(trackContents,{src:contentTrackSources[index]}))})});updateMarkers();emit("changeTrack",false,activeTrack)}function canEditAnnotation(annotation){return annotation.hasPermission("edit")&&annotation.get("track.id")===activeTrack.get("id")}function setUpAnnotationId(popcornId,annotation){var annotationId=annotation.id||annotation.get("id"),whiteListKeys=["created","duration","duration_format","id","isDeleted","isLoaded","isSaved","modified","properties","ratings_avg","start_time","start_time_format","track","type"],whiteListExceptions={track:"track.id"};var scope;function cullAnnotation(){return whiteListKeys.reduce(function(obj,key){var furtherCull=whiteListExceptions[key];obj[key]=annotation&&annotation.get("data."+[furtherCull?furtherCull:key]);return obj},{})}if(scopesByPopcornId[popcornId]){if(annotationsById[annotationId]&&popcornIdLookup[annotationId]){return}scope=scopesByPopcornId[popcornId]}else{scope=trackScope.scope("tmp-event-"+popcornId,null,true)}if(scope){scope.rename("event-"+annotationId)}else{environment.load("hapyak-env",trackSystemScope.name()+"/"+trackScope.name()+"/event-"+annotationId);scope=trackScope.scope("event-"+annotationId)}trackSystemScope.set("annotationIds."+annotationId,true,true);scopesByPopcornId[popcornId]=scope;annotationsById[annotationId]=annotation;popcornIdLookup[annotationId]=popcornId;trackSystemScope.set("projectAnnotations."+annotationId,cullAnnotation(),true)}function getAnnotationTimeInSeconds(annotation,field){var time=annotation.get(field),trackEventDuration=annotation.get("properties.popcorn._duration"),format=annotation.get(field+"_format"),percentageTime;if(field==="duration"&&trackEventDuration===-1){return trackEventDuration}if(format==="percent"){if(time&&duration){percentageTime=duration*(Math.abs(time)/100);if(time<0){return duration-percentageTime}else{return percentageTime}}return 0}else if(time<0){return duration?duration+time:0}else{return time}}function setUpAnnotation(profile,annotation){var aType=annotation.get("type"),annotationId,id,plugin=profile.plugin||aType,trackEvent,videoDuration;popcorn.on("durationchange",function(){if(!trackEvent){return}if(trackEvent.durationFormat==="percent"&&trackEvent.durationValue===100){trackEvent.end=popcorn.duration();return}trackEvent.end=Math.min(trackEvent.end,popcorn.duration())});if(!duration){if(annotation.get("start_time_format")==="percent"&&annotation.get("start_time")>0){annotationsWaitingForDuration.push(annotation);return}if(annotation.get("duration_format")==="percent"){annotationsWaitingForDuration.push(annotation);return}}aType=aTypeAliases[aType]||aType;if(!Popcorn.registryByName[plugin]&&!Popcorn.filterRoutes[plugin]){logging.warn("Cannot load annotation. Unknown type: "+plugin)}else{trackEvent=Popcorn.extend({},annotation.getCustomProperty("popcorn")||annotation.get("properties")||{});trackEvent.start=getAnnotationTimeInSeconds(annotation,"start_time");if(Math.abs(trackEvent.start-duration)<.5){trackEvent.start=Math.max(duration-.5,0)}trackEvent.environment=hapyak.environment;if(embedUtils.dotget(profile,"variables.populateConfig")){annotationVariableConfig.register(aType,profile.variables.populateConfig)}trackEvent.annotationVariableConfig=annotationVariableConfig;trackEvent.startTimeValue=annotation.get("start_time");trackEvent.startTimeFormat=annotation.get("start_time_format");trackEvent.customConfig=annotation.get("custom_configuration");trackEvent._duration=getAnnotationTimeInSeconds(annotation,"duration");trackEvent.durationValue=annotation.get("duration");trackEvent.durationFormat=annotation.get("duration_format");if(profile.filter&&profile.filter(trackEvent,annotation)===false){logging.log("Empty or invalid event "+annotation.get("id"))}else{annotationId=annotation.id||annotation.get("id");trackEvent.annotationId=annotationId;if(trackEvent._duration){trackEvent.end=trackEvent.start+trackEvent._duration}if(trackEvent.pause){if(playerConfig&&playerConfig.pauseDuration){trackEvent.end=trackEvent.start+playerConfig.pauseDuration}else{trackEvent.end=trackEvent.start+.5}}if(!trackEvent.end||trackEvent.end<trackEvent.start){trackEvent.end=trackEvent.start+defaultDuration}videoDuration=Math.max(video.get("duration"),popcorn.duration());if(_.isFinite(videoDuration)&&videoDuration>0){trackEvent.start=Math.min(trackEvent.start,videoDuration);if(trackEvent.durationFormat==="percent"&&trackEvent.durationValue===100){trackEvent.end=videoDuration}else{trackEvent.end=Math.min(trackEvent.end,videoDuration)}}if(trackEvent.noscale){trackEvent.dragContainer=trackEvent.editorContainer=trackEvent.target=trackEvent.topContainer=elements.annotationNoscaleContainer}id=Popcorn.guid(plugin);popcornAnnotations[id]=annotation
;setUpAnnotationId(id,annotation);popcorn[plugin](id,trackEvent);if(id!==popcorn.getLastTrackEventId()){logging.warn("Error loading annotation "+annotation.get("id"),trackEvent);delete popcornAnnotations[id];delete annotationsById[annotationId];return}if(editor&&profile.create){profile.create(id,annotation,editor,alternateControls[profile.id])}if(editor&&(!window.HapyakApp||!canEditAnnotation(annotation))){editor.disable(id)}setDebugAttributes(popcorn.getTrackEvent(id),annotation)}}annotationsToLoad--;if(!annotationsToLoad){doneLoadingAnnotations()}}function provisionAnnotationEditor(aType){var profile;aType=aTypeAliases[aType]||aType;profile=annotationProfiles[aType];if(!profile){provisionAnnotationType(aType);return}if(editor&&!annotationEditorsLoaded.hasOwnProperty(aType)){annotationEditorsLoaded[aType]=false;require(profile.editor,function(){var i=0,pending;annotationEditorsLoaded[aType]=true;while(i<pendingCreate.length){pending=pendingCreate[i];if(pending[0]===profile){if(popcorn.paused()){createButtonClick.apply(me,pending)}pendingCreate.splice(i,1)}else{i++}}},function(err){delete annotationEditorsLoaded[aType];logging.warn("Failed to load editor",err);logging.captureException(err)})}}function provisionAnnotationType(aType,callback){var profileName,dependencies;function doneLoading(){profilesPending--;if(!profilesPending){updateAnnotationDisplay();if(elements.editControls&&showControls==="edit"){removeClass(elements.groupCreate,"loading");resizeControls()}emit("setupannotations")}}aType=aTypeAliases[aType]||aType;profileName="popcorn.profile."+aType;if(annotationProfiles.hasOwnProperty(aType)){if(callback){if(annotationProfiles[aType]){callback()}else{if(!provisionCallbacks[aType]){provisionCallbacks[aType]=[]}provisionCallbacks[aType].push(callback)}}return}dependencies=[profileName];if(playerConfig.pluginDependencies&&Popcorn.isArray(playerConfig.pluginDependencies[aType])){dependencies.push.apply(dependencies,playerConfig.pluginDependencies[aType])}annotationProfiles[aType]=false;profilesPending++;require(dependencies,function(profile){var allow360,annotation,backlog=annotationBacklog[aType],buttonElements,compatible,id,plugin,defaults,callbacks;if(!annotationProfiles[aType]){if(typeof profile==="function"){profile=profile({uploadAuth:uploadAuth,rootUrl:moduleConfig.rootUrl})}Popcorn.forEach(playerConfig.profiles&&playerConfig.profiles[aType],function(val,key){if(typeof profile[key]!=="function"){profile[key]=val}});id=profile.id;plugin=profile.plugin||id;annotationProfiles[aType]=profile;compatible=!Popcorn.incompatible(plugin);if(compatible){if(!profile.defaults){profile.defaults={}}if(playerConfig.defaults&&playerConfig.defaults[plugin]){Popcorn.extend(profile.defaults,playerConfig.defaults[plugin])}defaults=Popcorn.extend(profile.defaults,{target:elements[profile.target]||elements.annotationContainer});popcorn.defaults(plugin,defaults);if(!profile.normalize){profile.normalize={}}Popcorn.forEach(normalizeMethods,function(method,key){if(normalizeMethods.hasOwnProperty(key)&&typeof profile.normalize[key]!=="function"){profile.normalize[key]=method}});allow360=id!=="basic360"||["videojsvr"].indexOf(playerType)!==-1;if(elements.editControls&&(pluginsEnabled[plugin]||pluginsEnabled[aType])&&allow360){var font=id==="response"?"fa":"ss-icon";buttonElements=utils.microTemplate(elements.editControls,{"#":id,".":font+" disabled hapyak-new-"+id+" hapyak-annotation-tooltip",">":profile.icon,title:"Add "+profile.title,"data-annotation-tooltip":"Add "+profile.title});profile.button=buttonElements[id];elements["new-"+id]=profile.button;editButtons.push({index:profile.sortIndex,id:"new-"+id,alt:id});editButtons.sort(editButtonsSort);pluginOrder[id]=profile.zIndex;addButtonListener(profile.button,function(){createButtonClick(profile)});if(!editorLocked){removeClass(profile.button,"disabled")}if(profile.enableAltControls!==false&&options.enableAltControls!==false){setUpAltControl(profile)}provisionAnnotationEditor(aType)}}doneLoading()}if(backlog){while(backlog.length){annotation=backlog.shift();setUpAnnotation(profile,annotation)}updateMarkers()}if(typeof callback==="function"){callback()}callbacks=provisionCallbacks[aType];if(callbacks){while(callbacks.length){callbacks.shift()()}}},function(err){var backlog=annotationBacklog[aType];if(backlog){annotationsToLoad-=backlog.length;backlog.length=0}doneLoading();logging.warn("Failed to load plugin "+aType,err);logging.captureException(err);if(!annotationsToLoad){doneLoadingAnnotations()}})}function loadAnnotation(annotation){var aType=annotation.get("type");aType=aTypeAliases[aType]||aType;if(annotationProfiles[aType]){setUpAnnotation(annotationProfiles[aType],annotation);return}if(!annotationBacklog[aType]){annotationBacklog[aType]=[]}annotationBacklog[aType].push(annotation);provisionAnnotationType(aType)}function createAnnotation(plugin,options,callback,commit,aType){function createTrackEvent(){var id,currentTime,duration;function done(id){var annotation;if(id){editor.edit(id);annotation=popcornAnnotations[id];if(typeof callback==="function"){if(commit){annotation.onSave(function(){setUpAnnotationId(id,annotation);callback(id,annotation,editor,alternateControls[aType])});dao.store.commit()}else{callback(id,null,editor,alternateControls[aType])}}else if(commit){dao.store.commit()}}}if(!options){options={}}if(isNaN(options.start)){currentTime=getCurrentTime();duration=options._duration;if(!duration||duration<0){duration=playerConfig.duration||3;if(options._duration===undefined){options._duration=duration}}options.start=currentTime;options.end=currentTime+duration}options.end=Math.min(options.end,popcorn.duration());getEditor(function(){var profile=annotationProfiles[plugin];if(embedUtils.dotget(profile,"variables.populateConfig")){annotationVariableConfig.register(plugin,annotationProfiles[plugin].variables.populateConfig)}options.annotationVariableConfig=annotationVariableConfig;id=editor.create(plugin,options,done);logging.log("Created editor, id is",id,options);done(id)})}if(activeTrack&&window.HapyakApp&&activeTrack.hasPermission("add_annotations")){createTrackEvent()}else{emit("requestCreateTrack");return false}}function sortAnnotations(time){function sortFn(a,b){var pluginA,pluginB;pluginA=pluginOrder[a._natives.type];pluginB=pluginOrder[b._natives.type];if(pluginA===undefined){pluginA=-1}if(pluginB===undefined){pluginB=-1}return pluginA-pluginB||b.end-a.end}var i,events=[],nextContainer=null;var event,eventsByStart,targetContainer;if(!popcorn){return}eventsByStart=popcorn.data.trackEvents.byStart;if(eventsByStart.length<=2){return}for(i=1;i<eventsByStart.length;i++){event=eventsByStart[i];if(event.container&&[elements.annotationContainer,elements.annotationNoscaleContainer].indexOf(event.container.parentNode)!==-1){if(event.start>time){nextContainer=event.container;break}if(event.start===time&&!event.noSort){events.push(event)}}}if(events.length<=1){return}events.sort(sortFn);for(i=0;i<events.length;i++){event=events[i];if(event.noscale){targetContainer=elements.annotationNoscaleContainer}else{targetContainer=elements.annotationContainer}event.dragContainer=event.editorContainer=event.target=event.topContainer=targetContainer;if(nextContainer&&nextContainer.parentNode!==event.container.parentNode){nextContainer=null}targetContainer.insertBefore(event.container,nextContainer)}}function loadEditor(){if(editor||!elements||!queuedEditorRequested){return}hy.require(["popcorn.quickedit"],function(){editor=Popcorn.quickEdit(popcorn,{permission:function(action,id){var annotation,permission;if(action==="create"){return activeTrack&&window.HapyakApp&&activeTrack.hasPermission("edit")}if(action==="edit"&&transientAnnotations[id]){return false}annotation=popcornAnnotations[id];try{permission=!annotation||(action==="edit"?canEditAnnotation(annotation):annotation.hasPermission(action))}catch(e){permission=false}return permission},getAnnotationObject:function(id){return popcornAnnotations[id]},dialogContainer:elements.editorContainer,dragContainer:elements.annotationContainer,topContainer:elements.annotationContainer,baseWidth:BASE_WIDTH});editor.setting("basic360","editorContainer",elements.basic360EditContainer);editor.setting("drawing","editorContainer",elements.drawingEditContainer);editor.setting("ontime","editorContainer",elements.ontimeEditContainer);editor.setting("remote","editorContainer",elements.topLeftContainer);editor.setting("remote","remotes",remotes||[]);editor.on("activate",function(trackEvent,editor){if(editor.editContainer.parentNode===elements.annotationContainer||editor.editContainer.parentNode===elements.contentsContainer){setPrefixedStyle(editor.editContainer,"transform","scale("+1/playerScale+")")}editor.setting("annotation",popcornAnnotations[trackEvent.id])});editor.on("edit",function(trackEvent){var annotation,aType,id=trackEvent._id,container=trackEvent.container,parent=container&&container.parentNode||trackEvent.target,editContainer=parent&&parent.querySelectorAll('div[data-popcorn-id="'+id+'"].popcorn-quickedit-edit')[0],plugin=trackEvent.plugin||trackEvent._natives&&trackEvent._natives.type,profile;me.pause();popcorn.setData(id,"hapyak-editing",true,true);annotation=popcornAnnotations[id];aType=annotation&&annotation.get("type")||plugin;aType=aTypeAliases[aType]||aType;if(container){addClass(container,"hapyak-editing-"+plugin);if(container.parentNode!==parent||parent.lastElementChild!==container&&parent.lastElementChild!==editContainer){parent.appendChild(container)}}if(editContainer&&editContainer.parentNode){parent.appendChild(editContainer)}if(alternateControls[aType]){Popcorn.forEach(alternateControls[aType],function(control){control.activate()})}if(annotation&&annotation.get("isSaved")){profile=annotationProfiles[aType];if(profile&&profile.create){profile.create(id,annotation,editor,alternateControls[profile.id])}}emit("annotationFocus",false,annotation.get("id"))},true);editor.on("done",function(trackEvent){var editing=editor&&editor.editing(),annotation,aType;popcorn.setData(trackEvent._id,"hapyak-editing",false,true);annotation=popcornAnnotations[trackEvent._id];emit("annotationBlur",false,annotation.get("id"));Popcorn.forEach(Popcorn.registryByName,function(obj,plugin){var i,e,remove=true;for(i=editing.length-1;i>=0;i--){e=editing[i];if(e&&(e.plugin||e._natives&&e._natives.type)===plugin){remove=false;editing.splice(i,1)}}if(remove){if(trackEvent.container){removeClass(trackEvent.container,"hapyak-editing-"+plugin)}annotation=popcornAnnotations[trackEvent._id];aType=annotation&&annotation.get("type")||plugin;aType=aTypeAliases[aType]||aType;if(alternateControls[aType]){Popcorn.forEach(alternateControls[aType],function(control){control.deactivate()})}}})});Popcorn.forEach(pluginsEnabled,function(val,key){if(val){provisionAnnotationEditor(key)}});Popcorn.forEach(popcornAnnotations,function(annotation,id){var aType,profile;aType=annotation.get("type");aType=aTypeAliases[aType]||aType;profile=annotationProfiles[aType];if(profile&&profile.create){profile.create(id,annotation,editor,alternateControls[profile.id])}});unlockEditor("loadEditor");updateAnnotationDisplay();while(queuedEditorCallbacks.length){queuedEditorCallbacks.shift()()}})}function getEditor(callback){if(editor){if(callback){callback()}return}lockEditor("loadEditor");queuedEditorRequested=true;if(callback){queuedEditorCallbacks.push(callback)}loadEditor()}function trackLinks(trackEvent){var links,i,link,element;function trackLink(evt){var annotation,link=evt.currentTarget;if(link&&link.href){annotation=popcornAnnotations[trackEvent._id];me.tracking.annotationAction(annotation,"External Click",{Target:link.href,Text:annotation.getCustomProperty("popcorn.text"),Remaining:popcorn.duration()-popcorn.currentTime()})}}if(!trackEvent||!trackEvent.container){return}element=trackEvent.container;links=element.querySelectorAll("a");for(i=0;i<links.length;i++){link=links[i];link.removeEventListener("click",trackLink,false);if(link.hasAttribute("data-hapyak-log")){link.addEventListener("click",trackLink,false)}}}function updateModeSwitch(){if(!elements.controlBar){return}function notifyModeChange(mode){popcorn.emit("editModeChange",{mode:mode})}if(editMode){addClass(elements.editAnnotations,"active");removeClass(elements.showAnnotations,"active");removeClass(elements.hideAnnotations,"active");notifyModeChange("editAnnotations");return}if(showAnnotations){removeClass(elements.editAnnotations,"active");addClass(elements.showAnnotations,"active");removeClass(elements.hideAnnotations,"active");Popcorn.forEach(popcorn.data.trackEvents.byStart.slice(1,popcorn.data.trackEvents.byStart.length-2),function(trackEvent){removeClass(trackEvent.container,"hapyak-editing-"+trackEvent._natives.type)});notifyModeChange("showAnnotations");return}removeClass(elements.editAnnotations,"active");removeClass(elements.showAnnotations,"active");addClass(elements.hideAnnotations,"active");notifyModeChange("hideAnnotations")}function clearWarnings(){var now=Date.now(),remain=0;Popcorn.forEach(warnings,function(w){if(w.expire<=now){elements.warning.removeChild(w.element);delete warnings[w]}else{remain++}});if(remain){elements.warning.style.display="block";elements.warning.style.marginTop=-elements.warning.offsetHeight+"px";setTimeout(clearWarnings,100)}else{elements.warning.style.marginTop=""}}function addWarning(msg){var warning=warnings[msg];if(!warning){warning={element:document.createElement("div")};warning.element.appendChild(document.createTextNode(msg));elements.warning.appendChild(warning.element);warnings[msg]=warning}warning.expire=Date.now()+5e3;clearWarnings()}function updateSectionsViewed(force){var time=popcorn.currentTime(),next;if(force||!popcorn.paused()){while(time<currentSection.start&&currentSectionIndex>=0){currentSectionIndex--;currentSection=sectionsViewed[currentSectionIndex]}if(time<currentSection.end){return}next=sectionsViewed[currentSectionIndex+1];while(next&&next.start<=time){currentSectionIndex++;currentSection=sectionsViewed[currentSectionIndex];next=sectionsViewed[currentSectionIndex+1]}if(currentSection&&(!force&&time-currentSection.end<5||time-currentSection.end<1)){currentSection.end=time;if(currentSectionIndex<sectionsViewed.length-1){if(next.start-time<1){currentSection.end=next.end;sectionsViewed.splice(currentSectionIndex+1,1)}}return}currentSection={start:time,end:time};currentSectionIndex++;sectionsViewed.splice(currentSectionIndex,0,currentSection)}}function addButtonListener(button,callback){if(!button){return}button.style.webkitTouchCallout="none";setPrefixedStyle(button,"userSelect","none");button.setAttribute("unselectable","on");button.addEventListener("click",function(evt){if(evt.which===3||evt.button===2||evt.ctrlKey){return false}evt.preventDefault();if(button!==elements.moreIcon){removeClass(elements.moreIcon,"hover")}callback.call(this,evt)},false)}function setDebugAttributes(trackEvent,annotation){var container=trackEvent.container;if(container){if(!container.getAttribute("data-popcorn-id")){container.setAttribute("data-popcorn-id",trackEvent._id)}if(annotation&&!container.getAttribute("data-hapyak-id")){if(annotation.get("isSaved")&&annotation.get("id")){container.setAttribute("data-hapyak-id",annotation.get("id"))}else{annotation.onSave(function(){container.setAttribute("data-hapyak-id",annotation.get("id"))})}}}}function updateTrackInfo(){var user,image,fullName,title,description,ratingsAvg,show=false;if(!elements.trackInfo||moduleConfig.hideTrackInfo){return false}user=activeTrack&&activeTrack.get("owner");image=user&&user.get("image");if(image){elements.ownerProfileImage.src=image;elements.ownerProfileImage.style.display="";show=true}else{elements.ownerProfileImage.style.display="none"}fullName=user&&user.get("full_name");if(fullName){show=true;setText(elements.ownerName,fullName);elements.ownerName.parentNode.style.display=""}else{elements.ownerName.parentNode.style.display="none"}if(activeTrack){title=activeTrack.get("title");description=activeTrack.get("description");ratingsAvg=activeTrack.get("ratings_avg");if(title||description){show=true}}else{title=video&&video.get("title")}setText(elements.trackTitle,title);setText(elements.trackDescription,description);return true}function trackEventUpdated(data){var trackEvent=data.track,newTrackEvent={},plugin,transientAnnotation,annotation,id,duration,notEmpty=false,notEmptyFields=/^(bottom|end|height|left|right|start|top|width)$/;trackLinks(trackEvent);id=trackEvent._id;if(!editor||editor.editing().length<=0){sortAnnotations(trackEvent.start)}if(!trackEvent._natives){return}if(!popcornEventsByType[trackEvent._natives.type]){popcornEventsByType[trackEvent._natives.type]={}}popcornEventsByType[trackEvent._natives.type][id]=trackEvent;if(!annotationsLoaded){return}updateMarkers(id);if(blockSave[id]){return}annotation=popcornAnnotations[id];Popcorn.forEach(trackEvent,function(val,key){if(blacklist[key]){return}if(val===undefined||typeof val==="function"||val===null){return}if(instanceOfElement(val)||val instanceof window.Popcorn){return}try{if(!JSON.stringify(val)){return}}catch(e){return}if(typeof val!=="object"||Popcorn.isArray(val)){if(val===Infinity){val=Number.MAX_VALUE}else if(val===-Infinity){val=-Number.MAX_VALUE}newTrackEvent[key]=val}else{newTrackEvent[key]=Popcorn.extend({},val)}if(!notEmptyFields.test(key)){notEmpty=true}});trackEvent._duration=trackEvent._duration||0;duration=popcorn.duration();if(duration>0){trackEvent.start=Math.min(trackEvent.start||0,duration);trackEvent.end=Math.min(trackEvent.end||trackEvent.start,duration)}if(annotation){if(popcornDeleteQueue[id]){delete popcornDeleteQueue[id]}if(notEmpty&&canEditAnnotation(annotation)){annotation.set("start_time",trackEvent.startTimeValue);annotation.set("start_time_format",trackEvent.startTimeFormat);annotation.set("custom_configuration",trackEvent.customConfig);annotation.set("duration",trackEvent.durationValue);annotation.set("duration_format",trackEvent.durationFormat);annotation.setCustomProperty("target",null);annotation.setCustomProperty("popcorn",newTrackEvent);annotation.onSave(function(){if(editor){editor.emit("commit",false,id,annotation)}emit("updateTrackEventSaved",false,annotation)});dao.store.commit();emit("updateTrackEvent",false,annotation)}}else{if(trackEvent._isTransient){transientAnnotations[id]=trackEvent}transientAnnotation=transientAnnotations[id];trackEvent.startTimeValue=trackEvent.start;trackEvent.startTimeFormat="seconds";trackEvent.durationValue=trackEvent._duration;trackEvent.durationFormat="seconds";annotation=model.Comment.createRecord(null,!!transientAnnotation);if(transientAnnotation){annotation.setCustomProperty("externalId",transientAnnotation.id)}plugin=trackEvent.plugin||trackEvent._natives&&trackEvent._natives.type;annotation.set("type",plugin);annotation.set("track",activeTrack);annotation.set("start_time",trackEvent.startTimeValue);annotation.set("start_time_format",trackEvent.startTimeFormat);annotation.set("custom_configuration",trackEvent.customConfig);annotation.set("duration",trackEvent.durationValue);annotation.set("duration_format",trackEvent.durationFormat);if(window.HapyakApp){annotation.set("user",window.HapyakApp.currentUser)}annotation.set("privacy","public");annotation.setCustomProperty("popcorn",newTrackEvent);if(newTrackEvent._duration){annotation.set("duration",newTrackEvent._duration)}annotation.onSave(function(){setUpAnnotationId(id,annotation);if(editor){editor.emit("commit",false,id,annotation)}trackEvent.annotationId=annotation.id||annotation.get("id");blockSave[id]=true;popcorn[plugin](trackEvent);delete blockSave[id];emit("createTrackEventSaved",false,annotation)});popcornAnnotations[trackEvent._id]=annotation;if(!transientAnnotation){dao.store.commit()}emit("createTrackEvent",false,annotation)}setDebugAttributes(trackEvent,annotation)}function getVideoLink(){return"http://corp.hapyak.com"}function setLinks(){if(elements&&elements.tinyLogo){elements.tinyLogo.setAttribute("href",getVideoLink())}if(popcorn){popcorn.options.sharing.url=getVideoLink()}}function getCurrentTime(){return popcorn&&Math.max(popcorn.currentTime(),0)||0}function loadQueuedAnnotations(){var annotations,opts,changeTrack=false,reloadAnnotationSources=false;if(!queuedAnnotations||destroyed){return}if(popcorn.getTrackEvents().length){removeTrackEvents();reloadAnnotationSources=true}if(queuedAnnotationSources&&queuedAnnotationSources.length){return}annotations=queuedAnnotations;queuedAnnotations=null;opts=queuedTrackOpts;queuedTrackOpts=null;if(window.HapyakApp&&!activeTrack.hasPermission("edit")){if(elements.editAnnotations){elements.editAnnotations.style.display="none"}me.editMode(false)}logging.debug("player: "+annotations.get("length")+" annotation(s) found, "+annotations);annotationsToLoad=annotations.get("length");if(annotationsToLoad){annotationsLoaded=false;annotations.forEach(function(annotation){if(annotation.get("type")==="basic360"&&["videojsvr"].indexOf(playerType)===-1){return}if(!annotation.hasPermission("view")){logging.warn("Do not have permission to view annotation "+annotation.get("id"));return}loadAnnotation(annotation)})}else{changeTrack=true;annotationsLoaded=true;updateMarkers();trackSystemScope.set("annotationsLoaded",true,true);if(reloadAnnotationSources){loadAnnotationSources()}popcorn.emit("annotationsloaded");addClass(elements.annotationContainer,"active")}if(!moduleConfig.hideTrackInfo&&elements.trackInfo){if(!options.hasOwnProperty("trackInfo")||options.trackInfo){me.showTrackInfo()}else{updateTrackInfo()}}if(startEditMode){me.editMode(true)}else{me.showAnnotations(true)}if(window.HapyakApp&&activeTrack.hasPermission("edit")){if(elements.editAnnotations){elements.editAnnotations.style.display=""}resizeControls()}if((!popcorn.checkGates||!popcorn.checkGates(true))&&opts&&opts.autoplay&&!played&&(!editor||!editor.editing().length)){if(targetAnnotation){me.seekAnnotation(targetAnnotation)}me.play()}if(changeTrack){emit("changeTrack",false,activeTrack)}if(opts&&opts.callback){opts.callback()}}function loadAnnotationSources(){queuedAnnotationSources=[];Popcorn.forEach(annotationSources,function(enabled,sourceName){if(enabled){queuedAnnotationSources.push(sourceName);require([sourceName],function(source){var sourceNameIndex=queuedAnnotationSources.indexOf(sourceName);queuedAnnotationSources.splice(sourceNameIndex,1);source.call(this,container,video,opts,wrapper,function(events,plugins){var numAnnotations={};if(destroyed||!events){return}popcorn.getTrackEvents().forEach(function(te){numAnnotations[te._natives.type]=numAnnotations[te._natives.type]||0;numAnnotations[te._natives.type]++});Popcorn.forEach(events,function(eventData){var plugin=eventData.plugin,trackEvent=eventData.popcorn,maxAllowed;if(annotationProfiles&&annotationProfiles[plugin]){maxAllowed=annotationProfiles[plugin].maxAllowed}if(maxAllowed&&maxAllowed>0&&numAnnotations[plugin]>=maxAllowed){return true}provisionAnnotationType(plugin,function(){var id;var profile=annotationProfiles&&plugin&&annotationProfiles[plugin],annotationVariableConfig=new AnnotationVariableConfig(popcorn);id=Popcorn.guid(plugin);transientAnnotations[id]=eventData;if(!trackEvent.annotationVariableConfig&&plugin&&profile){if(embedUtils.dotget(profile,"variables.populateConfig")){annotationVariableConfig.register(plugin,profile.variables.populateConfig)}trackEvent.annotationVariableConfig=annotationVariableConfig}if(trackEvent._duration){trackEvent.end=trackEvent.start+trackEvent._duration}if(trackEvent.pause){trackEvent.end=trackEvent.start+.5}if(!trackEvent.end||trackEvent.end<trackEvent.start){trackEvent.end=trackEvent.start+defaultDuration}popcorn[plugin](id,trackEvent)})})});if(!queuedAnnotationSources.length){loadQueuedAnnotations()}},function(err){logging.captureException(err);die("Unable to load annotation source: "+sourceName)})}})}function loadVideoWrapper(){var wrapperRef,ref,i,result,args,popcornOptions,viewerTemplate,groupStandard,videoElement;function onDurationChange(){var parsedTime,time;duration=popcorn.duration()||duration||video.get("duration");if(duration===durationChangeVal){return}durationChangeVal=duration;if(duration&&Math.abs((video.get("duration")||0)-duration)>1&&video.hasPermission("edit")){video.set("duration",duration)}updateMarkers();drawTimeline();if(wrapperRef&&wrapperRef.showControlsEvent==="durationchange"){unlockEditor("player")}if(typeof options.time==="string"){parsedTime=timeRegex.exec(options.time);if(parsedTime){time=parseFloat(parsedTime[1]||0)*60+parseFloat(parsedTime[2]||0)}}else if(options.time){time=options.time}if(!isNaN(time)&&time>0&&time<duration){popcorn.currentTime(time)}if(hapyakPlayerTimer&&hapyakPlayerTimer.setDuration&&typeof hapyakPlayerTimer.setDuration==="function"){hapyakPlayerTimer.setDuration(duration)}emit("durationchange",true)}function onLoadedMetadata(){var closedCaptionButtons=document.querySelectorAll(".vjs-subs-caps-button"),i=0;duration=popcorn.duration();if(showControls==="viewer"){if(wrapperRef&&typeof wrapperRef.forceIpadControls==="function"){wrapperRef.forceIpadControls(src)}elements.controlBar.style.display=""}if(!playerConfig.showClosedCaptioningButton&&wrapperRef&&wrapperRef.id==="hapyakhostedplayer"){for(i=0;i<closedCaptionButtons.length;++i){closedCaptionButtons[i].style.display="none"}}if(duration){onDurationChange()}if(loadedMetadataFired){return}loadedMetadataFired=true;if(wrapperRef&&wrapperRef.showControlsEvent==="loadedmetadata"){unlockEditor("player")}me.resize();updateMarkers();drawTimeline();if(showTrackInfoTimeout&&elements.trackInfo){clearTimeout(showTrackInfoTimeout);showTrackInfoTimeout=setTimeout(function(){if(elements.trackInfo){removeClass(elements.trackInfo,"visible")}},2e3)}emit("loadedmetadata",true,{controlBarHeight:controlBarHeight,videoWidth:me.videoWidth(),videoHeight:me.videoHeight(),pluginData:me.pluginData()})}function updateAnnotationContainerPosition(){var container=popcorn.media.outerContainer;if(container){["annotationContainer","annotationNoscaleContainer","topLeftContainer","editorContainer","overlayContainer"].forEach(function(property){container.appendChild(elements[property])})}}function canPlay(){var trgtEl,videosPresent,trgtHoverContainer;if(configuration.provisioning.persistTime&&!isEditMode&&popcorn.persistTime){popcorn.currentTime(popcorn.persistTime)}if(me&&me.editMode()||hapyak&&hapyak.iframed){videosPresent=document.getElementsByTagName("video");if(videosPresent.length>0){Array.prototype.forEach.call(videosPresent,function(el){el.setAttribute("webkit-playsinline","webkit-playsinline");el.setAttribute("playsinline","playsinline")})}}popcorn.off("canplay",canPlay);unlockEditor("player");updateAnnotationDisplay();emit("canplay",true,{controlBarHeight:controlBarHeight,videoWidth:me.videoWidth(),videoHeight:me.videoHeight(),pluginData:me.pluginData()});trgtEl=me.outerContainer();trgtHoverContainer=trgtEl&&trgtEl.addEventListener==="fn"?trgtEl:embedUtils.dotget(elements,"annotationContainer.parentNode");if(opts.embed){updateAnnotationContainerPosition()}trgtHoverContainer.addEventListener("mouseleave",function playerMouseOver(){popcorn.emit("playerHover",false)},false);trgtHoverContainer.addEventListener("mouseenter",function playerMouseOut(){popcorn.emit("playerHover",true)},false);Popcorn.forEach(annotationProfiles,function(profile){var type;if(!profile){return}type=profile.plugin||profile.id;if(isAnnotationTypeOverMaxAllowed(annotationProfiles[type])){toggleAnnotationTypeEnabled(false,type)}})}window.addEventListener("message",trackingEvent,false);if(destroyed){return}ref=playerType&&wrappers[playerType];if(ref){if(Popcorn[ref.fn]&&Popcorn[ref.fn]._canPlaySrc(container)){wrapperRef=ref}}if(!wrapperRef){for(i in wrappers){if(wrappers.hasOwnProperty(i)){ref=wrappers[i];result=Popcorn[ref.fn]&&Popcorn[ref.fn]._canPlaySrc(container);if(result===true||result==="probably"){wrapperRef=ref;break}}}}if(wrapperRef){if(wrapperRef.isDuplicate&&wrapperRef.isDuplicate(container)){return}if(wrapperRef.args){options.playerParameters=Popcorn.extend({duration:options.duration,minimalRootCss:options.minimalRootCss,videoSourceId:embedUtils.dotget(video,"data.source_id")},options.playerParameters);args=wrapperRef.args(video,Popcorn.extend({isIOS:isIOS},options));args.unshift(container);wrapper=Popcorn[wrapperRef.fn].apply(Popcorn,args)}else{wrapper=Popcorn[wrapperRef.fn](container,args)}src=container;container=wrapperRef.container(container,wrapper)||container}if(!instanceOfElement(container)){die("Missing container element")}showIOSControls=isIOS&&(!wrapperRef||!wrapperRef.preventIOSControls);if(wrapper){existingVideo=true;viewerTemplate=options.playerType==="skeleton"&&embedUtils.dotget(options,"player.minimalRootCss")?rootBoxTemplate:annotationTemplate;elements=utils.microTemplate(container,viewerTemplate);if(wrapperRef.setupAnnotationContainer){wrapperRef.setupAnnotationContainer(elements,options)}if(showIOSControls&&(options.controls===undefined&&wrapperRef.forceIpadControls&&isIOS)||options.controls==="viewer"){if(typeof wrapperRef.forceIpadControls==="function"){wrapperRef.forceIpadControls(src,elements)}embedUtils.controlStyle(true,true);elements.controlBar=container.appendChild(document.createElement("div"));elements.controlBar.className="hapyak-viewer-control-bar";Popcorn.extend(elements,utils.microTemplate(elements.controlBar,controlBarTemplate));elements.controlBar.style.paddingBottom="0";elements.controlBar.style.bottom="-4px";elements.controlBar.style.position="absolute";elements.controlBar.style.width="100%";groupStandard=elements.groupStandard;groupStandard.style.marginTop="0";groupStandard.firstChild.style.border="none";groupStandard.firstChild.style.boxShadow="none";elements.groupCreate.style.display="none";elements.modeSwitch.style.display="none";showControls="viewer"}else{showControls=false}if(wrapperRef&&wrapperRef.modify){wrapperRef.modify(elements,container)}wrapper.autoplay=options.autoplay;showNativeControls=false;wrapper.controls=showControls?false:true;addClass(container,"hapyak-remote")}else{elements=utils.microTemplate(container,options.embed?embedTemplate:playerTemplate);if(!isEditMode&&hideCtrlbarLogo&&elements.tinyLogo){elements.tinyLogo.style.display="none"}if(!isEditMode&&hideCtrlbarSkipfwd&&elements.annotationSkipContainer){elements.annotationSkipContainer.style.display="none"}if(!isEditMode&&hideCtrlbarTimeline&&elements.timeline){elements.timeline.style.display="none"}if(options.controls===undefined){showControls="edit"}else{showControls=showControls===undefined?options.controls:showControls;if(showControls==="play"){elements.groupCreate.style.display="none"}else if(showControls){showControls="edit"}elements.controlBar.style.display=showControls?"":"none"}if(showNativeControls===undefined){showNativeControls=!showControls}wrapperRef=wrappers[source]||options.playerType&&wrappers[options.playerType];if(wrapperRef){if(wrapperRef.src){src=wrapperRef.src(video,options)}else{src=(wrapperRef.pre||"")+encodeURIComponent(sourceId)+(wrapperRef.post||"")}if(wrapperRef.args){options.playerParameters=Popcorn.extend({forceReadyState:showControls==="edit",isViewer:showControls==="viewer"},options.playerParameters);args=wrapperRef.args(video,options);args.unshift(elements.videoContainer);wrapper=Popcorn[wrapperRef.fn].apply(Popcorn,args)}else{wrapper=Popcorn[wrapperRef.fn](elements.videoContainer)}}else if(source==="html5"){(function(){var sourceMimeType,canPlay=false,sources,source;sources=video.getCustomProperty("sources");if(!sources||!sources.length){die("No video sources found");return}src=[];wrapper=document.createElement("video");for(i=0;i<sources.length;i++){source=sources[i];sourceMimeType=source.mime_type;src.push({src:source.url,type:sourceMimeType});if(sourceMimeType&&wrapper.canPlayType(sourceMimeType)){canPlay=true}}if(canPlay){for(i=0;i<src.length;i++){source=document.createElement("source");source.setAttribute("src",src[i].src);source.setAttribute("type",src[i].type||"")
;wrapper.appendChild(source)}elements.videoContainer.appendChild(wrapper);wrapper.addEventListener("error",function(){if(!destroyed){logging.error("Unable to play video",sources)}},false);src=null}else{wrapper=Popcorn.HTMLVideojsVideoElement(elements.videoContainer);wrapper.preload="auto"}})()}else{die("Unknown source: "+video.get("source"))}wrapper.controls=isEditMode?false:showNativeControls;wrapper.autoplay=options.autoplay;addClass(elements.playBox,video.get("source"))}if(!wrapper){die("Unable to create video element")}if(options.playerType==="skeleton"&&embedUtils.dotget(options,"player.minimalRootCss")||options.minimalRootCss){addClass(container,"hapyak-minimal-css")}addClass(container,"hapyak-player");ctx=elements.timeline&&elements.timeline.getContext("2d");preserveFullscreenStyles=wrapperRef&&wrapperRef.preserveFullscreenStyles;Popcorn.forEach(playerConfig.styles,function(styles,name){var element=elements[name];if(element){Popcorn.forEach(styles,function(value,key){element.style[key]=value})}});if(showControls==="edit"){Popcorn.forEach(pluginsEnabled,function(val,key){if(val){provisionAnnotationType(key)}})}if(options.embed){addClass(container,"hapyak-embed");addClass(container,"hapyak-remote");setLinks();elements.tinyLogo.addEventListener("click",function(){popcorn.pause();me.tracking.playerAction("Controls","Embed Logo Link")},true);if(!fullscreenEnabled&&!playerConfig.fullScreenPopOut){elements.fullScreen.style.display="none"}}else if(elements.controlBar){elements.tinyLogo.style.display="none"}addClass(container,"hapyak-"+(options.edit?"edit":"view")+"-mode");if(elements.timeline){timelineTouch=new Touch(elements.timeline,mouseShuttle,mouseShuttle,function(){if(!shuttlePaused){popcorn.play();shuttlePaused=true}})}if(showIOSControls&&elements.volumeContainer&&(isIOS||navigator.userAgent.match(/Android/))){elements.volumeContainer.style.display="none";elements.annotationSkipContainer.style.display="none"}if(elements.volumeSliderContainer){volumeTouch=new Touch(elements.volumeSliderContainer,function(evt,x,y){addClass(elements.volumeContainer,"active");dragVolume(evt,x,y)},dragVolume,function(){removeClass(elements.volumeContainer,"active")});vctx=elements.volumeSlider.getContext("2d")}volume=1;if(configuration.provisioning.watermark){elements.watermark=document.createElement("a");elements.watermark.style.cssText=["position: absolute","width: 100%","top: 0","left: 0","display: block","visibility: visible","opacity: 0.3","margin: 10% 0 0 0","padding: 20px","color: white","background-color: black","text-align: center","font-size: 30px","line-height: 30px","font-weight: bold","box-sizing: border-box;","z-index: auto"].join(";");if(startEditMode){elements.watermark.style.display="none"}elements.watermark.className="hapyak-watermark";elements.watermark.setAttribute("target","_new");elements.watermark.innerHTML='<img src="'+hapyak.assets+'/img/yak-blue.png"/>';elements.watermark.appendChild(document.createTextNode(playerConfig.watermarkText||"Contact HapYak to purchase API Keys"));elements.watermark.setAttribute("href",playerConfig.contactUrl||"http://corp.hapyak.com");elements.watermark.addEventListener("click",function(){if(popcorn){popcorn.pause()}},false);elements.annotationContainer.parentNode.insertBefore(elements.watermark,elements.annotationContainer.nextSibling)}popcornOptions={environment:trackScope,hapyakPlayer:me,getScope:getScope,frameAnimation:true,sharing:{image:video.get("image"),title:video.get("title"),url:getVideoLink()},shortenUrls:playerConfig.shortenUrls,validateLink:validateLink,hostWindow:options.hostWindow||window,disableInlineTextEdit:moduleConfig.disableInlineTextEdit===undefined?playerConfig.disableInlineTextEdit:moduleConfig.disableInlineTextEdit,autoEditDialog:moduleConfig.autoEditDialog===undefined?playerConfig.autoEditDialog:moduleConfig.autoEditDialog};Popcorn.extend(popcornOptions,playerConfig.popcornOptions);popcorn=Popcorn(wrapper,popcornOptions);annotationVariableConfig=new AnnotationVariableConfig(popcorn);if(existingVideo&&wrapperRef.setupAnnotationContainer){if(popcorn.readyState()>=3){wrapperRef.setupAnnotationContainer(elements,options)}else{popcorn.on("canplay",function(){if(embedUtils.dotget(popcorn,"media._utils.getPlayerInstance")){wrapperRef.setupAnnotationContainer(elements,{player:popcorn.media._utils.getPlayerInstance()})}})}}if(wrapperRef&&wrapperRef.annotationBlacklist){wrapperRef.annotationBlacklist.forEach(function(annotation){pluginsEnabled[annotation]=false})}updateAnnotationDisplay();popcorn.options.loadTrackTime=function(trackId,time,annotationId,callback){var track;var annotation=annotationsById[annotationId];if(typeof time==="string"){time=Popcorn.util.toSeconds(time,popcorn.options.framerate)}time=annotation?annotation.get("properties.popcorn.start")+.3:time;if(!isNaN(time)&&time>=0&&[null,undefined].indexOf(time)<0&&time<popcorn.duration()){popcorn.currentTime(time)}if(trackId){if(activeTrack&&activeTrack.get("id")===trackId&&trackScope!==environment){Popcorn.forEach(trackScope.keys(),function(key){if(key!=="trackId"){trackScope.clear(key,true)}});Popcorn.forEach(scopesByPopcornId,function(scope){Popcorn.forEach(scope.keys(),function(key){scope.clear(key,true)})})}track=model.Track.find(trackId);track.onLoad(function(){me.loadTrack(track,{callback:callback})})}else if(callback){callback()}};popcorn.on("pluginerror",function(e){logging.captureException(e)});Popcorn.forEach(Popcorn.registryByName,function(plugin,name){popcorn.defaults(name,{target:elements.annotationContainer})});if(elements.trackReplayButton){elements.trackReplayButton.innerHTML="Replay";elements.trackReplayButton.addEventListener("click",function(e){if(e.which===3||e.button===2||e.ctrlKey){return false}removeClass(elements.annotationContainer,"hapyak-player-overlay");removeClass(elements.annotationNoscaleContainer,"hapyak-player-overlay");removeClass(elements.trackInfo,"visible");removeClass(elements.trackMessage,"visible");elements.trackReplayButton.style.display="none";popcorn.play(0)},false)}(function(){var seekingTimeout,clearSeekingTimeout,seekingMessageElement=elements.trackMessage,previousCurrentTime=popcorn.currentTime();if(!elements.trackInfo||moduleConfig.hideTrackInfo){return}popcorn.on("seeking",function(){clearTimeout(seekingTimeout);clearTimeout(clearSeekingTimeout);if(elements.trackCapContent){removeClass(elements.trackCapContent,"visible")}seekingTimeout=setTimeout(function(){var minutes=parseInt(popcorn.currentTime()/60,10),seconds,buffered=popcorn.buffered(),end=0,start=0,showOverlay=false,i,l;if(Math.abs(previousCurrentTime-popcorn.currentTime())<1){return}for(i=0,l=buffered.length;i<l&&!showOverlay;i++){end=buffered.end(i);start=buffered.start(i);if(popcorn.currentTime()<start||popcorn.currentTime()>end){showOverlay=true}}if(!showOverlay){return}previousCurrentTime=popcorn.currentTime();if(minutes>=1){if(minutes>=10){minutes+=":"}else{minutes="0"+minutes+":"}}else{minutes="00:"}seconds=parseInt(popcorn.currentTime()%60,10);if(seconds<10){seconds="0"+seconds}addClass(elements.trackInfo,"visible");addClass(elements.trackMessage,"visible");elements.trackReplayButton.style.display="none";seekingMessageElement.innerHTML="Seeking to: "+minutes+seconds;clearSeekingTimeout=setTimeout(function(){if(elements.trackInfo){removeClass(elements.trackInfo,"visible")}if(seekingMessageElement){seekingMessageElement.innerHTML=""}},3e3)},250)});popcorn.on("ended",function(){clearTimeout(seekingTimeout);clearTimeout(clearSeekingTimeout);seekingMessageElement.innerHTML="";removeClass(elements.annotationContainer,"hapyak-player-overlay");removeClass(elements.annotationNoscaleContainer,"hapyak-player-overlay");elements.trackReplayButton.style.display="";addClass(elements.trackInfo,"visible");addClass(elements.trackMessage,"visible");if(loop){popcorn.currentTime(0);popcorn.play()}});popcorn.on("seeked",function(){clearTimeout(clearSeekingTimeout);removeClass(elements.trackInfo,"visible");seekingMessageElement.innerHTML=""})})();addButtonListener(elements.playButton,function(){if(editor){editor.done()}if(me.paused()){me.play();me.tracking.playerAction("Controls","Play")}else{me.pause();me.tracking.playerAction("Controls","Pause")}});addButtonListener(elements.volume,function(){var muted=popcorn.muted();popcorn.muted(!muted);if(muted&&!popcorn.volume()){popcorn.volume(1)}});addButtonListener(elements.moreIcon,function(evt){if(evt.target!==elements.moreIcon&&evt.target!==elements.moreIcon.firstChild){return}clearTimeout(editControlsTimeout);addClass(elements.moreIcon,"hover");editControlsTimeout=setTimeout(function(){removeClass(elements.moreIcon,"hover")},5e3)});if(!destroyed&&typeof overlay.setup==="function"){overlay.setup(elements.overlayContainer,{})}if(fullscreenEnabled){document.addEventListener("fullscreenchange",fullscreenFunction,false);document.addEventListener("mozfullscreenchange",fullscreenFunction,false);document.addEventListener("webkitfullscreenchange",fullscreenFunction,false);document.addEventListener("MSFullscreenChange",fullscreenFunction,false)}if(elements.fullScreen){if(!options.embed||fullscreenEnabled){addButtonListener(elements.fullScreen,function(){me.fullscreen(!isFullscreen(containerIsFullscreen));me.tracking.playerAction("Controls","Fullscreen");if(isMobileDevice){if(!options.embed){mobileUtils.initFullscreenChange(me,container)}changeIframeStyles()}})}else if(playerConfig.fullScreenPopOut){elements.fullScreen.setAttribute("title","Open video at full size in new window");addButtonListener(elements.fullScreen,function(){var windowName=video.get("id")+"hapyak",location=window.location,url,query,i;if(activeTrack){windowName+=activeTrack.get("id")}url=[moduleConfig.rootUrl+location.pathname];if(location.search&&location.search.length>1){query=location.search.substr(1).split("&");for(i=0;i<query.length;i++){if(utils.startsWith.call(query[i],"time=")){query.splice(i,1);i--}}}else{query=[]}if(popcorn){query.push("time="+popcorn.currentTime());url.push(query.join("&"))}me.tracking.playerAction("Controls","Fullscreen");me.pause();if(popOutWindow&&!popOutWindow.closed){popOutWindow.focus()}else{popOutWindow=window.open(url.join("?"),windowName)}})}}if(elements.showAnnotations){addButtonListener(elements.showAnnotations,function(){if(editorLocked){return}me.editMode(false);me.showAnnotations(true);me.tracking.playerAction("Controls","Show Annotations")})}if(elements.hideAnnotations){addButtonListener(elements.hideAnnotations,function(){if(editorLocked){return}me.showAnnotations(false);me.tracking.playerAction("Controls","Hide Annotations")})}if(elements.editAnnotations){addButtonListener(elements.editAnnotations,function(){if(editorLocked){return}me.editMode(true);me.tracking.playerAction("Controls","Edit Annotations")})}if(popcorn.prev&&elements.prevButton){addButtonListener(elements.prevButton,function(){if(editMode){popcorn.pause()}if(editor){editor.done()}popcorn.prev();me.tracking.playerAction("Controls","Skip Backward")})}if(popcorn.next&&elements.nextButton){addButtonListener(elements.nextButton,function(){if(editMode){popcorn.pause()}if(editor){editor.done()}popcorn.next();me.tracking.playerAction("Controls","Skip Forward")})}if(elements.createTrack){if(window.HapyakApp&&window.HapyakApp.currentUser){addButtonListener(elements.createTrack,function(){if(editorLocked){return}if(editor){editor.done()}if(!window.HapyakApp.currentUser){logging.info("No permission to create track");return}me.editMode(true);me.createTrack()},false)}else{elements.createTrack.display="none"}}if(elements.trackInfoClose){addButtonListener(elements.trackInfoClose,function(){removeClass(elements.trackInfo,"visible")})}window.addEventListener("resize",resize,false);window.addEventListener("orientationchange",orientationChange,false);window.addEventListener("orientationchange",resize,false);window.addEventListener("message",changeIframeStyles,false);if(autoResize){autoResizeTimer=setInterval(resize,500)}function checkActiveAnnotations(){var plugins=popcorn.data.running;if(!plugins){return false}return Object.keys(plugins).some(function(pluginName){return plugins[pluginName].length>0})}popcorn.on("resize",function(){me.resize()});popcorn.on("loadedmetadata",onLoadedMetadata);popcorn.on("durationchange",onDurationChange);popcorn.on("progress",function(){lastTimelineTime=-1});popcorn.on("volumechange",function(){var muted=popcorn.muted();if(!muted){volume=popcorn.volume()}if(elements.volume){if(!volume||muted){elements.volume.className="hapyak-volume ss-volume"}else if(volume<.5){elements.volume.className="hapyak-volume ss-volumelow"}else{elements.volume.className="hapyak-volume ss-volumehigh"}}drawVolume()});popcorn.on("trackadded",trackEventUpdated);popcorn.on("trackchange",trackEventUpdated);popcorn.on("trackremoved",function(trackEvent){function deleteAnnotation(){var annotation,annotationId;if(popcornDeleteQueue[trackEvent._id]){annotation=popcornDeleteQueue[trackEvent._id];annotationId=annotation.get("id");if(!window.HapyakApp||!annotation.hasPermission("delete")){logging.warn("Do not have permission to delete track "+annotation.get("id"));return}logging.info("delete event "+trackEvent._id);delete popcornDeleteQueue[trackEvent._id];emit("removeTrackEvent",false,annotation);annotation.onDelete(function(){emit("removeTrackEventSaved",false,annotation)});annotation.deleteRecord();dao.store.commit();delete popcornAnnotations[trackEvent._id];popcorn.removeTrackEvent(trackEvent._id);if(activeTrack){trackSystemScope.set("annotationIds."+annotationId,false,true);trackSystemScope.set("projectAnnotations."+annotationId,false,true);getScope(trackEvent._id).destroy()}delete scopesByPopcornId[trackEvent._id];delete popcornIdLookup[annotationId];delete annotationsById[annotationId];if(markers[trackEvent._id]){if(elements.controlBar){elements.controlBar.removeChild(markers[trackEvent._id])}delete markers[trackEvent._id]}if(!isAnnotationTypeOverMaxAllowed(annotationProfiles[eventType])){toggleAnnotationTypeEnabled(true,eventType)}}}var eventType=trackEvent._natives&&trackEvent._natives.type||"",events=popcornEventsByType[eventType];if(events){delete events[trackEvent._id]}if(popcornAnnotations[trackEvent._id]){popcornDeleteQueue[trackEvent._id]=popcornAnnotations[trackEvent._id];if(destroyed){deleteAnnotation()}setTimeout(deleteAnnotation,10)}});popcorn.on("trackstart",function(trackEvent){var annotation,links,link,i,p;if(activeTrackEvents[trackEvent.id]){return}annotation=popcornAnnotations[trackEvent._id];if(annotation&&!me.editMode()){if(trackEvent.container&&annotation.get("type")==="pop"){p={};links=trackEvent.container.querySelectorAll("a");for(i=0;i<links.length;i++){link=links[i];p["Target"+(i+1)]=link.href}}me.tracking.annotationView(annotation,p);trackStartTimes[trackEvent.id]=Date.now()}if(trackEvent&&trackEvent.container){if(trackEvent.gate){addClass(trackEvent.container,"hapyak-action-gate")}if(trackEvent.pause){popcorn.annotationPause(trackEvent);annotationPauseTriggered=true;addClass(trackEvent.container,"hapyak-action-pause")}}setDebugAttributes(trackEvent.track,annotation);emit("trackEventViewed",false,annotation,trackEvent)});popcorn.on("trackend",function(trackEvent){var start=trackStartTimes[trackEvent._id],annotation;if(start){annotation=popcornAnnotations[trackEvent._id];if(annotation){me.tracking.annotationEnded(annotation,{Elapsed:(Date.now()-start)/1e3,Paused:!!trackEvent.pause})}}if(trackEvent&&trackEvent.container){removeClass(trackEvent.container,"hapyak-action-gate");removeClass(trackEvent.container,"hapyak-action-pause")}delete trackStartTimes[trackEvent._id];delete activeTrackEvents[trackEvent.id]});popcorn.on("timeupdate",function(){var currentTime=getCurrentTime();if(Popcorn.p.hasOwnProperty("persistTime")&&configuration.provisioning.persistTime&&!isEditMode){popcorn.persistTime=currentTime}if(currentTime<duration){if(ended){ended=false;updateAnnotationDisplay()}else{ended=false}}if(popcorn.checkGates&&popcorn.checkGates()){return}if(currentTime<currentViewSection.start||currentTime-currentViewSection.end>=5){accumulatedViewTime+=currentViewSection.end-currentViewSection.start;currentViewSection.start=currentTime}currentViewSection.end=currentTime;accruedTimeUtils.post(embedUtils.dotget(popcorn,"options.hapyakPlayer"));updateSectionsViewed();emit("timeupdate",false,popcorn.currentTime());me.tracking.updateVideoPlayback()});popcorn.on("seeking",function(){var currentTime=popcorn.currentTime();accumulatedViewTime+=currentViewSection.end-currentViewSection.start;currentViewSection.start=currentTime;currentViewSection.end=currentTime});popcorn.on("seeked",function(){updateSectionsViewed(true);emit("seeked",false,popcorn.currentTime());me.tracking.updateVideoPlayback();if(seekedEventCount<=50){me.tracking.playerAction("Video","Seeked");seekedEventCount+=1}else if(!seekedEventAlerted){seekedEventAlerted=true;me.tracking.customAction("System","Seek Flood",null,{})}});popcorn.on("ended",function(){var action;ended=true;if(hideEndAnnotations){updateAnnotationDisplay()}emit("ended",false,popcorn.currentTime());if(accumulatedViewTime>duration){action="End-over"}else if(duration-accumulatedViewTime<.5){action="End-complete"}else{action="End-under"}if(loop){popcorn.currentTime(0);popcorn.play()}me.tracking.playerAction("Video",action)});popcorn.on("play",function onPlay(){played=true;addClass(container,"playing");if(elements.playButton){elements.playButton.innerHTML="&#xE8A0;"}if(elements.trackInfo){removeClass(elements.trackInfo,"visible");removeClass(elements.trackCapContent,"visible")}annotationPauseTriggered=false;if(options.hidePlayerUIWhenInteracting){this.media._utils.updatePlayerUI(this.media.parentNode,true)}emit("play");me.tracking.playerAction("Video","Resume")});popcorn.on("pause",function onPause(){if(shuttlePaused){removeClass(container,"playing");if(elements.playButton){elements.playButton.innerHTML="&#x25B6;"}}if(checkActiveAnnotations()&&options.hidePlayerUIWhenInteracting){this.media._utils.updatePlayerUI(this.media.parentNode,false)}emit("pause");me.tracking.playerAction("Video","Pause")});popcorn.on("disable",function(){me.showAnnotations(false)});popcorn.fallback({start:function(event,options){var type,msg;type=options&&options._natives&&options._natives.type;msg=popcorn.incompatible(type);addWarning(msg)}});emit("loadedplayer",true,wrapper);resize(options.width,options.height);if(src){wrapper.src=src}if(moduleConfig.tracking&&wrapper._util&&wrapper._util.trackView){wrapper._util.trackView(JSON.stringify(moduleConfig.tracking))}if(wrapper._utils&&wrapper._utils.addConversionListener){wrapper._utils.addConversionListener(function(type,data){var auth=hapyak.auth(),partnerAuth=auth.partner,email,username,userId;if(typeof data.email==="string"&&data.email.indexOf("{")===-1){email=partnerAuth.email||data.email;username=partnerAuth.username||data.username||email;userId=partnerAuth.userId||data.userId||username;hapyak.auth({partner:{userId:userId,username:username,email:email}})}emit("conversion",false,type,data)})}if(moduleConfig.muted){popcorn.muted(true)}drawVolume();me.showAnnotations(true);lockEditor("player");updateTrackInfo();if(popcorn.duration()){onDurationChange();if(wrapper.videoWidth===undefined?wrapper.width&&wrapper.height:wrapper.videoWidth&&wrapper.videoHeight){onLoadedMetadata()}}if(wrapper.readyState>=3){canPlay()}else{popcorn.on("canplay",canPlay)}loadQueuedAnnotations();loadAnnotationSources();setLinks();me.controls(showControls);if(queuedPlaying){me.play()}if(queuedFullscreen){me.fullscreen(queuedFullscreen)}}function trackDataObserver(){function dataChanged(){var obj,changed=false,changes,removed,val,i,key;dataChangeTimeout=0;if(destroyed||!listeners.data||!activeTrack){return}obj={};changes={};removed={};for(key in variablesBackup){if(variablesBackup.hasOwnProperty(key)){changes[key]=undefined;removed[key]=true}}for(i=0;i<trackScope.keys.count;i++){key=trackScope.keys(i);val=trackScope.get(key);obj[key]=val;if(variablesBackup[key]===val){delete changes[key]}else{variablesBackup[key]=val;changes[key]=val;changed=true}delete removed[key]}if(changed){for(key in removed){if(removed.hasOwnProperty(key)){delete variablesBackup[key]}}emit("data",false,obj,changes)}}if(dataChangeTimeout){return}dataChangeTimeout=setTimeout(dataChanged,0)}this.annotationPosition=function(annotation){var popcornId=popcornIdLookup[annotation.get("id")];var trackEvent=popcorn.getTrackEvent(popcornId);if(!trackEvent||!embedUtils.dotget(trackEvent,"container.parentNode")){return[undefined,undefined]}var container=trackEvent.container,parent=trackEvent.container.parentNode,annotationHeight=container.offsetHeight,annotationWidth=container.offsetWidth,parentHeight=parent.offsetHeight,parentWidth=parent.offsetWidth,pctWidth=annotationWidth/parentWidth*100,pctHeight=annotationHeight/parentHeight*100,pctTop=container.offsetTop/parentHeight*100,pctLeft=container.offsetLeft/parentWidth*100,gridBoundaries=[1/3*100,2/3*100],horizontalLabels=["left","right"],verticalLabels=["top","bottom"],topLeft={x:pctLeft,y:pctTop},topRight={x:pctLeft+pctWidth,y:pctTop},bottomLeft={x:pctLeft,y:pctTop+pctHeight},bottomRight={x:pctLeft+pctWidth,y:pctTop+pctHeight},center={x:(topLeft.x+bottomRight.x)/2,y:(topLeft.y+bottomRight.y)/2},horizontalIndex=gridBoundaries.indexOf(gridBoundaries.concat(center.x).sort()[1]),verticalIndex=gridBoundaries.indexOf(gridBoundaries.concat(center.y).sort()[1]),horizontalLabel=horizontalIndex===-1?"center":horizontalLabels[horizontalIndex],verticalLabel=verticalIndex===-1?"center":verticalLabels[verticalIndex];return[verticalLabel+"-"+horizontalLabel,{top_left:topLeft,top_right:topRight,bottom_left:bottomLeft,bottom_right:bottomRight,center:center}]};options=options||{};me.tracking.startPlayerContext(this,options);if(typeof container==="string"){container=document.querySelector(container)}if(!container||typeof container!=="object"&&!instanceOfElement(container)){die("Missing container element");return}if(!video){die("Missing video");return}source=video.get("source");if(!source){die("Missing source");return}sourceId=video.get("source_id");if(!sourceId){die("Missing source_id");return}activePlayers++;duration=video.get("duration");startEditMode=options.edit;environment.register("render",function(scope,str,encode){return str.replace(utils.regex.templateVarsRegex(),function(match,name,def){var value=scope.get(name)||def||"";if(encode&&value){value=encodeURIComponent(value)}return value})});environment.register("templateVars",function(scope,str,a){var array=a||[];str.replace(utils.regex.templateVarsRegex(),function(match,name){var i=array.indexOf(name);if(i<0){array.push(name)}});return array});(function(){var oldUserId,newUserId;try{oldUserId=parseInt(window.localStorage.hapyakUserId,10)||0;newUserId=window.HapyakApp.currentUser&&window.HapyakApp.currentUser.get("id")||0;if(oldUserId!==newUserId){Popcorn.forEach(window.localStorage,function(val,key){if(utils.startsWith.call(key,"hapyak-env")){window.localStorage.removeItem(key)}});if(newUserId){window.localStorage.setItem("hapyakUserId",newUserId)}else if(oldUserId){window.localStorage.removeItem("hapyakUserId")}}}catch(localStorageError){}})();Environment.localStorage.move(/^hapyak-env\/track-([0-9]+)($|\/)/,"hapyak-env/track-$1-system/track-$1");environment.load("hapyak-env","");environment.set("playerId",uuid(),true);environment.set("tracking",moduleConfig.tracking||{},true);environment.set("context",moduleConfig.context||{},true);environment.set("configuration",playerConfig||{},true);environment.set("hapyakCSRFToken",moduleConfig.csrfToken,true);environment.set("hapyakAPIKey",moduleConfig.apiKey,true);function updateAuth(auth){var partnerAuth=auth.partner;if(!_.isEmpty(partnerAuth)){environment.set("hapyakPartnerAuth",partnerAuth,true);_.each(["userId","username","email"],function(field){if(partnerAuth[field]){environment.set(field,partnerAuth[field],true)}})}popcorn&&popcorn.emit("authchange",{partner:partnerAuth});emit("authchange",true,partnerAuth)}updateAuth(hapyak.auth());hapyak.addEventListener("auth",updateAuth);this.play=function(){if(popcorn){popcorn.play()}else{queuedPlaying=true}};this.pause=function(){if(popcorn){popcorn.pause()}else{queuedPlaying=false}};this.playTime=function(){return hapyakPlayerTimer.getPlayTime()};this.slicePlayTime=function(reset){return hapyakPlayerTimer.getSlicePlayTime(reset)};this.currentTime=function(time){var that=this;function deferCurrentTimeUntilPlay(){popcorn.off("play",deferCurrentTimeUntilPlay);if(opts.autoplay){popcorn.currentTime(time);return}popcorn.on("pause",deferCurrentTimeUntilPause);popcorn.pause()}function deferCurrentTimeUntilPause(){popcorn.off("pause",deferCurrentTimeUntilPause);popcorn.currentTime(time)}if(!popcorn){if(time){this.on("loadedmetadata",function onLoadedMetaData(){that.off("loadedmetadata",onLoadedMetaData);if(!popcorn.paused()){popcorn.currentTime(time)}else{popcorn.on("play",deferCurrentTimeUntilPlay);popcorn.play()}})}return 0}if(time===undefined||time>popcorn.duration()||time<0){return popcorn.currentTime()}return popcorn.currentTime(time)};this.elapsedTime=function(){if(!popcorn){return 0}return accumulatedViewTime+Math.max(popcorn.currentTime(),currentViewSection.end)-currentViewSection.start};this.mediaType=function(){return popcorn&&popcorn.media&&popcorn.media.mediaType};this.duration=function(){if(!popcorn){return NaN}return popcorn.duration()};this.paused=function(){if(popcorn){return popcorn.paused()}return!queuedPlaying};this.aspectRatio=function(newAspectRatio){var ratio;if(newAspectRatio&&newAspectRatio>0){options.aspectRatio=newAspectRatio}if(options.aspectRatio==="widescreen"){return 16/9}ratio=parseFloat(options.aspectRatio);if(ratio>0){return ratio}if(wrapper&&wrapper.videoHeight){return wrapper.videoWidth/wrapper.videoHeight}if(playerConfig.aspectRatioOverride==="widescreen"||video.get("aspect_ratio")==="widescreen"){return 16/9}ratio=parseFloat(video.get("aspect_ratio"));if(ratio>0){return ratio}return 4/3};this.width=function(){return wrapper.width};this.height=function(){return wrapper.height};this.videoWidth=function(){return wrapper.videoWidth};this.videoHeight=function(){return wrapper.videoHeight};this.pluginData=function(){return wrapper.pluginData};this.volume=function(volume){if(volume!==undefined){return popcorn.volume(volume)}return popcorn.muted()?0:popcorn.volume()};this.muted=function(){return popcorn.muted()};this.mute=function(muted){muted=muted||muted===undefined?true:false;popcorn.mute(muted)};this.loop=function(val){if([undefined,null].indexOf(val)>-1){return loop}loop=val;return loop};this.seekAnnotation=function(id,offset){function seek(annotation){var props,time;function seekWhenReady(){if(time<popcorn.duration()){popcorn.currentTime(time)}popcorn.off("durationchange",seekWhenReady)}if(annotation instanceof model.Comment){props=annotation.get("properties");if(!props||!popcorn){targetAnnotation=annotation;return}if(props.popcorn&&props.popcorn.start){time=props.popcorn.start;if(offset){time=time-offset}if(popcorn.duration()>time){popcorn.currentTime(time)}else{popcorn.on("durationchange",seekWhenReady)}}targetAnnotation=null}}var i;if(typeof id==="object"){return seek(id)}for(i in popcornAnnotations){if(popcornAnnotations.hasOwnProperty(i)){if(popcornAnnotations[i].get("id")===id){seek(popcornAnnotations[i])}}}};this.fullscreen=function(fs){if(!wrapper){if(fs!==undefined){queuedFullscreen=fs}return queuedFullscreen}if(fs===undefined){return isFullscreen()}if(fs){if(fullscreenEnabled){if(container.requestFullScreen){container.requestFullScreen()}else if(container.mozRequestFullScreen){container.mozRequestFullScreen()}else if(container.msRequestFullscreen){container.msRequestFullscreen()}else if(container.webkitRequestFullScreen){if(/chrome/i.test(navigator.userAgent)||!/safari/i.test(navigator.userAgent)){container.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}else{container.webkitRequestFullScreen()}}}fullScreenChange(null,true);return}else if(fullscreenEnabled){if(document.cancelFullScreen){document.cancelFullScreen();return}if(document.mozCancelFullScreen){document.mozCancelFullScreen();return}if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();return}if(document.msExitFullscreen){document.msExitFullscreen();return}}fullScreenChange(null)};this.resize=resize;this.controls=function(show){if(!wrapper){showControls=show&&showControls!=="play"?"edit":show;return}if(show!==undefined&&elements.controlBar){if(show&&!showControls){drawTimeline()}showControls=show;if(showControls==="play"||showControls==="viewer"){elements.groupCreate.style.display="none"}else{elements.groupCreate.style.display=""}elements.controlBar.style.display=show?"":"none";resize();updateMarkers()}return showControls};this.showCapContent=function(content,timeout){if(!elements||!elements.trackCapContent){return}if(instanceOfElement(content)||instanceOfElement("DocumentFragment")||instanceOfElement(content,"Text")&&instanceOfElement(content)){elements.trackCapContent.innerHTML="";elements.trackCapContent.appendChild(content)}else if(content){elements.trackCapContent.innerHTML=content}addClass(elements.trackCapContent,"visible");if(timeout){setTimeout(function(){removeClass(elements.trackCapContent,"visible")},timeout)}};this.loadTrack=function(track,opts){function onLoadComments(annotations){if(!track||activeTrack!==track){return}queuedAnnotations=annotations;queuedTrackOpts=opts;if(wrapper){loadQueuedAnnotations()}}if(activeTrack===track){if(opts&&opts.callback){opts.callback()}return}unloadTrack();if(embedUtils.dotget(configuration,"provisioning.pauseOnWindowBlur")){document.addEventListener(visibilityEvent,function(){isBlurred=!isBlurred;pauseOnWindowBlur.apply(this)}.bind(this),false)}if(!track){setLinks();if(activeTrack){emit("changeTrack",false,track)}return}logging.info("player: loading track #"+track.get("id"));activeTrack=track;trackSystemScope=environment.scope("track-"+track.get("id")+"-system");trackSystemScope.set("environment",hapyak.environment,true);trackSystemScope.set("playerType",options.playerType,true);trackSystemScope.set("playlistId",options.playlistId,true);trackSystemScope.set("projectId",options.projectId,true);if(options.workflow){trackSystemScope.set("workflow",options.workflow,true)}trackSystemScope.set("projectName",options.projectName,true);trackSystemScope.set("trackId",track.get("id"),true);trackSystemScope.set("trackEditPermission",activeTrack.hasPermission("edit"),true);trackSystemScope.set("annotationsLoaded",false,true);environment.load("hapyak-env","track-"+track.get("id")+"-system/track-"+track.get("id"));trackScope=trackSystemScope.scope("track-"+track.get("id"));trackScope.observe(trackDataObserver);trackDataObserver();setLinks();if(popcorn){popcorn.options.sharing.url=getVideoLink()}if(opts&&opts.comments){logging.info("loading comments from passed in options");onLoadComments(opts.comments)}else{logging.info("querying server for comments for track "+track.get("id"));model.Comment.find({track:track.get("id"),limit:500}).onLoad(onLoadComments)}};this.createTrack=function(data,callback){function createEmptyTrack(d){var track,title,data=d&&typeof d==="object"||{};title=data.title||"";unloadTrack();track=model.Track.createRecord({owner:window.HapyakApp.currentUser,video:video,title:title,created:new Date,modified:new Date,privacy:"public"});dao.store.commit();activeTrack=track;emit("createTrack",false,track);unlockEditor("createTrack");me.editMode(true);if(typeof callback==="function"){callback.call(me,track)}return track}if(!window.HapyakApp.currentUser){emit("createError",false,"no-user");die("Do not have permission to create new track");return false}lockEditor("createTrack");return createEmptyTrack(data)};this.editTrack=function(data,callback){var me=this,validEdit=false;if(!window.HapyakApp.currentUser){emit("createError",false,"no-user");die("Do not have permission to edit track");return false}if(!activeTrack){
emit("createError",false,"no-active-track");die("There is no active track to edit");return false}if(typeof data.title==="string"){activeTrack.set("title",data.title);validEdit=true}if(typeof data.description==="string"){activeTrack.set("description",data.description);validEdit=true}if(validEdit){activeTrack.onSave(function(){emit("editTrack",false,activeTrack);if(typeof callback==="function"){callback.call(me,activeTrack)}});dao.store.commit()}return activeTrack};this.copyTrack=function(callback){var me=this,track;if(!window.HapyakApp.currentUser){emit("createError",false,"no-user");die("Do not have permission to create new track");return false}if(!activeTrack){emit("createError",false,"no-active-track");die("There is no active track to copy from");return false}track=model.Track.createRecord({copied_from:activeTrack.get("id")});track.onSave(function(){emit("createTrack",false,track);me.loadTrack(track);unlockEditor("copyTrack");me.editMode(true);if(typeof callback==="function"){callback.call(me,track)}});dao.store.commit();lockEditor("copyTrack");return track};this.deleteTrack=function(callback){var me=this,trackId;if(!window.HapyakApp.currentUser){emit("createError",false,"no-user");die("Do not have permission to delete track");return false}if(!activeTrack){emit("createError",false,"no-active-track");die("There is no active track to delete");return false}trackId=activeTrack.get("id");lockEditor("deleteTrack");activeTrack.onDelete(function(){emit("deleteTrack",false,trackId);unloadTrack();unlockEditor("deleteTrack");me.editMode(false);if(typeof callback==="function"){callback.call(me,trackId)}});activeTrack.deleteRecord();dao.store.commit();return trackId};this.annotations=function(){var array=[];function sort(a,b){function ifNum(num,alt){if(isNaN(num)){return alt}return num}var aStart,bStart,aEnd,bEnd;aStart=a.get("properties.popcorn")||a.get("properties");aStart=ifNum(aStart&&ifNum(aStart.start,aStart.start_time),a.get("start_time"));bStart=b.get("properties.popcorn")||b.get("properties");bStart=ifNum(bStart&&ifNum(bStart.start,bStart.start_time),b.get("start_time"));if(aStart===bStart){aEnd=a.get("properties.popcorn")||a.get("properties");aEnd=ifNum(aEnd&&ifNum(aEnd.end,aEnd.end_time),a.get("end_time"));bEnd=b.get("properties.popcorn")||b.get("properties");bEnd=ifNum(bEnd&&ifNum(bEnd.end,bEnd.end_time),b.get("end_time"));return aEnd-bEnd}return aStart-bStart}Popcorn.forEach(popcornAnnotations,function(annotation){array.push(annotation)});array.sort(sort);return array};this.annotations.get=function(annotationId){var annotation=annotationsById[annotationId],popcornId=popcornIdLookup[annotationId];var annotationProps,customConfig;if(annotation&&popcornId){customConfig=annotation.get("custom_configuration");annotationProps={annotationId:parseInt(annotationId,10),trackId:annotation.get("track.id"),properties:Popcorn.extend({},annotation.getCustomProperty("popcorn")||annotation.get("properties")),type:annotation.get("type"),created:annotation.get("created").valueOf(),modified:annotation.get("modified").valueOf(),writable:!transientAnnotations[popcornId]};if(customConfig){annotationProps.customConfig=customConfig}return annotationProps}return null};this.annotations.all=function(type){var annotationId,annotation,single,result=[];function sort(a,b){if(a.properties.start===b.properties.start){return a.properties.end-b.properties.end}return a.properties.start-b.properties.start}if(activeTrack){for(annotationId in annotationsById){if(annotationsById.hasOwnProperty(annotationId)){annotation=annotationsById[annotationId];if(!type||type===annotation.get("type")){single=me.annotations.get(annotationId);if(single){result.push(single)}}}}}result.sort(sort);return result};this.annotations.create=function(type,properties,callback){if(!pluginsEnabled[type]){throw new Error("annotations.create: Unsupported plugin type "+type)}delete properties.dataId;delete properties.id;delete properties._id;delete properties.annotationId;if(properties.end){properties._duration=properties.end-properties.start}provisionAnnotationType(type,function(){createButtonClick(annotationProfiles[type],properties,function(id,annotation){if(typeof callback==="function"){callback(me.annotations.get(annotation.get("id")))}})});return properties};this.annotations.update=function(id,properties,callback){var popcornId=popcornIdLookup[id],writable,trackEvent,annotation,result;if(!id){throw new Error("annotations.update: Annotation ID required")}if(!popcornId){throw new Error("annotations.update: Annotation '"+id+"' not found")}writable=!transientAnnotations[popcornId];if(!writable){throw new Error("annotations.update: Unable to modify annotation "+id)}if(!properties){result=me.annotations.get(id);if(typeof callback==="function"){callback(result)}return result}annotation=annotationsById[id];trackEvent=popcorn.getTrackEvent(popcornId);delete properties.dataId;delete properties.id;delete properties._id;delete properties.annotationId;if(!properties.startTimeValue&&properties.start){properties.startTimeValue=properties.start}if(!properties.durationValue&&properties._duration){properties.durationValue=properties._duration}Popcorn.extend(trackEvent,properties);if(typeof callback==="function"){if(dao.store.isDirty){annotation.onSave(function(){var annotation=me.annotations.get(id);callback(annotation)})}else{setTimeout(function(){callback(me.annotations.get(id))},100)}}popcorn[annotation.get("type")](popcornId,trackEvent);result=me.annotations.get(id);return result};this.annotations.remove=function(id,callback){var popcornId=popcornIdLookup[id],writable,annotation=annotationsById[id];if(!id){throw new Error("annotations.remove: Annotation ID required")}if(!popcornId||!annotation){throw new Error("annotations.remove: Annotation '"+id+"' not found")}writable=!transientAnnotations[popcornId];if(!writable){throw new Error("annotations.remove: Unable to remove annotation "+id)}if(typeof callback==="function"){annotation.onDelete(function(){callback(id)})}popcorn.removeTrackEvent(popcornId);return id};this.annotations.types=function(callback){var result={},count=Object.keys(annotationProfiles).length;if(!callback){return}Popcorn.forEach(annotationProfiles,function(val,key){if(pluginsEnabled[key]){provisionAnnotationType(key,function(){var profile,type,d;profile=annotationProfiles[key];type={id:key,icon:profile.icon||"",title:profile.title||key,enabled:!!pluginsEnabled[key],defaults:{}};if(profile.defaults){for(d in profile.defaults){if(profile.defaults.hasOwnProperty(d)&&typeof profile.defaults[d]!=="function"&&!(profile.defaults[d]instanceof Element)){type.defaults[d]=profile.defaults[d];if(type.defaults[d]===Infinity){type.defaults[d]=Number.MAX_VALUE}else if(type.defaults[d]===-Infinity){type.defaults[d]=-Number.MAX_VALUE}}}}result[key]=type;count--;if(!count){callback(result)}})}else{count--}})};this.annotations.normalize=function(annotationId,key,value,dictionary,callback){var annotation=annotationsById[annotationId],popcornId,trackEvent,properties,profile,result;if(annotationId&&typeof callback==="function"){if(annotation){popcornId=popcornIdLookup[annotationId];trackEvent=popcorn.getTrackEvent(popcornId);profile=annotationProfiles[trackEvent._natives.type];properties=profile&&Popcorn.extend({},trackEvent,dictionary)}else if(pluginsEnabled[annotationId]){profile=annotationProfiles[annotationId];properties=dictionary}if(profile){if(profile.normalize[key]||profile.normalizeAny){if(profile.normalize[key]){result=profile.normalize[key].call(me,value,properties,callback);if(result!==undefined&&result!==null){callback(result)}}else{result=profile.normalizeAny.call(me,key,value,properties,callback);if(result!==undefined&&result!==null){callback(result)}}}}else{callback(false)}}return null};this.annotations.focus=function(annotationId,callback){var popcornId=popcornIdLookup[annotationId],trackEvent,type,writable;if(!annotationId){if(editor){editor.done()}return}if(!popcornId){throw new Error("annotations.focus: Annotation '"+annotationId+"' not found")}writable=!transientAnnotations[popcornId];if(!writable){throw new Error("annotations.focus: Unable to edit annotation "+annotationId)}if(!me.editMode(true)){throw new Error("annotations.focus: Do not have permission to edit")}trackEvent=popcorn.getTrackEvent(popcornId);type=trackEvent&&trackEvent._natives&&trackEvent._natives.type;if(!type||!pluginsEnabled[type]){throw new Error("annotations.focus: Unable to edit annotation "+annotationId)}getEditor(function(){editor.edit(popcornId);if(typeof callback==="function"){callback(annotationId)}})};this.annotations.blur=function(annotationId){var popcornId=popcornIdLookup[annotationId];if(editor){editor.done(popcornId||null)}};this.showTrackInfo=function(){if(!updateTrackInfo()){return}addClass(elements.trackInfo,"visible");if(showTrackInfoTimeout){clearTimeout(showTrackInfoTimeout)}showTrackInfoTimeout=setTimeout(function(){if(elements.trackInfo){removeClass(elements.trackInfo,"visible")}},2e3)};this.editMode=function(show){if(show===undefined){return editMode}show=!!show;if(show&&(!activeTrack||!window.HapyakApp||!activeTrack.hasPermission("edit"))){show=false}if(editMode===show){return editMode}editMode=show;startEditMode=startEditMode&&show;this.resetVariables();environment.set("editMode",editMode,true);if(editMode){if(showAnnotations){updateAnnotationDisplay()}else{this.showAnnotations(true)}getEditor(function(){editor.activate();addClass(elements.annotationContainer,"hapyak-editing");addClass(elements.annotationNoscaleContainer,"hapyak-editing")})}else if(editor){editor.done();editor.deactivate();removeClass(elements.annotationContainer,"hapyak-editing");removeClass(elements.annotationNoscaleContainer,"hapyak-editing");updateAnnotationDisplay()}if(elements.watermark){elements.watermark.style.display=editMode?"none":"block"}updateModeSwitch();return editMode};this.showAnnotations=function(show,annotationType,annotationId){var method;if(annotationId){var popcornId=popcornIdLookup[annotationId],className="hapyak-annotation-list-hide",quickedit=$('[data-popcorn-id="'+popcornId+'"]');quickedit.each(function(i,el){show?removeClass(el,className):addClass(el,className)});return showAnnotations}if(show===undefined){return showAnnotations}show=!!show;if(showAnnotations===show){return}showAnnotations=show;if(!showAnnotations&&annotationType!=="ontime"){me.editMode(false)}method=show?"enable":"disable";Popcorn.forEach(Popcorn.registryByName,function(obj,plugin){if(annotationType&&annotationType!==plugin){return}var i=0,l,trackEvents,trackEvent,currentTime=popcorn.currentTime();trackEvents=popcorn.data.running[plugin];if(method==="disable"){popcorn.emit("clearactivepauses")}updateAnnotationDisplay(annotationType);if(trackEvents){for(l=trackEvents.length;i<l;i++){trackEvent=trackEvents[i];if(currentTime>=trackEvent.start&&currentTime<=trackEvent.end&&method==="enable"){addClass(trackEvent.container,"active")}else{removeClass(trackEvent.container,"active")}}}});updateModeSwitch();return showAnnotations};this.updateTrackEvent=function(annotation){var properties,popcornId=popcornIdLookup[annotation.get("id")],trackEvent;if(popcornId){trackEvent=popcorn.getTrackEvent(popcornId);properties=annotation.getCustomProperty("popcorn");Popcorn.extend(trackEvent,properties);popcorn[annotation.get("type")](popcornId,trackEvent)}};this.videoViewed=function(){var sum=0;if(!duration){return 0}Popcorn.forEach(sectionsViewed,function(section){sum+=section.end-section.start});return sum/duration};this.videoViewedFromStart=function(){var section;if(!duration||!sectionsViewed.length){return 0}section=sectionsViewed[0];return(section.end-section.start)/duration};this.resetVariables=function(){if(activeTrack&&trackScope){Popcorn.forEach(trackScope.keys(),function(key){trackScope.clear(key,true)});trackScope.save("hapyak-env");Popcorn.forEach(popcornAnnotations,function(annotation,id){var scope=getScope(id),keys=scope.keys(),i;for(i=0;i<keys.length;i++){scope.clear(keys[i],true)}scope.save("hapyak-env")})}};this.getData=function(name){var obj,i,n,key;if(name){return trackScope.get(name)}obj={};for(i=0,n=trackScope.keys.count;i<n;i++){key=trackScope.keys(i);obj[key]=_.clone(trackScope.get(key))}return obj};this.setData=function(name,value){if(name&&typeof name==="object"){value=name;name=null}if(name){if(value===undefined){environment.clear(name,true)}else{environment.set(name,value,true)}return}if(value&&typeof value==="object"){Popcorn.forEach(value,function(val,name){environment.set(name,val,true)})}};this.lockEditor=lockEditor;this.unlockEditor=unlockEditor;this.addClass=function(value){if(container&&typeof value==="string"&&value.length){addClass(container,value.indexOf("hapyak-")===0?value:"hapyak-"+value)}};this.removeClass=function(value){if(container&&typeof value==="string"&&value.length){removeClass(container,value.indexOf("hapyak-")===0?value:"hapyak-"+value)}};this.on=function(hook,callback){var list;if(typeof hook!=="string"||typeof callback!=="function"){return}list=listeners[hook];if(!list){list=listeners[hook]=[]}if(list.indexOf(callback)<0){list.push(callback)}};this.off=function(hook,callback){var list,i;if(typeof hook!=="string"||typeof callback!=="function"){return}list=listeners[hook];if(!list){return}i=list.indexOf(callback);if(i>=0){list.splice(i,1)}};this.setRemotes=function(items){remotes=items;if(editor){editor.setting("remote","remotes",remotes||[])}};this.destroy=function(save,callback){var fn;function nop(){}function cleanElements(){var key,element,elementKeys=["controlBar","playBox","annotationContainer","annotationNoscaleContainer","topLeftContainer","editorContainer","overlayContainer","watermark","rootBox"];while(elementKeys.length){key=elementKeys.shift();element=elements[key];if(element&&element.parentNode){element.parentNode.removeChild(element)}}for(key in elements){if(elements.hasOwnProperty(key)){delete elements[key]}}}destroyed=true;hapyakPlayerTimer.stop();hapyakPlayerTimer=null;me.tracking.endPlayerContext();hapyak.removeEventListener("auth",updateAuth);emitQueue.splice(0);if(["play","viewer"].indexOf(showControls)>-1||editor){me.fullscreen(false)}if(editor){if(save){editor.done()}editor.destroy()}clearTimeout(resizeTimeout);if(autoResizeTimer){clearInterval(autoResizeTimer)}window.removeEventListener("resize",resize,false);window.removeEventListener("orientationchange",orientationChange,false);window.removeEventListener("message",trackingEvent,false);window.removeEventListener("orientationchange",resize,false);window.removeEventListener("message",changeIframeStyles,false);document.removeEventListener(visibilityEvent,visibilityChange,false);document.removeEventListener(visibilityEvent,pauseOnWindowBlur,false);if(fullscreenEnabled){document.removeEventListener("fullscreenchange",fullscreenFunction,false);document.removeEventListener("mozfullscreenchange",fullscreenFunction,false);document.removeEventListener("webkitfullscreenchange",fullscreenFunction,false);document.removeEventListener("MSFullscreenChange",fullscreenFunction,false)}unloadTrack();if(container.style){removeClass(container,"hapyak-player");removeClass(container,"hapyak-embed");removeClass(container,"hapyak-remote");removeClass(container,"hapyak-"+(options.edit?"edit":"view")+"-mode")}for(fn in this){if(this.hasOwnProperty(fn)&&typeof this[fn]==="function"){this[fn]=nop}}activePlayers=Math.max(0,activePlayers-1);if(popcorn){if(embedUtils.dotget(popcorn,"media._util.destroy")){popcorn.media._util.destroy()}popcorn.destroy()}if(timelineTouch){timelineTouch.remove()}if(volumeTouch){volumeTouch.remove()}if(elements&&(elements.videoContainer||elements.rootBox)){safeTry(function(){if(elements.videoContainer&&elements.videoContainer.firstChild&&elements.videoContainer.firstChild.tagName==="IFRAME"){elements.videoContainer.firstChild.src="";setTimeout(function(){elements.videoContainer.innerHTML="";cleanElements();if(callback){callback()}},10);return}if(wrapper){if(wrapper._util&&wrapper._util.destroy){wrapper._util.destroy()}else{wrapper.src="";if(wrapper.load){wrapper.load()}}}if(elements.videoContainer){elements.videoContainer.innerHTML=""}cleanElements();if(callback){callback()}})}else{if(elements){cleanElements()}if(callback){callback()}}};this.outerContainer=function(){if(!popcorn||!popcorn.media){return}return popcorn.media.outerContainer};this.dispatchSkeletonEvent=function(eventName,data){if(embedUtils.dotget(popcorn,"media._util.events."+eventName)){popcorn.media._util.events[eventName](data)}};this.contentTracks=function(){var contentTrackContainer=new ContentTrackContainer;me.tracking.register({loc:{lang:"en-us"}});window.addEventListener("message",function(msg){function msgIsJson(str){try{JSON.parse(str)}catch(e){return false}return true}if(msg&&msg.data&&msgIsJson(msg.data)){msg=msg&&msg.data&&JSON.parse(msg.data)||{}}if(!msg||!msg.data||msg.event!=="content-track"){return}var data=msg.data,cTracks=popcorn&&embedUtils.dotget(popcorn,"options.hapyakPlayer.contentTracks"),actionMap={load:cTracks&&typeof cTracks.load==="function"&&cTracks.load,add:cTracks&&typeof cTracks.add==="function"&&cTracks.add};if(data.action==="load"&&data.lang){actionMap.load&&actionMap.load(data.lang);return}if(data.action==="add"&&data.src){require([data.src],function(){Array.prototype.forEach.call(arguments,function(trackContents){actionMap.add&&actionMap.add(trackContents)})})}},false);return{add:function(contentTrack){var track;if(typeof contentTrack==="string"){require([contentTrack],function(){Array.prototype.forEach.call(arguments,function(trackContents){track=contentTrackContainer.add(trackContents);if(track&&track.default&&track.data){annotationVariableConfig.load(track.data)}})})}else if(typeof contentTrack==="object"){track=contentTrackContainer.add(contentTrack)}if(track&&track.default&&track.data){annotationVariableConfig.load(track.data)}},load:function(srclang){contentTrackContainer.tracks.some(function(track){if(srclang===track.srclang){me.tracking.register({loc:{lang:srclang}});me.tracking.playerAction("Language","Change");annotationVariableConfig.languageManager.changeLanguage(srclang);annotationVariableConfig.load(track.data);return true}})},tracks:function(){return contentTrackContainer.tracks},annotationVariableConfig:function(){return annotationVariableConfig}}}();document.addEventListener(visibilityEvent,visibilityChange,false);if(options.variables){this.setData(null,options.variables)}playerType=wrappers.detect(container,options.playerType||source)||options.playerType||source;if(playerType){playerType=playerType.toLowerCase()}if(!playerType||wrappers[playerType]||playerType==="html5"){loadVideoWrapper()}else{require(["player.profile."+playerType],loadVideoWrapper,function(err){logging.captureException(err);die("Unable to load player: "+playerType)})}}Popcorn.filter("dataId","",function(name,options,next,node){options.dataId=node.virtualEventId;next(options)});Popcorn.plugin.debug=debug;Popcorn.dom.debug=debug;requestAnimationFrame=function(){var lastTime=0;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){var currTime,timeToCall,id;function timeoutCallback(){callback(currTime+timeToCall)}currTime=(new Date).getTime();timeToCall=Math.max(0,16-(currTime-lastTime));id=window.setTimeout(timeoutCallback,timeToCall);lastTime=currTime+timeToCall;return id}}();if(document.hidden!==undefined){hiddenProperty="hidden";visibilityEvent="visibilitychange"}else if(document.webkitHidden!==undefined){hiddenProperty="webkitHidden";visibilityEvent="webkitvisibilitychange"}else if(document.mozHidden!==undefined){hiddenProperty="mozHidden";visibilityEvent="mozvisibilitychange"}else if(document.msHidden!==undefined){hiddenProperty="msHidden";visibilityEvent="msvisibilitychange"}Popcorn.forEach(aTypeAliases,function(aType,alias){if(pluginsEnabled[alias]){pluginsEnabled[aType]=true}else if(pluginsEnabled[aType]){pluginsEnabled[alias]=true}});return HapyakPlayer});hy.define("viewer",["require","module","configuration","model","dao","utils.embed","utils.sanitizeparams","hapyak.player","cookie","logging","tracking","raven.hapyak","lodash.noconflict","ember.noconflict"],function(require,module,configuration,model,dao,utils,sanitizeParams,HapyakPlayer,cookie,logging,tracking,Raven,_){var host,href,search,tmpElement,moduleConfig=module.config(),viewerEvents={authchange:true,data:true,durationchange:true,load:true,loadannotations:true,setupannotations:true,loadedmetadata:true,customtrackingevent:true,pause:true,play:true,resized:true,conversion:true},dotget=utils.dotget,auth=hapyak.auth(),findUserQueue=[];var trackingVariables,hapyakRemote,userId,username,email,queryParamContext;function cleanupUserQueue(currentUser){if(findUserQueue.length){callback=findUserQueue.shift();if(callback&&typeof callback==="function"){callback(currentUser)}}}try{if(window.top&&window.top.location){host=window.top.location.host;href=window.top.location.href;search=window.top.location.search}}catch(e){}if(!href){tmpElement=document.createElement("a");href=tmpElement.href=parent!==window?document.referrer:window.location.host;host=tmpElement.host;search=tmpElement.search}queryParamContext=utils.getQueryParams(search,"hapyak_");trackingVariables={Embedded:true,Context:"Viewer",Host:host,Href:href};userId=auth.partner.userId;username=auth.partner.username;email=auth.partner.email;if(!email){email=dotget(moduleConfig,dotget(configuration,"auth.email"))||queryParamContext.email}if(!username){username=dotget(moduleConfig,dotget(configuration,"auth.username"))||queryParamContext.username||email}if(!userId){userId=dotget(moduleConfig,dotget(configuration,"auth.userId"))||queryParamContext.userId||username}auth=hapyak.auth({partner:{userId:userId,username:username,email:email}});if(configuration.group){trackingVariables["Group ID"]=configuration.group.id;if(configuration.group.name){trackingVariables["Group Name"]=configuration.group.name}if(configuration.group.parent){trackingVariables["Group Parent ID"]=configuration.group.parent}if(configuration.group.customer){trackingVariables["Customer"]=configuration.group.customer;trackingVariables["Affiliate"]=configuration.group.affiliate}}utils.controlStyle(true,true);function HapyakViewer(config,project,video,track,comments,microserviceAccessToken){this.instanceId=config.instanceId;logging.debug("[hapyak.viewer] HapyakViewer Created, id="+this.instanceId,config,project,video,track,comments);this.tracking=tracking.getInstance(this.instanceId,true);this.init();if(project){this.tracking.startProjectContext(project);if(dotget(configuration,"analytics.customFields.enabled")){this.tracking.registerPartnerProperties(dotget(config,"player.mediainfo.customFields"))}}this.tracking.microserviceAccessToken=microserviceAccessToken;this.tracking.startVideoContext(video);if(track){this.tracking.startTrackContext(track,comments)}var player=new HapyakPlayer(config.player,video,sanitizeParams.viewer(config,{annotationSources:config.plugins&&config.plugins.annotationSources,projectName:project?project.get("title"):"",keepAnnotationAspectRatio:project?project.get("keepAnnotationAspectRatio"):false,contentTracks:project?project.get("contentTracks"):[],projectId:project?project.get("id"):null,workflow:project?project.get("workflow"):null,remotes:config.plugins&&config.plugins.remote&&config.plugins.remote.items}),this.instanceId,this.tracking),me=this,asyncEventQueue=[],listeners={},key,remoteQueue=[],remotes=[];function nextAsync(){var fn;if(asyncEventQueue.length){fn=asyncEventQueue.shift();fn()}}function fireAsyncEvent(callbackName){var args=Array.prototype.slice.call(arguments,1);asyncEventQueue.push(function(){var i,list=listeners[callbackName];if(!list){return}for(i=0;i<list.length;i++){list[i].apply(me,args)}});setTimeout(nextAsync,0)}function registerAsyncEvent(eventName,callbackName,arg){player.on(eventName,function(){var args=Array.prototype.slice.call(arguments,0);if(arg){args.push(arg)}args.unshift(callbackName);fireAsyncEvent.apply(null,args)})}function remoteInstance(id,container,options){var r=new hapyakRemote.HapyakRemote(id,container,options);remotes.push(r);return r}function requireRemote(callback){hy.require(["remote"],function(remote){hapyakRemote=remote;while(remoteQueue.length){hapyakRemote.registerItem(remoteQueue.shift())}if(typeof callback==="function"){callback()}})}function remote(id,container,options,callback){if(typeof options==="function"){callback=options;options=null}if(hapyakRemote){callback(remoteInstance(id,container))}else{requireRemote(function(){callback(remoteInstance(id,container))})}}function addEventListener(name,callback){var list;if(!name||typeof name!=="string"||typeof callback!=="function"){return}name=name.toLowerCase();if(!viewerEvents[name]){return}list=listeners[name];if(!list){list=listeners[name]=[]}list.push(callback)}function removeEventListener(name,callback){var list,i;if(!name||typeof name!=="string"||typeof callback!=="function"){return}name=name.toLowerCase();if(!viewerEvents[name]){return}list=listeners[name];if(!list){return}i=list.indexOf(callback);if(i>=0){list.splice(i,1)}}function messageHandler(event){try{var data=JSON.parse(event.data);if(data.context==="hapyak"){switch(data.event){case"notifyResize":player.resize(data.width,data.height,data.sync);break;case"pause":player&&typeof player.pause==="function"&&player.pause();break;case"play":if(player&&typeof player.play==="function"){if(player.playTime()>0){player.play()}else{document.getElementsByTagName("video")[0].muted=true;document.getElementsByTagName("video")[0].play()}}break}}}catch(e){}}registerAsyncEvent("changeTrack","loadannotations",track);registerAsyncEvent("data","data",track);if(config.resetVariables){player.on("changeTrack",function(){player.resetVariables()})}fireAsyncEvent("load",this);player.loadTrack(track,{comments:Ember.A(comments),autoplay:config.autoplay});this.tracking.playerView("Load");if(player.duration()){fireAsyncEvent("durationchange");fireAsyncEvent("loadedmetadata")}else{registerAsyncEvent("loadedmetadata","loadedmetadata")}registerAsyncEvent("authchange","authchange");registerAsyncEvent("durationchange","durationchange");registerAsyncEvent("play","play",track);registerAsyncEvent("pause","pause",track);registerAsyncEvent("conversion","conversion");registerAsyncEvent("resized","resized");registerAsyncEvent("customtrackingevent","customtrackingevent");for(key in config){if(config.hasOwnProperty(key)&&key.substring(0,2)==="on"){addEventListener(key.substring(2),config[key])}}if(config.plugins&&config.plugins.remote&&config.plugins.remote.items){config.plugins.remote.items.forEach(function(item){if(hapyakRemote){hapyakRemote.registerItem(item)}else{remoteQueue.push(item)}remotes.push(item)});if(config.plugins.remote.scan){requireRemote(function(){var scannedRemotes=hapyakRemote.scan();while(scannedRemotes.length){remotes.push(scannedRemotes.shift())}if(player){player.setRemotes(remotes)}})}}this.getTrackId=function(){return track.get("id")};this.resize=function(width,height,sync){player.resize(width,height,sync);return this};this.trackList=function(element,options){hy.require(["widget.controls.tracklist"],function(widget){widget.trackList(element,options,player,video)})};this.resetVariables=function(){player.resetVariables()};this.destroy=function(){var that=this;if(track){this.tracking.endTrackContext()}this.tracking.endVideoContext();if(config.projectId){this.tracking.endProjectContext()}asyncEventQueue.splice(0);while(remotes.length){remotes.pop().destroy()}window.removeEventListener("message",messageHandler,false);player.destroy();hapyak.instances.viewer.some(function(instance,index){if(instance.instanceId===that.instanceId){hapyak.instances.viewer.splice(index,1);return true}})};this.addEventListener=addEventListener;this.removeEventListener=removeEventListener;this.remote=remote;this.getData=function(name){return player.getData(name)};this.setData=function(name,value){return player.setData(name,value)};this.dispatchEvent=function(eventName,data){player.dispatchSkeletonEvent(eventName,data)};this.play=function(){player.play()};this.pause=function(){player.pause()};this.fullscreen=function(value){if(value===undefined){value=true}player.fullscreen(value)};this.disableAnnotations=function(){player.showAnnotations(false)};this.enableAnnotations=function(){player.showAnnotations(true)};Object.defineProperty(this,"currentTime",{configurable:false,enumerable:true,get:function(){return player.currentTime()},set:function(time){player.currentTime(time)}});Object.defineProperty(this,"duration",{configurable:false,enumerable:true,get:function(){return player.duration()}});Object.defineProperty(this,"paused",{configurable:false,enumerable:true,get:function(){return player.paused()}});Object.defineProperty(this,"outerContainer",{configurable:false,enumerable:true,get:function(){return player.outerContainer()}});Object.defineProperty(this,"contentTracks",{configurable:false,enumerable:true,get:function(){return player.contentTracks}});window.addEventListener("message",messageHandler,false)}HapyakViewer.prototype.toString=function(){return"[object HapyakViewer]"};HapyakViewer.prototype.init=function(){var that=this;var callback,currentUser;this.tracking.register(trackingVariables);this.tracking.registerPartnerProperties(moduleConfig.tracking);this.tracking.registerPartnerProperties(moduleConfig.plugins);this.tracking.registerPartnerProperties(queryParamContext);function onLoadCurrentUser(user){currentUser=window.HapyakApp.get("currentUser");if(!currentUser){window.HapyakApp.set("currentUser",user)}that.tracking.startUserContext(user);if(typeof window.postMessage==="function"&&window.parent){window.parent.postMessage(JSON.stringify({context:"hapyak",callback:"loadcurrentuser",userId:user.get("id"),username:user.get("username")}),"*")}cleanupUserQueue(user)}if(auth.user){if(!window.HapyakApp){window.HapyakApp=Ember.Object.create();dao.store.load(model.User,auth.user);dao.store.find(model.User,auth.user.id).onLoad(onLoadCurrentUser);return}currentUser=window.HapyakApp.get("currentUser");if(currentUser){onLoadCurrentUser(currentUser);return}findUserQueue.push(onLoadCurrentUser)}};var loadViewer=function(config,onLoaded){if(configuration&&configuration.player&&configuration.player.css){hapyak.asset.css(configuration.player.css)}if(config.css){hapyak.asset.css(config.css)}var params={};if(config.videoType){params.source=config.videoType}if(config.videoTitle){params.video_title=config.videoTitle}if(config.videoId){params.source_id=config.videoId}if(config.videoUrl){params.source_url=config.videoUrl}if(config.trackId){params.track=config.trackId}else if(config.track){params.track=JSON.stringify(config.track)}if(config.projectId){params.project=config.projectId}else if(config.project){params.project=JSON.stringify(config.project)}if(config.cacheBuster){params.cacheBuster=config.cacheBuster}if(config.plugins){if(config.variables===undefined){config.variables={}}config.variables.plugins=config.plugins}if(config.controls){config.controls="viewer"}if(config.playerParameters){params.source_parameters=JSON.stringify(config.playerParameters)}if(config.readOnly){params.read_only=true}if(dotget(configuration,"player.nls")){config.nls=configuration.player.nls}if(config.duration){params.duration=config.duration}if(!config.projectId&&!config.trackId&&!config.videoId&&!config.videoUrl){logging.error("Unable to create viewer. Add a videoId, videoUrl, projectId or trackId parameter.")}else{dao.store.findOne(model.ViewerSetup,params,function(viewerSetup){var autoplay,comments,oldOnData,project,track,video,viewerInstance,microserviceAccessToken;var cssUrls=[];if(viewerSetup){project=viewerSetup.get("project"),video=viewerSetup.get("video"),track=viewerSetup.get("track"),comments=viewerSetup.get("comments"),microserviceAccessToken=viewerSetup.get("mat")
;if(project&&[null,undefined].indexOf(config.resetVariables)!=-1){config.resetVariables=project.get("resetVariables")}if(project&&project.get("width")&&project.get("height")){config.aspectRatio=project.get("width")/project.get("height")}if(config.ondata){oldOnData=config.ondata}config.ondata=function(data){hapyak.message.receiveData(data);if(oldOnData&&typeof oldOnData==="function"){oldOnData(data)}};viewerInstance=new HapyakViewer(config,project,video,track,comments,microserviceAccessToken);viewerInstance.setData("projectConfig",{css:config&&config.css||"",title:project&&project.get("title"),image:video&&video.get("image")});hapyak.instances.viewer.push(viewerInstance);if(!_.isEmpty(queryParamContext)){viewerInstance.setData(queryParamContext);autoplay=queryParamContext["autoplay"];if(autoplay&&autoplay==="true"){viewerInstance.play()}if(queryParamContext["seek"]){viewerInstance.currentTime=parseInt(queryParamContext["seek"],10)}}if(!video||!track){logging.info("no annotations found")}}else{logging.info("no video/track/annotations found")}if(typeof onLoaded==="function"){onLoaded(viewerInstance)}})}};return{load:function(config,onLoaded){Raven.context(function(){loadViewer(config,onLoaded)})}}});hy.define("base64",[],function(){var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var _utf8_encode=function(string){var utftext="",c,n;string=string.replace(/\r\n/g,"\n");for(n=0;n<string.length;n++){c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext};var _utf8_decode=function(utftext){var string="",i=0,c=0,c1=0,c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c1=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c1&63);i+=2}else{c1=utftext.charCodeAt(i+1);c2=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c1&63)<<6|c2&63);i+=3}}return string};var _hexEncode=function(input){var output="",i;for(i=0;i<input.length;i++){output+=input.charCodeAt(i).toString(16)}return output};var _hexDecode=function(input){var output="",i;if(input.length%2>0){input="0"+input}for(i=0;i<input.length;i=i+2){output+=String.fromCharCode(parseInt(input.charAt(i)+input.charAt(i+1),16))}return output};var encode=function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=_utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output+=_keyStr.charAt(enc1);output+=_keyStr.charAt(enc2);output+=_keyStr.charAt(enc3);output+=_keyStr.charAt(enc4)}return output};var decode=function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=_keyStr.indexOf(input.charAt(i++));enc2=_keyStr.indexOf(input.charAt(i++));enc3=_keyStr.indexOf(input.charAt(i++));enc4=_keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output+=String.fromCharCode(chr1);if(enc3!==64){output+=String.fromCharCode(chr2)}if(enc4!==64){output+=String.fromCharCode(chr3)}}return _utf8_decode(output)};var decodeToHex=function(input){return _hexEncode(decode(input))};var encodeFromHex=function(input){return encode(_hexDecode(input))};return{encode:encode,decode:decode,decodeToHex:decodeToHex,encodeFromHex:encodeFromHex}}());hy.define("analytics.ganalytics",["module","configuration","analytics.integration","dao","base64","lodash.noconflict","logging"],function(module,configuration,AnalyticsIntegation,dao,base64,_,logging,undefined){var HAPYAK_GA_QUEUE_NAME="hapyak_ga_queue";var prototype=null;var config=configuration.analytics&&configuration.analytics.google||{};var localDebug=config.localDebug;function GoogleAnalyticsIntegration(){this._state={};this._trackingIds=[];this.initialize(config);logging.debug("[ganalytics.js] GoogleAnalyticsIntegration Created ")}prototype=GoogleAnalyticsIntegration.prototype=new AnalyticsIntegation;prototype.initialize=function initialize(config){var that=this;if(config.setup){_.each(config.setup,function(setting){that._addTrackingId(setting[1])})}};prototype._addTrackingId=function addTrackingId(id){this._trackingIds.push(id)};prototype.setState=function setState(instanceId,key,value){if(!this._state[instanceId]){this._state[instanceId]={}}this._state[instanceId][key]=value};prototype.getState=function getState(instanceId,key){if(this._state[instanceId]){return this._state[instanceId][key]}return null};prototype.willTrack=function willTrack(eventName,properties){var category,annotationStartTime,customEventData,rating,formattedRating;if(!properties||properties.Context==="Embedded Editor"){return}if(!properties.instanceId){logging.error("Instance id missing from event properties");return}category=" ("+properties["Project ID"]+") "+(properties["Project Title"]||""),annotationStartTime=properties["Annotation Start Time"],customEventData=properties["Custom Event Data"],rating=customEventData&&customEventData.image,formattedRating=rating&&rating.split&&rating.split("_").join&&rating.split("_").join(" ");if(eventName==="Player Action"&&properties.Type!=="Controls"){this._push(properties,category,properties.Action)}else if(eventName==="Annotation Action"){if(properties["Target Time"]||properties.Type==="contents"&&properties.Target!==properties["Annotation ID"]){this._push(properties,category,"Navigation-Info","Chapter: "+properties.Text);this._push(properties,category,"Navigation")}else if(properties["Target Link"]||properties.Action==="External Click"){this._push(properties,category,"Link-Info",properties["Target Link"]||properties.Target);this._push(properties,category,"Link")}else if(properties.Action==="Answer"){this._push(properties,category,"Quiz-Info",properties.Question+(properties.Correct?" - (Correct)":" - (Incorrect)"));this._push(properties,category,"Quiz")}else if(properties["Annotation Subtype"]==="widget-user-sentiment"){if(!formattedRating){return}this._push(properties,category,"User-Sentiment-Info",formattedRating)}}};prototype.track=function track(eventName,properties){properties=this.transformData(properties);if(AnalyticsIntegation.shouldTrack({include:config.include,exclude:config.exclude},eventName,properties)){this.willTrack(eventName,properties)}};prototype.transformData=function(properties){var excludeKeys=["Annotation Types","Annotation Position","Annotation Coordinates","Partner Data","Gating","Pausing","Summary","Extension Source","Player Type","Rollup","Templates","excludeKeys"],o=_.omit(properties,excludeKeys);o["Template IDs"]=_.pluck(properties["Templates"],"id");return o};prototype._initializeGA=function _initializeGA(properties){var gaHelper;var projectTitle=properties["Project Title"],videoSource=properties["Video Source"],videoSourceId=properties["Video Source ID"],userId=properties["User ID"],username=properties.Username;gaHelper=new GAHelper(this._trackingIds[0],"hapyak_ga_analytics_"+properties.instanceId,config.localDebug);this.setState(properties.instanceId,"gahlper",gaHelper);if(projectTitle){gaHelper.set("Project",projectTitle)}if(videoSource){gaHelper.set("Video Source",videoSource)}if(videoSourceId){gaHelper.set("Video Source ID",videoSourceId)}if(userId){gaHelper.set("User ID",userId)}if(username){gaHelper.set("Username",username)}};prototype._push=function _push(properties,category,action,label,value){var gaHelper=this.getState(properties.instanceId,"gahlper");var fieldsObject;if(!gaHelper){this._initializeGA(properties)}category="HapYak - "+category;if(category.length>150){category=category.substring(0,150)}if(action&&action.length>500){action=action.substring(0,500)}if(label&&!isNaN(label)){label="_"+label}if(label&&label.length>500){label=label.substring(0,500)}if(typeof value==="number"){value=Math.round(value)}else if(typeof value==="string"){value=parseInt(value,10)}else{value=null}if(properties.Action!=="Progress"){gaHelper=this.getState(properties.instanceId,"gahlper");fieldsObject={hitType:"event",eventCategory:category,eventAction:action};if(label){fieldsObject.eventLabel=label}if(value){fieldsObject.eventValue=value}gaHelper.send(fieldsObject)}};function GAHelper(trackingId,trackerName,debug){this.trackingId=trackingId;this.trackerName=trackerName||null;this.debugGA=false;this.debug=debug||false;this.queueName=HAPYAK_GA_QUEUE_NAME;this._createQueue();this._createTracker()}GAHelper.prototype={_createQueue:function(){var gaSrc=this.debugGA?"https://www.google-analytics.com/analytics_debug.js":"https://www.google-analytics.com/analytics.js";if(!window[this.queueName]){(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script",gaSrc,this.queueName)}},_createTracker:function(){var trackerConfig={cookieDomain:"auto",name:this.trackerName};if(inCrossDomainIFrame()){trackerConfig.cookieFlags="SameSite=None; Secure"}window[this.queueName]("create",this.trackingId,trackerConfig);function inCrossDomainIFrame(){return window.parent!==window&&(document.referrer||"").indexOf(window.location.origin)!==0}},_enqueue:function(command,fieldsObject){window[this.queueName](command,fieldsObject)},_buildCommand:function(command){if(this.trackerName){return[this.trackerName,command].join(".")}return command},send:function(fieldsObject){var command=this._buildCommand("send");if(this.debug){logging.info("[hapyak.ganalytics#track] [instance="+this.trackerName+"] "+JSON.stringify(fieldsObject,null,1))}this._enqueue(command,fieldsObject)},set:function(name,value){var command=this._buildCommand("set");var fieldsObject={};fieldsObject[name]=value;this._enqueue(command,fieldsObject)},toString:function(){return this}};return new GoogleAnalyticsIntegration});hy.define("analytics.internal",["module","configuration","analytics.integration","logging","dao","base64","lodash.noconflict"],function(module,configuration,AnalyticsIntegation,logging,dao,base64,_,undefined){var config=configuration.analytics&&configuration.analytics.internal||{},whitelistedPlugins=config.whitelistedPlugins?_.pick(module.config().plugins||{},_.keys(config.whitelistedPlugins)):{};function InternalIntegration(){this.track=function(eventName,properties,options,callback){if(config.include){if(AnalyticsIntegation.shouldTrack({include:config.include,exclude:config.exclude},eventName,properties)){logging.logMethod("internal.track",eventName,properties);if(!properties.Time){properties.Time=(new Date).getTime()}var params={data:base64.encode(JSON.stringify({name:eventName,properties:properties,plugins:whitelistedPlugins})),key:module.config().apiKey};dao.store.getJSON(null,"/api/analytics/track",params)}}}}InternalIntegration.prototype=new AnalyticsIntegation;return new InternalIntegration});hy.define("vendor/mixpanel",["logging"],function(logging,undefined){if(!window.mixpanel){try{(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+"//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[])}catch(e){logging.error("error loading mixpanel");window.mixpanel={init:function(value,props,key){window.mixpanel[key]={track:function(){},register:function(){},identify:function(){},people:{set:function(){}}}},track:function(){},register:function(){},identify:function(){},disable:function(){},people:{set:function(){}}}}}return window.mixpanel});hy.define("analytics.mixpanel",["require","module","configuration","lodash.noconflict","analytics.integration","vendor/mixpanel","cookie","logging"],function(require,module,configuration,_,AnalyticsIntegation,mixpanel,cookie,logging,undefined){var currentUsersSampleValues={},shouldLogEventFilters={},localDebug=configuration.analytics.mixpanel&&configuration.analytics.mixpanel.localDebug,groupId=configuration.group&&configuration.group.id?configuration.group.id:null,parentGroupId=configuration.group&&configuration.group.parent?configuration.group.parent:null;function inMixpanelSample(sampleRate,sampleValueExpiresInDays){var cookieName,groupId=configuration.group?configuration.group.id:null,currentUsersSampleValue=currentUsersSampleValues[groupId];if(currentUsersSampleValue===undefined){if(groupId){cookieName="hapyak.mixpanel."+groupId+".sample"}else{cookieName="hapyak.mixpanel.sample"}currentUsersSampleValue=cookie.get(cookieName);if(currentUsersSampleValue){currentUsersSampleValue=parseInt(currentUsersSampleValue,10)}else{currentUsersSampleValue=Math.floor(Math.random()*100);cookie.set(cookieName,currentUsersSampleValue,sampleValueExpiresInDays||60)}currentUsersSampleValues[groupId]=currentUsersSampleValue}return sampleRate>=currentUsersSampleValue}_.each(configuration.mixpanel,function(value,key){var token=value;if(typeof token==="object"){token=value["token"]}mixpanel.init(token,{debug:localDebug},key);shouldLogEventFilters[key]=function(name,p){if(!AnalyticsIntegation.shouldTrack({include:value.include,exclude:value.exclude},name,p)){return false}if(value.sampleRate!==undefined&&!inMixpanelSample(value.sampleRate,value.sampleValueExpiresInDays)){return false}return true};if(value.filter){require([value.filter],function(filter){var existingShouldLogEvent=shouldLogEventFilters[key];shouldLogEventFilters[key]=function(name,properties){if(!existingShouldLogEvent(name,properties)){return false}return filter.shouldLogEvent(name,properties)}})}if(value.enabled===false||module.config().environment!=="production"){if(groupId!=110&&parentGroupId!=110){mixpanel[key].disable()}}});function MixpanelIntegration(){function hasAnnotations(p){return p["Num Annotations"]>0||_.isArray(p["Templates"])&&p["Templates"].length>0}logging.debug("[mixpanel.js] MixpanelIntegration Created");this.identify=function(userId,traits,options,callback){logging.logMethod("mixpanel.identify",userId,traits);_.each(configuration.mixpanel,function(value,key){mixpanel[key].identify(userId)})};this.track=function(eventName,properties,options,callback){var isAnnotationEnded=eventName==="Annotation Ended",isPlayerAction=eventName==="Player Action",isPlayerActionPlay=isPlayerAction&&properties&&properties["Type"]==="Video"&&properties["Action"]==="Play";if(isAnnotationEnded||isPlayerAction&&!isPlayerActionPlay){return}if(!hasAnnotations(properties)){logging.debug("MixpanelIntegration: Ignoring event "+eventName+" for view without annotations");return}properties=this.transformData(properties);logging.logMethod("mixpanel.track",eventName,properties);_.each(configuration.mixpanel,function(config,key){var partnerMixpanel=mixpanel[key],shouldLogEvent=shouldLogEventFilters[key];if(shouldLogEvent&&!shouldLogEvent(eventName,properties)){return}if(key==="hapyak"){partnerMixpanel.track(eventName,properties,callback)}else{var extended=_.extend({"Mixpanel Event Source":"HapYak"},properties);partnerMixpanel.track("HapYak / "+eventName,extended)}})};this.transformData=function(properties){var excludeKeys=["Annotation Types","Annotation Position","Annotation Coordinates","Partner Data","Gating","Pausing","Summary","Extension Source","Player Type","Rollup","Templates","excludeKeys"],o=_.omit(properties,excludeKeys);o["Template IDs"]=_.pluck(properties["Templates"],"id");return o}}MixpanelIntegration.prototype=new AnalyticsIntegation;return new MixpanelIntegration});hy.define("analytics.bigquery",["module","configuration","analytics.integration","base64","jquery.noconflict","lodash.noconflict","logging","utils.embed","utils.omitinvalid"],function(module,configuration,AnalyticsIntegation,base64,$,_,logging,utils,omitInvalid,undefined){var config=configuration.analytics&&configuration.analytics.bigquery||{},env=module.config().environment||"production",localAnalytics=config.localAnalytics,localDebug=config.localDebug,maxRequests=10,isOldIE=$.browser.msie&&$.browser.version<10,referringDomain=/\/\/([^\/]+)/i.exec(document.referrer),whitelistedPlugins=config.whitelistedPlugins?_.pick(module.config().plugins||{},_.keys(config.whitelistedPlugins)):{};if(isOldIE){this.hapyak_analytics_uid=null;this.hapyak_analytics_sid=null}function BigQueryIntegration(){var that=this;logging.debug("[bigquery.js] BigQueryIntegration Created ");this.queue=[];this.hasRateLimits=false;this.rateLimitRemaining=0;this.rateLimitReset=0;this.sendDelay=0;this.finalEventProperties=null;this.finalEventEnabled=config.finalEvent;this.propertiesToParams=function(eventName,properties){var params;var utcNow=(new Date).toUTCString();properties=this.transformData(properties);if(!properties["Event Time"]){properties["Event Time"]=utcNow}if(properties.Action&&(properties.Action=="Response-Poll"||properties.Action=="Response-Information")){properties=this.mergeResponseData(properties)}if(properties["Custom Event Data"]){properties["Custom Event Data"]=this.transformEventData(properties["Custom Event Data"])}logging.logMethod("bigquery.track",eventName,properties);properties=this.filterProperties(eventName,properties);if(localDebug){console.log({event:eventName,properties:properties})}params={api_key:utils.dotget(configuration,"analytics.bigquery.api_key"),data:base64.encode(JSON.stringify({name:eventName,properties:properties,plugins:whitelistedPlugins})),attempt:0};if(isOldIE){params.hapyak_analytics_uid=this.hapyak_analytics_uid;params.hapyak_analytics_sid=this.hapyak_analytics_sid}if(env!=="production"){params.dataset=env+"_client_event_stream"}else if(properties["Group ID"]===101){params.dataset="dailymotion_client_event_stream";params.queue="dailymotion-analytics:events"}if(config.dataset){params.dataset=config.dataset}return params};this.finalEvent=function(event){if(!this.finalEventProperties){return}var url=this.getAnalyticsEndpointUrl(env,localAnalytics);var properties=_.extend(this.finalEventProperties,{Action:"Final",Type:"Video"});var params=JSON.stringify(this.propertiesToParams("Player Action",properties));if(navigator.sendBeacon){navigator.sendBeacon(url,params)}else if(window.fetch){fetch(url,{method:"POST",body:params,mode:"cors",keepalive:true})}else{}};if(this.finalEventEnabled){window.addEventListener("unload",function(){that.finalEvent()})}this.capturePropertiesForFinalEvent=function(properties){this.finalEventProperties=properties};this.getAnalyticsEndpointUrl=function(env,localAnalytics){return"https://analytics-"+(env==="dev"&&!localAnalytics?"staging":env)+".hapyak.com/track"};this.track=function(eventName,properties,options,callback){var utcNow=(new Date).toUTCString();if(properties["Group ID"]===101){if(eventName==="Player Action"&&properties&&properties["Type"]==="Video"&&(properties["Action"]==="Resume"||properties["Action"]==="Pause"||properties["Action"]==="Seeked")){return}}if(this.finalEventEnabled){if(eventName=="Player Action"&&properties.Type&&properties.Type=="Video"&&properties.Action&&(properties.Action=="Progress"||properties.Action=="Play")){this.capturePropertiesForFinalEvent(properties)}}if(AnalyticsIntegation.shouldTrack({include:config.include,exclude:config.exclude},eventName,properties)){var params;properties=this.transformData(properties);if(!properties["Event Time"]){properties["Event Time"]=utcNow}if(properties.Action&&(properties.Action=="Response-Poll"||properties.Action=="Response-Information")){properties=this.mergeResponseData(properties)}if(properties["Custom Event Data"]){properties["Custom Event Data"]=this.transformEventData(properties["Custom Event Data"])}logging.logMethod("bigquery.track",eventName,properties);properties=this.filterProperties(eventName,properties);if(localDebug){console.log({event:eventName,properties:properties})}params={api_key:utils.dotget(configuration,"analytics.bigquery.api_key"),data:base64.encode(JSON.stringify({name:eventName,properties:properties,plugins:whitelistedPlugins})),attempt:0};if(isOldIE){params.hapyak_analytics_uid=this.hapyak_analytics_uid;params.hapyak_analytics_sid=this.hapyak_analytics_sid}if(env!=="production"){params.dataset=env+"_client_event_stream"}else if(properties["Group ID"]===101){params.dataset="dailymotion_client_event_stream";params.queue="dailymotion-analytics:events"}if(config.dataset){params.dataset=config.dataset}this.queue.push(params);this.sendRequest()}};this.filterProperties=function(eventName,properties){properties=properties||{};var omitList=[];var type=properties["Type"];var action=properties["Action"];if(eventName==="Player Action"&&type==="Video"&&action==="Progress"){omitList.push("Partner Data","Href","Project Title","Group Name","Project Tags","Quiz","Templates")}if(omitList.length){return _.omit(properties,omitList)}return properties};this.transformEventData=function(data){var arrayResult=[],name,responseData;responseData=data["responseData"];if(responseData&&_.isArray(responseData)){this.mergeResponseData(null,responseData,arrayResult)}for(name in data){if(data[name]!==null){arrayResult.push({key:name,value:data[name].toString()})}}return arrayResult};this.mergeResponseData=function(properties,source,destination){var source=source||properties["Response Data"];var destination=destination||properties["Partner Data"];if(!source){try{console.warn("mergeResponseData: invalid source")}catch(e){}return properties}if(!destination){destination=[]}_.each(source,function(responseDataItem){_.each(responseDataItem,function(value,key,item){destination.push({key:String(key),value:String(value)})})});return properties};this.sendRequest=function(){var that=this;function getRateLimits(response){var remaining=response.getResponseHeader("X-RateLimit-Remaining"),reset=response.getResponseHeader("X-RateLimit-Reset");if(remaining!==null){that.rateLimitRemaining=+remaining}if(reset!==null){that.rateLimitReset=reset*1e3}that.hasRateLimits=remaining!==null&&reset!==null}function createRequest(params){return function(){params.attempt+=1;if(params.attempt>maxRequests){logging.debug("[analytics.bigquery] Runaway requests detected! Aborting.");return}var ajaxSettings={},analyticsUrl=that.getAnalyticsEndpointUrl(env,localAnalytics);if(isOldIE){ajaxSettings={type:"GET",url:analyticsUrl,data:params,dataType:"jsonp"}}else{ajaxSettings={type:"POST",url:analyticsUrl,data:params,xhrFields:{withCredentials:true}}}$.ajax(ajaxSettings).done(function(data,text,response){getRateLimits(response);if(that.rateLimitRemaining){that.sendDelay=0}if(that.rateLimitRemaining<100){logging.dev("[analytics.bigquery] Remaining: "+that.rateLimitRemaining+", Reset: "+that.rateLimitReset+" (SUCCESS)")}if(isOldIE){that.hapyak_analytics_uid=response.responseJSON.hapyak_analytics_uid;that.hapyak_analytics_sid=response.responseJSON.hapyak_analytics_sid}}).fail(function(response,text,error){getRateLimits(response);that.queue.unshift(params);if(!that.hasRateLimits){that.sendDelay+=500}else if(that.rateLimitRemaining===0){that.sendDelay+=50}that.sendRequest()})}}function calculateTimeout(){var timeout=that.sendDelay;var now,utc;if(that.hasRateLimits&&that.rateLimitRemaining===0){now=new Date;utc=now.getTime()+now.getTimezoneOffset()*6e4;timeout=Math.max(0,(that.rateLimitReset||0)-utc+that.sendDelay)}return timeout}while(this.queue.length>0){setTimeout(createRequest(this.queue.pop()),calculateTimeout())}};this.transformData=function(properties){var excludeKeys=["Answers","Correct","excludeKeys","Num Answered","Num Correct","Num Questions","Pass","Questions","Submit","Summary","Target","Target Time","Text","Target Expression","Video Elapsed Difference"].concat(properties.excludeKeys),o=_.omit(properties,excludeKeys),quiz=omitInvalid({answer:properties["Answer"],correct:properties["Correct"],num_answered:properties["Num Answered"],num_correct:properties["Num Correct"],num_questions:properties["Num Questions"],passed:properties["Pass"],question:properties["Question"],submit:properties["Action"]==="Submit",summary:properties["Summary"]});o["Annotation Dwell Time"]=properties["Video Elapsed Difference"];o["Annotation Text"]=properties["Text"];if(!_.isFinite(properties.Target)){o["Link Url"]=properties["Target"]}o["Link Time"]=properties["Target Time"];o["Link Code"]=properties["Target Expression"];o.Quiz=quiz;if(quiz.answer){o.Rollup=(o.Rollup||[]).concat("response")}o.Rollup=_.uniq(o.Rollup);o.Referrer=document.referrer;o["Referring Domain"]=referringDomain&&referringDomain[1];o["Video Dwell Time"]=properties["Video Accrued"];if(o.Templates&&typeof o.Templates.forEach==="function"){o.Templates.forEach(function(item,index,reference){if(item.tags===null){item.tags=[]}})}return omitInvalid(o)}}BigQueryIntegration.prototype=new AnalyticsIntegation;return new BigQueryIntegration});hy.define("hapyak.list",["module","model","dao","jquery.noconflict","configuration","utils.embed",undefined],function(module,model,dao,$,configuration,utils){function HapyakList(options){var projectIds=[],that=this;var currentPlayer,iframe,playlistToProject,currentIndex;function sendMessage(event){hapyak.message.send(iframe,event,{playlistItems:playlistToProject,currentVideo:playlistToProject[currentIndex],customContext:"getPlaylist"})}this.moduleConfig=module.config();console.debug("[hapyak.list] HapYak playlist embedded",options);hapyak.message.addEventListener("getPlaylistExternal",function(){hapyak.message.send(iframe,"gotPlaylistExternal",{playlistItems:cullPlaylistData(),customContext:"getPlaylist"})});function cullPlaylistData(){var playlist=playlistToProject&&JSON.parse(JSON.stringify(playlistToProject)),outplaylist=[],idx=0;for(idx=0;idx<playlist.length;idx++){outplaylist.push(joinReplaceDelete(playlist[idx]))}return outplaylist}function joinReplaceDelete(inputPlaylistToProject){var map={group:"replace",track:"replace",video:"replace",owner:"replace",created:"delete",modified:"delete"},dataArray=utils.dotget(inputPlaylistToProject,"data.project.data"),functionMap={replace:function(key){dataArray[key]=utils.dotget(inputPlaylistToProject,"data.project."+key+".id")},delete:function(key){delete dataArray[key]}};var key;if(!dataArray.hasOwnProperty("image")){dataArray["image"]=utils.dotget(inputPlaylistToProject,"data.project.data.video.data.image")}for(key in dataArray){if(map[key]){functionMap[map[key]](key)}}return dataArray}function loadProject(project,callback){var approved,safestreamProps;if(!project){return}function ready(el){if(el){iframe=el}sendMessage("setup");if(iframe&&callback&&typeof callback==="function"){callback(that)}}safestreamProps=project.get("properties.safestream");approved=safestreamProps&&safestreamProps.approved;var controlBarHeight=options.edit?utils.dotget(configuration,"player.viewer.controlBarHeight")||59:0,frepParams=that.moduleConfig.frepParams,startTime=frepParams?+frepParams.hapyak_start_time:+options.startTime,projectProperties=project.get("properties")||{},playerParameters=projectProperties.player_parameters||{},hyExperienceParams=options.hyExperienceParams;var config;playerParameters.isLive=utils.dotget(that,"moduleConfig.experienceDataGraph.experience.layout.template")==="live";if(project.get("workflow_state")){options.edit=project.get("workflow_state.properties.rules.can_edit")}config={apiKey:options.apiKey,edit:options.edit&&!approved,projectId:project.get("id"),elementId:options.elementId,autoplay:options.autoplay,nativeControls:options.nativeControls,videoType:project.get("embed_type"),height:project.get("height")+controlBarHeight,width:project.get("width"),playerParameters:playerParameters,userId:options.userId,isExperience:options.isExperience,resetVariables:projectProperties.reset_variables,onLoad:ready,controls:!options.nativeControls,onCanPlay:function(){if(startTime&&!that.firstLoad){that.firstLoad=true;currentPlayer.currentTime=startTime}if(options.onCanPlay&&typeof options.onCanPlay==="function"){options.onCanPlay.call(this,arguments)}},onLoadTrack:options.onLoadTrack,onLoadAnnotations:options.onLoadAnnotations,experienceDataGraph:that.moduleConfig.experienceDataGraph||options.experienceData,registrationData:that.moduleConfig.registrationData,frepParams:that.moduleConfig.frepParams};if(options.edit){config.controlBarHeight=undefined}if(hyExperienceParams){config.variables=hyExperienceParams;if(hyExperienceParams.userId){config.userId=hyExperienceParams.userId}if(hyExperienceParams.username){config.username=hyExperienceParams.username}}currentPlayer=hapyak.iframe(config)}function destroy(callback){function checkFullScreen(){if(window.innerHeight!==screen.height){currentPlayer.destroy();document.getElementById(options.elementId).innerHTML="";currentPlayer=null;iframe=null;if(callback&&typeof callback==="function"){callback()}}else{setTimeout(function(){checkFullScreen()},100);return}}if(utils.dotget(currentPlayer,"destroy")){if(window.innerHeight===screen.height){if(document.exitFullScreen){document.exitFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}checkFullScreen()}}model.PlaylistToProject.find({playlist:options.listId}).onLoad(function(response){var startAt=options.startAt||0;playlistToProject=response.get("content");if(!playlistToProject.length){console.warn("[hapyak.list] No projects in selected playlist!");return}playlistToProject.forEach(function(instance,index){var project=instance.get("project"),frepParams=that.moduleConfig.frepParams,firstProject=frepParams?+frepParams.hapyak_project:+options.firstProject;var projectId;if(project){projectId=project.get("id");if(firstProject===projectId){startAt=index}projectIds.push(projectId)}});if(startAt>projectIds.length-1){startAt=0}currentIndex=startAt;loadProject(playlistToProject[startAt].get("project"),options.onLoad)});this.id=options.listId;this.firstLoad=false;this.pid="hapyak_"+this.id;this.element=function(){return iframe};this.currentPlayer=function(){return currentPlayer};this.currentProject=function(){return playlistToProject[currentIndex].get("project")};this.next=function(callback){var index=currentIndex+1,projectId=projectIds[index],that=this;if(!projectId){console.warn("[hapyak.list] Already at last item in playlist!");return}destroy(function(){hapyak.triggerListeners("playlist.change",that,[currentIndex]);loadProject(playlistToProject[index].get("project"),function(player){currentIndex++;if(callback&&typeof callback==="function"){callback(player)}})});return true};this.previous=function(callback){var index=currentIndex-1,projectId=projectIds[index],that=this;if(!projectId){console.warn("[hapyak.list] Already at first item in playlist!");return}destroy(function(){hapyak.triggerListeners("playlist.change",that,[currentIndex]);loadProject(playlistToProject[index].get("project"),function(player){currentIndex--;if(callback&&typeof callback==="function"){callback(player)}})});return true};this.move=function(from,to,callback){
var lastIndex=projectIds.length-1,currentProject=projectIds[currentIndex];var movingProjectId,movingPlaylistToProject;if(!options.edit){console.warn("[hapyak.list] Can't move item in playlist when not in edit mode!");return}if(from<0||to<0){console.warn("[hapyak.list] Invalid from or to index.");return}from=Math.min(from,lastIndex);to=Math.min(to,lastIndex);movingProjectId=projectIds[from];movingPlaylistToProject=playlistToProject[from];projectIds.splice(from,1);projectIds.splice(to,0,movingProjectId);playlistToProject.splice(from,1);playlistToProject.splice(to,0,movingPlaylistToProject);playlistToProject.forEach(function(instance,index){instance.set("display_order",index)});dao.store.commit(function(){currentIndex=projectIds.indexOf(currentProject);sendMessage("move");if(callback&&typeof callback==="function"){callback()}});return true};this.add=function(projectId,callback){if(!projectId||!options.edit){console.warn("[hapyak.list] Can't add item to playlist when not in edit mode!");return}model.PlaylistToProject.createRecord({playlist:options.listId,project:projectId}).onSave(function(newPlaylistToProject){model.Project.find(projectId).onLoad(function(projectObject){newPlaylistToProject.data.project=projectObject;playlistToProject.push(newPlaylistToProject);projectIds.push(projectObject.get("id"));sendMessage("add");if(callback&&typeof callback==="function"){callback()}})});return true};this.remove=function(projectId,callback){var index;if(!projectId||!options.edit){console.warn("[hapyak.list] Can't remove item from playlist when not in edit mode!");return}index=projectIds.indexOf(projectId);if(index===-1||!playlistToProject[index]){return}playlistToProject[index].deleteRecord();dao.store.commit(function(){projectIds.splice(index,1);playlistToProject.splice(index,1);sendMessage("remove");if(callback&&typeof callback==="function"){callback()}});return true};this.all=function(){if(!playlistToProject){return}return playlistToProject.map(function(instance){return instance.get("project")})};this.goTo=function(index,callback){var projectId=projectIds[index],that=this;if(!projectId){console.warn("[hapyak.list] No video at index="+index);return}destroy(function(){hapyak.triggerListeners("playlist.change",that,[currentIndex]);loadProject(playlistToProject[index].get("project"),function(player){currentIndex=index;sendMessage("goTo");if(callback&&typeof callback==="function"){callback(player)}})});return true};this.currentIndex=function(){return currentIndex};this.pause=function(){if(currentPlayer){currentPlayer.pause()}};this.play=function(){if(currentPlayer){currentPlayer.play()}}}return HapyakList});(function(Popcorn,document){function parseUri(str){var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--){uri[o.key[i]]=m[i]||""}uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1){uri[o.q.name][$1]=$2}});return uri}parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var _fakeTimeRanges={length:0,start:Popcorn.nop,end:Popcorn.nop};window.MediaError=window.MediaError||function(){function MediaError(code,msg){this.code=code||null;this.message=msg||""}MediaError.MEDIA_ERR_NONE_ACTIVE=0;MediaError.MEDIA_ERR_ABORTED=1;MediaError.MEDIA_ERR_NETWORK=2;MediaError.MEDIA_ERR_DECODE=3;MediaError.MEDIA_ERR_NONE_SUPPORTED=4;return MediaError}();function MediaElementProto(){}MediaElementProto.prototype={_util:{TIMEUPDATE_MS:250,MIN_WIDTH:300,MIN_HEIGHT:150,isAttributeSet:function(value){return typeof value==="string"||value===true},parseUri:parseUri},addEventListener:function(type,listener,useCapture){document.addEventListener(this._eventNamespace+type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){document.removeEventListener(this._eventNamespace+type,listener,useCapture)},dispatchEvent:function(name){var customEvent,detail={type:name,target:this.parentNode,data:null};try{customEvent=document.createEvent("CustomEvent");customEvent.initCustomEvent(this._eventNamespace+name,false,false,detail)}catch(e){customEvent=document.createEvent("HTMLEvents");customEvent.initEvent(this._eventNamespace+name,false,false);customEvent.type=name;customEvent.target=detail.target}document.dispatchEvent(customEvent)},load:Popcorn.nop,canPlayType:function(url){return""},getBoundingClientRect:function(){return this.parentNode.getBoundingClientRect()},NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4};MediaElementProto.prototype.constructor=MediaElementProto;Object.defineProperties(MediaElementProto.prototype,{currentSrc:{get:function(){return this.src!==undefined?this.src:""}},preload:{get:function(){return"auto"},set:Popcorn.nop},controls:{get:function(){return true},set:Popcorn.nop},poster:{get:function(){return""},set:Popcorn.nop},crossorigin:{get:function(){return""}},played:{get:function(){return _fakeTimeRanges}},seekable:{get:function(){return _fakeTimeRanges}},buffered:{get:function(){return _fakeTimeRanges}},defaultMuted:{get:function(){return false}},defaultPlaybackRate:{get:function(){return 1}}});Popcorn._MediaElementProto=MediaElementProto})(Popcorn,window.document);hy.define("popcorn.mediaelementproto",function(){});hy.define("player.intersect",["jquery.noconflict"],function($,undefined){return function(child,parent,padding){var o={},p={top:0,right:0,bottom:0,left:0};var childPos,parentPos;if(!child){return}if(padding===undefined){padding=0}if(child){if(child instanceof HTMLElement){child=$(child)}if(child.x!==undefined){o.child=child}else{childPos=child.position();o.child={x:childPos&&childPos.left||0,y:childPos&&childPos.top||0,width:child.outerWidth()||0,height:child.outerHeight()||0}}}if(parent){if(parent instanceof HTMLElement){parent=$(parent)}if(parent.x!==undefined){o.parent=parent}else{parentPos=parent.position();o.parent={x:parentPos&&parentPos.left||0,y:parentPos&&parentPos.top||0,width:parent.outerWidth()||0,height:parent.outerHeight()||0}}}if(padding){if(typeof padding==="object"){$.extend(p,padding)}else{if(typeof padding==="string"&&padding.indexOf("%")!==-1){padding=padding.replace("%","")/100;p.top=p.bottom=o.parent.height*padding;p.left=p.right=o.parent.width*padding}else if(typeof padding==="number"){p.top=p.right=p.bottom=p.left=padding}}}if(o.child&&o.parent){o.relative={top:o.child.y-p.top,right:o.child.x+o.child.width-o.parent.width+p.right,bottom:o.child.y+o.child.height-o.parent.height+p.bottom,left:o.child.x-p.left};o.exceed={top:o.relative.top<0,right:o.relative.right>0,bottom:o.relative.bottom>0,left:o.relative.left<0}}return o}});(function(root,factory){if(typeof exports==="object"){module.exports=factory(require("jquery.noconflict"),require("player.intersect"),require("hapyak.overlay"),require("popcorn"),require("popcorn.filter"))}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.close",["jquery.noconflict","player.intersect","hapyak.overlay","popcorn","popcorn.datafilter"],factory)}else{factory(root.Popcorn)}})(this,function($,intersect,overlay,Popcorn,popcornfilter,undefined){var asked={},hiddenContainers={};Popcorn.dataFilter(["editMode"],"close",["pop","hotlink","iframe"],function(name,options,next,node,editMode){var popcorn=this;var boundaries,close,container,playBoxContainer;function closeAnnotation(e){e.preventDefault();e.stopPropagation();if(container){hiddenContainers[node.uid]=container;container.addClass("closed")}if(asked[popcorn.id]){delete asked[popcorn.id];overlay.confirm({title:"Disable annotations",message:"Do you want to disable all annotations?",callbacks:{success:function(){var key;for(key in hiddenContainers){if(hiddenContainers.hasOwnProperty(key)){hiddenContainers[key].removeClass("closed");delete hiddenContainers[key]}}popcorn.emit("disable")}}})}else{asked[popcorn.id]=true}}function hasDynamicWidth(){return node.fakeTrackEvent._natives.plugin==="userfollow"}function relativeDim(value,prop){var dim=prop==="width"?playBoxContainer.outerWidth():playBoxContainer.outerHeight();if(value===undefined||!dim){return 0}if(typeof value==="number"){return value}else if(value.indexOf("px")!==-1){return+value.replace("px","")}else{return dim*(+value.replace("%","")/100)}}next(options);if(name==="iframe"&&(!node.fakeTrackEvent||!node.fakeTrackEvent._natives||!(node.fakeTrackEvent._natives.plugin==="userfollow"||node.fakeTrackEvent._natives.plugin==="videopreview"))){return}if(editMode&&hiddenContainers[node.uid]){hiddenContainers[node.uid].removeClass("closed");delete hiddenContainers[node.uid]}container=$(node.fakeTrackEvent.container);playBoxContainer=$(container).closest(".hapyak-play-box, .hapyak-player");if(container&&container.parent()){close=$(container).find(".hapyak-el-close");if(!close.length){close=$('<div class="hapyak-el-close"><div>&times;</div></div>').hide().appendTo(container);close.click(closeAnnotation)}close.hide();boundaries=intersect({x:relativeDim(options.left,"width"),y:relativeDim(options.top,"height"),width:relativeDim(hasDynamicWidth()?container.outerWidth()*1.93548:options.width||container.outerWidth(),"width"),height:relativeDim(container.outerHeight(),"height")},playBoxContainer,"4%");if(boundaries.exceed.right){close.addClass("hapyak-el-close-left")}else{close.removeClass("hapyak-el-close-left")}if(boundaries.exceed.top){close.addClass("hapyak-el-close-bottom")}else{close.removeClass("hapyak-el-close-bottom")}if(!editMode){close.show()}}},false,function(node){if(hiddenContainers[node.uid]){hiddenContainers[node.uid].removeClass("closed")}delete hiddenContainers[node.uid]})});(function(window,Popcorn,undefined){var document=window.document,EMPTY_STRING="",MIN_WIDTH=300,MIN_HEIGHT=200,smartAPIScriptElement,experienceScriptElement,apiReadyCallbacks=[],brightcove,brightcoveScriptDomains={"https:":"//sadmin.brightcove.com/","http:":"//admin.brightcove.com/"},numberRegex=/^\s*?\d+(?:\.\d+)?\s*$/,isVideoPlayerAPI=false,htmlMode,readyStates=[["loadstart"],["durationchange","loadedmetadata"],["loadeddata"],["loadeddata","canplay"],["canplaythrough"]];function findExistingPlayer(src){var item;if(!brightcove){brightcove=window.brightcove}if(brightcove&&brightcove.experiences&&src&&src.experience){if(window.VideoPlayerAPI&&src instanceof window.VideoPlayerAPI){for(item in brightcove.instances){if(brightcove.instances.hasOwnProperty(item)&&brightcove.instances[item]===src.experience){isVideoPlayerAPI=true;return true}}}else if(brightcove.experiences[src.experience.id]){return true}}return false}function apiReadyPromise(fn){function checkAPIReady(){if(checkExperienceAPILoaded()){loadSmartAPI();if(checkSmartAPILoaded()){while(apiReadyCallbacks.length){apiReadyCallbacks.shift()()}}}setTimeout(checkAPIReady,10);return false}function checkSmartAPILoaded(){if(window.brightcove.api){brightcove=window.brightcove;return true}return false}function checkExperienceAPILoaded(){if(window.brightcove){return true}return false}function loadSmartAPI(){if(!checkSmartAPILoaded()&&!smartAPIScriptElement){smartAPIScriptElement=document.createElement("script");smartAPIScriptElement.async=true;smartAPIScriptElement.src=document.location.protocol+brightcoveScriptDomains[document.location.protocol]+"js/api/SmartPlayerAPI.js";document.head.appendChild(smartAPIScriptElement)}}function loadExperienceAPI(){if(!checkExperienceAPILoaded()&&!experienceScriptElement){experienceScriptElement=document.createElement("script");experienceScriptElement.async=true;experienceScriptElement.src=document.location.protocol+brightcoveScriptDomains[document.location.protocol]+"js/BrightcoveExperiences.js";document.head.appendChild(experienceScriptElement)}}if(checkExperienceAPILoaded()&&checkSmartAPILoaded()){fn();return}loadExperienceAPI();if(!apiReadyCallbacks.length){setTimeout(checkAPIReady,10)}apiReadyCallbacks.push(fn)}function findVideoParams(url){var videoId=/bctid=([0-9]*)/.exec(url),playerId=/bcpid([0-9]*)/.exec(url),playerKey=/bckey=([^&]*)/.exec(url);videoId=videoId?videoId[1]:null;playerId=playerId?playerId[1]:null;playerKey=playerKey?playerKey[1]:null;return{videoId:videoId,playerId:playerId,playerKey:playerKey}}function HTMLBrightcoveVideoElement(id,options){options=options||{};var self=this,parent=typeof id==="string"?Popcorn.dom.find(id):id,brightcoveObject,forceReadyState=options.forceReadyState,impl={src:EMPTY_STRING,networkState:self.NETWORK_EMPTY,readyState:self.HAVE_NOTHING,seeking:false,autoplay:EMPTY_STRING,preload:EMPTY_STRING,controls:false,loop:false,poster:EMPTY_STRING,volume:1,muted:0,currentTime:0,duration:NaN,ended:false,paused:true,width:0,height:0,error:null,progressAmount:null},videoWidth=0,videoHeight=0,maxReadyState=0,playEventPending=false,playingEventPending=false,playerReady=false,player,experienceModule,existingPlayer,playerReadyCallbacks=[],stalledTimeout,brightcoveId=Popcorn.guid(),eventCallbacks={},templateLoadedTimeout,errorMessageElement,beginFired=false,videoContainsAds=false,brightcoveElement,forcedPlay=false,seekTarget=-1;function playerReadyPromise(fn,unique){var i;if(playerReady){fn();return}if(unique){i=playerReadyCallbacks.indexOf(fn);if(i>=0){playerReadyCallbacks.splice(i,1)}}playerReadyCallbacks.push(fn)}function registerEventListener(name,src,dest){var callback;callback=eventCallbacks[name];if(callback){player.removeEventListener(name,callback)}if(typeof src==="string"){callback=function(evt){var val=player[dest||src];if(impl[src]!==val){impl[src]=val}}}else if(typeof src==="function"){callback=function(evt){src.apply(this,[].concat(evt))}}else{callback=function(){}}eventCallbacks[name]=callback;player.addEventListener(name,callback)}function removeEventListeners(){Popcorn.forEach(eventCallbacks,function(name,callback){player.removeEventListener(name,callback)})}function setReadyState(state){var i,queue;if(state<=impl.readyState){return}maxReadyState=Math.max(maxReadyState,state);if(state-impl.readyState>1){return}impl.readyState++;queue=readyStates[impl.readyState];for(i=0;i<queue.length;i++){self.dispatchEvent(queue[i])}setReadyState(maxReadyState)}function destroyPlayer(){clearTimeout(stalledTimeout);clearTimeout(templateLoadedTimeout);if(errorMessageElement){parent.removeChild(errorMessageElement);errorMessageElement=null}if(!(playerReady&&player)){return}delete self._util.player;delete self._util.brightcovePlayer;removeEventListeners();if(!existingPlayer){if(player.experience.type==="flash"||document.getElementById(player.experience.id)){player.pause()}brightcove.removeExperience(player.experience.id)}player=null;playerReady=false}function onDurationChange(){function callback(duration){if(!duration||videoContainsAds&&!beginFired){return}impl.duration=duration;setReadyState(self.HAVE_METADATA);setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);setReadyState(self.HAVE_ENOUGH_DATA);if(playEventPending){player.play();self.dispatchEvent("play")}if(playingEventPending){player.play();self.dispatchEvent("playing");playingEventPending=false}if(playEventPending){playEventPending=false;if(impl.paused){player.pause();self.dispatchEvent("pause")}}}if(isVideoPlayerAPI){callback(player.getVideoDuration())}else{player.getVideoDuration(false,callback)}}function onStalled(){if(!impl.duration||impl.progressAmount<impl.duration){impl.networkState=self.NETWORK_IDLE;self.dispatchEvent("stalled")}else{monitorStalled()}}function monitorStalled(){clearTimeout(stalledTimeout);stalledTimeout=setTimeout(onStalled,3e3)}function updateSize(){if(!experienceModule||!experienceModule.experience){return}experienceModule.setSize(impl.width,impl.height);self.parentNode.setAttribute("width",impl.width);self.parentNode.setAttribute("height",impl.height)}function changeSrc(aSrc){if(player){destroyPlayer()}impl.readyState=-1;maxReadyState=-1;playEventPending=false;playingEventPending=false;if(!aSrc&&!impl.src){return}if(impl.networkState!==self.NETWORK_EMPTY){if(impl.networkState===self.NETWORK_LOADING||impl.networkState===self.NETWORK_IDLE){self.dispatchEvent("abort")}self.dispatchEvent("emptied")}if(!impl.paused){if(playerReady){player.pause()}impl.paused=false}impl.seeking=false;impl.duration=NaN;if(impl.currentTime){impl.currentTime=0;self.dispatchEvent("timeupdate")}impl.error=null;if(!aSrc){impl.readyState=self.HAVE_NOTHING;impl.src=aSrc;return}if(!self._canPlaySrc(aSrc)){impl.error={name:"MediaError",message:"Media Source Not Supported",code:window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};impl.networkState=self.NETWORK_NO_SRC;self.dispatchEvent("error");return}impl.src=aSrc;impl.networkState=self.NETWORK_LOADING;setReadyState(self.HAVE_NOTHING);window["brightcoveReady"+brightcoveId]=function(){var brightcovePlayer,APIModules,adModule;return{onTemplateLoad:function(experienceID){clearTimeout(templateLoadedTimeout);if(errorMessageElement){parent.removeChild(errorMessageElement);errorMessageElement=null}brightcovePlayer=isVideoPlayerAPI?brightcove.getExperience(experienceID):brightcove.api.getExperience(experienceID);APIModules=brightcove.api.modules.APIModules;self._util.brightcovePlayer=brightcovePlayer},onTemplateReady:function(){playerReady=true;player=brightcovePlayer.getModule(APIModules.VIDEO_PLAYER);self._util.player=player;experienceModule=brightcovePlayer.getModule(APIModules.EXPERIENCE);experienceModule.setSize(impl.width,impl.height);adModule=brightcovePlayer.getModule(APIModules.ADVERTISING);adModule.getAdPolicy(function(adPolicy){if(!existingPlayer&&options.forceReadyState){adPolicy.prerollAds=false;adModule.setAdPolicy(adPolicy)}else{videoContainsAds=true}});player.getCurrentRendition(function(renditionDTO){if(renditionDTO){videoWidth=renditionDTO.frameWidth;videoHeight=renditionDTO.frameHeight}});if(parent&&parent.firstChild&&parent.firstChild.nodeName==="SPAN"){parent.firstChild.style.width="100%";parent.firstChild.style.height="100%"}onDurationChange();while(playerReadyCallbacks.length){playerReadyCallbacks.shift()()}delete window["brightcoveReady"+brightcoveId]}}}();apiReadyPromise(function(){var playerId,videoId,playerKey,playerParams={bgcolor:"#FFFFFF",width:"100%",height:"100%",playerID:"",isVid:"true",isUI:"true",dynamicStreaming:"true","@videoPlayer":"",includeAPI:"true",secureConnections:"",wmode:"transparent",templateLoadHandler:"brightcoveReady"+brightcoveId+".onTemplateLoad",templateReadyHandler:"brightcoveReady"+brightcoveId+".onTemplateReady"},videoParams;if(document.location.protocol==="https:"){playerParams["secureConnections"]="true"}if(!impl.src&&player){destroyPlayer()}existingPlayer=findExistingPlayer(impl.src);if(!existingPlayer){videoParams=findVideoParams(impl.src);videoId=videoParams.videoId;playerId=videoParams.playerId;playerKey=videoParams.playerKey;brightcoveObject=document.createElement("object");brightcoveObject.id="myExperience"+brightcoveId;brightcoveObject.className="BrightcoveExperience";if(playerId){playerParams["playerID"]=playerId}if(playerKey){playerParams["playerKey"]=playerKey}if(videoId){playerParams["@videoPlayer"]=videoId}Popcorn.forEach(playerParams,function(val,key){var param=document.createElement("param");param.name=key;param.value=val;brightcoveObject.appendChild(param)});templateLoadedTimeout=setTimeout(function(){var text;errorMessageElement=document.createElement("div");errorMessageElement.appendChild(document.createElement("p"));errorMessageElement.className="video-wrapper-error";if(forceReadyState){text="The connection to Brightcove timed out, retrying. For more information please review our <a target='_blank' href='https://docs.google.com/document/d/1uN4pLI_VO-_nNmwpExQoJpoRbRDfi2DPyvNogz8zRuc/pub'>Quick Start guide</a>."}else{text="The connection to Brightcove timed out, retrying."}errorMessageElement.firstChild.innerHTML=text;parent.appendChild(errorMessageElement)},15e3);parent.appendChild(brightcoveObject)}else{id=isVideoPlayerAPI?impl.src.callback.split(brightcove.ID_DELIM)[0]:impl.src.experience.id;brightcoveObject=document.getElementById(id);parent=brightcoveObject.parentNode;if(parent&&parent.nodeName==="SPAN"){parent.style.width=brightcoveObject.width;parent.style.height=brightcoveObject.height}window["brightcoveReady"+brightcoveId].onTemplateLoad(id);window["brightcoveReady"+brightcoveId].onTemplateReady()}brightcove.createExperiences();playerReadyPromise(function(){var initialPlayOccurred;function updateProgress(evt){var timeRange;if(!evt){return}impl.currentTime=evt.position;if(!impl.duration){onDurationChange()}setReadyState(self.HAVE_CURRENT_DATA);if(evt.position>=impl.duration){impl.networkState=self.NETWORK_IDLE;setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);setReadyState(self.HAVE_ENOUGH_DATA)}else{impl.networkState=self.NETWORK_LOADING;monitorStalled()}if(!initialPlayOccurred){initialPlayOccurred=true;impl.paused=false;self.dispatchEvent("play")}self.dispatchEvent("progress");return true}if(!player){return}registerEventListener(brightcove.api.events.MediaEvent.ERROR);monitorStalled();registerEventListener("stalled",onStalled);registerEventListener("durationchange",onDurationChange);registerEventListener("timeupdate","currentTime");registerEventListener("volumechange",function(){var volume=player.volume,muted=player.muted;if(impl.volume!==volume||impl.muted!==muted){impl.volume=volume;impl.muted=muted;return true}});registerEventListener(brightcove.api.events.MediaEvent.PROGRESS,function(evt){if(videoContainsAds&&!beginFired){return}updateProgress(evt)});registerEventListener(brightcove.api.events.MediaEvent.BEGIN,function(evt){beginFired=true;if(!initialPlayOccurred){updateProgress(evt);player.addEventListener(brightcove.api.events.MediaEvent.PROGRESS,function onFirstProgress(){player.removeEventListener(brightcove.api.events.MediaEvent.PROGRESS,onFirstProgress);registerEventListener(brightcove.api.events.MediaEvent.PROGRESS,updateProgress);if(seekTarget>0){player.seek(seekTarget);seekTarget=-1}if(!impl.autoplay&&!videoContainsAds&&forcedPlay&&forceReadyState){player.pause()}else{impl.paused=false;self.dispatchEvent("play")}forcedPlay=false})}initialPlayOccurred=true});registerEventListener(brightcove.api.events.MediaEvent.PLAY,function(evt){if(impl.paused){impl.paused=false;if(!impl.duration){if(initialPlayOccured&&forceReadyState){playEventPending=true;playingEventPending=true}}else{if(initialPlayOccurred){self.dispatchEvent("play")}return true}}});registerEventListener(brightcove.api.events.MediaEvent.SEEK_NOTIFY,function(evt){impl.seeking=true;if(impl.seeking){impl.seeking=false;if(impl.paused&&evt.position!==impl.currentTime){impl.currentTime=evt.position;setCurrentTime()}seekTarget=-1;self.dispatchEvent("seeking");self.dispatchEvent("seeked");return true}});registerEventListener(brightcove.api.events.MediaEvent.STOP,function(){if(!impl.paused){impl.paused=true;if(initialPlayOccurred){self.dispatchEvent("pause")}return!!impl.duration}});registerEventListener(brightcove.api.events.MediaEvent.COMPLETE,function(){if(impl.loop){player.seek(0);player.play()}else{impl.ended=true;self.dispatchEvent("pause");self.dispatchEvent("timeupdate");self.dispatchEvent("ended");return true}});initialPlayOccurred=readyStates[impl.readyState]>=1;if(!initialPlayOccurred&&!existingPlayer&&forceReadyState){forcedPlay=true;player.play()}})},true)}function setVolume(){player._callMethod("setVolume",[impl.volume])}function getVolume(){return impl.muted>0?impl.muted:impl.volume}function setMuted(){impl.muted=impl.muted>0?0:1;player._callMethod("mute",[Boolean(impl.muted)])}function getMuted(){return impl.muted>0}function setCurrentTime(){if(!beginFired&&forceReadyState){forcedPlay=true;player.play()}seekTarget=impl.currentTime;player.seek(impl.currentTime)}if(parent.experience&&parent.experience.id){brightcoveElement=document.getElementById(parent.experience.id);impl.width=brightcoveElement.offsetWidth;impl.height=brightcoveElement.offsetHeight}else if(parent.getWidth){impl.width=parent.getWidth();impl.height=parent.getHeight()}else{impl.width=parent.offsetWidth||MIN_WIDTH;impl.height=parent.offsetHeight||MIN_HEIGHT}self._eventNamespace=Popcorn.guid("HTMLBrightcoveVideoElement::");self.parentNode=parent instanceof Element?parent:document.getElementById(parent.experience.id);self._util=Popcorn.extend({},self._util);self._util.type="Brightcove";self.play=function(){function play(){player.play();self.dispatchEvent("playing")}forcedPlay=false;playerReadyPromise(play,true)};self.pause=function(){function pause(){player.pause();self.dispatchEvent("pause")}impl.paused=true;playerReadyPromise(pause,true)};self.load=function(){changeSrc(impl.src)};self._util.destroy=function(){destroyPlayer()};self._util.fullscreenChange=function(margin){self.parentNode.style.margin=margin};Object.defineProperties(self,{src:{get:function(){return impl.src},set:function(aSrc){if(aSrc!==impl.src){changeSrc(aSrc)}}},autoplay:{get:function(){return impl.autoplay},set:function(aValue){impl.autoplay=self._util.isAttributeSet(aValue)}},loop:{get:function(){return impl.loop},set:function(aValue){impl.loop=self._util.isAttributeSet(aValue)}},width:{get:function(){if(brightcoveObject){if(numberRegex.test(brightcoveObject.width)){return brightcoveObject.width}return brightcoveObject.offsetWidth||impl.width}return impl.width},set:function(aValue){impl.width=aValue;playerReadyPromise(updateSize)}},videoWidth:{get:function(){return videoWidth||0}},height:{get:function(){if(brightcoveObject){if(numberRegex.test(brightcoveObject.height)){return brightcoveObject.height}return brightcoveObject.offsetHeight||impl.height}return impl.height},set:function(aValue){impl.height=aValue;playerReadyPromise(updateSize)}},videoHeight:{get:function(){return videoHeight||0}},currentTime:{get:function(){return impl.currentTime},set:function(aValue){aValue=parseFloat(aValue);impl.currentTime=aValue;playerReadyPromise(setCurrentTime,true)}},currentSrc:{get:function(){return impl.src}},duration:{get:function(){return impl.duration}},ended:{get:function(){return impl.ended}},paused:{get:function(){return impl.paused}},seeking:{get:function(){return impl.seeking}},readyState:{get:function(){return impl.readyState}},networkState:{get:function(){return impl.networkState}},volume:{get:function(){return getVolume()},set:function(aValue){aValue=parseFloat(aValue);if(aValue<0||aValue>1||isNaN(aValue)){throw new Error("Volume value must be between 0.0 and 1.0")}impl.volume=aValue;playerReadyPromise(setVolume,true);self.dispatchEvent("volumechange")}},muted:{get:function(){return getMuted()},set:function(aValue){playerReadyPromise(setMuted,true);self.dispatchEvent("volumechange")}},error:{get:function(){return impl.error}}})}HTMLBrightcoveVideoElement.prototype=new Popcorn._MediaElementProto;HTMLBrightcoveVideoElement.prototype.constructor=HTMLBrightcoveVideoElement;HTMLBrightcoveVideoElement.prototype._canPlaySrc=function(url){var tempElem=document.createElement("a"),params=findVideoParams(url);tempElem.href=url;return findExistingPlayer(url)||tempElem.hostname==="link.brightcove.com"&&params.videoId&&params.playerId};HTMLBrightcoveVideoElement.prototype.canPlayType=function(type){return type==="video/x-brightcove"?"probably":EMPTY_STRING};Popcorn.HTMLBrightcoveVideoElement=function(id,options){return new HTMLBrightcoveVideoElement(id,options)};Popcorn.HTMLBrightcoveVideoElement._canPlaySrc=HTMLBrightcoveVideoElement.prototype._canPlaySrc})(this,this.Popcorn);hy.define("popcorn.htmlbrightcovevideoelement",function(){});hy.define("player.profile.brightcove",["lodash.noconflict","player.wrappers","popcorn.htmlbrightcovevideoelement"],function(_,wrappers){wrappers.brightcove={id:"brightcove",name:"Brightcove",fn:"HTMLBrightcoveVideoElement",forceIpadControls:true,args:function(video,options){return[options.playerParameters]},src:function(video,options){var bcpid,bckey,src,sourceId=video.get("source_id"),sourceParams=video.getCustomProperty("source_parameters")||{};if(options.playerParameters&&options.playerParameters.bcpid){bcpid=options.playerParameters.bcpid}if(options.playerParameters&&options.playerParameters.bckey){bckey=options.playerParameters.bckey}if(!bcpid&&sourceParams){bcpid=sourceParams.bcpid}if(!bckey&&sourceParams){bckey=sourceParams.bckey}if(!bcpid&&options.playerType){bcpid=options.playerType}src=window.location.protocol+"//link.brightcove.com/services/player/";if(bcpid){src+="bcpid"+bcpid+"?"+"bckey="+encodeURIComponent(bckey)+"&"+"bctid="+encodeURIComponent(sourceId)}else{src+=sourceId}return src},container:function(container){var id;if(window.VideoPlayerAPI&&container instanceof window.VideoPlayerAPI){id=container.callback.split(brightcove.ID_DELIM)[0]}else{id=container.experience.id}return document.getElementById(id).parentNode},isDuplicate:function(container){if(Popcorn.instances.length===0||!window.brightcove||!container.experience||!window.brightcove.experiences[container.experience.id]){return false}return _.some(Popcorn.instances,function(instance){if(instance&&instance.media&&instance.media.parentNode){if(container.experience.id===instance.media.parentNode.id){return true}}})}};return wrappers.brightcove});hy.define("ember-rsvp",["ember.noconflict"],function(Ember){return Ember.RSVP});hy.define("base.adapter",["configuration","lodash.noconflict","require","ember"],function(configuration,_,require,ember){var usesHyrtm=ember.get(configuration,"provisioning.experiences.layoutTypes.live");function Adapter(channel,environment){var that=this;this.supports=["realtime"];this.techOrder=["realtime"];this.currentTech="realtime";if(usesHyrtm){hy.require(["hyrtm.client"],function(HYRTMClient){that.hyrtm=new HYRTMClient(channel,{environment:environment||"production"});that.hyrtm.sendRemote("*","get",{},function(data){that.hyrtm.on("set",function(data){var payload=data.payload||{};if(payload.streamTech!=="realtime"){return}that.realtime(payload)})})})}}Adapter.prototype={realtime:function(payload){var that=this;var delay;if(!payload){return}delay=(payload.slideDelay||3)*1e3;setTimeout(function(){that.hyrtm.sendLocal(window.parent,"realtime_event",payload)},delay)}};return Adapter});hy.define("adapters",["require","base.adapter","utils.embed"],function(require,BaseAdapter,utils){var adapterMap={videojs4:"brightcove-v2.adapter",videojsvr:"brightcove-v2.adapter"};return{load:function(playerType,callback){if(!playerType){console.warn("Can't load an adapter without a playerType");return}var adapterModule=adapterMap[playerType],queryParams=utils.getQueryParams(window.location.href);var experienceData,channel;callback=callback||function(){};try{experienceData=JSON.parse(queryParams.experience_data);channel=experienceData.experience.id}catch(e){callback();return}if(!experienceData||!experienceData.layout||experienceData.layout.type_name!=="live"){callback();return}if(!adapterModule){callback(new BaseAdapter(channel,hapyak.environment||"production"));return}require([adapterModule],function(Adapter){callback(new Adapter(channel,hapyak.environment||"production"))})}}});hy.define("virtualmediaelement",["lodash.noconflict","ember-rsvp","adapters"],function(_,RSVP,adapters){var registry={},guidCounter=0,guid=function(prefix){prefix=prefix||"";guidCounter++;return prefix+(Date.now()+guidCounter)},apiPromises={},timeouts=[],vmeGuid=guid("VirtualMediaElement"),vmeRequire=hy.requirejs.config({context:vmeGuid}),regex={mimeStart:/^video\/x-/i,http:/^https?:/i},readyStateNames={none:1,current:2,future:3,enough:4},properties={volume:false,currentTime:false,outerContainer:false,ended:false,muted:false,
paused:false,width:false,height:false,offsetWidth:false,offsetHeight:false,videoWidth:false,videoHeight:false,parentNode:null,pause:true,play:true,addEventListener:true,removeEventListener:true},MediaError=function(){function MediaError(code){this.code=code||null}MediaError.MEDIA_ERR_NONE_ACTIVE=0;MediaError.MEDIA_ERR_ABORTED=1;MediaError.MEDIA_ERR_NETWORK=2;MediaError.MEDIA_ERR_DECODE=3;MediaError.MEDIA_ERR_NONE_SUPPORTED=4;return MediaError}();function parseQueryString(str,targetObject,noOverride){var obj=targetObject||{};if(str&&typeof str==="string"){if(str[0]==="?"){str=str.substring(1)}_.forEach(str.split("&"),function(param){var pair=param.split("="),key=pair[0],val=pair[1];if(val!==""&&(!noOverride||!(key in obj))){obj[key]=val}})}return obj}function nextTickCallback(){var fn=timeouts.shift();fn()}function nextTick(callback){if(typeof callback==="function"){timeouts.push(callback);setTimeout(nextTickCallback,0)}}function VirtualMediaElement(playerTypeId,definition,container,opts){var options=opts||{},that=this,wrapper,parent,eventNamespace,apiReadyPromises=apiPromises[playerTypeId],promises={},resolvePlayer,rejectPlayer,props={},pendingEvents={},errorQueue=[],loadCount=0,listeners={},lastProgressEvent=-1,lastTimeUpdate=0,previousCurrentTime,hasLoadeddata=false,state,eventCallbacks={error:function(){if(errorQueue.length){errorQueue.shift()}}};function fireError(errorCode){var error=new MediaError(errorCode);state.error=error;errorQueue.push(error);that.dispatchEvent("error")}function fireProgress(){var now=Date.now();if(now-lastProgressEvent>=350){lastProgressEvent=now;that.dispatchEvent("progress")}}function fireTimeUpdate(seeked){var now=Date.now();if((seeked||now-lastTimeUpdate>200)&&state.currentTime!==previousCurrentTime){that.dispatchEvent("timeupdate");previousCurrentTime=state.currentTime;lastTimeUpdate=now}}function haveMetadata(){return state.duration&&state.videoWidth&&state.videoHeight}function setReadyState(readyState){var previousState;if(readyState===state.readyState||!haveMetadata()){return}if(readyState>that.HAVE_METADATA&&!state.readyState){setReadyState(that.HAVE_METADATA)}previousState=state.readyState;state.readyState=readyState;if(previousState===that.HAVE_NOTHING&&readyState===that.HAVE_METADATA){that.dispatchEvent("loadedmetadata")}if(previousState===that.HAVE_METADATA&&readyState>=that.HAVE_CURRENT_DATA&&!hasLoadeddata){that.dispatchEvent("loadeddata")}if(previousState>=that.HAVE_FUTURE_DATA&&readyState<=that.HAVE_CURRENT_DATA){fireTimeUpdate();that.dispatchEvent("waiting")}if(previousState<=that.HAVE_CURRENT_DATA&&readyState===that.HAVE_FUTURE_DATA){that.dispatchEvent("canplay");if(!state.paused){that.dispatchEvent("playing")}}if(readyState===that.HAVE_ENOUGH_DATA){if(previousState<=that.HAVE_CURRENT_DATA){that.dispatchEvent("canplay")}if(!state.paused){that.dispatchEvent("playing")}else if(state.autoplay){that.play()}that.dispatchEvent("canplaythrough")}}function evaluateReadyState(){if(!haveMetadata()){setReadyState(that.HAVE_NOTHING);return}if(!state.readyState){setReadyState(that.HAVE_METADATA)}}function destroy(){if(promises.playerReady){if(rejectPlayer){rejectPlayer()}resolvePlayer=null;rejectPlayer=null;delete promises.playerReady}if(typeof wrapper.destroy==="function"){that.WasteManagement.takeOutTheTrash();wrapper.destroy.call(that,state)}_.forEach(props,function(prop,key){delete props[key]});delete state.player;state.readyState=that.HAVE_NOTHING;if(state.networkState!==that.NETWORK_EMPTY){if(state.networkState===that.NETWORK_LOADING||state.networkState===that.NETWORK_IDLE){that.dispatchEvent("abort")}that.dispatchEvent("emptied")}lastProgressEvent=-1;hasLoadeddata=false;evaluateReadyState()}function isPotentiallyPlaying(){return!state.paused&&!state.ended&&!state.error}function changeSrc(){var src=state.src,currentLoadCount=loadCount;function loadFail(err,code){if(_.isNumber(err)){code=err}if(loadCount===currentLoadCount){state.networkState=that.NETWORK_NO_SOURCE;fireError(code||MediaError.MEDIA_ERR_NETWORK)}}if(state.currentSrc===src){return}if(state.networkState!==that.NETWORK_EMPTY){if(state.networkState===that.NETWORK_LOADING||state.networkState===that.NETWORK_IDLE){that.dispatchEvent("abort")}that.dispatchEvent("emptied")}destroy();state.paused=true;state.seeking=false;state.currentTime=0;state.duration=NaN;state.playBackRate=1;state.error=null;state.videoWidth=0;state.videoHeight=0;state.ended=false;errorQueue.length=0;if(!src){return}if(!that._canPlaySrc(src)){fireError(MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED);state.networkState=that.NETWORK_NO_SRC;return}state.currentSrc=src;state.networkState=that.NETWORK_LOADING;that.dispatchEvent("loadstart");_.forEach(wrapper.apiRequires,function(url,key){var path,protocol;protocol=window.location.protocol;if(protocol==="file:"){protocol="http:"}if(typeof url==="function"){url=url(options)}if(typeof url==="string"){url=url.replace(regex.http,protocol)}else if(typeof url==="object"&&url["isPath"]){path=url=url["path"]}else if(url){url=url[protocol.slice(0,-1)]}if(!url){return}if(apiReadyPromises[url+key]){apiReadyPromises[key]=apiReadyPromises[url+key];return}apiReadyPromises[key]=apiReadyPromises[url+key]=new RSVP.Promise(function(resolve,reject){var shim,sources;var paths={};if(path){paths[key]=path;url=null}if(window[key]){resolve(window[key]);return}shim={};if(url){shim[url]={exports:key}}vmeRequire=hy.requirejs.config({context:vmeGuid,shim:shim,paths:paths});sources=Object.keys(paths);if(url){sources.push(url)}vmeRequire(sources,function(obj){fireProgress();resolve(obj)},reject)})});if(typeof registry[playerTypeId].loadApi==="function"&&!apiReadyPromises[""]){apiReadyPromises[""]=new RSVP.Promise(function(resolve,reject){registry[playerTypeId].loadApi(vmeRequire,resolve,reject)})}promises.playerReady=new RSVP.Promise(function(resolve,reject){resolvePlayer=function(player){if(player&&typeof player==="object"){state.player=player}if(!state.player||typeof state.player!=="object"){rejectPlayer();return}resolve(state.player)};rejectPlayer=reject});RSVP.hash(apiReadyPromises).then(function(results){fireProgress();if(typeof wrapper.player!=="function"){return}adapters.load(playerTypeId,function(adapter){if(registry&&typeof registry[playerTypeId].findExisting==="function"){state.existingPlayer=registry[playerTypeId].findExisting(state.src)}if(adapter){results.adapter=adapter}state.player=wrapper.player(results,resolvePlayer,rejectPlayer);if(wrapper.events){that._util.events=wrapper.events}_.forEach(properties,function(isMethod,property){if(typeof wrapper[property]==="function"){props[property]=wrapper[property]}});if(state.player&&typeof state.player==="object"){resolvePlayer(state.player)}})},loadFail);promises.playerReady.then(function(player){_.forEach(properties,function(isMethod,property){var prop=wrapper[property]||property;if(typeof prop==="function"){props[property]=prop}else if(typeof prop==="string"&&prop){if(typeof player[prop]==="function"){props[property]=function(val){return player[prop](val)}}else if(prop in player){if(isMethod){props[property]=function(){return player[prop](arguments)}}else{props[property]=function(val){if(val===undefined){return player[prop]}player[prop]=val;return val}}}}});if(state.autoplay){props.play()}},loadFail)}parent=typeof container==="string"?document.querySelector(container):container;eventNamespace=guid("VirtualMediaElement")+"::";state={existingPlayer:null,player:null,src:"",currentSrc:"",networkState:that.NETWORK_EMPTY,readyState:that.HAVE_NOTHING,seeking:false,autoplay:false,preload:"",controls:false,loop:false,poster:"",volume:1,muted:false,currentTime:0,duration:NaN,ended:false,paused:true,playing:false,width:undefined,height:undefined,error:null,progressAmount:null,videoHeight:0,videoWidth:0,haveMetadata:haveMetadata,setDuration:function(duration){if(state.duration!==duration){state.duration=duration;that.dispatchEvent("durationchange");evaluateReadyState()}},setDimensions:function(width,height){if(state.videoHeight!==height||state.videoWidth!==width){state.videoHeight=height;state.videoWidth=width;that.dispatchEvent("resize");evaluateReadyState()}},setReadyState:function(readyState){if(typeof readyState==="string"){readyState=readyStateNames[readyState]}if(_.isNumber(state.readyState)&&readyState>=1&&readyState<=4){setReadyState(readyState)}},setCurrentTime:function(currentTime){if(_.isNaN(currentTime)){currentTime=props.currentTime&&props.currentTime();if(currentTime===undefined){return}}if(currentTime>=0&&currentTime<state.duration&&state.currentTime!==currentTime){state.currentTime=currentTime;fireTimeUpdate()}},setVolume:function(volume){if(volume>=0&&volume<=1&&state.volume!==volume){state.volume=volume;that.dispatchEvent("volumechange")}},setMuted:function(muted){if(muted!==state.muted){state.muted=muted;that.dispatchEvent("volumechange")}},setPlay:function(){state.paused=false;that.dispatchEvent("play")},setPaused:function(){state.paused=true;that.dispatchEvent("pause")},setSeeking:function(){if(!state.seeking){state.seeking=true;that.dispatchEvent("seeking")}},setSeeked:function(){state.setSeeking();fireTimeUpdate(true);state.seeking=false;that.dispatchEvent("seeked")},setEnded:function(){state.ended=true;that.dispatchEvent("ended")}};this.play=function(){if(props.play){props.play()}};this.pause=function(){if(props.pause){props.pause()}};this.load=function(){if(state.src!==state.currentSrc){loadCount++;changeSrc()}};this.addEventListener=function(type,listener,useCapture){var listenersByType,list,i,obj;if(typeof listener==="function"){listenersByType=listeners[type];if(!listenersByType){listenersByType=listeners[type]=[[],[]]}list=listenersByType[useCapture?1:0];for(i=list.length-1;i>=0;i--){if(list[i].listener===listener){return}}if(i<0){obj={listener:listener,callback:function(evt){if(obj.loadCount===loadCount){listener(evt)}},loadCount:loadCount};list.push(obj);document.addEventListener(eventNamespace+type,obj.callback,useCapture)}}};this.removeEventListener=function(type,listener,useCapture){var listenersByType,list,i,obj;if(typeof listener==="function"){listenersByType=listeners[type];if(!listenersByType){return}list=listenersByType[useCapture?1:0];for(i=list.length-1;i>=0;i--){obj=list[i];if(obj.listener===listener){document.removeEventListener(eventNamespace+type,obj.callback,useCapture);list.splice(i,1);return}}}};this.dispatchEvent=function(name){var customEvent,detail={type:name,target:this.parentNode,data:null};function dispatch(){pendingEvents[name]--;document.dispatchEvent(customEvent);if(eventCallbacks[name]){eventCallbacks[name](customEvent)}}if(name&&name.type){name=name.type}try{customEvent=document.createEvent("CustomEvent");customEvent.initCustomEvent(eventNamespace+name,false,false,detail)}catch(e){customEvent=document.createEvent("HTMLEvents");customEvent.initEvent(eventNamespace+name,false,false);customEvent.type=name;customEvent.target=detail.target}if(pendingEvents[name]){pendingEvents[name]++}else{pendingEvents[name]=1}nextTick(dispatch)};this._util={type:playerTypeId,destroy:function(){_.forEach(listeners,function(listenersByType,type){_.forEach(listenersByType,function(list,useCapture){_.forEach(list,function(obj){document.removeEventListener(eventNamespace+type,obj.callback,!!useCapture)})});delete listeners[type]});destroy()},guid:guid,parseQueryString:parseQueryString,nextTick:nextTick};this.canPlayType=function(mimeType){var result;if(!mimeType||typeof mimeType!=="string"){return""}if(typeof wrapper.canPlayType==="function"){result=wrapper.canPlayType(mimeType);if(result){return result}}else if(wrapper.canPlayType instanceof RegExp){if(wrapper.canPlayType.test(mimeType)){return"probably"}}else if(typeof wrapper.canPlayType==="string"&&mimeType===wrapper.canPlayType){return"probably"}if(regex.mimeStart.test(mimeType)&&mimeType.toLowerCase().substr(8)===playerTypeId.toLowerCase()){return"probably"}return""};this.WasteManagement=function(){var playerInstance,registerMethodName,deregisterMethodName,oldRegisterListener;var openEnrollment=false,eventListeners={};return{takeOutTheTrash:function(){if(!playerInstance||!typeof playerInstance[deregisterMethodName]==="function"||!oldRegisterListener){return}Object.keys(eventListeners).forEach(function(key){eventListeners[key].forEach(function(eventListener,index){playerInstance[deregisterMethodName](key,eventListener);if(index===eventListeners[key].length-1){delete eventListeners[key]}})});playerInstance[registerMethodName]=oldRegisterListener},toggleOpenEnrollment:function(bool){openEnrollment=bool},getEventListeners:function(){return eventListeners},setup:function(player,registerName,deregisterName){var that=this;playerInstance=player;registerMethodName=registerName;deregisterMethodName=deregisterName;openEnrollment=true;if(!oldRegisterListener){oldRegisterListener=playerInstance[registerMethodName];playerInstance[registerMethodName]=function(key,callback){if(openEnrollment){if(!eventListeners[key]){eventListeners[key]=[]}eventListeners[key].push(callback)}oldRegisterListener.apply(this,arguments)}}}}}();Object.defineProperties(that,{src:{get:function(){return state.src},set:function(src){if(state.src!==src){state.src=src}if(!loadCount){changeSrc()}}},autoplay:{get:function(){return state.autoplay},set:function(val){state.autoplay=!!val}},loop:{get:function(){return state.loop},set:function(val){state.loop=!!val}},controls:{get:function(){return state.controls},set:function(val){state.controls=!!val}},width:{get:function(){return state.width===undefined?0:state.width},set:function(width){width=parseInt(width,10);if(isNaN(width)||width<0){width=0}state.width=width;if(props.width){props.width(width)}return state.width===undefined?0:state.width}},height:{get:function(){return state.height===undefined?0:state.height},set:function(height){height=parseInt(height,10);if(isNaN(height)||height<0){height=0}state.height=height;if(props.height){props.height(height)}return state.height===undefined?0:state.height}},currentTime:{get:function(){var currentTime;if(props.currentTime){currentTime=props.currentTime();if(currentTime!==undefined){state.currentTime=currentTime}}return state.currentTime},set:function(val){if(state.readyState<that.HAVE_METADATA){throw new Error("Cannot seek without metadata")}if(props.currentTime){props.currentTime(val)}return state.currentTime}},outerContainer:{get:function(){return props.outerContainer?props.outerContainer():null}},volume:{get:function(){var volume;if(props.volume){volume=props.volume()}if(volume!==undefined){state.volume=volume}if(state.muted){return 0}return state.volume},set:function(val){val=Math.min(Math.max(val,0),1);if(props.volume){props.volume(val)}return state.volume}},muted:{get:function(){return!!state.muted},set:function(val){if(props.muted){props.muted(!!val)}if(props.volume){props.volume(0)}return!!state.muted}},currentSrc:{get:function(){return state.currentSrc}},duration:{get:function(){return state.duration}},ended:{get:function(){return state.ended}},paused:{get:function(){return state.paused}},seeking:{get:function(){if(pendingEvents.seeked){return true}return state.seeking}},readyState:{get:function(){return state.readyState}},networkState:{get:function(){return state.networkState}},videoWidth:{get:function(){return props.videoWidth?props.videoWidth():state.videoWidth}},videoHeight:{get:function(){return props.videoHeight?props.videoHeight():state.videoHeight}},offsetWidth:{get:function(){if(props.offsetWidth){return props.offsetWidth()}}},offsetHeight:{get:function(){if(props.offsetHeight){return props.offsetHeight()}}},error:{get:function(){return errorQueue.length&&errorQueue[0]||state.error}},parentNode:{get:function(){return props.parentNode?props.parentNode():parent}}});wrapper=definition.call(this,state,parent,options)}VirtualMediaElement.prototype={NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4,getBoundingClientRect:function(){return this.parentNode.getBoundingClientRect()}};VirtualMediaElement.register=function(playerTypeId,definition,opts){var Wrapper,options=opts||{};if(playerTypeId){Wrapper=function(container,opts){var obj=new VirtualMediaElement(playerTypeId,definition,container,opts);obj._canPlaySrc=Wrapper._canPlaySrc;obj._utils=Wrapper._utils;return obj};VirtualMediaElement[playerTypeId]=Wrapper;Wrapper._canPlaySrc=function(src){var result;if(typeof options.findExisting==="function"){result=options.findExisting(src);if(result){if(typeof result!=="string"){result="probably"}return result}}if(typeof options.canPlaySrc==="function"){result=options.canPlaySrc(src);if(result){if(typeof result!=="string"){result="probably"}return result}}else if(options.canPlaySrc instanceof RegExp&&options.canPlaySrc.test(src)){return"probably"}return""};if(_.isObject(options.utils)){Wrapper._utils=options.utils}registry[playerTypeId]={wrapper:Wrapper,definition:definition,findExisting:options.findExisting,canPlaySrc:options.canPlaySrc,loadApi:options.loadApi};apiPromises[playerTypeId]={};return Wrapper}};return VirtualMediaElement});hy.define("player.videojs4",["logging","virtualmediaelement","lodash.noconflict","jquery.noconflict","utils.embed","configuration","require","dao"],function(logging,VirtualMediaElement,_,$,utils,configuration,require,dao){return VirtualMediaElement.register("videojs4",function(state,parent,options){var player,playerContainer,video;var accountId=options.accountId,bcPlayer=options.bcPlayer,bcEmbed=options.bcEmbed,isBrightcove=!!options.accountId,isLive=options.isLive,isHapyakHostedPlayer=state.isHapyakHostedPlayer=options.isHapyakHostedPlayer,is360=options.is360,cssUrl=isHapyakHostedPlayer||isM3u8(state)?hapyak.api+"/js/vendor/videojs/6.11.0/video-js.min.css":"//vjs.zencdn.net/4.8/video-js.css",requiresObj={},that=this,playerConfig=configuration.player||{};function getFallbackDimensions(dimension){var rawSources=player&&player.mediainfo&&player.mediainfo.rawSources_;var sourcesWithWidthAndHeight;if(!rawSources||["width","height"].indexOf(dimension)===-1){return 0}sourcesWithWidthAndHeight=player.mediainfo.rawSources_.filter(function filterForWidthAndHeight(source){return source.width&&source.height});if(sourcesWithWidthAndHeight.length===0){return 1}return sourcesWithWidthAndHeight[0][dimension]}function getPlayerDimensions(player){var dimensions={width:0,height:0};if(!player){return dimensions}if(typeof player.width==="function"&&typeof player.height==="function"){dimensions.width=player.width();dimensions.height=player.height()}if(!dimensions.width&&!dimensions.height&&player.el_){dimensions.width=player.el_.offsetWidth||0;dimensions.height=player.el_.offsetHeight||0}return dimensions}function isM3u8(state){var src=state&&state.src&&state.src[0]&&state.src[0].src;if(!src){src=options.videoSourceId}return src&&src.indexOf(".m3u8")>-1}function isSafestream(state){return!!(state&&state.currentSrc&&state.currentSrc[0]&&state.currentSrc[0]["src"]&&state.currentSrc.length==1&&state.currentSrc[0]["src"].indexOf("safestream")>-1)}requiresObj[is360?"videojsvr":isBrightcove?"bc":"videojs"]=function(){if(isM3u8(state)||isHapyakHostedPlayer){return hapyak.api+"/js/vendor/videojs/6.11.0/video.min.js"}if(is360){return hapyak.css360Host+"/css360AMD.js"}if(!isBrightcove){return"//vjs.zencdn.net/4.8/video.js"}return{isPath:true,path:"//players.brightcove.net/"+accountId+"/"+bcPlayer+"_"+bcEmbed+"/index"}};function getFlashShim(api,player,state){var desiredSeekTime,playheadStalled;return{onSeeking:function(){playheadStalled=true;desiredSeekTime=player.currentTime()},isCaughtUp:function(){return player.currentTime()-desiredSeekTime>0},onTimeUpdate:function(){if(playheadStalled){state.setCurrentTime(desiredSeekTime);if(this.isCaughtUp()){playheadStalled=false;state.setCurrentTime(player.currentTime());state.setSeeked()}}else{state.setCurrentTime(player.currentTime())}}}}function sourceLoadErrorHandler(player){var maxReloads=playerConfig.stream_retry_count||5,backoff=playerConfig.stream_retry_interval||250;function handleError(){if(maxReloads>0){setTimeout(function reloadPlayer(){if(state&&state.playing===false){player.src(player.currentSource())}},backoff);maxReloads--;logging.warn("Video Load failed retries: "+maxReloads)}}player.on("error",function(err){var error=player.error(),errorList=playerConfig.stream_error_list||[4];if(error&&_.indexOf(errorList,error.code)>-1){handleError()}})}var wrapperRef={apiRequires:requiresObj,player:function(resources,resolve){var bc=resources.bc,guid=Popcorn.guid("hapyak-videojs4-container"),videojs=resources.videojs,playerSettings={},isDesktopSafari=videojs&&videojs.browser&&videojs.browser.IS_SAFARI&&!videojs.browser.IS_IOS;function accessSecure(){if(options.workflow&&options.workflow.rules&&options.workflow.rules.is_secure){var signature=options.signature,signedUrl=signature["Virtual-Manifest"]+signature["CloudFront-Query-String"];if(state.src[0]){state.src[0].src=encodeURIComponent(signedUrl)}else{options.videoSourceId=signedUrl}}}function setup(){if(window.videojs&&resources.adapter&&resources.adapter.hyrtm&&configuration.provisioning.hiveStream&&configuration.provisioning.hiveStream===true){hy.require(["hive-stream"],function(hiveStream){var hiveCache=new hiveStream(window.videojs,resources.adapter.hyrtm)})}function readyCallback(){player=this;var techName=player.eb||player.techName,firstPlay=false;var videoContainer,playInterval;playerContainer=player.el();videoContainer=playerContainer?playerContainer.querySelector("video"):null;if(["Flash","Hls"].indexOf(techName)>-1&&options.forceReadyState||videoContainer&&videoContainer.preload==="none"){player.on("timeupdate",function onTime(){if(!firstPlay){return}clearInterval(playInterval);if(player.currentTime()>0){player.off("timeupdate",onTime);player.pause();videojsReady(player)}});playInterval=setInterval(function(){player.play();firstPlay=true},1e3)}else{videojsReady(player)}}function videojsReady(api){var videoContainer=playerContainer?playerContainer.querySelector("video"):null,flashShim=getFlashShim(api,player,state);if(videoContainer){player.usingNativeControls(false);videoContainer.controls=false}that.WasteManagement.setup(api,"on","off");var playerResolved=false;if(resources.adapter&&resources.adapter.setupPlayer){resources.adapter.setupPlayer(player)}if(isHapyakHostedPlayer&&options.videoSourceId){sourceLoadErrorHandler(player);player.src({src:options.videoSourceId,type:options.videoSourceId.indexOf(".m3u8")>-1?"application/x-mpegURL":"video/mp4",withCredentials:options.workflow&&options.workflow.rules&&options.workflow.rules.is_secure})}function onLoadedMetaData(){var intrinsicHeight=wrapperRef.videoHeight(),intrinsicWidth=wrapperRef.videoWidth(),width=parent.offsetWidth||wrapperRef.offsetWidth(),height=parent.offsetHeight||wrapperRef.offsetHeight(),duration=utils.dotget(player,"mediainfo.duration")||player.duration();if(intrinsicWidth&&intrinsicHeight){state.setDimensions(intrinsicWidth,intrinsicHeight)}if(height&&width&&(options.forceReadyState||options.isViewer===false)){player.width(width);player.height(height)}if(duration){state.setDuration(duration);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})}}function resolvePlayer(){if(!playerResolved){playerResolved=true;resolve(player)}}function apiReady(){var video,objectElem,readyStateInterval;if(!api.paused()){state.setPlay()}video=playerContainer&&playerContainer.querySelector("video");objectElem=playerContainer&&playerContainer.querySelector("object");if(video&&video.readyState>=1){onLoadedMetaData();resolvePlayer();return}if(objectElem){readyStateInterval=setInterval(function(){var videoWidth=that.videoWidth,videoHeight=that.videoHeight,duration=player.duration();if(!videoWidth||!videoHeight||!duration){return}clearInterval(readyStateInterval);state.setDuration(duration);state.setDimensions(videoWidth,videoHeight);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});resolvePlayer()},250)}}api.on("loadedmetadata",function(){onLoadedMetaData();resolvePlayer()});api.on("durationchange",function(){state.setDuration(utils.dotget(player,"mediainfo.duration")||player.duration());that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})});api.on("volumechange",function(){state.setVolume(player.volume())});api.on("timeupdate",function(){if(player.techName_==="Flash"){flashShim.onTimeUpdate()}else{state.setCurrentTime(player.currentTime())}if(isHapyakHostedPlayer&&!state.haveMetadata()){onLoadedMetaData()}});api.on("ended",function(){state.setEnded(true)});api.on("muted",function(){state.setMuted(!!player.muted())});api.on("pause",function(){state.setPaused()});api.on("play",function(){state.setPlay()});api.on("seeking",function(){state.setSeeking();if(player.techName_==="Flash"){flashShim.onSeeking()}});api.on("seeked",function(){if(player.techName_!=="Flash"){state.setCurrentTime(player.currentTime());state.setSeeked()}});that.WasteManagement.toggleOpenEnrollment(false);that._util.player=player;player.controls(state.controls);apiReady()}if(state.existingPlayer){player=state.src;state.controls=state.controls?true:false;player.ready(function(){playerContainer=player.el();videojsReady(player)})}else{$("<link/>",{rel:"stylesheet",type:"text/css",href:cssUrl}).appendTo(window.document.head);video=$("<video/>",{id:guid,playsinline:"playsinline",css:{width:"100%",height:"100%"},on:{loadedmetadata:function(){state.setDimensions(video.prop("videoWidth"),video.prop("videoHeight"))},canplay:function(){state.setDimensions(video.prop("videoWidth"),video.prop("videoHeight"))}}});if(_.isArray(state.src)){_.forEach(state.src,function(src){var videoSource=decodeURIComponent(src.src||src.url);$("<source/>",{type:src.type||src.mime_type,src:videoSource}).appendTo(video)})}else if(typeof state.src==="string"&&!isBrightcove){state.src=decodeURIComponent(state.src);video.attr("src",state.src)}video.addClass("video-js");if(isBrightcove){video.attr("data-account",accountId);video.attr("data-player",bcPlayer);video.attr("data-embed",bcEmbed);if(state.src!=="00000"){video.attr("data-video-id",state.src)}video.attr("controls","")}else{video.addClass("vjs-controls-enabled");video.addClass("vjs-default-skin")}$(parent).append(video);if(resources&&resources.videojsvr&&resources.videojsvr.Css360){video.attr("crossorigin","anonymous");hapyak.Css360=resources.videojsvr.Css360;hapyak.Css360.create(video[0].parentNode,{video:video[0],id:video[0].dataset.videoId,radar:"true",editMode:utils.dotget(utils.getQueryParams(location.href),"edit")==="true",analytics:false,disableHistoryControllers:true,callback:function startScene(sphere){sphere.vjsPlayer.ready(readyCallback)}})}else if(isBrightcove){bc(document.querySelectorAll("video")[0]);videojs=window.videojs;player=videojs.players[guid];player.ready(readyCallback)}else{if(options.workflow&&options.workflow.rules&&options.workflow.rules.is_secure){playerSettings={html5:{hls:{withCredentials:true}}};if(isDesktopSafari){playerSettings.html5.hls.overrideNative=true;playerSettings.html5.nativeVideoTracks=false;playerSettings.html5.nativeAudioTracks=false;playerSettings.html5.nativeTextTracks=false}}if(isHapyakHostedPlayer){player=videojs(video.attr("id"),playerSettings,readyCallback);sourceLoadErrorHandler(player)}else{videojs(video.attr("id"),playerSettings,readyCallback)}}}}if(isM3u8(state)){window.videojs=videojs;require([hapyak.api+"/js/vendor/videojs/videojs-contrib-hls/5.15.0/contrib-hls.min.js"],function(){accessSecure();if(isSafestream(state)){videojs.Hls.xhr.beforeRequest=function(opts){opts.beforeSend=function(xhr){dao.store.setRequestHeaders(xhr,{"x-hapyak-project":options.projectId})};videojs.Hls.xhr.beforeRequest=null}}setup()});return}setup()},outerContainer:function(){return playerContainer},currentTime:function(time){if(time!==undefined&&player){player.currentTime(time)}},volume:function(value){if(value!==undefined&&player){state.setVolume(value);player.volume(value)}},muted:function(value){if(player){state.setMuted(!!value);player.muted(!!value)}},destroy:function(){if(!state.existingPlayer&&parent&&parent.children&&player){player.dispose()}player=null},width:function(width){if(width!==undefined&&player){player.width(width)}},height:function(height){if(height!==undefined&&player){player.height(height)}},offsetWidth:function(){return playerContainer?playerContainer.offsetWidth:0},offsetHeight:function(){return playerContainer?playerContainer.offsetHeight:0},videoWidth:function(){var video=$("video",playerContainer),width;if(video){width=video.prop("videoWidth")}if(!width){width=getFallbackDimensions("width")}if((isLive||isHapyakHostedPlayer)&&!width){width=getPlayerDimensions(player).width}return width||0},videoHeight:function(){var video=$("video",playerContainer),height;if(video){height=video.prop("videoHeight")}if(!height){height=getFallbackDimensions("height")}if((isLive||isHapyakHostedPlayer)&&!height){height=getPlayerDimensions(player).height}return height||0}};return wrapperRef},{findExisting:function(obj){if(obj&&typeof obj.id==="function"&&typeof obj.el==="function"){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"||_.isArray(src)}})});hy.define("player.profile.brightcove-v2",["popcorn","player.wrappers","player.videojs4"],function(Popcorn,wrappers,HTMLVideojs4VideoElement){Popcorn.HTMLVideojs4VideoElement=HTMLVideojs4VideoElement;wrappers["brightcove-v2"]={id:"brightcove-v2",name:"Brightcove V2",fn:"HTMLVideojs4VideoElement",forceIpadControls:function(player,elements){player.controlBar.el_.style.display="none"},preserveFullscreenStyles:true,preventIOSControls:true,args:function(video,options){return[options.playerParameters]},container:function(container){if(typeof container.el==="function"){container=container.el()}else{container=container.el}return container},modify:function(elements,container){var resizeManagerDiv=container.querySelector(".vjs-resize-manager");if(resizeManagerDiv){container.insertBefore(elements.annotationContainer,resizeManagerDiv.nextSibling);return}container.insertBefore(elements.annotationContainer,container.querySelector(".vjs-text-track-display")||container.querySelector(".vjs-loading-spinner")||container.querySelector(".vjs-big-play-button")||container.querySelector(".vjs-controls")||elements.controlBar||null)}};return wrappers["brightcove-v2"]});(function(window,Popcorn,undefined){var document=window.document,EMPTY_STRING="",MIN_WIDTH=300,MIN_HEIGHT=200,apiScriptElement,apiReadyCallbacks=[],DM,htmlMode,readyStates=[["loadstart"],["durationchange","loadedmetadata"],["loadeddata"],["loadeddata","canplay"],["canplaythrough"]];function isEmbedPlayer(src){return[window.DailymotionPlayer,window.DailymotionPlayerFlash,window.DailymotionPlayerHTML].some(function(DMPlayer){return DMPlayer&&src instanceof DMPlayer})}function findExistingPlayer(src){var val=false;if(!DM){DM=window.DM}if(DM&&DM.Player&&DM.Player._INSTANCES){for(var player in DM.Player._INSTANCES){if(DM.Player._INSTANCES[player]===src){val=true}}}if(!val){val=isEmbedPlayer(src)}return val}function apiReadyPromise(fn){if(!window.DM&&!apiScriptElement){apiScriptElement=document.createElement("script");apiScriptElement.async=true;apiScriptElement.src=(document.location.protocol==="file:"?"http:":document.location.protocol)+"//api.dmcdn.net/all.js";document.head.appendChild(apiScriptElement)}if(window.DM){DM=window.DM;fn()}else{if(!apiReadyCallbacks.length){if(typeof window.dmAsyncInit==="function"){apiReadyCallbacks.push(window.dmAsyncInit)}window.dmAsyncInit=function(){DM=window.DM;while(apiReadyCallbacks.length){apiReadyCallbacks.shift()()}}}apiReadyCallbacks.push(fn)}}function HTMLDailymotionVideoElement(id,options){options=options||{};var self=this,parent=typeof id==="string"?Popcorn.dom.find(id):id,elem,impl={src:EMPTY_STRING,networkState:self.NETWORK_EMPTY,readyState:self.HAVE_NOTHING,seeking:false,autoplay:EMPTY_STRING,preload:EMPTY_STRING,
controls:false,loop:false,poster:EMPTY_STRING,volume:1,muted:0,currentTime:0,duration:NaN,ended:false,paused:true,width:parent.width|0?parent.width:MIN_WIDTH,height:parent.height|0?parent.height:MIN_HEIGHT,error:null,progressAmount:null},forceReadyState=options.forceReadyState,maxReadyState=0,playEventPending=false,playingEventPending=false,playerReady=false,player,existingPlayer,playerEventObject,playerReadyCallbacks=[],stalledTimeout,targetCurrentTime,dmRegex=/video\/([a-z0-9]+)/i,firstPlayingEvent=false,embedPlayer=false,htmlEmbedPlayer=false,info,eventCallbacks={};function playerReadyPromise(fn,unique){var i;if(playerReady){fn();return}if(unique){i=playerReadyCallbacks.indexOf(fn);if(i>=0){playerReadyCallbacks.splice(i,1)}}playerReadyCallbacks.push(fn)}function registerEventListener(name,src){var callback;callback=eventCallbacks[name];if(callback){removeListener(name,callback)}if(typeof src==="function"){callback=function(evt){if(src.call(this,evt)){self.dispatchEvent(name)}}}else{callback=function(){self.dispatchEvent(name)}}eventCallbacks[name]=callback;addListener(name,callback)}function fireEventListener(name){var callback=eventCallbacks[name];if(callback){callback()}}function removeEventListeners(){Popcorn.forEach(eventCallbacks,function(name,callback){removeListener(name,callback)})}function removeListener(name,callback){if(player.removeEventListener){player.removeEventListener(name,callback)}else{$(playerEventObject).off(name,callback)}}function addListener(name,callback){if(player.addEventListener){player.addEventListener(name,callback)}else{$(playerEventObject).on(name,callback)}}function setReadyState(state){var i,queue;if(state<=impl.readyState){return}maxReadyState=Math.max(maxReadyState,state);if(state-impl.readyState>1){return}impl.readyState++;queue=readyStates[impl.readyState];for(i=0;i<queue.length;i++){self.dispatchEvent(queue[i])}setReadyState(maxReadyState)}function destroyPlayer(){clearTimeout(stalledTimeout);if(!(playerReady&&player)){return}player.pause();removeEventListeners();parent.removeChild(elem);elem=null;playerReady=false}function onDurationChange(){impl.duration=embedPlayer?info.duration:player.duration;if(!impl.duration){impl.duration=options.duration}if(impl.readyState<self.HAVE_METADATA){setReadyState(self.HAVE_METADATA)}else{self.dispatchEvent("durationchange")}if(playEventPending){self.dispatchEvent("play")}if(playingEventPending){playingEventPending=false;self.dispatchEvent("playing")}if(playEventPending){playEventPending=false;if(impl.paused){self.dispatchEvent("pause")}}}function onStalled(){if(!impl.duration||impl.progressAmount<impl.duration){impl.networkState=self.NETWORK_IDLE;self.dispatchEvent("stalled")}else{monitorStalled()}}function monitorStalled(){clearTimeout(stalledTimeout);stalledTimeout=setTimeout(onStalled,3e3)}function updateSize(){player.width=impl.width;player.height=impl.height}function changeSrc(aSrc){function getSrc(){if(info&&info.url){return info.url}else if(player.contentInfo&&player.contentInfo.url){return player.contentInfo.url}return player.src}var playerParams;destroyPlayer();impl.readyState=-1;maxReadyState=-1;playEventPending=false;playingEventPending=false;if(impl.networkState!==self.NETWORK_EMPTY){if(impl.networkState===self.NETWORK_LOADING||impl.networkState===self.NETWORK_IDLE){self.dispatchEvent("abort")}self.dispatchEvent("emptied")}if(!impl.paused){if(playerReady){player.pause()}impl.paused=false}impl.seeking=false;impl.duration=NaN;if(impl.currentTime){impl.currentTime=0;self.dispatchEvent("timeupdate")}impl.error=null;if(!aSrc){impl.readyState=self.HAVE_NOTHING;return}if(!self._canPlaySrc(aSrc)){impl.error={name:"MediaError",message:"Media Source Not Supported",code:window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};impl.networkState=self.NETWORK_NO_SRC;self.dispatchEvent("error");return}impl.src=aSrc;impl.networkState=self.NETWORK_LOADING;setReadyState(self.HAVE_NOTHING);apiReadyPromise(function(){function findHTMLPlayer(dmPlayer){if(dmPlayer.implem){if(dmPlayer.implem instanceof window.DailymotionPlayerHTML){return dmPlayer.implem}if(dmPlayer.implem.backend instanceof window.DailymotionPlayerHTML){return dmPlayer.implem.backend}}return false}var videoId,ui;if(!impl.src&&player){destroyPlayer()}existingPlayer=findExistingPlayer(impl.src);if(!existingPlayer){videoId=dmRegex.exec(impl.src)[1];elem=document.createElement("div");parent.appendChild(elem);playerParams={autoplay:+impl.autoplay,annotations:0,info:0,related:0,controls:htmlMode&&"html"||"flash",chromeless:impl.controls?0:1,html:htmlMode,logo:!htmlMode&&1||0};if(forceReadyState){playerParams["advertising-enable"]=0}player=DM.player(elem,{video:videoId,width:impl.width,height:impl.height,params:playerParams});playerEventObject=player}else{embedPlayer=isEmbedPlayer(impl.src);htmlEmbedPlayer=embedPlayer&&findHTMLPlayer(impl.src);player=embedPlayer?htmlEmbedPlayer||impl.src.implem:impl.src;playerEventObject=impl.src.implem||player;info=embedPlayer?impl.src.info||impl.src.contentInfo:null;ui=player.ui;impl.src=getSrc();if(ui&&ui.root&&ui.root[0]){impl.width=ui.root[0].firstChild.offsetWidth||(hapyak.iframed?document.body.offsetWidth:0),impl.height=ui.root[0].firstChild.offsetHeight||(hapyak.iframed?document.body.offsetHeight:0)}else{impl.width=player.offsetWidth;impl.height=player.offsetHeight}impl.duration=embedPlayer?info.duration:player.duration;onDurationChange();if(player.autoplay){impl.autoplay=true}else if(player.options){impl.autoplay=player.options.autoplay}else if(player.params){impl.autoplay=!!player.params.autoplay}else if(/[?&]autoplay=/.test(impl.src)){impl.autoplay=!!+impl.src.split("autoplay=")[1][0]}else{impl.autoplay=false}}function apiReady(){playerReady=true;removeListener("apiready",apiReady);while(playerReadyCallbacks.length){playerReadyCallbacks.shift()()}}if(existingPlayer){if(embedPlayer&&!htmlEmbedPlayer){addListener("canplay",function embedPlayerCanPlay(){removeListener("canplay",embedPlayerCanPlay);apiReady()})}else{apiReady()}}else{addListener("apiready",apiReady)}playerReadyPromise(function(){registerEventListener("error");monitorStalled();function updateProgress(){if(!impl.duration&&player.duration){onDurationChange()}if(player.bufferedTime<Infinity){impl.progressAmount=player.bufferedTime}impl.progressAmount=Math.max(impl.progressAmount,player.currentTime);setReadyState(self.HAVE_CURRENT_DATA);if(impl.progressAmount>=impl.duration){impl.networkState=self.NETWORK_IDLE;setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);setReadyState(self.HAVE_ENOUGH_DATA)}else{impl.networkState=self.NETWORK_LOADING;monitorStalled()}return true}updateProgress();registerEventListener("progress",updateProgress);registerEventListener("stalled",onStalled);registerEventListener("timeupdate",function(){var currentTime=embedPlayer?player.currentTime():player.currentTime;if(impl.currentTime!==currentTime){impl.currentTime=currentTime;self.dispatchEvent("timeupdate")}});registerEventListener("durationchange",onDurationChange);registerEventListener("volumechange",function(){var volume=player.volume;if(impl.volume!==volume){impl.volume=volume;return true}});registerEventListener("canplay",function(){if(!impl.duration&&player.duration){onDurationChange()}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA)});registerEventListener("canplaythrough",function(){setReadyState(self.HAVE_ENOUGH_DATA)});registerEventListener("play",function(){if(impl.paused){impl.paused=false;if(!impl.duration){playEventPending=true}else{return true}}});registerEventListener("seeking",function(){impl.seeking=true;if(impl.paused){self.dispatchEvent("seeking");impl.seeking=false;self.dispatchEvent("seeked")}return true});registerEventListener("seeked",function(){if(impl.seeking){impl.seeking=false;return true}});registerEventListener("playing",function(){if(!impl.duration&&player.duration){onDurationChange()}if(!firstPlayingEvent&&!impl.autoplay){firstPlayingEvent=true}if(!impl.duration){playingEventPending=true;return false}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);if(impl.seeking){impl.seeking=false;self.dispatchEvent("seeked")}return true});registerEventListener("pause",function(){if(!impl.paused){impl.paused=true;return!!impl.duration}});registerEventListener("ended",function(){if(impl.loop){player.seek(0);player.play()}else{impl.ended=true;return true}});if(existingPlayer&&htmlEmbedPlayer){if(htmlEmbedPlayer.player.readyState>=self.HAVE_METADATA){fireEventListener("durationchange");fireEventListener("loadedmetadata")}if(htmlEmbedPlayer.player.readyState>=self.HAVE_CURRENT_DATA){fireEventListener("loadeddata")}if(htmlEmbedPlayer.player.readyState>=self.HAVE_FUTURE_DATA){fireEventListener("canplay")}if(htmlEmbedPlayer.player.readyState>=self.HAVE_ENOUGH_DATA){fireEventListener("canplaythrough")}}if(!impl.autoplay&&!impl.duration){player.play()}})},true)}function setVolume(){player.setVolume(impl.volume)}function getVolume(){return impl.muted>0?impl.muted:impl.volume}function setMuted(){player.api(impl.muted>0?"mute":"unmute")}function getMuted(){return impl.muted>0}function setCurrentTime(){if(targetCurrentTime>=0&&targetCurrentTime<impl.duration){if(htmlEmbedPlayer){player.currentTime(targetCurrentTime)}player.seek(targetCurrentTime);targetCurrentTime=-1}}if(htmlMode===undefined){elem=document.createElement("video");htmlMode=!!(elem.canPlayType&&elem.canPlayType("video/mp4"));elem=null}self._eventNamespace=Popcorn.guid("HTMLDailymotionVideoElement::");self.parentNode=parent;self._util=Popcorn.extend({},self._util);self._util.type="Dailymotion";self.play=function(){function play(){player.play()}playerReadyPromise(play,true)};self.pause=function(){function pause(){player.pause()}playerReadyPromise(pause,true)};self.load=function(){changeSrc(impl.src)};Object.defineProperties(self,{src:{get:function(){return impl.src},set:function(aSrc){if(aSrc!==impl.src){changeSrc(aSrc)}}},autoplay:{get:function(){return impl.autoplay},set:function(aValue){impl.autoplay=self._util.isAttributeSet(aValue)}},loop:{get:function(){return impl.loop},set:function(aValue){impl.loop=self._util.isAttributeSet(aValue)}},width:{get:function(){if(player&&player.player){return player.player.offsetWidth||impl.width}return impl.width},set:function(aValue){impl.width=aValue;playerReadyPromise(updateSize)}},height:{get:function(){if(player&&player.player){return player.player.offsetHeight||impl.height}return impl.height},set:function(aValue){impl.height=aValue;playerReadyPromise(updateSize)}},currentTime:{get:function(){if(player){if(embedPlayer){return player.currentTime()}return player.currentTime}return 0},set:function(aValue){aValue=parseFloat(aValue);targetCurrentTime=aValue;playerReadyPromise(setCurrentTime,true)}},currentSrc:{get:function(){return impl.src}},duration:{get:function(){return impl.duration}},ended:{get:function(){return impl.ended}},paused:{get:function(){return impl.paused}},seeking:{get:function(){return impl.seeking}},readyState:{get:function(){return impl.readyState}},networkState:{get:function(){return impl.networkState}},volume:{get:function(){return getVolume()},set:function(aValue){aValue=parseFloat(aValue);if(aValue<0||aValue>1||isNaN(aValue)){throw new Error("Volume value must be between 0.0 and 1.0")}impl.volume=aValue;playerReadyPromise(setVolume,true);self.dispatchEvent("volumechange")}},muted:{get:function(){return getMuted()},set:function(aValue){impl.muted=self._util.isAttributeSet(aValue)&&1||0;playerReadyPromise(setMuted,true);self.dispatchEvent("volumechange")}},error:{get:function(){return impl.error}}})}HTMLDailymotionVideoElement.prototype=new Popcorn._MediaElementProto;HTMLDailymotionVideoElement.prototype.constructor=HTMLDailymotionVideoElement;HTMLDailymotionVideoElement.prototype._canPlaySrc=function(url){return findExistingPlayer(url)||/dailymotion\.com\/(embed\/)?video\/([a-z0-9]+)/i.test(url)?"probably":EMPTY_STRING};HTMLDailymotionVideoElement.prototype.canPlayType=function(type){return type==="video/x-dailymotion"?"probably":EMPTY_STRING};Popcorn.HTMLDailymotionVideoElement=function(id,options){return new HTMLDailymotionVideoElement(id,options)};Popcorn.HTMLDailymotionVideoElement._canPlaySrc=HTMLDailymotionVideoElement.prototype._canPlaySrc})(this,this.Popcorn);hy.define("popcorn.htmldailymotionvideoelement",function(){});hy.define("player.profile.dailymotion",["player.wrappers","popcorn.htmldailymotionvideoelement"],function(wrappers){wrappers.dailymotion={id:"dailymotion",name:"Dailymotion",fn:"HTMLDailymotionVideoElement",pre:"//www.dailymotion.com/video/",args:function(video,options){return[options.playerParameters]},container:function(container,wrapper){var elem=container.parentNode||document.createElement("div");if(elem.parentNode){return elem}wrapper.addEventListener("canplay",function onDailymotionCanPlay(){wrapper.removeEventListener("canplay",onDailymotionCanPlay,false);if(container.player&&container.player.parentNode){container.player.parentNode.appendChild(elem)}},false);elem.style.position="static";container.ui.root[0].parentNode.appendChild(elem);return elem}};return wrappers.dailymotion});(function(window,Popcorn,undefined){var document=window.document,EMPTY_STRING="",MIN_WIDTH=300,MIN_HEIGHT=200,apiReadyCallbacks=[],htmlMode,readyStates=[["loadstart"],["durationchange","loadedmetadata"],["loadeddata"],["loadeddata","canplay","canplaythrough"]],dataRegex=/dmcdn\.net([a-zA-Z0-9\/\-]+\.swf)/;function findExistingPlayer(src){var data,Pg_Video,DM_Player;Pg_Video=window.Pg_Video;DM_Player=window.DM_Player;if(Pg_Video&&Pg_Video.videoPlayer===src||DM_Player&&DM_Player.players&&DM_Player.players.indexOf(src)>-1){return true}if(src&&src.tagName==="OBJECT"&&src.getAttribute){data=src.getAttribute("data");if(data&&dataRegex.test(data)){return true}}return src&&src.tagName==="OBJECT"&&src.playVideo&&"maybe"}function HTMLDailymotionVideoElementInternal(id){var self=this,parent=typeof id==="string"?Popcorn.dom.find(id):id,elem,impl={src:EMPTY_STRING,networkState:self.NETWORK_EMPTY,readyState:self.HAVE_NOTHING,seeking:false,autoplay:EMPTY_STRING,preload:EMPTY_STRING,controls:false,loop:false,poster:EMPTY_STRING,volume:1,muted:0,currentTime:0,duration:NaN,ended:false,paused:true,width:parent.width|0?parent.width:MIN_WIDTH,height:parent.height|0?parent.height:MIN_HEIGHT,error:null,progressAmount:null,mediaType:null},maxReadyState=0,requestedPlay=false,playEventPending=false,playingEventPending=false,playerReady=false,player,existingPlayer,playerReadyCallbacks=[],stalledTimeout,dmRegex=/video\/([a-z0-9]+)/i,eventCallbacks={},eventGuid=Popcorn.guid();window["hapyakDMCallbacks"+eventGuid]={};function apiReadyPromise(fn){function isApiReady(){if(window.Pg_Video||window.DM_Player&&window.DM_Player.players||impl.src&&impl.src.tagName==="OBJECT"){while(apiReadyCallbacks.length){apiReadyCallbacks.shift()()}return true}setTimeout(isApiReady,100)}if(window.Pg_Video||window.DM_Player&&window.DM_Player.players||impl.src&&impl.src.tagName==="OBJECT"){fn()}else{apiReadyCallbacks.push(fn);setTimeout(isApiReady,100)}}function playerReadyPromise(fn,unique){var i;if(playerReady){fn();return}if(unique){i=playerReadyCallbacks.indexOf(fn);if(i>=0){playerReadyCallbacks.splice(i,1)}}playerReadyCallbacks.push(fn)}function registerEventListener(name,src,dest){var callback;callback=eventCallbacks[name];if(callback){player.removeEventListener(name,callback)}eventCallbacks[name]=src;player.addEventListener(name,eventCallbacks[name])}function removeEventListeners(){Popcorn.forEach(eventCallbacks,function(name,callback){player.removeEventListener(name,callback)})}function setReadyState(state){var i,queue;if(state<=impl.readyState){return}maxReadyState=Math.max(maxReadyState,state);if(state-impl.readyState>1){return}impl.readyState++;queue=readyStates[impl.readyState];for(i=0;i<queue.length;i++){self.dispatchEvent(queue[i])}setReadyState(maxReadyState)}function destroyPlayer(){clearTimeout(stalledTimeout);if(!(playerReady&&player)){return}player.pause();removeEventListeners();parent.removeChild(elem);elem=null}function durationChange(newDuration){var duration=newDuration||player.getDuration();if(!duration||duration===impl.duration){return}impl.duration=duration;if(impl.readyState<self.HAVE_METADATA){setReadyState(self.HAVE_METADATA)}else{self.dispatchEvent("durationchange")}if(playEventPending){self.dispatchEvent("play")}if(playingEventPending){playingEventPending=false;setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);self.dispatchEvent("playing")}if(playEventPending){playEventPending=false;if(impl.paused){self.dispatchEvent("pause")}}}window["hapyakDMCallbacks"+eventGuid].onDurationChange=function(evt){durationChange(+evt.videoDuration.split("sc")[0].toFixed(2));impl.volume=evt.volume};function onStalled(){if(!impl.duration||impl.progressAmount<100){impl.networkState=self.NETWORK_IDLE;self.dispatchEvent("stalled")}else{monitorStalled()}}function monitorStalled(){clearTimeout(stalledTimeout);stalledTimeout=setTimeout(onStalled,3e3)}function updateSize(){player.width=impl.width;player.height=impl.height}function changeSrc(aSrc){destroyPlayer();impl.readyState=-1;maxReadyState=-1;playEventPending=false;playingEventPending=false;if(impl.networkState!==self.NETWORK_EMPTY){if(impl.networkState===self.NETWORK_LOADING||impl.networkState===self.NETWORK_IDLE){self.dispatchEvent("abort")}self.dispatchEvent("emptied")}if(!impl.paused){if(playerReady){player.pause()}impl.paused=false}requestedPlay=!!impl.autoplay;impl.seeking=false;impl.duration=NaN;impl.error=null;if(!aSrc){impl.readyState=self.HAVE_NOTHING;return}if(!self._canPlaySrc(aSrc)){impl.error={name:"MediaError",message:"Media Source Not Supported",code:window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};impl.networkState=self.NETWORK_NO_SRC;self.dispatchEvent("error");return}impl.src=aSrc;impl.networkState=self.NETWORK_LOADING;setReadyState(self.HAVE_NOTHING);apiReadyPromise(function(){var videoId;if(!impl.src){if(player){destroyPlayer()}}existingPlayer=findExistingPlayer(impl.src);if(!existingPlayer){}else{player=impl.src;impl.src=window.Pg_Video?window.Pg_Video.urlFull:impl.src.data;impl.width=parent.offsetWidth;impl.height=parent.offsetHeight;if(/[?&]autoplay=/.test(impl.src)){impl.autoplay=!!+impl.src.split("autoplay=")[1][0]}else{impl.autoplay=false}}function apiReady(){var playVideoIsFunction=typeof player.playVideo==="function",isReady=window.Pg_Video&&window.Pg_Video.playerIsReady||playVideoIsFunction;function playerIsReady(){playerReady=true;while(playerReadyCallbacks.length){playerReadyCallbacks.shift()()}}if(isReady){playerIsReady();return}if(window.DM_Player){isReady=window.DM_Player.players.some(function(obj){return obj.object===player});if(isReady&&playVideoIsFunction){playerIsReady();return}}setTimeout(apiReady,100)}if(existingPlayer){requestedPlay=true;apiReady()}playerReadyPromise(function(){window["hapyakDMCallbacks"+eventGuid].onError=function(){self.dispatchEvent("error")};registerEventListener("onError","window.hapyakDMCallbacks"+eventGuid+".onError"+eventGuid);monitorStalled();window["hapyakDMCallbacks"+eventGuid].updateProgress=function(evt){var volume=player.getVolume()/100,muted=player.isMuted();impl.currentTime=evt.mediaTime;impl.progressAmount=evt.mediaProgress;impl.mediaType=evt.mediaType;if(evt.mediaDuration!==impl.duration){window["hapyakDMCallbacks"+eventGuid].onDurationChange({videoDuration:evt.mediaDuration+"sc",volume:volume})}setReadyState(self.HAVE_CURRENT_DATA);if(impl.progressAmount===100){impl.networkState=self.NETWORK_IDLE;setReadyState(self.HAVE_FUTURE_DATA)}else{impl.networkState=self.NETWORK_LOADING;monitorStalled()}if(impl.volume!==volume||impl.muted!==muted){impl.volume=volume;impl.muted=muted;self.dispatchEvent("volumeChange")}self.dispatchEvent("timeupdate");return true};registerEventListener("onVideoProgress","window.hapyakDMCallbacks"+eventGuid+".updateProgress");registerEventListener("onVideoMetadata","window.hapyakDMCallbacks"+eventGuid+".onDurationChange");window["hapyakDMCallbacks"+eventGuid].onSeek=function(){impl.seeking=true;self.dispatchEvent("seeking");if(impl.seeking){impl.seeking=false;self.dispatchEvent("seeked");return true}};registerEventListener("onSeek","window.hapyakDMCallbacks"+eventGuid+".onSeek");window["hapyakDMCallbacks"+eventGuid].onStateChange=function(state){if(state===0){if(impl.loop){player.seek(0);player.playVideo()}else{impl.ended=true}self.dispatchEvent("ended");return}if(state===1){if(!impl.duration){durationChange()}if(!impl.duration){playingEventPending=true;return false}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);self.dispatchEvent("playing");return}if(state===2){impl.paused=true;self.dispatchEvent("paused")}if(state===3){}};registerEventListener("onStateChange","window.hapyakDMCallbacks"+eventGuid+".onStateChange");if(!impl.duration){if(player.getPlayerState()===1){playingEventPending=true}durationChange()}})},true)}function setVolume(){player.setVolume(impl.volume*100)}function getVolume(){return impl.muted>0?impl.muted:impl.volume}function setMuted(){impl.muted>0?player.mute():player.unMute()}function getMuted(){return impl.muted>0}function setCurrentTime(){player.seekTo(impl.currentTime)}self._eventNamespace=Popcorn.guid("HTMLDailymotionVideoElementInternal::");self.parentNode=parent;self._util=Popcorn.extend({},self._util);self._util.type="Dailymotion";self.play=function(){function play(){player.playVideo()}requestedPlay=true;playerReadyPromise(play,true)};self.pause=function(){function pause(){player.pauseVideo()}playerReadyPromise(pause,true)};self.load=function(){changeSrc(impl.src)};Object.defineProperties(self,{src:{get:function(){return impl.src},set:function(aSrc){if(aSrc!==impl.src){changeSrc(aSrc)}}},autoplay:{get:function(){return impl.autoplay},set:function(aValue){impl.autoplay=self._util.isAttributeSet(aValue)}},loop:{get:function(){return impl.loop},set:function(aValue){impl.loop=self._util.isAttributeSet(aValue)}},width:{get:function(){return parent&&parent.offsetWidth||impl.width},set:function(aValue){impl.width=aValue;playerReadyPromise(updateSize)}},height:{get:function(){return parent&&parent.offsetHeight||impl.height},set:function(aValue){impl.height=aValue;playerReadyPromise(updateSize)}},currentTime:{get:function(){return impl.currentTime},set:function(aValue){aValue=parseFloat(aValue);impl.currentTime=aValue;playerReadyPromise(setCurrentTime,true)}},currentSrc:{get:function(){return impl.src}},duration:{get:function(){return impl.duration}},ended:{get:function(){return impl.ended}},paused:{get:function(){return impl.paused}},seeking:{get:function(){return impl.seeking}},readyState:{get:function(){return impl.readyState}},networkState:{get:function(){return impl.networkState}},volume:{get:function(){return getVolume()},set:function(aValue){aValue=parseFloat(aValue);if(aValue<0||aValue>1||isNaN(aValue)){throw new Error("Volume value must be between 0.0 and 1.0")}impl.volume=aValue;playerReadyPromise(setVolume,true);self.dispatchEvent("volumechange")}},muted:{get:function(){return getMuted()},set:function(aValue){impl.muted=self._util.isAttributeSet(aValue)&&1||0;playerReadyPromise(setMuted,true);self.dispatchEvent("volumechange")}},error:{get:function(){return impl.error}},mediaType:{get:function(){return impl.mediaType}}})}HTMLDailymotionVideoElementInternal.prototype=new Popcorn._MediaElementProto;HTMLDailymotionVideoElementInternal.prototype.constructor=HTMLDailymotionVideoElementInternal;HTMLDailymotionVideoElementInternal.prototype._canPlaySrc=function(url){return findExistingPlayer(url)};HTMLDailymotionVideoElementInternal.prototype.canPlayType=function(type){return type==="video/x-dailymotionInternal"?"probably":EMPTY_STRING};Popcorn.HTMLDailymotionVideoElementInternal=function(id){return new HTMLDailymotionVideoElementInternal(id)};Popcorn.HTMLDailymotionVideoElementInternal._canPlaySrc=HTMLDailymotionVideoElementInternal.prototype._canPlaySrc})(this,this.Popcorn);hy.define("popcorn.htmldailymotionvideoelement.internal",function(){});hy.define("player.profile.dailymotioninternal",["player.wrappers","popcorn.htmldailymotionvideoelement.internal"],function(wrappers){wrappers.dailymotioninternal={id:"dailymotioninternal",name:"Dailymotion",fn:"HTMLDailymotionVideoElementInternal",container:function(container){return container.parentNode}};return wrappers.dailymotioninternal});hy.define("player.dailymotionv5",["virtualmediaelement"],function(VirtualMediaElement){return VirtualMediaElement.register("dailymotionv5",function(state,parent,options){options=options||{};var forceReadyState=options.forceReadyState,me=this,volumeBackup=0;var player;function isHTMLMode(){var elem=document.createElement("video");return!!(elem.canPlayType&&elem.canPlayType("video/mp4"))}function onCanPlay(){if(!state.duration&&player.duration){onDurationChange()}}function onDurationChange(){state.setDuration(player.duration||options.duration);me._util.nextTick(function(){state.setReadyState(me.HAVE_ENOUGH_DATA)})}function updateProgress(){if(!state.duration&&player.duration){onDurationChange()}}function onTimeupdate(){state.setCurrentTime(player.currentTime)}function onVolumeChange(){if(!state.muted){state.setVolume(player.volume);if(!player.volume){state.setMuted(true)}}}function onPlay(){state.setPlay()}function onSeek(){state.setSeeking()}function onSeeked(){state.setCurrentTime(player.currentTime);state.setSeeked()}function onPause(){state.setPaused()}function onEnded(){state.setEnded()}return{apiRequires:{DM:"//api.dmcdn.net/all.js"},player:function(resources,resolve){var DM=resources.DM,htmlMode=isHTMLMode();var height,playerParams,sacrificialContainer,width;function onPlayerReady(){player.removeEventListener("apiready",onPlayerReady);player.addEventListener("progress",updateProgress);player.addEventListener("durationchange",onDurationChange);player.addEventListener("canplay",onCanPlay);player.addEventListener("canplaythrough",onCanPlay);player.addEventListener("timeupdate",onTimeupdate);player.addEventListener("volumechange",onVolumeChange);player.addEventListener("playing",onPlay);player.addEventListener("seeking",onSeek);player.addEventListener("seeked",onSeeked);player.addEventListener("pause",onPause);player.addEventListener("ended",onEnded);state.volume=player.volume;updateProgress();if(forceReadyState){player.addEventListener("playing",function onFirstPlay(){player.removeEventListener("playing",onFirstPlay);player.pause()});player.play()}width=parseInt(state.existingPlayer?player.width:parent.offsetWidth,10);height=parseInt(state.existingPlayer?player.height:parent.offsetHeight,10);state.setDimensions(width,height);resolve(player)}if(state.existingPlayer){player=state.src;onPlayerReady()}else{sacrificialContainer=document.createElement("div");parent.appendChild(sacrificialContainer);playerParams={autoplay:+state.autoplay,annotations:0,info:0,related:0,controls:htmlMode?"html":"flash",chromeless:state.controls?0:1,html:htmlMode,logo:!htmlMode?1:0,GK_PV5:1};if(forceReadyState){playerParams["advertising-enable"]=0}player=DM.player(sacrificialContainer,{video:/video\/([a-z0-9]+)/i.exec(state.src)[1],width:state.width,height:state.height,params:playerParams});if(options.duration){onDurationChange()}player.addEventListener("apiready",onPlayerReady)}},play:function(){if(player){player.play()}},pause:function(){if(player){player.pause()}},currentTime:function(time){if(time!==undefined&&player){player.seek(time)}},volume:function(volume){if(volume!==undefined&&player){player.setVolume(volume)}},muted:function(val){if(player){if(val){volumeBackup=state.volume;player.setVolume(0);state.setMuted(true)}else if(val===false){player.setVolume(volumeBackup);state.setMuted(false)}return state.muted}},destroy:function(){if(player&&player.removeEventListener){player.removeEventListener("progress",updateProgress);player.removeEventListener("durationchange",onDurationChange);player.removeEventListener("canplay",onCanPlay);player.removeEventListener("canplaythrough",onCanPlay);player.removeEventListener("timeupdate",onTimeupdate);player.removeEventListener("volumechange",onVolumeChange);player.removeEventListener("playing",onPlay);player.removeEventListener("seeking",onSeek);player.removeEventListener("seeked",onSeeked);player.removeEventListener("pause",onPause);player.removeEventListener("ended",onEnded)}},width:function(width){if(width!==undefined&&player){player.width=width}},height:function(height){if(height!==undefined&&player){player.height=height}},offsetWidth:function(){return parent&&parent.offsetWidth||0},offsetHeight:function(){return parent&&parent.offsetHeight||0},parentNode:function(){var elem;if(player instanceof Element){elem=player}else if(player&&player.id){elem=document.getElementById(player.id).parentNode}return elem}}},{findExisting:function(obj){if(obj instanceof window.HTMLIFrameElement){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"}})});hy.define("player.profile.dailymotionv5",["popcorn","player.wrappers","player.dailymotionv5"],function(Popcorn,wrappers,HTMLDailymotionV5VideoElement){Popcorn.HTMLDailymotionV5VideoElement=HTMLDailymotionV5VideoElement;wrappers.dailymotionv5={id:"dailymotionv5",name:"Dailymotion V5",fn:"HTMLDailymotionV5VideoElement",pre:"//www.dailymotion.com/video/",args:function(video,options){return[options.playerParameters]},container:function(container,wrapper){var elem=container.parentNode||document.createElement("div");if(elem.parentNode){return elem}wrapper.addEventListener("canplay",function onDailymotionCanPlay(){wrapper.removeEventListener("canplay",onDailymotionCanPlay,false);if(container.player&&container.player.parentNode){container.player.parentNode.appendChild(elem)}},false);elem.style.position="static";container.ui.root[0].parentNode.appendChild(elem);return elem}};return wrappers.dailymotionv5});hy.define("player.flowplayer",["virtualmediaelement","lodash.noconflict","jquery.noconflict"],function(VirtualMediaElement,_,$){var validMediaTypes=["mp4","ogv","webm","flv","m4v","wmv"];function getExtension(src){var idx=src.lastIndexOf(".");return src.substr(idx+1,src.length-idx).split("?")[0]}return VirtualMediaElement.register("flowplayer",function(state,parent){var that=this,player,playedOnce=false,destroyed=false;return{apiRequires:{flowplayer:"//releases.flowplayer.org/5.4.6/flowplayer.js"},player:function(resources,resolve){var flowplayer=resources.flowplayer,flowplayerCss,playlist={};destroyed=false;playedOnce=false;function flowplayerReady(api){that.WasteManagement.setup(api,"bind","unbind");api.conf.keyboard=false;if(!state.existingPlayer&&!state.controls){$(".fp-ui",parent).hide()}function apiReady(){var width,height;player=api;state.setDuration(api.video.duration);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});if(state.existingPlayer){width=parseInt(parent.offsetWidth,10);height=parseInt(parent.offsetHeight,10);parent=document.querySelector(".flowplayer")}if(width>0&&height>0&&width.toString()===parent.offsetWidth&&height.toString()===parent.offsetHeight){state.setDimensions(width,height)}else{state.setDimensions(player.video.width,player.video.height)}resolve(player)}if(api.ready){apiReady()}else{api.bind("ready",apiReady)}api.bind("volume",function(jquery,api,volume){state.setVolume(volume)});api.bind("progress",function(jquery,api,currentTime){state.setCurrentTime(currentTime)});api.bind("finish",function(){state.setEnded(true)});api.bind("mute",function(jquery,api,muted){state.setMuted(muted)});api.bind("pause",function(){state.setPaused()});api.bind("resume",function(){state.setPlay()});api.bind("beforeseek",function(){state.setSeeking()});api.bind("seek",function(){state.setSeeked()});that.WasteManagement.toggleOpenEnrollment(false)}if(state.existingPlayer){player=state.src;flowplayerReady(player)}else{state.src=decodeURIComponent(state.src);flowplayerCss=document.createElement("link")
;flowplayerCss.href="//releases.flowplayer.org/5.4.6/skin/minimalist.css";flowplayerCss.rel="stylesheet";document.head.appendChild(flowplayerCss);parent.id=Popcorn.guid("hapyak-flowplayer-container");flowplayer(flowplayerReady);playlist[getExtension(state.src)]=state.src;$("#"+parent.id).flowplayer({playlist:[[playlist]],adaptiveRatio:true})}},currentTime:function(time){if(player&&time!==undefined&&time>=0){if(time>.1){player.seek(time);return}state.setCurrentTime(time);player.unload()}},volume:function(volume){if(volume!==undefined&&player){state.setVolume(volume);player.volume(volume)}},muted:function(val){if(player){state.setMuted(+val);player.mute(!!val);return!!val}},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){if(width!==undefined&&parent){parent.style.width=width+"px"}},height:function(height){if(height!==undefined&&parent){parent.style.height=height+"px"}},offsetWidth:function(){return parent&&parent.offsetWidth||0},offsetHeight:function(){return parent&&parent.offsetHeight||0},videoWidth:function(){return player&&player.video.width||0},videoHeight:function(){return player&&player.video.height||0}}},{findExisting:function(obj){if(window.flowplayer&&obj.conf&&obj.video&&obj.video.url){return"probably"}return""},canPlaySrc:function(src){if(typeof src!=="string"){return false}return validMediaTypes.indexOf(getExtension(src))>-1}})});hy.define("player.profile.flowplayer",["popcorn","player.wrappers","player.flowplayer"],function(Popcorn,wrappers,HTMLFlowplayerVideoElement){Popcorn.HTMLFlowplayerVideoElement=HTMLFlowplayerVideoElement;wrappers.flowplayer={id:"flowplayer",name:"Flowplayer",fn:"HTMLFlowplayerVideoElement",container:function(container){var parent=document.querySelector(".flowplayer"),isFlowplayer=false;if(parent&&parent.children){isFlowplayer=Array.prototype.some.call(parent.children,function(child){return["VIDEO","OBJECT"].indexOf(child.tagName)>-1})}if(isFlowplayer){return parent}return container}};return wrappers.flowplayer});hy.define("popcorn.htmljplayervideoelement",["require","popcorn","jquery.noconflict","lodash"],function(require,Popcorn,$,_){var document=window.document,EMPTY_STRING="",JPLAYER_SWF_URL="//cdnjs.cloudflare.com/ajax/libs/jplayer/2.5.4/Jplayer.swf",JPLAYER_SCRIPT_URL="//cdnjs.cloudflare.com/ajax/libs/jplayer/2.5.4/jquery.jplayer.min.js",jPlayerJQuery=$,jPlayer,validMediaTypes={mp3:{codec:'audio/mpeg; codecs="mp3"',flashCanPlay:true},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:true},oga:{codec:'audio/ogg; codecs="vorbis"',flashCanPlay:false},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:false},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:false},fla:{codec:"audio/x-flv",flashCanPlay:true},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:true},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:true},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:false},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:false},flv:{codec:"video/x-flv",flashCanPlay:true},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:true}},readyStates=[["loadstart"],["durationchange","loadedmetadata"],["loadeddata"],["loadeddata","canplay"],["canplaythrough"]],jPlayerExtensions={webm:"webmv",mp4:"m4v",ogg:"ogv"};function isJPlayerReady(){var jQuery=_.find([window.$,window.jQuery,$],function(jQuery){return jQuery&&jQuery.jPlayer});if(jQuery){jPlayerJQuery=jQuery;jPlayer=jQuery.jPlayer;return true}return false}function apiReadyPromise(fn){if(isJPlayerReady()){fn()}else{require([JPLAYER_SCRIPT_URL],function(){fn()})}}function findExistingPlayer(obj){if(!isJPlayerReady()||typeof obj==="string"){return false}obj=jPlayerJQuery(obj);return obj.data&&obj.data("jPlayer")&&jPlayer.prototype.instances[obj.data("jPlayer").internal.instance]}function findMediaExtensions(src){var i,l,extension,extensionIdx,result="";if(Array.isArray(src)){for(i=0,l=src.length;i<l;i++){result+=findMediaExtensions(src[i])+","}return result}if(typeof src==="object"){if(src.type&&typeof src.type==="string"){extension=src.type.split("/")[1];return jPlayerExtensions[extension]||extension}}if(typeof src==="string"){extensionIdx=src.lastIndexOf(".");extension=src.substr(extensionIdx+1,src.length-extensionIdx);return jPlayerExtensions[extension]||extension}return result}function HTMLJPlayerVideoElement(id){var self=this,parent=typeof id==="string"?Popcorn.dom.find(id):id,impl={src:EMPTY_STRING,networkState:self.NETWORK_EMPTY,readyState:self.HAVE_NOTHING,seeking:false,autoplay:EMPTY_STRING,preload:EMPTY_STRING,controls:false,loop:false,poster:EMPTY_STRING,volume:1,muted:0,currentTime:0,duration:NaN,ended:false,paused:true,width:parent instanceof jPlayerJQuery?parent.width():parent.offsetWidth,height:parent instanceof jPlayerJQuery?parent.height():parent.offsetHeight,error:null,progressAmount:null},maxReadyState=0,existingPlayer,playEventPending=false,playingEventPending=false,playerReady=false,player,playerObject,srcExtensions="",playerReadyCallbacks=[],stalledTimeout,eventCallbacks={};function playerReadyPromise(fn,unique){var i;if(playerReady){fn();return}if(unique){i=playerReadyCallbacks.indexOf(fn);if(i>=0){playerReadyCallbacks.splice(i,1)}}playerReadyCallbacks.push(fn)}function registerEventListener(name,src,dest){var callback;callback=eventCallbacks[name];if(callback){player.off(jPlayer.event[name],callback)}if(typeof src==="string"){callback=function(){var val;if(!playerObject||!playerObject.status){return}val=playerObject.status[dest||src];if(impl[src]!==val){impl[src]=val;self.dispatchEvent(name)}}}else if(typeof src==="function"){callback=function(evt){if(src.call(this,evt)){self.dispatchEvent(name)}}}else{callback=function(){self.dispatchEvent(name)}}eventCallbacks[name]=callback;player.on(jPlayer.event[name],callback)}function removeEventListeners(){Popcorn.forEach(eventCallbacks,function(name,callback){player.off(jPlayer.event[name],callback)})}function setReadyState(state){var i,queue;if(state<=impl.readyState){return}maxReadyState=Math.max(maxReadyState,state);if(state-impl.readyState>1){return}impl.readyState++;queue=readyStates[impl.readyState];for(i=0;i<queue.length;i++){self.dispatchEvent(queue[i])}setReadyState(maxReadyState)}function destroyPlayer(){clearTimeout(stalledTimeout);if(!(playerReady&&player)){return}removeEventListeners();if(!existingPlayer){player.jPlayer("pause");try{player.jPlayer("destroy")}catch(e){}}player=null;playerObject=null;existingPlayer=null;parent=null;playerReady=false}function onDurationChange(){if(!playerObject){playerObject=jPlayerJQuery(self).data("jPlayer")}if(!playerObject){return}impl.duration=playerObject.status.duration;if(impl.readyState<self.HAVE_METADATA){setReadyState(self.HAVE_METADATA)}else{self.dispatchEvent("durationchange")}if(playEventPending){self.dispatchEvent("play")}if(playingEventPending){playingEventPending=false;self.dispatchEvent("playing")}if(playEventPending){playEventPending=false;if(impl.paused){self.dispatchEvent("pause")}}}function onStalled(){if(!impl.duration||impl.progressAmount<impl.duration){impl.networkState=self.NETWORK_IDLE;self.dispatchEvent("stalled")}else{monitorStalled()}}function monitorStalled(){clearTimeout(stalledTimeout);stalledTimeout=setTimeout(onStalled,3e3)}function updateSize(){var container=playerObject.ancestorJq[0]||playerObject.element[0],video=playerObject.internal.video.jq[0],px="px";container.style.width=impl.width+px;video.style.width=impl.width+px;container.style.height=impl.height+px;video.style.height=impl.height+px}function changeSrc(aSrc){function isJPlayerObject(){return isJPlayerReady()&&typeof aSrc==="object"&&aSrc.data&&jPlayer.prototype.instances[aSrc.data("jPlayer").internal.instance]}if(isJPlayerObject()&&aSrc.data("jPlayer").status.src===impl.src){return}if(!isJPlayerObject()){destroyPlayer()}impl.readyState=-1;maxReadyState=-1;playEventPending=false;playingEventPending=false;if(impl.networkState!==self.NETWORK_EMPTY){if(impl.networkState===self.NETWORK_LOADING||impl.networkState===self.NETWORK_IDLE){self.dispatchEvent("abort")}self.dispatchEvent("emptied")}if(!impl.paused){if(playerReady){player.jPlayer("pause")}impl.paused=false}impl.seeking=false;impl.duration=NaN;if(impl.currentTime){impl.currentTime=0;self.dispatchEvent("timeupdate")}impl.error=null;if(!aSrc){impl.readyState=self.HAVE_NOTHING;return}if(isJPlayerObject()){impl.src=player.data("jPlayer").status.src}else{impl.src=aSrc}impl.networkState=self.NETWORK_LOADING;setReadyState(self.HAVE_NOTHING);apiReadyPromise(function(){if(!impl.src){if(player){destroyPlayer()}}if(!player&&!self._canPlaySrc(aSrc)){impl.error={name:"MediaError",message:"Media Source Not Supported",code:window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};impl.networkState=self.NETWORK_NO_SRC;self.dispatchEvent("error");return}if(!player){player=jPlayerJQuery(parent);srcExtensions=findMediaExtensions(aSrc)}else{playerReady=true;playerObject=player.data("jPlayer");while(playerReadyCallbacks.length){playerReadyCallbacks.shift()()}}player.css({position:"relative"});player.jPlayer({ready:function(){var srcObj={},extensions=srcExtensions.split(","),i,l;playerReady=true;playerObject=player.data("jPlayer");if(Array.isArray(impl.src)){for(i=0,l=impl.src.length;i<l;i++){srcObj[extensions[i]]=impl.src[i].src}}else if(typeof impl.src==="object"){srcObj[srcExtensions]=impl.src.src}else{srcObj[srcExtensions]=impl.src}player.jPlayer("setMedia",srcObj);if(impl.autoplay){player.jPlayer("play")}while(playerReadyCallbacks.length){playerReadyCallbacks.shift()()}},loop:!!impl.loop,size:{width:"100%",height:"100%"},swfPath:JPLAYER_SWF_URL,solution:"html, flash",supplied:srcExtensions});playerReadyPromise(function(){registerEventListener("error");monitorStalled();function updateProgress(){if(!playerObject||!playerObject.status){return}if(!impl.duration&&playerObject.status.duration){onDurationChange()}impl.progressAmount=playerObject.status.seekPercent;impl.progressAmount=Math.max(impl.progressAmount,playerObject.status.currentTime);setReadyState(self.HAVE_CURRENT_DATA);if(impl.progressAmount>=impl.duration){impl.networkState=self.NETWORK_IDLE;setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);setReadyState(self.HAVE_ENOUGH_DATA)}else{impl.networkState=self.NETWORK_LOADING;monitorStalled()}return true}updateProgress();registerEventListener("progress",updateProgress);registerEventListener("stalled",onStalled);registerEventListener("timeupdate","currentTime");registerEventListener("durationchange",onDurationChange);registerEventListener("volumechange",function(){var volume,muted;if(!playerObject||!playerObject.options){return}volume=playerObject.options.volume;muted=playerObject.options.muted;if(impl.volume!==volume||impl.muted!==muted){impl.volume=volume;impl.muted=muted;return true}});registerEventListener("canplay",function(){if(!playerObject||!playerObject.status){return}if(!impl.duration&&playerObject.status.duration){onDurationChange()}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA)});registerEventListener("canplaythrough",function(){setReadyState(self.HAVE_ENOUGH_DATA)});registerEventListener("play",function(){if(impl.paused){impl.paused=false;if(!impl.duration){playEventPending=true}else{return true}}});registerEventListener("seeking",function(){impl.seeking=true;return true});registerEventListener("seeked",function(){if(impl.seeking){impl.seeking=false;return true}});registerEventListener("playing",function(){if(!impl.duration&&playerObject.status.duration){onDurationChange()}if(!impl.duration){playingEventPending=true;return false}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);if(impl.seeking){impl.seeking=false;self.dispatchEvent("seeked")}return true});registerEventListener("pause",function(){if(!impl.paused){impl.paused=true;return!!impl.duration}});registerEventListener("ended",function(){impl.ended=true;return true})})},true)}function setVolume(){player.jPlayer("unmute");impl.muted=0;player.jPlayer("volume",impl.volume)}function getVolume(){return impl.muted>0?impl.muted:impl.volume}function setMuted(){if(!impl.muted){player.jPlayer("unmute")}else{player.jPlayer("mute")}}function getMuted(){return impl.muted>0}function setCurrentTime(){if(impl.paused){player.jPlayer("pause",impl.currentTime)}else{player.jPlayer("play",impl.currentTime)}}existingPlayer=findExistingPlayer(parent);if(existingPlayer){player=existingPlayer;changeSrc(existingPlayer)}self._eventNamespace=Popcorn.guid("HTMLJPlayerVideoElement::");self.parentNode=parent instanceof Element?parent:parent[0];self._util=Popcorn.extend({},self._util);self._util.type="JPlayer";self._util.destroy=function(){destroyPlayer()};self.play=function(){function play(){impl.paused=true;player.jPlayer("play")}playerReadyPromise(play,true)};self.pause=function(){function pause(){player.jPlayer("pause")}playerReadyPromise(pause,true)};self.load=function(){changeSrc(impl.src)};Object.defineProperties(self,{src:{get:function(){return impl.src},set:function(aSrc){if(aSrc!==impl.src){changeSrc(aSrc)}}},autoplay:{get:function(){return impl.autoplay},set:function(aValue){impl.autoplay=self._util.isAttributeSet(aValue)}},loop:{get:function(){return impl.loop},set:function(aValue){impl.loop=self._util.isAttributeSet(aValue)}},controls:{get:function(){return impl.controls},set:function(aValue){impl.controls=self._util.isAttributeSet(aValue)}},width:{get:function(){return player&&player.width()||impl.width},set:function(aValue){impl.width=aValue;playerReadyPromise(updateSize)}},videoWidth:{get:function(){return playerObject?playerObject.status.videoWidth:0}},height:{get:function(){return player&&player.height()||impl.height},set:function(aValue){impl.height=aValue;playerReadyPromise(updateSize)}},videoHeight:{get:function(){return playerObject?playerObject.status.videoHeight:0}},currentTime:{get:function(){return playerObject&&playerObject.status.currentTime||0},set:function(aValue){aValue=parseFloat(aValue);impl.currentTime=aValue;playerReadyPromise(setCurrentTime,true)}},currentSrc:{get:function(){return impl.src}},duration:{get:function(){return impl.duration}},ended:{get:function(){return impl.ended}},paused:{get:function(){return impl.paused}},seeking:{get:function(){return impl.seeking}},readyState:{get:function(){return impl.readyState}},networkState:{get:function(){return impl.networkState}},volume:{get:function(){return getVolume()},set:function(aValue){aValue=parseFloat(aValue);if(aValue<0||aValue>1||isNaN(aValue)){throw new Error("Volume value must be between 0.0 and 1.0")}impl.volume=aValue;playerReadyPromise(setVolume,true)}},muted:{get:function(){return getMuted()},set:function(aValue){impl.muted=self._util.isAttributeSet(aValue)&&1||0;playerReadyPromise(setMuted,true)}},error:{get:function(){return impl.error}}})}HTMLJPlayerVideoElement.prototype=new Popcorn._MediaElementProto;HTMLJPlayerVideoElement.prototype.constructor=HTMLJPlayerVideoElement;HTMLJPlayerVideoElement.prototype._canPlaySrc=function(source){if(findExistingPlayer(source)){return"probably"}var testVideo,extension,mediaTypeObj,result=false,i,l;if(Array.isArray(source)){for(i=0,l=source.length;i<l;i++){result=HTMLJPlayerVideoElement.prototype._canPlaySrc(source[i]);if(result){return result}}return result}if(typeof source==="object"){if(!source.type||typeof source.type!=="string"){return EMPTY_STRING}testVideo=document.createElement("video");result=testVideo.canPlayType(source.type)?"probably":EMPTY_STRING;if(result){return result}extension=findMediaExtensions(source);return validMediaTypes[extension]&&validMediaTypes[extension].flashCanPlay?"probably":EMPTY_STRING}if(typeof source==="string"){extension=findMediaExtensions(source);mediaTypeObj=validMediaTypes[extension];if(!mediaTypeObj){return EMPTY_STRING}testVideo=document.createElement("video");result=testVideo.canPlayType(mediaTypeObj.codec)?"probably":EMPTY_STRING;if(result){return result}return mediaTypeObj.flashCanPlay?"probably":EMPTY_STRING}return EMPTY_STRING};HTMLJPlayerVideoElement.prototype.canPlayType=function(type){var testVideo=document.createElement("video"),canPlay=false,extension;for(extension in validMediaTypes){if(validMediaTypes.hasOwnProperty(extension)&&validMediaTypes[extension].codec===type){canPlay=true;break}}return testVideo.canPlayType(type)||canPlay?"probably":EMPTY_STRING};Popcorn.HTMLJPlayerVideoElement=function(id){return new HTMLJPlayerVideoElement(id)};Popcorn.HTMLJPlayerVideoElement._canPlaySrc=HTMLJPlayerVideoElement.prototype._canPlaySrc;return Popcorn.HTMLJPlayerVideoElement});hy.define("player.profile.jplayer",["player.wrappers","popcorn.htmljplayervideoelement"],function(wrappers){wrappers.jplayer={id:"jplayer",name:"JPlayer",fn:"HTMLJPlayerVideoElement",src:function(video){var arr=[];Popcorn.forEach(video.getCustomProperty("sources"),function(val){arr.push({type:val.mime_type,src:val.url})});return arr},container:function(container){return container.parentNode||container.context}};return wrappers.jplayer});hy.define("player.kaltura",["popcorn","virtualmediaelement"],function(Popcorn,VirtualMediaElement){return VirtualMediaElement.register("kaltura",function(state,parent,options){var that=this,destroyed=false,isNative=false,isTest=false;var player,elem,requirements,containerIframe;if(!options.playerParameters){isTest=true;options.playerParameters=state.src}if(!options.playerParameters.partnerId){isNative=true;requirements={}}if(!isNative){if(!options.playerParameters.wid){options.playerParameters.wid="_"+options.playerParameters.partnerId;options.playerParameters.partnerId=options.playerParameters.partnerId.replace("_","")}requirements={Kaltura:"//cdnapisec.kaltura.com/p/"+options.playerParameters.partnerId+"/sp/"+options.playerParameters.partnerId+"00"+"/embedIframeJs/uiconf_id/"+options.playerParameters.uiConfId+"/partner_id/"+options.playerParameters.partnerId+"?entry_id="+options.playerParameters.entry_id}}return{apiRequires:requirements,player:function(resources,resolve){var videoGuid;function kalturaSetupEvents(player){player.kBind("playerPlayed",function(){state.setPlay()});player.kBind("playerPaused",function(){state.setPaused()});player.kBind("seeked",state.setSeeked);player.kBind("timeupdate",function(){state.setCurrentTime(player.evaluate("{video.player.currentTime}"))});player.kBind("mute",function(){if(state.volume!==0){state.setMuted(true)}});player.kBind("unmute",function(){if(state.volume!==0){state.setMuted(false)}});player.kBind("playerPlayEnd",state.setEnded);player.kBind("volumeChanged",function(volume){state.setVolume(volume.newVolume)});that.WasteManagement.toggleOpenEnrollment(false);state.setDimensions(player.offsetWidth||player.width(),player.offsetHeight||player.height());state.setDuration(player.evaluate("{duration}"));state.setVolume(1);player.sendNotification("changeVolume",1);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA);resolve(player)})}function havePlayer(kalturaPlayer){player=kalturaPlayer;if(!isNative){containerIframe=document.getElementById(elem.id+"_ifp")}else{elem=parent;containerIframe=document.getElementById(elem.id+"_ifp").parentElement}kalturaSetupEvents(kalturaPlayer)}if(!isNative){videoGuid=options.playerParameters.entryId;parent.id=Popcorn.guid("hapyak-kaltura-container");elem=document.createElement("div");elem.id="kaltura_"+videoGuid;elem.style.width=(state.width||640)+"px";elem.style.height=(state.height||360)+"px";parent.appendChild(elem);kWidget.embed({targetId:elem.id,wid:options.playerParameters.wid,uiconf_id:options.playerParameters.uiConfId,entry_id:options.playerParameters.entryId,flashvars:{autoPlay:false,"controlBarContainer.plugin":state.controls,externalInterfaceDisabled:false,controlsHolder:{width:"0%",height:"0",includeInLayout:false,visible:false},ControllerScreenHolder:{width:"0%",height:"0",includeInLayout:false,visible:false}},width:"100%",height:"100%",params:{wmode:"transparent"},readyCallback:function(playerId){player=document.getElementById(elem.id);that.WasteManagement.setup(player,"kBind","kUnbind");player.kBind("mediaReady",function(){havePlayer(player)})}})}else{player=options.player;that.WasteManagement.setup(player,"kBind","kUnbind");player.setKDPAttribute("controlBarContainer","visible",state.controls);havePlayer(player)}},currentTime:function(time){if(player&&time!==undefined&&time>=0){player.sendNotification("doSeek",time)}if(player&&player.evaluate){return player.evaluate("{video.player.currentTime}")}},play:function(){player.sendNotification("doPlay")},pause:function(){player.sendNotification("doPause")},volume:function(volume){if(volume!==undefined&&player){state.setVolume(volume);player.sendNotification("changeVolume",volume)}},muted:function(isMuted){if(state.volume!==0){player.sendNotification("mute");state.setMuted(isMuted);state.setVolume(+!isMuted)}},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children&&player){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){containerIframe.style.width=width+"px"},height:function(height){containerIframe.style.height=height+"px"},offsetWidth:function(){if(player){return player.offsetWidth}return parent&&parent.offsetWidth||0},offsetHeight:function(){if(player){return player.offsetHeight}return parent&&parent.offsetHeight||0},videoWidth:function(){if(player){return player.evaluate("{mediaProxy.sources}")[0].width}else{return state.videoWidth}},videoHeight:function(){if(player){return player.evaluate("{mediaProxy.sources}")[0].height}else{return state.videoHeight}}}},{findExisting:function(obj){if(obj.className==="kWidgetIframeContainer"){return"probably"}else{return""}},canPlaySrc:function(src){if(typeof src==="string"||src.className&&src.className.indexOf("kWidgetIframeContainer")>-1||src.wid){return true}return false},utils:{getPlayerInstance:function(){return player}}})});hy.define("player.profile.kaltura",["popcorn","player.wrappers","player.kaltura"],function(Popcorn,wrappers,HTMLKalturaVideoElement){Popcorn.HTMLKalturaVideoElement=HTMLKalturaVideoElement;wrappers.kaltura={id:"kaltura",name:"Kaltura",fn:"HTMLKalturaVideoElement",args:function(video,options){return[options]},container:function(container){return container},src:function(video,options){var partnerId,uiConfId,sourceId=video.get("source_id"),sourceParams=video.getCustomProperty("source_parameters")||{},subdomain,src;if(options.playerParameters&&options.playerParameters.partnerId){partnerId=options.playerParameters.partnerId}if(options.playerParameters&&options.playerParameters.uiConfId){uiConfId=options.playerParameters.uiConfId}if(options.playerParameters&&options.playerParameters.subdomain){subdomain=options.playerParameters.subdomain}if(!partnerId&&sourceParams){partnerId=sourceParams.partnerId}if(!uiConfId&&sourceParams){uiConfId=sourceParams.uiConfId}if(!subdomain&&sourceParams){subdomain=sourceParams.subdomain}subdomain=subdomain||"cdnapi";src=(window.location.protocol==="file:"?"http:":window.location.protocol)+"//"+subdomain+".kaltura.com/index.php/kwidget/";if(partnerId){src+="wid/"+encodeURIComponent(partnerId)+"/uiconf_id/"+encodeURIComponent(uiConfId)+"/entry_id/"+encodeURIComponent(sourceId)}else{src+=sourceId}return src}};return wrappers.kaltura});!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"===typeof hy.define&&hy.define.amd?hy.define("hls",[],e):"object"==typeof exports?exports.Hls=e():t.Hls=e()}(this,function(){return function(t){function e(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=8)}([function(t,e,r){function i(){}function a(t,e){return e="["+t+"] > "+e}function n(t){var e=self.console[t];return e?function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=a(t,i[0])),e.apply(self.console,i)}:i}function o(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];r.forEach(function(e){u[e]=t[e]?t[e].bind(t):n(e)})}r.d(e,"a",function(){return d}),r.d(e,"b",function(){return h});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l={trace:i,debug:i,log:i,warn:i,info:i,error:i},u=l,d=function(t){if(!0===t||"object"===(void 0===t?"undefined":s(t))){o(t,"debug","log","info","warn","error");try{u.log()}catch(t){u=l}}else u=l},h=u},function(t,e,r){e.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(t,e,r){r.d(e,"b",function(){return i}),r.d(e,"a",function(){return a});var i={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},a={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(t,e,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.d(e,"b",function(){return n});var a=function(){function t(){i(this,t)}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,r){for(var i=r,a=0;t.isHeader(e,r);){a+=10;a+=t._readSize(e,r+6),t.isFooter(e,r+10)&&(a+=10),r+=a}if(a>0)return e.subarray(i,i+a)},t._readSize=function(t,e){var r=0;return r=(127&t[e])<<21,r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3]},t.getTimeStamp=function(e){for(var r=t.getID3Frames(e),i=0;i<r.length;i++){var a=r[i];if(t.isTimeStampFrame(a))return t._readTimeStamp(a)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var r=String.fromCharCode(e[0],e[1],e[2],e[3]),i=t._readSize(e,4);return{type:r,size:i,data:e.subarray(10,10+i)}},t.getID3Frames=function(e){for(var r=0,i=[];t.isHeader(e,r);){var a=t._readSize(e,r+6);r+=10;for(var n=r+a;r+8<n;){var o=t._getFrameData(e.subarray(r)),s=t._decodeFrame(o);s&&i.push(s),r+=o.size+10}t.isFooter(e,r)&&(r+=10)}return i},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),r=1&e[3],i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var r=t._utf8ArrayToStr(e.data,!0),i=new Uint8Array(e.data.subarray(r.length+1));return{key:e.type,info:r,data:i.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var r=1,i=t._utf8ArrayToStr(e.data.subarray(r));r+=i.length+1;var a=t._utf8ArrayToStr(e.data.subarray(r));return{key:e.type,info:i,data:a}}var n=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:n}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var r=1,i=t._utf8ArrayToStr(e.data.subarray(r));r+=i.length+1;var a=t._utf8ArrayToStr(e.data.subarray(r));return{key:e.type,info:i,data:a}}var n=t._utf8ArrayToStr(e.data);return{key:e.type,data:n}},t._utf8ArrayToStr=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.length,i=void 0,a=void 0,n=void 0,o="",s=0;s<r;){if(0===(i=t[s++])&&e)return o;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:a=t[s++],o+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=t[s++],n=t[s++],o+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&n)<<0)}}return o},t}(),n=a._utf8ArrayToStr;e.a=a},function(t,e,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(e,r){i(this,t),this.subtle=e,this.aesIV=r}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}(),l=s,u=function(){function t(e,r){a(this,t),this.subtle=e,this.key=r}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}(),d=u,h=function(){function t(){n(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],
this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],a=r[1],n=r[2],o=r[3],s=this.invSubMix,l=s[0],u=s[1],d=s[2],h=s[3],c=new Uint32Array(256),f=0,p=0,g=0;for(g=0;g<256;g++)c[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var v=p^p<<1^p<<2^p<<3^p<<4;v=v>>>8^255&v^99,t[f]=v,e[v]=f;var y=c[f],m=c[y],b=c[m],E=257*c[v]^16843008*v;i[f]=E<<24|E>>>8,a[f]=E<<16|E>>>16,n[f]=E<<8|E>>>24,o[f]=E,E=16843009*b^65537*m^257*y^16843008*f,l[v]=E<<24|E>>>8,u[v]=E<<16|E>>>16,d[v]=E<<8|E>>>24,h[v]=E,f?(f=y^c[c[c[b^y]]],p^=c[c[p]]):f=p=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var a=this.keySize=e.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);var n=this.ksRows=4*(a+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(n),u=this.invKeySchedule=new Uint32Array(n),d=this.sBox,h=this.rcon,c=this.invSubMix,f=c[0],p=c[1],g=c[2],v=c[3],y=void 0,m=void 0;for(o=0;o<n;o++)o<a?y=l[o]=e[o]:(m=y,o%a==0?(m=m<<8|m>>>24,m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m],m^=h[o/a|0]<<24):a>6&&o%a==4&&(m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m]),l[o]=y=(l[o-a]^m)>>>0);for(s=0;s<n;s++)o=n-s,m=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?m:f[d[m>>>24]]^p[d[m>>>16&255]]^g[d[m>>>8&255]]^v[d[255&m]],u[s]=u[s]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,r){for(var i,a,n=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,l=this.invSubMix,u=l[0],d=l[1],h=l[2],c=l[3],f=this.uint8ArrayToUint32Array_(r),p=f[0],g=f[1],v=f[2],y=f[3],m=new Int32Array(t),b=new Int32Array(m.length),E=void 0,T=void 0,R=void 0,A=void 0,S=void 0,L=void 0,_=void 0,w=void 0,D=void 0,I=void 0,k=void 0,O=void 0,C=this.networkToHostOrderSwap;e<m.length;){for(D=C(m[e]),I=C(m[e+1]),k=C(m[e+2]),O=C(m[e+3]),S=D^o[0],L=O^o[1],_=k^o[2],w=I^o[3],i=4,a=1;a<n;a++)E=u[S>>>24]^d[L>>16&255]^h[_>>8&255]^c[255&w]^o[i],T=u[L>>>24]^d[_>>16&255]^h[w>>8&255]^c[255&S]^o[i+1],R=u[_>>>24]^d[w>>16&255]^h[S>>8&255]^c[255&L]^o[i+2],A=u[w>>>24]^d[S>>16&255]^h[L>>8&255]^c[255&_]^o[i+3],S=E,L=T,_=R,w=A,i+=4;E=s[S>>>24]<<24^s[L>>16&255]<<16^s[_>>8&255]<<8^s[255&w]^o[i],T=s[L>>>24]<<24^s[_>>16&255]<<16^s[w>>8&255]<<8^s[255&S]^o[i+1],R=s[_>>>24]<<24^s[w>>16&255]<<16^s[S>>8&255]<<8^s[255&L]^o[i+2],A=s[w>>>24]<<24^s[S>>16&255]<<16^s[L>>8&255]<<8^s[255&_]^o[i+3],i+=3,b[e]=C(E^p),b[e+1]=C(A^g),b[e+2]=C(R^v),b[e+3]=C(T^y),p=D,g=I,v=k,y=O,e+=4}return b.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),c=h,f=r(2),p=r(0),g=function(){function t(e,r){o(this,t),this.observer=e,this.config=r,this.logEnabled=!0;try{var i=crypto||self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(t){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function(t,e,r,i){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(p.b.log("JS AES decrypt"),this.logEnabled=!1);var n=this.decryptor;n||(this.decryptor=n=new c),n.expandKey(e),i(n.decrypt(t,0,r))}else{this.logEnabled&&(p.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var o=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new d(o,e)),this.fastAesKey.expandKey().then(function(n){new l(o,r).decrypt(t,n).catch(function(n){a.onWebCryptoError(n,t,e,r,i)}).then(function(t){i(t)})}).catch(function(n){a.onWebCryptoError(n,t,e,r,i)})}},t.prototype.onWebCryptoError=function(t,e,r,i,a){this.config.enableSoftwareAES?(p.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,r,i,a)):(p.b.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:f.b.MEDIA_ERROR,details:f.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.a=g},function(t,e){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t}function n(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,r,a,s,l,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var d=new Error('Uncaught, unspecified "error" event. ('+e+")");throw d.context=e,d}if(r=this._events[t],o(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(n(r))for(s=Array.prototype.slice.call(arguments,1),u=r.slice(),a=u.length,l=0;l<a;l++)u[l].apply(this,s);return!0},r.prototype.addListener=function(t,e){var a;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?n(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,n(this._events[t])&&!this._events[t].warned&&(a=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[t].length>a&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function r(){this.removeListener(t,r),a||(a=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var a=!1;return r.listener=e,this.on(t,r),this},r.prototype.removeListener=function(t,e){var r,a,o,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=this._events[t],o=r.length,a=-1,r===e||i(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(n(r)){for(s=o;s-- >0;)if(r[s]===e||r[s].listener&&r[s].listener===e){a=s;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[t],i(r))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,r){!function(e){var r=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/;?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var a=this.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");return a.path=o.normalizePath(a.path),o.buildURLFromParts(a)}var n=this.parseURL(e);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=o.normalizePath(n.path),o.buildURLFromParts(n)):e;var s=this.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(u.netLoc=s.netLoc,"/"!==n.path[0]))if(n.path){var d=s.path,h=d.substring(0,d.lastIndexOf("/")+1)+n.path;u.path=o.normalizePath(h)}else u.path=s.path,n.params||(u.params=s.params,n.query||(u.query=s.query));return null===u.path&&(u.path=r.alwaysNormalize?o.normalizePath(n.path):n.path),o.buildURLFromParts(u)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(a,"");t.length!==(t=t.replace(n,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=o}()},function(t,e,r){function i(t,e,r,i){var a,n,o,s,l,u=navigator.userAgent.toLowerCase(),d=i,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return a=1+((192&e[r+2])>>>6),(n=(60&e[r+2])>>>2)>h.length-1?void t.trigger(Event.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+n}):(s=(1&e[r+2])<<2,s|=(192&e[r+3])>>>6,w.b.log("manifest codec:"+i+",ADTS data:type:"+a+",sampleingIndex:"+n+"["+h[n]+"Hz],channelConfig:"+s),/firefox/i.test(u)?n>=6?(a=5,l=new Array(4),o=n-3):(a=2,l=new Array(2),o=n):-1!==u.indexOf("android")?(a=2,l=new Array(2),o=n):(a=5,l=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&n>=6?o=n-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(n>=6&&1===s||/vivaldi/i.test(u))||!i&&1===s)&&(a=2,l=new Array(2)),o=n)),l[0]=a<<3,l[0]|=(14&n)>>1,l[1]|=(1&n)<<7,l[1]|=s<<3,5===a&&(l[1]|=(14&o)>>1,l[2]=(1&o)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:h[n],channelCount:s,codec:"mp4a.40."+a,manifestCodec:d})}function a(t,e){return 255===t[e]&&240==(246&t[e+1])}function n(t,e){return 1&t[e+1]?7:9}function o(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function s(t,e){return!!(e+1<t.length&&a(t,e))}function l(t,e){if(e+1<t.length&&a(t,e)){var r=n(t,e),i=r;e+5<t.length&&(i=o(t,e));var s=e+i;if(s===t.length||s+1<t.length&&a(t,s))return!0}return!1}function u(t,e,r,a,n){if(!t.samplerate){var o=i(e,r,a,n);t.config=o.config,t.samplerate=o.samplerate,t.channelCount=o.channelCount,t.codec=o.codec,t.manifestCodec=o.manifestCodec,w.b.log("parsed codec:"+t.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)}}function d(t){return 9216e4/t}function h(t,e,r,i,a){var s,l,u,d=t.length;if(s=n(t,e),l=o(t,e),(l-=s)>0&&e+s+l<=d)return u=r+i*a,{headerLength:s,frameLength:l,stamp:u}}function c(t,e,r,i,a){var n=d(t.samplerate),o=h(e,r,i,a,n);if(o){var s=o.stamp,l=o.headerLength,u=o.frameLength,c={unit:e.subarray(r+l,r+l+u),pts:s,dts:s};return t.samples.push(c),t.len+=u,{sample:c,length:u+l}}}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var S=r(1),L=r(2),_=r(4),w=r(0),D=r(3),I=function(){function t(e,r,i){f(this,t),this.observer=e,this.config=i,this.remuxer=r}return t.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){if(!t)return!1;for(var e=D.a.getID3Data(t,0)||[],r=e.length,i=t.length;r<i;r++)if(l(t,r))return w.b.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(t,e,r,i){for(var a=this._audioTrack,n=D.a.getID3Data(t,0)||[],o=D.a.getTimeStamp(n),l=o?90*o:9e4*e,d=0,h=l,f=t.length,p=n.length,g=[{pts:h,dts:h,data:n}];p<f-1;)if(s(t,p)&&p+5<f){u(a,this.observer,t,p,a.manifestCodec);var v=c(a,t,p,l,d);if(!v){w.b.log("Unable to parse AAC frame");break}p+=v.length,h=v.sample.pts,d++}else D.a.isHeader(t,p)?(n=D.a.getID3Data(t,p),g.push({pts:h,dts:h,data:n}),p+=n.length):p++;this.remuxer.remux(a,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},e,r,i)},t.prototype.destroy=function(){},t}(),k=I,O=Math.pow(2,32)-1,C=function(){function t(e,r){p(this,t),this.observer=e,this.remuxer=r}return t.prototype.resetTimeStamp=function(t){this.initPTS=t},t.prototype.resetInitSegment=function(e,r,i,a){if(e&&e.byteLength){var n=this.initData=t.parseInitSegment(e);null==r&&(r="mp4a.40.5"),null==i&&(i="avc1.42e01e");var o={};n.audio&&n.video?o.audiovideo={container:"video/mp4",codec:r+","+i,initSegment:a?e:null}:(n.audio&&(o.audio={container:"audio/mp4",codec:r,initSegment:a?e:null}),n.video&&(o.video={container:"video/mp4",codec:i,initSegment:a?e:null})),this.observer.trigger(S.a.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else r&&(this.audioCodec=r),i&&(this.videoCodec=i)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var r=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return r<0?4294967296+r:r},t.writeUint32=function(t,e,r){t.data&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r},t.findBox=function(e,r){var i,a,n,o,s,l,u,d=[];if(e.data?(l=e.start,o=e.end,e=e.data):(l=0,o=e.byteLength),!r.length)return null;for(i=l;i<o;)a=t.readUint32(e,i),n=t.bin2str(e.subarray(i+4,i+8)),u=a>1?i+a:o,n===r[0]&&(1===r.length?d.push({data:e,start:i+8,end:u}):(s=t.findBox({data:e,start:i+8,end:u},r.slice(1)),s.length&&(d=d.concat(s)))),i=u;return d},t.parseInitSegment=function(e){var r=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var i=t.findBox(e,["tkhd"])[0];if(i){var a=i.data[i.start],n=0===a?12:20,o=t.readUint32(i,n),s=t.findBox(e,["mdia","mdhd"])[0];if(s){a=s.data[s.start],n=0===a?12:20;var l=t.readUint32(s,n),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var d=t.bin2str(u.data.subarray(u.start+8,u.start+12)),h={soun:"audio",vide:"video"}[d];if(h){var c=t.findBox(e,["mdia","minf","stbl","stsd"]);if(c.length){c=c[0];var f=t.bin2str(c.data.subarray(c.start+12,c.start+16));w.b.log("MP4Demuxer:"+h+":"+f+" found")}r[o]={timescale:l,type:h},r[h]={timescale:l,id:o}}}}}}),r},t.getStartDTS=function(e,r){var i,a,n;return i=t.findBox(r,["moof","traf"]),a=[].concat.apply([],i.map(function(r){return t.findBox(r,["tfhd"]).map(function(i){var a,n;return a=t.readUint32(i,4),n=e[a].timescale||9e4,t.findBox(r,["tfdt"]).map(function(e){var r,i;return r=e.data[e.start],i=t.readUint32(e,4),1===r&&(i*=Math.pow(2,32),i+=t.readUint32(e,8)),i})[0]/n})})),n=Math.min.apply(null,a),isFinite(n)?n:0},t.offsetStartDTS=function(e,r,i){t.findBox(r,["moof","traf"]).map(function(r){return t.findBox(r,["tfhd"]).map(function(a){var n=t.readUint32(a,4),o=e[n].timescale||9e4;t.findBox(r,["tfdt"]).map(function(e){var r=e.data[e.start],a=t.readUint32(e,4);if(0===r)t.writeUint32(e,4,a-i*o);else{a*=Math.pow(2,32),a+=t.readUint32(e,8),a-=i*o,a=Math.max(a,0);var n=Math.floor(a/(O+1)),s=Math.floor(a%(O+1));t.writeUint32(e,4,n),t.writeUint32(e,8,s)}})})})},t.prototype.append=function(e,r,i,a){var n=this.initData;n||(this.resetInitSegment(e,this.audioCodec,this.videoCodec),n=this.initData);var o=void 0,s=this.initPTS;if(void 0===s){var l=t.getStartDTS(n,e);this.initPTS=s=l-r,this.observer.trigger(S.a.INIT_PTS_FOUND,{initPTS:s})}t.offsetStartDTS(n,e,s),o=t.getStartDTS(n,e),this.remuxer.remux(n.audio,n.video,null,null,o,i,a,e)},t.prototype.destroy=function(){},t}(),P=C,x={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,r,i,a){if(!(r+24>e.length)){var n=this.parseHeader(e,r);if(n&&r+n.frameLength<=e.length){var o=9e4*n.samplesPerFrame/n.sampleRate,s=i+a*o,l={unit:e.subarray(r,r+n.frameLength),pts:s,dts:s};return t.config=[],t.channelCount=n.channelCount,t.samplerate=n.sampleRate,t.samples.push(l),t.len+=n.frameLength,{sample:l,length:n.frameLength}}}},parseHeader:function(t,e){var r=t[e+1]>>3&3,i=t[e+1]>>1&3,a=t[e+2]>>4&15,n=t[e+2]>>2&3,o=t[e+2]>>1&1;if(1!==r&&0!==a&&15!==a&&3!==n){var s=3===r?3-i:3===i?3:4,l=1e3*x.BitratesMap[14*s+a-1],u=3===r?0:2===r?1:2,d=x.SamplingRateMap[3*u+n],h=t[e+3]>>6==3?1:2,c=x.SamplesCoefficients[r][i],f=x.BytesInSlot[i],p=8*c*f;return{sampleRate:d,channelCount:h,frameLength:parseInt(c*l/d+o,10)*f,samplesPerFrame:p}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var r=this.parseHeader(t,e),i=4;r&&r.frameLength&&(i=r.frameLength);var a=e+i;if(a===t.length||a+1<t.length&&this.isHeaderPattern(t,a))return!0}return!1}},F=x,N=function(){function t(e){g(this,t),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),a=Math.min(4,e);if(0===a)throw new Error("no bytes available");i.set(t.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},t.prototype.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return t>32&&w.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0&&this.bitsAvailable?r<<e|this.readBits(e):r},t.prototype.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e,r,i=8,a=8;for(e=0;e<t;e++)0!==a&&(r=this.readEG(),a=(i+r+256)%256),i=0===a?i:a},t.prototype.readSPS=function(){var t,e,r,i,a,n,o,s=0,l=0,u=0,d=0,h=this.readUByte.bind(this),c=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),g=this.skipBits.bind(this),v=this.skipEG.bind(this),y=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(h(),t=h(),c(5),g(3),h(),y(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var b=f();if(3===b&&g(1),y(),y(),g(1),p())for(n=3!==b?8:12,o=0;o<n;o++)p()&&m(o<6?16:64)}y();var E=f();if(0===E)f();else if(1===E)for(g(1),v(),v(),e=f(),o=0;o<e;o++)v();y(),g(1),r=f(),i=f(),a=c(1),0===a&&g(1),g(1),p()&&(s=f(),l=f(),u=f(),d=f());var T=[1,1];if(p()&&p()){switch(h()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[h()<<8|h(),h()<<8|h()]}}return{width:Math.ceil(16*(r+1)-2*s-2*l),height:(2-a)*(i+1)*16-(a?2:4)*(u+d),pixelRatio:T}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),M=N,U=function(){function t(e,r,i,a){v(this,t),this.decryptdata=i,this.discardEPB=a,this.decrypter=new _.a(e,r)}return t.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},t.prototype.decryptAacSample=function(t,e,r,i){var a=t[e].unit,n=a.subarray(16,a.length-a.length%16),o=n.buffer.slice(n.byteOffset,n.byteOffset+n.length),s=this;this.decryptBuffer(o,function(n){n=new Uint8Array(n),a.set(n,16),i||s.decryptAacSamples(t,e+1,r)})},t.prototype.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},t.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,a=32;a<=t.length-16;a+=160,i+=16)r.set(t.subarray(a,a+16),i);return r},t.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var r=0,i=32;i<=t.length-16;i+=160,r+=16)t.set(e.subarray(r,r+16),i);return t},t.prototype.decryptAvcSample=function(t,e,r,i,a,n){var o=this.discardEPB(a.data),s=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(s.buffer,function(s){a.data=l.getAvcDecryptedUnit(o,s),n||l.decryptAvcSamples(t,e,r+1,i)})},t.prototype.decryptAvcSamples=function(t,e,r,i){for(;;e++,r=0){if(e>=t.length)return void i();for(var a=t[e].units;!(r>=a.length);r++){var n=a[r];if(!(n.length<=48||1!==n.type&&5!==n.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,n,o),!o)return}}}},t}(),B=U,G={video:0,audio:1,id3:2,text:3},j=function(){function t(e,r,i,a){y(this,t),this.observer=e,this.config=i,this.typeSupported=a,this.remuxer=r,this.sampleAes=null}return t.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new B(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var r=t._syncOffset(e);return!(r<0)&&(r&&w.b.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),!0)},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:G[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},t.prototype.resetInitSegment=function(e,r,i,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",a),this._audioTrack=t.createTrack("audio",a),this._id3Track=t.createTrack("id3",a),this._txtTrack=t.createTrack("text",a),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=i,this._duration=a},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,r,i,a){var n,o,s,l,u,d=e.length,h=!1;this.contiguous=i;var c=this.pmtParsed,f=this._avcTrack,p=this._audioTrack,g=this._id3Track,v=f.pid,y=p.pid,m=g.pid,b=this._pmtId,E=f.pesData,T=p.pesData,R=g.pesData,A=this._parsePAT,_=this._parsePMT,D=this._parsePES,I=this._parseAVCPES.bind(this),k=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),C=this._parseID3PES.bind(this),P=t._syncOffset(e);for(d-=(d+P)%188,n=P;n<d;n+=188)if(71===e[n]){if(o=!!(64&e[n+1]),s=((31&e[n+1])<<8)+e[n+2],(48&e[n+3])>>4>1){if((l=n+5+e[n+4])===n+188)continue}else l=n+4;switch(s){case v:o&&(E&&(u=D(E))&&I(u,!1),E={data:[],size:0}),E&&(E.data.push(e.subarray(l,n+188)),E.size+=n+188-l);break;case y:o&&(T&&(u=D(T))&&(p.isAAC?k(u):O(u)),T={data:[],size:0}),T&&(T.data.push(e.subarray(l,n+188)),T.size+=n+188-l);break;case m:o&&(R&&(u=D(R))&&C(u),R={data:[],size:0}),R&&(R.data.push(e.subarray(l,n+188)),R.size+=n+188-l);break;case 0:o&&(l+=e[l]+1),b=this._pmtId=A(e,l);break;case b:o&&(l+=e[l]+1);var x=_(e,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);v=x.avc,v>0&&(f.pid=v),y=x.audio,y>0&&(p.pid=y,p.isAAC=x.isAAC),m=x.id3,m>0&&(g.pid=m),h&&!c&&(w.b.log("reparse from beginning"),h=!1,n=P-188),c=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});E&&(u=D(E))?(I(u,!0),f.pesData=null):f.pesData=E,T&&(u=D(T))?(p.isAAC?k(u):O(u),p.pesData=null):(T&&T.size&&w.b.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=T),R&&(u=D(R))?(C(u),g.pesData=null):g.pesData=R,null==this.sampleAes?this.remuxer.remux(p,f,g,this._txtTrack,r,i,a):this.decryptAndRemux(p,f,g,this._txtTrack,r,i,a)},t.prototype.decryptAndRemux=function(t,e,r,i,a,n,o){if(t.samples&&t.isAAC){var s=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){s.decryptAndRemuxAvc(t,e,r,i,a,n,o)})}else this.decryptAndRemuxAvc(t,e,r,i,a,n,o)},t.prototype.decryptAndRemuxAvc=function(t,e,r,i,a,n,o){if(e.samples){var s=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){s.remuxer.remux(t,e,r,i,a,n,o)})}else this.remuxer.remux(t,e,r,i,a,n,o)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},t.prototype._parsePMT=function(t,e,r,i){var a,n,o,s,l={audio:-1,avc:-1,id3:-1,isAAC:!0};for(a=(15&t[e+1])<<8|t[e+2],n=e+3+a-4,o=(15&t[e+10])<<8|t[e+11],e+=12+o;e<n;){switch(s=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!i){w.b.log("unkown stream type:"+t[e]);break}case 15:-1===l.audio&&(l.audio=s);break;case 21:-1===l.id3&&(l.id3=s);break;case 219:if(!i){w.b.log("unkown stream type:"+t[e]);break}case 27:-1===l.avc&&(l.avc=s);break;case 3:case 4:r?-1===l.audio&&(l.audio=s,l.isAAC=!1):w.b.log("MPEG audio found, not supported in this browser for now");break;case 36:w.b.warn("HEVC stream type found, not supported for now");break;default:w.b.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return l},t.prototype._parsePES=function(t){var e,r,i,a,n,o,s,l,u=0,d=t.data;if(!t||0===t.size)return null;for(;d[0].length<19&&d.length>1;){var h=new Uint8Array(d[0].length+d[1].length);h.set(d[0]),h.set(d[1],d[0].length),d[0]=h,d.splice(1,1)}if(e=d[0],1===(e[0]<<16)+(e[1]<<8)+e[2]){if((i=(e[4]<<8)+e[5])&&i>t.size-6)return null;r=e[7],192&r&&(o=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,o>4294967295&&(o-=8589934592),64&r?(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,s>4294967295&&(s-=8589934592),o-s>54e5&&(w.b.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),a=e[8],l=a+9,t.size-=l,n=new Uint8Array(t.size);for(var c=0,f=d.length;c<f;c++){e=d[c];var p=e.byteLength;if(l){if(l>p){l-=p;continue}e=e.subarray(l),p-=l,l=0}n.set(e,u),u+=p}return i&&(i-=a+3),{data:n,pts:o,dts:s,len:i}}return null},t.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var r=e.samples,i=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(i||this.contiguous)?(t.id=i,r.push(t)):e.dropped++}t.debug.length&&w.b.log(t.pts+"/"+t.dts+":"+t.debug)},t.prototype._parseAVCPES=function(t,e){var r,i,a,n=this,o=this._avcTrack,s=this._parseAVCNALu(t.data),l=this.avcSample,u=!1,d=this.pushAccesUnit.bind(this),h=function(t,e,r,i){return{key:t,pts:e,dts:r,units:[],debug:i}};t.data=null,l&&s.length&&!o.audFound&&(d(l,o),l=this.avcSample=h(!1,t.pts,t.dts,"")),s.forEach(function(e){switch(e.type){case 1:i=!0,l||(l=n.avcSample=h(!0,t.pts,t.dts,"")),l.frame=!0;var s=e.data;if(u&&s.length>4){var c=new M(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(l.key=!0)}break;case 5:i=!0,l||(l=n.avcSample=h(!0,t.pts,t.dts,"")),l.key=!0,l.frame=!0;break;case 6:i=!0,r=new M(n.discardEPB(e.data)),r.readUByte();for(var f=0,p=0,g=!1,v=0;!g&&r.bytesAvailable>1;){f=0;do{v=r.readUByte(),f+=v}while(255===v);p=0;do{v=r.readUByte(),p+=v}while(255===v);if(4===f&&0!==r.bytesAvailable){g=!0;if(181===r.readUByte()){if(49===r.readUShort()){if(1195456820===r.readUInt()){if(3===r.readUByte()){var y=r.readUByte(),m=r.readUByte(),b=31&y,E=[y,m];for(a=0;a<b;a++)E.push(r.readUByte()),E.push(r.readUByte()),E.push(r.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{type:3,pts:t.pts,bytes:E})}}}}}else if(p<r.bytesAvailable)for(a=0;a<p;a++)r.readUByte()}break;case 7:if(i=!0,u=!0,!o.sps){r=new M(e.data);var T=r.readSPS();o.width=T.width,o.height=T.height,o.pixelRatio=T.pixelRatio,o.sps=[e.data],o.duration=n._duration;var R=e.data.subarray(1,4),A="avc1.";for(a=0;a<3;a++){var S=R[a].toString(16);S.length<2&&(S="0"+S),A+=S}o.codec=A}break;case 8:i=!0,o.pps||(o.pps=[e.data]);break;case 9:i=!1,o.audFound=!0,l&&d(l,o),l=n.avcSample=h(!1,t.pts,t.dts,"");break;case 12:i=!1;break;default:i=!1,l&&(l.debug+="unknown NAL "+e.type+" ")}if(l&&i){l.units.push(e)}}),e&&l&&(d(l,o),this.avcSample=null)},t.prototype._insertSampleInOrder=function(t,e){var r=t.length;if(r>0){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;i>=0;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)},t.prototype._getLastNalUnit=function(){var t=this.avcSample,e=void 0;if(!t||0===t.units.length){var r=this._avcTrack,i=r.samples;t=i[i.length-1]}if(t){var a=t.units;e=a[a.length-1]}return e},t.prototype._parseAVCNALu=function(t){var e,r,i,a,n,o=0,s=t.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,h=[],c=-1;for(-1===u&&(c=0,n=31&t[0],u=0,o=1);o<s;)if(e=t[o++],u)if(1!==u)if(e)if(1===e){if(c>=0)i={data:t.subarray(c,o-u-1),type:n},h.push(i);else{var f=this._getLastNalUnit();if(f&&(d&&o<=4-d&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-d)),(r=o-u-1)>0)){var p=new Uint8Array(f.data.byteLength+r);p.set(f.data,0),p.set(t.subarray(0,r),f.data.byteLength),f.data=p}}o<s?(a=31&t[o],c=o,n=a,u=0):u=-1}else u=0;else u=3;else u=e?0:2;else u=e?0:1;if(c>=0&&u>=0&&(i={data:t.subarray(c,s),type:n,state:u},h.push(i)),0===h.length){var g=this._getLastNalUnit();if(g){var v=new Uint8Array(g.data.byteLength+t.byteLength);v.set(g.data,0),v.set(t,g.data.byteLength),g.data=v}}return l.naluState=u,h},t.prototype.discardEPB=function(t){
for(var e,r,i=t.byteLength,a=[],n=1;n<i-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return t;e=i-a.length,r=new Uint8Array(e);var o=0;for(n=0;n<e;o++,n++)o===a[0]&&(o++,a.shift()),r[n]=t[o];return r},t.prototype._parseAACPES=function(t){var e,r,i,a,n,o=this._audioTrack,l=t.data,h=t.pts,f=this.aacOverFlow,p=this.aacLastPTS;if(f){var g=new Uint8Array(f.byteLength+l.byteLength);g.set(f,0),g.set(l,f.byteLength),l=g}for(i=0,n=l.length;i<n-1&&!s(l,i);i++);if(i){var v,y;if(i<n-1?(v="AAC PES did not start with ADTS header,offset:"+i,y=!1):(v="no ADTS header found in AAC PES",y=!0),w.b.warn("parsing error:"+v),this.observer.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:y,reason:v}),y)return}if(u(o,this.observer,l,i,this.audioCodec),r=0,e=d(o.samplerate),f&&p){var m=p+e;Math.abs(m-h)>1&&(w.b.log("AAC: align PTS for overlapping frames by "+Math.round((m-h)/90)),h=m)}for(;i<n;)if(s(l,i)&&i+5<n){var b=c(o,l,i,h,r);if(!b)break;i+=b.length,a=b.sample.pts,r++}else i++;f=i<n?l.subarray(i,n):null,this.aacOverFlow=f,this.aacLastPTS=a},t.prototype._parseMPEGPES=function(t){for(var e=t.data,r=e.length,i=0,a=0,n=t.pts;a<r;)if(F.isHeader(e,a)){var o=F.appendFrame(this._audioTrack,e,a,n,i);if(!o)break;a+=o.length,i++}else a++},t.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},t}(),H=j,K=function(){function t(e,r,i){m(this,t),this.observer=e,this.config=i,this.remuxer=r}return t.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){var e,r,i=D.a.getID3Data(t,0);if(i&&void 0!==D.a.getTimeStamp(i))for(e=i.length,r=Math.min(t.length-1,e+100);e<r;e++)if(F.probe(t,e))return w.b.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function(t,e,r,i){for(var a=D.a.getID3Data(t,0),n=D.a.getTimeStamp(a),o=n?90*n:9e4*e,s=a.length,l=t.length,u=0,d=0,h=this._audioTrack,c=[{pts:o,dts:o,data:a}];s<l;)if(F.isHeader(t,s)){var f=F.appendFrame(h,t,s,o,u);if(!f)break;s+=f.length,d=f.sample.pts,u++}else D.a.isHeader(t,s)?(a=D.a.getID3Data(t,s),c.push({pts:d,dts:d,data:a}),s+=a.length):s++;this.remuxer.remux(h,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,r,i)},t.prototype.destroy=function(){},t}(),W=K,V=function(){function t(){b(this,t)}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),Y=V,z=Math.pow(2,32)-1,X=function(){function t(){E(this,t)}return t.init=function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:r,audio:i};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=n,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,o,l,o,s),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,a))},t.box=function(t){for(var e,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for(e=new Uint8Array(i),e[0]=i>>24&255,e[1]=i>>16&255,e[2]=i>>8&255,e[3]=255&i,e.set(t,4),a=0,i=8;a<n;a++)e.set(r[a],i),i+=r[a].byteLength;return e},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,r){r*=e;var i=Math.floor(r/(z+1)),a=Math.floor(r%(z+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,r,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,r))},t.moov=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trak(e[r]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))},t.mvex=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trex(e[r]);return t.box.apply(null,[t.types.mvex].concat(i))},t.mvhd=function(e,r){r*=e;var i=Math.floor(r/(z+1)),a=Math.floor(r%(z+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,n)},t.sdtp=function(e){var r,i,a=e.samples||[],n=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)r=a[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return t.box(t.types.sdtp,n)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var r,i,a,n=[],o=[];for(r=0;r<e.sps.length;r++)i=e.sps[r],a=i.byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(i));for(r=0;r<e.pps.length;r++)i=e.pps[r],a=i.byteLength,o.push(a>>>8&255),o.push(255&a),o=o.concat(Array.prototype.slice.call(i));var s=t.box(t.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(o))),l=e.width,u=e.height,d=e.pixelRatio[0],h=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var r=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var r=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var r=e.id,i=e.duration*e.timescale,a=e.width,n=e.height,o=Math.floor(i/(z+1)),s=Math.floor(i%(z+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))},t.traf=function(e,r){var i=t.sdtp(e),a=e.id,n=Math.floor(r/(z+1)),o=Math.floor(r%(z+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var r=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,r){var i,a,n,o,s,l,u=e.samples||[],d=u.length,h=12+16*d,c=new Uint8Array(h);for(r+=8+h,c.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)a=u[i],n=a.duration,o=a.size,s=a.flags,l=a.cts,c.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return t.box(t.types.trun,c)},t.initSegment=function(e){t.types||t.init();var r,i=t.moov(e);return r=new Uint8Array(t.FTYP.byteLength+i.byteLength),r.set(t.FTYP),r.set(i,t.FTYP.byteLength),r},t}(),q=X,Q=function(){function t(e,r,i,a){T(this,t),this.observer=e,this.config=r,this.typeSupported=i;var n=navigator.userAgent;this.isSafari=a&&a.indexOf("Apple")>-1&&n&&!n.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(t,e,r,i,a,n,o){if(this.ISGenerated||this.generateIS(t,e,a),this.ISGenerated){var s=t.samples.length,l=e.samples.length,u=a,d=a;if(s&&l){var h=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale;u+=Math.max(0,h),d+=Math.max(0,-h)}if(s){t.timescale||(w.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,a));var c=this.remuxAudio(t,u,n,o);if(l){var f=void 0;c&&(f=c.endPTS-c.startPTS),e.timescale||(w.b.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,a)),this.remuxVideo(e,d,n,f,o)}}else{var p=void 0;l&&(p=this.remuxVideo(e,d,n,o)),p&&t.codec&&this.remuxEmptyAudio(t,u,n,p)}}r.samples.length&&this.remuxID3(r,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(S.a.FRAG_PARSED)},t.prototype.generateIS=function(t,e,r){var i,a,n=this.observer,o=t.samples,s=e.samples,l=this.typeSupported,u="audio/mp4",d={},h={tracks:d},c=void 0===this._initPTS;if(c&&(i=a=1/0),t.config&&o.length&&(t.timescale=t.samplerate,w.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(l.mpeg?(u="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),d.audio={container:u,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array:q.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(i=a=o[0].pts-t.inputTimeScale*r)),e.sps&&e.pps&&s.length){var f=e.inputTimeScale;e.timescale=f,d.video={container:"video/mp4",codec:e.codec,initSegment:q.initSegment([e]),metadata:{width:e.width,height:e.height}},c&&(i=Math.min(i,s[0].pts-f*r),a=Math.min(a,s[0].dts-f*r),this.observer.trigger(S.a.INIT_PTS_FOUND,{initPTS:i}))}Object.keys(d).length?(n.trigger(S.a.FRAG_PARSING_INIT_SEGMENT,h),this.ISGenerated=!0,c&&(this._initPTS=i,this._initDTS=a)):n.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function(t,e,r,i,a){var n,o,s,l,u,d,h,c=8,f=t.timescale,p=t.samples,g=[],v=p.length,y=this._PTSNormalize,m=this._initDTS,b=this.nextAvcDts,E=this.isSafari;E&&(r|=p.length&&b&&(a&&Math.abs(e-b/f)<.1||Math.abs(p[0].pts-b-m)<f/5)),r||(b=e*f),p.forEach(function(t){t.pts=y(t.pts-m,b),t.dts=y(t.dts-m,b)}),p.sort(function(t,e){var r=t.dts-e.dts,i=t.pts-e.pts;return r||(i||t.id-e.id)});var T=p.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(T<0){w.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var R=0;R<p.length;R++)p[R].dts+=T}var A=p[0];u=Math.max(A.dts,0),l=Math.max(A.pts,0);var _=Math.round((u-b)/90);r&&_&&(_>1?w.b.log("AVC:"+_+" ms hole between fragments detected,filling it"):_<-1&&w.b.log("AVC:"+-_+" ms overlapping between fragments detected"),u=b,p[0].dts=u,l=Math.max(l-_,b),p[0].pts=l,w.b.log("Video/PTS/DTS adjusted: "+Math.round(l/90)+"/"+Math.round(u/90)+",delta:"+_+" ms")),A=p[p.length-1],h=Math.max(A.dts,0),d=Math.max(A.pts,0,h),E&&(n=Math.round((h-u)/(p.length-1)));for(var D=0,I=0,k=0;k<v;k++){for(var O=p[k],C=O.units,P=C.length,x=0,F=0;F<P;F++)x+=C[F].data.length;I+=x,D+=P,O.length=x,O.dts=E?u+k*n:Math.max(O.dts,u),O.pts=Math.max(O.pts,O.dts)}var N=I+4*D+8;try{o=new Uint8Array(N)}catch(t){return void this.observer.trigger(S.a.ERROR,{type:L.b.MUX_ERROR,details:L.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating video mdat "+N})}var M=new DataView(o.buffer);M.setUint32(0,N),o.set(q.types.mdat,4);for(var U=0;U<v;U++){for(var B=p[U],G=B.units,j=0,H=void 0,K=0,W=G.length;K<W;K++){var V=G[K],Y=V.data,z=V.data.byteLength;M.setUint32(c,z),c+=4,o.set(Y,c),c+=z,j+=4+z}if(E)H=Math.max(0,n*Math.round((B.pts-B.dts)/n));else{if(U<v-1)n=p[U+1].dts-B.dts;else{var X=this.config,Q=B.dts-p[U>0?U-1:U].dts;if(X.stretchShortVideoTrack){var J=X.maxBufferHole,$=X.maxSeekHole,Z=Math.floor(Math.min(J,$)*f),tt=(i?l+i*f:this.nextAudioPts)-B.pts;tt>Z?(n=tt-Q,n<0&&(n=Q),w.b.log("It is approximately "+tt/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=Q}else n=Q}H=Math.round(B.pts-B.dts)}g.push({size:j,duration:n,cts:H,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:B.key?2:1,isNonSync:B.key?0:1}})}this.nextAvcDts=h+n;var et=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var rt=g[0].flags;rt.dependsOn=2,rt.isNonSync=0}t.samples=g,s=q.moof(t.sequenceNumber++,u,t),t.samples=[];var it={data1:s,data2:o,startPTS:l/f,endPTS:(d+n)/f,startDTS:u/f,endDTS:this.nextAvcDts/f,type:"video",nb:g.length,dropped:et};return this.observer.trigger(S.a.FRAG_PARSING_DATA,it),it},t.prototype.remuxAudio=function(t,e,r,i){var a,n,o,s,l,u,d,h=t.inputTimeScale,c=t.timescale,f=h/c,p=t.isAAC?1024:1152,g=p*f,v=this._PTSNormalize,y=this._initDTS,m=!t.isAAC&&this.typeSupported.mpeg,b=t.samples,E=[],T=this.nextAudioPts;if(r|=b.length&&T&&(i&&Math.abs(e-T/h)<.1||Math.abs(b[0].pts-T-y)<20*g),b.forEach(function(t){t.pts=t.dts=v(t.pts-y,e*h)}),b=b.filter(function(t){return t.pts>=0}),0!==b.length){if(r||(T=i?e*h:b[0].pts),t.isAAC)for(var R=this.config.maxAudioFramesDrift,A=0,_=T;A<b.length;){var D,I=b[A],k=I.pts;D=k-_;var O=Math.abs(1e3*D/h);if(D<=-R*g)w.b.warn("Dropping 1 audio frame @ "+(_/h).toFixed(3)+"s due to "+Math.round(O)+" ms overlap."),b.splice(A,1),t.len-=I.unit.length;else if(D>=R*g&&O<1e4&&_){var C=Math.round(D/g);w.b.warn("Injecting "+C+" audio frame @ "+(_/h).toFixed(3)+"s due to "+Math.round(1e3*D/h)+" ms gap.");for(var P=0;P<C;P++){var x=Math.max(_,0);o=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),o||(w.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),o=I.unit.subarray()),b.splice(A,0,{unit:o,pts:x,dts:x}),t.len+=o.length,_+=g,A++}I.pts=I.dts=_,_+=g,A++}else Math.abs(D),I.pts=I.dts=_,_+=g,A++}for(var F=0,N=b.length;F<N;F++){var M=b[F],U=M.unit,B=M.pts;if(void 0!==d)n.duration=Math.round((B-d)/f);else{var G=Math.round(1e3*(B-T)/h),j=0;if(r&&t.isAAC&&G){if(G>0&&G<1e4)j=Math.round((B-T)/g),w.b.log(G+" ms hole between AAC samples detected,filling it"),j>0&&(o=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),o||(o=U.subarray()),t.len+=j*o.length);else if(G<-12){w.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(T/h).toFixed(3)+"s/"+(B/h).toFixed(3)+"s/"+-G+"ms"),t.len-=U.byteLength;continue}B=T}if(u=B,!(t.len>0))return;var H=m?t.len:t.len+8;a=m?0:8;try{s=new Uint8Array(H)}catch(t){return void this.observer.trigger(S.a.ERROR,{type:L.b.MUX_ERROR,details:L.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating audio mdat "+H})}if(!m){new DataView(s.buffer).setUint32(0,H),s.set(q.types.mdat,4)}for(var K=0;K<j;K++)o=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),o||(w.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),o=U.subarray()),s.set(o,a),a+=o.byteLength,n={size:o.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(n)}s.set(U,a);var W=U.byteLength;a+=W,n={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(n),d=B}var V=0,z=E.length;if(z>=2&&(V=E[z-2].duration,n.duration=V),z){this.nextAudioPts=T=d+f*V,t.len=0,t.samples=E,l=m?new Uint8Array:q.moof(t.sequenceNumber++,u/f,t),t.samples=[];var X=u/h,Q=T/h,J={data1:l,data2:s,startPTS:X,endPTS:Q,startDTS:X,endDTS:Q,type:"audio",nb:z};return this.observer.trigger(S.a.FRAG_PARSING_DATA,J),J}return null}},t.prototype.remuxEmptyAudio=function(t,e,r,i){var a=t.inputTimeScale,n=t.samplerate?t.samplerate:a,o=a/n,s=this.nextAudioPts,l=(void 0!==s?s:i.startDTS*a)+this._initDTS,u=i.endDTS*a+this._initDTS,d=1024*o,h=Math.ceil((u-l)/d),c=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(w.b.warn("remux empty Audio"),!c)return void w.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var f=[],p=0;p<h;p++){var g=l+p*d;f.push({unit:c,pts:g,dts:g}),t.len+=c.length}t.samples=f,this.remuxAudio(t,e,r)},t.prototype.remuxID3=function(t,e){var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS,o=this._initDTS;if(i){for(var s=0;s<i;s++)r=t.samples[s],r.pts=(r.pts-n)/a,r.dts=(r.dts-o)/a;this.observer.trigger(S.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e},t.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS;if(i){for(var o=0;o<i;o++)r=t.samples[o],r.pts=(r.pts-n)/a;this.observer.trigger(S.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e},t.prototype._PTSNormalize=function(t,e){var r;if(void 0===e)return t;for(r=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=r;return t},t}(),J=Q,$=function(){function t(e){R(this,t),this.observer=e}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(){},t.prototype.resetInitSegment=function(){},t.prototype.remux=function(t,e,r,i,a,n,o,s){var l=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),l.trigger(S.a.FRAG_PARSING_DATA,{data1:s,startPTS:a,startDTS:a,type:u,nb:1,dropped:0}),l.trigger(S.a.FRAG_PARSED)},t}(),Z=$,tt=function(){function t(e,r,i,a){A(this,t),this.observer=e,this.typeSupported=r,this.config=i,this.vendor=a}return t.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},t.prototype.push=function(t,e,r,i,a,n,o,s,l,u,d,h){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var c=this.decrypter;null==c&&(c=this.decrypter=new _.a(this.observer,this.config));var f,p=this;try{f=performance.now()}catch(t){f=Date.now()}c.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var c;try{c=performance.now()}catch(t){c=Date.now()}p.observer.trigger(S.a.FRAG_DECRYPTED,{stats:{tstart:f,tdecrypt:c}}),p.pushDecrypted(new Uint8Array(t),e,new Uint8Array(r),i,a,n,o,s,l,u,d,h)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(r),i,a,n,o,s,l,u,d,h)},t.prototype.pushDecrypted=function(t,e,r,i,a,n,o,s,l,u,d,h){var c=this.demuxer;if(!c||o&&!this.probe(t)){for(var f=this.observer,p=this.typeSupported,g=this.config,v=[{demux:H,remux:J},{demux:P,remux:Z},{demux:k,remux:J},{demux:W,remux:J}],y=0,m=v.length;y<m;y++){var b=v[y],E=b.demux.probe;if(E(t)){var T=this.remuxer=new b.remux(f,g,p,this.vendor);c=new b.demux(f,T,g,p),this.probe=E;break}}if(!c)return void f.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=c}var R=this.remuxer;(o||s)&&(c.resetInitSegment(r,i,a,u),R.resetInitSegment()),o&&(c.resetTimeStamp(h),R.resetTimeStamp(h)),"function"==typeof c.setDecryptData&&c.setDecryptData(e),c.append(t,n,l,d)},t}();e.a=tt},function(t,e,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){var r=jt[e];return!!r&&!0===r[t.slice(0,4)]}function o(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!t)return null;for(var r=null,i=0;i<t.length;i++){var a=t[i];a.id===e&&(r=a)}return r}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function y(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e,r){var i=t[e],a=t[r],n=a.startPTS;isNaN(n)?a.start=r>e?i.start+i.duration:Math.max(i.start-a.duration,0):r>e?(i.duration=n-i.start,i.duration<0&&Pt.b.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-n,a.duration<0&&Pt.b.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}function E(t,e,r,i,a,n){var o=r;if(!isNaN(e.startPTS)){var s=Math.abs(e.startPTS-r);isNaN(e.deltaPTS)?e.deltaPTS=s:e.deltaPTS=Math.max(s,e.deltaPTS),o=Math.max(r,e.startPTS),r=Math.min(r,e.startPTS),i=Math.max(i,e.endPTS),a=Math.min(a,e.startDTS),n=Math.max(n,e.endDTS)}var l=r-e.start;e.start=e.startPTS=r,e.maxStartPTS=o,e.endPTS=i,e.startDTS=a,e.endDTS=n,e.duration=i-r;var u=e.sn;if(!t||u<t.startSN||u>t.endSN)return 0;var d,h,c;for(d=u-t.startSN,h=t.fragments,h[d]=e,c=d;c>0;c--)b(h,c,c-1);for(c=d;c<h.length-1;c++)b(h,c,c+1);return t.PTSKnown=!0,l}function T(t,e){var r,i=Math.max(t.startSN,e.startSN)-e.startSN,a=Math.min(t.endSN,e.endSN)-e.startSN,n=e.startSN-t.startSN,o=t.fragments,s=e.fragments,l=0;if(a<i)return void(e.PTSKnown=!1);for(var u=i;u<=a;u++){var d=o[n+u],h=s[u];h&&d&&(l=d.cc-h.cc,isNaN(d.startPTS)||(h.start=h.startPTS=d.startPTS,h.endPTS=d.endPTS,h.duration=d.duration,h.backtracked=d.backtracked,h.dropped=d.dropped,r=h))}if(l)for(Pt.b.log("discontinuity sliding from playlist, take drift into account"),u=0;u<s.length;u++)s[u].cc+=l;if(r)E(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(n>=0&&n<o.length){var c=o[n].start;for(u=0;u<s.length;u++)s[u].start+=c}e.PTSKnown=t.PTSKnown}function R(t,e){for(var r=null,i=0;i<t.length;i+=1){var a=t[i];if(a&&a.cc===e){r=a;break}}return r}function A(t,e){return re.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}function S(t,e,r){var i=!1;return e&&e.details&&r&&(r.endCC>r.startCC||t&&t.cc<r.startCC)&&(i=!0),i}function L(t,e){var r=t.fragments,i=e.fragments;if(!i.length||!r.length)return void Pt.b.log("No fragments to align");var a=R(r,i[0].cc);return!a||a&&!a.startPTS?void Pt.b.log("No frag in previous level to align on"):a}function _(t,e){e.fragments.forEach(function(e){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}),e.PTSKnown=!0}function w(t,e,r){if(S(t,e,r)){var i=L(e.details,r);i&&(Pt.b.log("Adjusting PTS using last level due to CC increase within current level"),_(i.start,r))}if(!1===r.PTSKnown&&e&&e.details){var a=e.details.programDateTime,n=r.programDateTime,o=(n-a)/1e3+e.details.fragments[0].start;isNaN(o)||(Pt.b.log("adjusting PTS using programDateTime delta, sliding:"+o.toFixed(3)),_(o,r))}}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function k(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function P(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function N(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function M(){var t=y(),e=window.SourceBuffer||window.WebKitSourceBuffer,r=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!r&&!!i}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function V(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function X(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function J(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function et(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function at(t,e){
if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function nt(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Qe,this.regionList=[]}function ot(t){function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+(0|i)/1e3}var r=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return r?r[3]?e(r[1],r[2],r[3].replace(":",""),r[4]):r[1]>59?e(r[1],r[2],0,r[4]):e(0,r[1],r[2],r[4]):null}function st(){this.values=Object.create(null)}function lt(t,e,r,i){var a=i?t.split(i):[t];for(var n in a)if("string"==typeof a[n]){var o=a[n].split(r);if(2===o.length){var s=o[0],l=o[1];e(s,l)}}}function ut(t,e,r){function i(){var e=ot(t);if(null===e)throw new Error("Malformed timestamp: "+n);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function a(){t=t.replace(/^\s+/,"")}var n=t;if(a(),e.startTime=i(),a(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);t=t.substr(3),a(),e.endTime=i(),a(),function(t,e){var i=new st;lt(t,function(t,e){switch(t){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===e){i.set(t,r[a].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":var n=e.split(","),o=n[0];i.integer(t,o),i.percent(t,o)&&i.set("snapToLines",!1),i.alt(t,o,["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",$e,"end"]);break;case"position":n=e.split(","),i.percent(t,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",$e,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",$e,"end","left","right"])}},/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");var a=i.get("line","auto");"auto"===a&&-1===Je.line&&(a=-1),e.line=a,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",$e);var n=i.get("position","auto");"auto"===n&&50===Je.position&&(n="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=n}(t,e)}function dt(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function ht(t,e,r,i){for(var a,n,o,s,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(a=i.rows[d],o=!0,s=0,l="",!a.isEmpty()){for(var h=0;h<a.chars.length;h++)a.chars[h].uchar.match(/\s/)&&o?s++:(l+=a.chars[h].uchar,o=!1);a.cueStartTime=e,e===r&&(r+=1e-4),n=new u(e,r,dt(l.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=d>7?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,s/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(n)}}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function vt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function yt(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}function mt(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function bt(t,e,r,i){return Math.min(e,i)-Math.max(t,r)}function Et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Rt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function At(t){for(var e=[],r=0;r<t.length;r++)"subtitles"===t[r].kind&&e.push(t[r]);return e}function St(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var Dt={};r.d(Dt,"newCue",function(){return ht});var It=r(6),kt=r.n(It),Ot=r(1),Ct=r(2),Pt=r(0),xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft=function(){function t(e){i(this,t),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];this.handledEvents=a,this.useGenericHandler=!0,this.registerListeners()}return t.prototype.destroy=function(){this.unregisterListeners()},t.prototype.isEventHandler=function(){return"object"===xt(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},t.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if("hlsEventGeneric"===t)throw new Error("Forbidden event name: "+t);this.hls.on(t,this.onEvent)},this)},t.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},t.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},t.prototype.onEventGeneric=function(t,e){var r=function(t,e){var r="on"+t.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,e)};try{r.call(this,t,e).call()}catch(e){Pt.b.error("internal error happened while processing "+t+":"+e.message),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.OTHER_ERROR,details:Ct.a.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},t}(),Nt=Ft,Mt=/^(\d+)x(\d+)$/,Ut=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Bt=function(){function t(e){a(this,t),"string"==typeof e&&(e=t.parseAttrList(e));for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r])}return t.prototype.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},t.prototype.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},t.prototype.enumeratedString=function(t){return this[t]},t.prototype.decimalResolution=function(t){var e=Mt.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,r={};for(Ut.lastIndex=0;null!==(e=Ut.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1]]=i}return r},t}(),Gt=Bt,jt={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Ht=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Kt=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Wt=/#EXT-X-MEDIA:(.*)/g,Vt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Yt=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,zt=function(){function t(){u(this,t),this.method=null,this.key=null,this.iv=null,this._uri=null}return Ht(t,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=kt.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),t}(),Xt=function(){function t(){u(this,t),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return t.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e},t.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var r=t;return t&&t.method&&t.uri&&!t.iv&&(r=new zt,r.method=t.method,r.baseuri=t.baseuri,r.reluri=t.reluri,r.iv=this.createInitializationVector(e)),r},t.prototype.cloneObj=function(t){return JSON.parse(JSON.stringify(t))},Ht(t,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=kt.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var t=this._byteRange=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var r=this.lastByteRangeEndOffset;t[0]=r||0}else t[0]=parseInt(e[1]);t[1]=parseInt(e[0])+t[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),t}(),qt=function(t){function e(r){u(this,e);var i=s(this,t.call(this,r,Ot.a.MANIFEST_LOADING,Ot.a.LEVEL_LOADING,Ot.a.AUDIO_TRACK_LOADING,Ot.a.SUBTITLE_TRACK_LOADING));return i.loaders={},i}return l(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},Nt.prototype.destroy.call(this)},e.prototype.onManifestLoading=function(t){this.load(t.url,{type:"manifest"})},e.prototype.onLevelLoading=function(t){this.load(t.url,{type:"level",level:t.level,id:t.id})},e.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:"audioTrack",id:t.id})},e.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:"subtitleTrack",id:t.id})},e.prototype.load=function(t,e){var r=this.loaders[e.type];if(void 0!==r){var i=r.context;if(i&&i.url===t)return void Pt.b.trace("playlist request ongoing");Pt.b.warn("abort previous loader for type:"+e.type),r.abort()}var a=this.hls.config,n=void 0,o=void 0,s=void 0,l=void 0;"manifest"===e.type?(n=a.manifestLoadingMaxRetry,o=a.manifestLoadingTimeOut,s=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout):"level"===e.type?(n=0,o=a.levelLoadingTimeOut):(n=a.levelLoadingMaxRetry,o=a.levelLoadingTimeOut,s=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout,Pt.b.log("loading playlist for "+e.type+" "+(e.level||e.id))),r=this.loaders[e.type]=e.loader=void 0!==a.pLoader?new a.pLoader(a):new a.loader(a),e.url=t,e.responseType="";var u=void 0,d=void 0;u={timeout:o,maxRetry:n,retryDelay:s,maxRetryDelay:l},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.load(e,u,d)},e.prototype.resolve=function(t,e){return kt.a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},e.prototype.parseMasterPlaylist=function(t,e){var r=[],i=void 0;for(Kt.lastIndex=0;null!=(i=Kt.exec(t));){var a={},o=a.attrs=new Gt(i[1]);a.url=this.resolve(i[2],e);var s=o.decimalResolution("RESOLUTION");s&&(a.width=s.width,a.height=s.height),a.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),a.name=o.NAME,function(t,e){["video","audio"].forEach(function(r){var i=t.filter(function(t){return n(t,r)});if(i.length){var a=i.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});e[r+"Codec"]=a.length>0?a[0]:i[0],t=t.filter(function(t){return-1===i.indexOf(t)})}}),e.unknownCodecs=t}([].concat((o.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=this.avc1toavcoti(a.videoCodec)),r.push(a)}return r},e.prototype.parseMasterPlaylistMedia=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=void 0,n=[],o=0;for(Wt.lastIndex=0;null!==(a=Wt.exec(t));){var s={},l=new Gt(a[1]);if(l.TYPE===r){if(s.groupId=l["GROUP-ID"],s.name=l.NAME,s.type=r,s.default="YES"===l.DEFAULT,s.autoselect="YES"===l.AUTOSELECT,s.forced="YES"===l.FORCED,l.URI&&(s.url=this.resolve(l.URI,e)),s.lang=l.LANGUAGE,s.name||(s.name=s.lang),i.length){var u=d(i,s.groupId);s.audioCodec=u?u.codec:i[0].codec}s.id=o++,n.push(s)}}return n},e.prototype.avc1toavcoti=function(t){var e,r=t.split(".");return r.length>2?(e=r.shift()+".",e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):e=t,e},e.prototype.parseLevelPlaylist=function(t,e,r,i){var a,n,o=0,s=0,l={type:null,version:null,url:e,fragments:[],live:!0,startSN:0},u=new zt,d=0,h=null,c=new Xt;for(Vt.lastIndex=0;null!==(a=Vt.exec(t));){var f=a[1];if(f){c.duration=parseFloat(f);var p=(" "+a[2]).slice(1);c.title=p||null,c.tagList.push(p?["INF",f,p]:["INF",f])}else if(a[3]){if(!isNaN(c.duration)){var g=o++;c.type=i,c.start=s,c.levelkey=u,c.sn=g,c.level=r,c.cc=d,c.baseurl=e,c.relurl=(" "+a[3]).slice(1),l.fragments.push(c),h=c,s+=c.duration,c=new Xt}}else if(a[4]){if(c.rawByteRange=(" "+a[4]).slice(1),h){var v=h.byteRangeEndOffset;v&&(c.lastByteRangeEndOffset=v)}}else if(a[5])c.rawProgramDateTime=(" "+a[5]).slice(1),c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]),void 0===l.programDateTime&&(l.programDateTime=new Date(new Date(Date.parse(a[5]))-1e3*s));else{for(a=a[0].match(Yt),n=1;n<a.length&&void 0===a[n];n++);var y=(" "+a[n+1]).slice(1),m=(" "+a[n+2]).slice(1);switch(a[n]){case"#":c.tagList.push(m?[y,m]:[y]);break;case"PLAYLIST-TYPE":l.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(y);break;case"TARGETDURATION":l.targetduration=parseFloat(y);break;case"VERSION":l.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,c.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(y);break;case"KEY":var b=y,E=new Gt(b),T=E.enumeratedString("METHOD"),R=E.URI,A=E.hexadecimalInteger("IV");T&&(u=new zt,R&&["AES-128","SAMPLE-AES"].indexOf(T)>=0&&(u.method=T,u.baseuri=e,u.reluri=R,u.key=null,u.iv=A));break;case"START":var S=y,L=new Gt(S),_=L.decimalFloatingPoint("TIME-OFFSET");isNaN(_)||(l.startTimeOffset=_);break;case"MAP":var w=new Gt(y);c.relurl=w.URI,c.rawByteRange=w.BYTERANGE,c.baseurl=e,c.level=r,c.type=i,c.sn="initSegment",l.initSegment=c,c=new Xt;break;default:Pt.b.warn("line parsed but not handled: "+a)}}}return c=h,c&&!c.relurl&&(l.fragments.pop(),s-=c.duration),l.totalduration=s,l.averagetargetduration=s/l.fragments.length,l.endSN=o-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=d,l},e.prototype.loadsuccess=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.data,n=t.url,o=r.type,s=r.id,l=r.level,u=this.hls;if(this.loaders[o]=void 0,void 0!==n&&0!==n.indexOf("data:")||(n=r.url),e.tload=performance.now(),0===a.indexOf("#EXTM3U"))if(a.indexOf("#EXTINF:")>0){var d="audioTrack"!==o&&"subtitleTrack"!==o,h=isNaN(l)?isNaN(s)?0:s:l,c=this.parseLevelPlaylist(a,n,h,"audioTrack"===o?"audio":"subtitleTrack"===o?"subtitle":"main");c.tload=e.tload,"manifest"===o&&u.trigger(Ot.a.MANIFEST_LOADED,{levels:[{url:n,details:c}],audioTracks:[],url:n,stats:e,networkDetails:i}),e.tparsed=performance.now(),c.targetduration?d?u.trigger(Ot.a.LEVEL_LOADED,{details:c,level:l||0,id:s||0,stats:e,networkDetails:i}):"audioTrack"===o?u.trigger(Ot.a.AUDIO_TRACK_LOADED,{details:c,id:s,stats:e,networkDetails:i}):"subtitleTrack"===o&&u.trigger(Ot.a.SUBTITLE_TRACK_LOADED,{details:c,id:s,stats:e,networkDetails:i}):u.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"invalid targetduration",networkDetails:i})}else{var f=this.parseMasterPlaylist(a,n);if(f.length){var p=f.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),g=this.parseMasterPlaylistMedia(a,n,"AUDIO",p),v=this.parseMasterPlaylistMedia(a,n,"SUBTITLES");if(g.length){var y=!1;g.forEach(function(t){t.url||(y=!0)}),!1===y&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(Pt.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main"}))}u.trigger(Ot.a.MANIFEST_LOADED,{levels:f,audioTracks:g,subtitles:v,url:n,stats:e,networkDetails:i})}else u.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"no level found in manifest",networkDetails:i})}else u.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"no EXTM3U delimiter",networkDetails:i})},e.prototype.loaderror=function(t,e){var r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=Ct.a.MANIFEST_LOAD_ERROR,i=!0;break;case"level":r=Ct.a.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":r=Ct.a.AUDIO_TRACK_LOAD_ERROR,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,response:t,context:e,networkDetails:a})},e.prototype.loadtimeout=function(t,e){var r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=Ct.a.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":r=Ct.a.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":r=Ct.a.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,context:e,networkDetails:a})},e}(Nt),Qt=qt,Jt=function(t){function e(r){h(this,e);var i=c(this,t.call(this,r,Ot.a.FRAG_LOADING));return i.loaders={},i}return f(e,t),e.prototype.destroy=function(){var t=this.loaders;for(var e in t){var r=t[e];r&&r.destroy()}this.loaders={},Nt.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag,r=e.type,i=this.loaders[r],a=this.hls.config;e.loaded=0,i&&(Pt.b.warn("abort previous fragment loader for type:"+r),i.abort()),i=this.loaders[r]=e.loader=void 0!==a.fLoader?new a.fLoader(a):new a.loader(a);var n=void 0,o=void 0,s=void 0;n={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var l=e.byteRangeStartOffset,u=e.byteRangeEndOffset;isNaN(l)||isNaN(u)||(n.rangeStart=l,n.rangeEnd=u),o={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(n,o,s)},e.prototype.loadsuccess=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.data,n=r.frag;n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(Ot.a.FRAG_LOADED,{payload:a,frag:n,stats:e,networkDetails:i})},e.prototype.loaderror=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:r})},e.prototype.loadtimeout=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:r})},e.prototype.loadprogress=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.frag;a.loaded=t.loaded,this.hls.trigger(Ot.a.FRAG_LOAD_PROGRESS,{frag:a,stats:t,networkDetails:i})},e}(Nt),$t=Jt,Zt=function(t){function e(r){p(this,e);var i=g(this,t.call(this,r,Ot.a.KEY_LOADING));return i.loaders={},i.decryptkey=null,i.decrypturl=null,i}return v(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},Nt.prototype.destroy.call(this)},e.prototype.onKeyLoading=function(t){var e=t.frag,r=e.type,i=this.loaders[r],a=e.decryptdata,n=a.uri;if(n!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;i&&(Pt.b.warn("abort previous key loader for type:"+r),i.abort()),e.loader=this.loaders[r]=new o.loader(o),this.decrypturl=n,this.decryptkey=null;var s=void 0,l=void 0,u=void 0;s={url:n,frag:e,responseType:"arraybuffer"},l={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(s,l,u)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(Ot.a.KEY_LOADED,{frag:e}))},e.prototype.loadsuccess=function(t,e,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(Ot.a.KEY_LOADED,{frag:i})},e.prototype.loaderror=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},e.prototype.loadtimeout=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},e}(Nt),te=Zt,ee={search:function(t,e){for(var r=0,i=t.length-1,a=null,n=null;r<=i;){a=(r+i)/2|0,n=t[a];var o=e(n);if(o>0)r=a+1;else{if(!(o<0))return n;i=a-1}}return null}},re=ee,ie={isBuffered:function(t,e){try{if(t)for(var r=t.buffered,i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1},bufferInfo:function(t,e,r){try{if(t){var i,a=t.buffered,n=[];for(i=0;i<a.length;i++)n.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(n,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},bufferedInfo:function(t,e,r){var i,a,n,o,s,l=[];for(t.sort(function(t,e){var r=t.start-e.start;return r||e.end-t.end}),s=0;s<t.length;s++){var u=l.length;if(u){var d=l[u-1].end;t[s].start-d<r?t[s].end>d&&(l[u-1].end=t[s].end):l.push(t[s])}else l.push(t[s])}for(s=0,i=0,a=n=e;s<l.length;s++){var h=l[s].start,c=l[s].end;if(e+r>=h&&e<c)a=h,n=c,i=n-e;else if(e+r<h){o=h;break}}return{len:i,start:a,end:n,nextStart:o}}},ae=ie,ne=r(7),oe=r(5),se=r.n(oe),le=r(9),ue=r.n(le),de=y(),he=function(){function t(e,r){m(this,t),this.hls=e,this.id=r;var i=this.observer=new se.a,a=e.config;i.trigger=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),a=1;a<e;a++)r[a-1]=arguments[a];i.emit.apply(i,[t,t].concat(r))},i.off=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),a=1;a<e;a++)r[a-1]=arguments[a];i.removeListener.apply(i,[t].concat(r))};var n=function(t,r){r=r||{},r.frag=this.frag,r.id=this.id,e.trigger(t,r)}.bind(this);i.on(Ot.a.FRAG_DECRYPTED,n),i.on(Ot.a.FRAG_PARSING_INIT_SEGMENT,n),i.on(Ot.a.FRAG_PARSING_DATA,n),i.on(Ot.a.FRAG_PARSED,n),i.on(Ot.a.ERROR,n),i.on(Ot.a.FRAG_PARSING_METADATA,n),i.on(Ot.a.FRAG_PARSING_USERDATA,n),i.on(Ot.a.INIT_PTS_FOUND,n);var o={mp4:de.isTypeSupported("video/mp4"),mpeg:de.isTypeSupported("audio/mpeg"),mp3:de.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(a.enableWorker&&"undefined"!=typeof Worker){Pt.b.log("demuxing in webworker");var l=void 0;try{l=this.w=ue()(10),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(t){e.trigger(Ot.a.ERROR,{type:Ct.b.OTHER_ERROR,details:Ct.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},l.postMessage({cmd:"init",typeSupported:o,vendor:s,id:r,config:JSON.stringify(a)})}catch(t){Pt.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),l&&URL.revokeObjectURL(l.objectURL),this.demuxer=new ne.a(i,o,a,s),this.w=void 0}}else this.demuxer=new ne.a(i,o,a,s)}return t.prototype.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)},t.prototype.push=function(t,e,r,i,a,n,o,s){var l=this.w,u=isNaN(a.startDTS)?a.start:a.startDTS,d=a.decryptdata,h=this.frag,c=!(h&&a.cc===h.cc),f=!(h&&a.level===h.level),p=h&&a.sn===h.sn+1,g=!f&&p;if(c&&Pt.b.log(this.id+":discontinuity detected"),f&&Pt.b.log(this.id+":switch detected"),this.frag=a,l)l.postMessage({cmd:"demux",data:t,decryptdata:d,initSegment:e,audioCodec:r,videoCodec:i,timeOffset:u,discontinuity:c,trackSwitch:f,contiguous:g,duration:n,accurateTimeOffset:o,defaultInitPTS:s},t instanceof ArrayBuffer?[t]:[]);else{var v=this.demuxer;v&&v.push(t,d,e,r,i,u,c,f,g,n,o,s)}},t.prototype.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case Ot.a.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},t}(),ce=he,fe={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}},pe=fe,ge=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),ve={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},ye=function(t){function e(r){D(this,e);var i=I(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_PARSED,Ot.a.LEVEL_LOADED,Ot.a.KEY_LOADED,Ot.a.FRAG_LOADED,Ot.a.FRAG_LOAD_EMERGENCY_ABORTED,Ot.a.FRAG_PARSING_INIT_SEGMENT,Ot.a.FRAG_PARSING_DATA,Ot.a.FRAG_PARSED,Ot.a.ERROR,Ot.a.AUDIO_TRACK_SWITCHING,Ot.a.AUDIO_TRACK_SWITCHED,Ot.a.BUFFER_CREATED,Ot.a.BUFFER_APPENDED,Ot.a.BUFFER_FLUSHED));return i.config=r.config,i.audioCodecSwap=!1,i.ticks=0,i._state=ve.STOPPED,i.ontick=i.tick.bind(i),i}return k(e,t),e.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Nt.prototype.destroy.call(this),this.state=ve.STOPPED},e.prototype.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}e>0&&-1===t&&(Pt.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=ve.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=ve.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ve.STOPPED,this.forceStartLoad=!1},e.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},e.prototype.doTick=function(){switch(this.state){case ve.ERROR:break;case ve.BUFFER_FLUSHING:this.fragLoadError=0;break;case ve.IDLE:this._doTickIdle();break;case ve.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=ve.IDLE);break;case ve.FRAG_LOADING_WAITING_RETRY:var e=performance.now(),r=this.retryDate;(!r||e>=r||this.media&&this.media.seeking)&&(Pt.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ve.IDLE);break;case ve.ERROR:case ve.STOPPED:case ve.FRAG_LOADING:case ve.PARSING:case ve.PARSED:case ve.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},e.prototype._doTickIdle=function(){var t=this.hls,e=t.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&e.startFragPrefetch)){var i=void 0;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var a=t.nextLoadLevel,n=this.levels[a];if(n){var o=n.bitrate,s=void 0;s=o?Math.max(8*e.maxBufferSize/o,e.maxBufferLength):e.maxBufferLength,s=Math.min(s,e.maxMaxBufferLength);var l=ae.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,e.maxBufferHole),u=l.len;if(!(u>=s)){Pt.b.trace("buffer length of "+u.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=a;var d=n.details;if(void 0===d||!0===d.live&&this.levelLastLoaded!==a)return void(this.state=ve.WAITING_LEVEL);var h=this.fragPrevious;if(!d.live&&h&&!h.backtracked&&h.sn===d.endSN&&!l.nextStart){if(Math.min(r.duration,h.start+h.duration)-Math.max(l.end,h.start)<=Math.max(.2,h.duration)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(Ot.a.BUFFER_EOS,c),void(this.state=ve.ENDED)}}this._fetchPayloadOrEos(i,l,d)}}}},e.prototype._fetchPayloadOrEos=function(t,e,r){var i=this.fragPrevious,a=this.level,n=r.fragments,o=n.length;if(0!==o){var s=n[0].start,l=n[o-1].start+n[o-1].duration,u=e.end,d=void 0;if(r.initSegment&&!r.initSegment.data)d=r.initSegment;else if(r.live){var h=this.config.initialLiveManifestSize;if(o<h)return void Pt.b.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+h);if(null===(d=this._ensureFragmentAtLivePoint(r,u,s,l,i,n,o)))return}else u<s&&(d=n[0]);d||(d=this._findFragment(s,i,o,n,u,l,r)),d&&this._loadFragmentOrKey(d,a,r,t,u)}},e.prototype._ensureFragmentAtLivePoint=function(t,e,r,i,a,n,o){var s=this.hls.config,l=this.media,u=void 0,d=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(r-s.maxFragLookUpTolerance,i-d)){var h=this.liveSyncPosition=this.computeLivePosition(r,t);Pt.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),e=h,l&&l.readyState&&l.duration>h&&(l.currentTime=h),this.nextLoadPosition=h}if(t.PTSKnown&&e>i&&l&&l.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(a){var c=a.sn+1;if(c>=t.startSN&&c<=t.endSN){var f=n[c-t.startSN];a.cc===f.cc&&(u=f,Pt.b.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=re.search(n,function(t){
return a.cc-t.cc}))&&Pt.b.log("live playlist, switching playlist, load frag with same CC: "+u.sn)}u||(u=n[Math.min(o-1,Math.round(o/2))],Pt.b.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u},e.prototype._findFragment=function(t,e,r,i,a,n,o){var s=this.hls.config,l=void 0,u=void 0,d=s.maxFragLookUpTolerance,h=e?i[e.sn-i[0].sn+1]:void 0,c=function(t){var e=Math.min(d,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-e<=a?1:t.start-e>a&&t.start?-1:0};if(a<n?(a>n-d&&(d=0),u=h&&!c(h)?h:re.search(i,c)):u=i[r-1],u){l=u;var f=l.sn-o.startSN,p=e&&l.level===e.level,g=i[f-1],v=i[f+1];if(e&&l.sn===e.sn)if(p&&!l.backtracked)if(l.sn<o.endSN){var y=e.deltaPTS;y&&y>s.maxBufferHole&&e.dropped&&f?(l=g,Pt.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),e.loadCounter--):(l=v,Pt.b.log("SN just loaded, load next one: "+l.sn))}else l=null;else l.backtracked&&(v&&v.backtracked?(Pt.b.warn("Already backtracked from fragment "+v.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+v.sn),l=v):(Pt.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),l.dropped=0,g?(g.loadCounter&&g.loadCounter--,l=g,l.backtracked=!0):f&&(l=null)))}return l},e.prototype._loadFragmentOrKey=function(t,e,r,i,a){var n=this.hls,o=n.config;if(!t.decryptdata||null==t.decryptdata.uri||null!=t.decryptdata.key){if(Pt.b.log("Loading "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e+", currentTime:"+i.toFixed(3)+",bufferEnd:"+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;var s=o.fragLoadingLoopThreshold;if(t.loadCounter>s&&Math.abs(this.fragLoadIdx-t.loadIdx)<s)return void n.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t})}else t.loadCounter=1;return t.loadIdx=this.fragLoadIdx,t.autoLevel=n.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||t.bitrateTest||(this.nextLoadPosition=t.start+t.duration),n.trigger(Ot.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new ce(n,"main")),void(this.state=ve.FRAG_LOADING)}Pt.b.log("Loading key for "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e),this.state=ve.KEY_LOADING,n.trigger(Ot.a.KEY_LOADING,{frag:t})},e.prototype.getBufferedFrag=function(t){return re.search(this._bufferedFrags,function(e){return t<e.startPTS?-1:t>e.endPTS?1:0})},e.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},e.prototype._checkFragmentChanged=function(){var t,e,r=this.media;if(r&&r.readyState&&!1===r.seeking&&(e=r.currentTime,e>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),ae.isBuffered(r,e)?t=this.getBufferedFrag(e):ae.isBuffered(r,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var i=t;if(i!==this.fragPlaying){this.hls.trigger(Ot.a.FRAG_CHANGED,{frag:i});var a=i.level;this.fragPlaying&&this.fragPlaying.level===a||this.hls.trigger(Ot.a.LEVEL_SWITCHED,{level:a}),this.fragPlaying=i}}},e.prototype.immediateLevelSwitch=function(){if(Pt.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,e=void 0;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,ae.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},e.prototype.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e=void 0,r=void 0,i=void 0;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),r=this.getBufferedFrag(t.currentTime),r&&r.startPTS>1&&this.flushMainBuffer(0,r.startPTS-1),t.paused)e=0;else{var a=this.hls.nextLoadLevel,n=this.levels[a],o=this.fragLastKbps;e=o&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*o)+1:0}if((i=this.getBufferedFrag(t.currentTime+e))&&(i=this.followingBufferedFrag(i))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.maxStartPTS,Number.POSITIVE_INFINITY)}}},e.prototype.flushMainBuffer=function(t,e){this.state=ve.BUFFER_FLUSHING;var r={startOffset:t,endOffset:e};this.altAudio&&(r.type="video"),this.hls.trigger(Ot.a.BUFFER_FLUSHING,r)},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(Pt.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0,t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){var t=this.media,e=t?t.currentTime:void 0,r=this.config;isNaN(e)||Pt.b.log("media seeking to "+e.toFixed(3));var i=this.mediaBuffer?this.mediaBuffer:t,a=ae.bufferInfo(i,e,this.config.maxBufferHole);if(this.state===ve.FRAG_LOADING){var n=this.fragCurrent;if(0===a.len&&n){var o=r.maxFragLookUpTolerance,s=n.start-o,l=n.start+n.duration+o;e<s||e>l?(n.loader&&(Pt.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ve.IDLE):Pt.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===ve.ENDED&&(0===a.len&&(this.fragPrevious=0),this.state=ve.IDLE);t&&(this.lastCurrentTime=e),this.state!==ve.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},e.prototype.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;isNaN(e)||Pt.b.log("media seeked to "+e.toFixed(3)),this.tick()},e.prototype.onMediaEnded=function(){Pt.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestLoading=function(){Pt.b.log("trigger BUFFER_RESET"),this.hls.trigger(Ot.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestParsed=function(t){var e,r=!1,i=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(r=!0),-1!==e.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&Pt.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;var a=this.config;(a.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(a.startPosition)},e.prototype.onLevelLoaded=function(t){var e=t.details,r=t.level,i=this.levels[this.levelLastLoaded],a=this.levels[r],n=e.totalduration,o=0;if(Pt.b.log("level "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+n),e.live){var s=a.details;s&&e.fragments.length>0?(T(s,e),o=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,s),e.PTSKnown&&!isNaN(o)?Pt.b.log("live playlist sliding:"+o.toFixed(3)):(Pt.b.log("live playlist - outdated PTS, unknown sliding"),w(this.fragPrevious,i,e))):(Pt.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,w(this.fragPrevious,i,e))}else e.PTSKnown=!1;if(a.details=e,this.levelLastLoaded=r,this.hls.trigger(Ot.a.LEVEL_UPDATED,{details:e,level:r}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var l=e.startTimeOffset;isNaN(l)?e.live?(this.startPosition=this.computeLivePosition(o,e),Pt.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(l<0&&(Pt.b.log("negative start time offset "+l+", count from end of last fragment"),l=o+n+l),Pt.b.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===ve.WAITING_LEVEL&&(this.state=ve.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===ve.KEY_LOADING&&(this.state=ve.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,r=t.frag;if(this.state===ve.FRAG_LOADING&&e&&"main"===r.type&&r.level===e.level&&r.sn===e.sn){var i=t.stats,a=this.levels[e.level],n=a.details;if(Pt.b.log("Loaded  "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+e.level),this.bitrateTest=!1,this.stats=i,!0===r.bitrateTest&&this.hls.nextLoadLevel)this.state=ve.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.tick();else if("initSegment"===r.sn)this.state=ve.IDLE,i.tparsed=i.tbuffered=performance.now(),n.initSegment.data=t.payload,this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.tick();else{this.state=ve.PARSING;var o=n.totalduration,s=e.level,l=e.sn,u=this.config.defaultAudioCodec||a.audioCodec;this.audioCodecSwap&&(Pt.b.log("swapping playlist audio codec"),void 0===u&&(u=this.lastAudioCodec),u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,Pt.b.log("Parsing "+l+" of ["+n.startSN+" ,"+n.endSN+"],level "+s+", cc "+e.cc);var d=this.demuxer;d||(d=this.demuxer=new ce(this.hls,"main"));var h=this.media,c=h&&h.seeking,f=!c&&(n.PTSKnown||!n.live),p=n.initSegment?n.initSegment.data:[];d.push(t.payload,p,u,a.videoCodec,e,o,f,void 0)}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;if(e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===ve.PARSING){var i,a,n=t.tracks;if(n.audio&&this.altAudio&&delete n.audio,a=n.audio){var o=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(Pt.b.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===s.indexOf("firefox")&&(o="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==a.container&&(o="mp4a.40.2",Pt.b.log("Android: force audio codec to "+o)),a.levelCodec=o,a.id=t.id}a=n.video,a&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=t.id),this.hls.trigger(Ot.a.BUFFER_CODECS,n);for(i in n){a=n[i],Pt.b.log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var l=a.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ot.a.BUFFER_APPENDING,{type:i,data:l,parent:"main",content:"initSegment"}))}this.tick()}},e.prototype.onFragParsingData=function(t){var e=this,r=this.fragCurrent,i=t.frag;if(r&&"main"===t.id&&i.sn===r.sn&&i.level===r.level&&("audio"!==t.type||!this.altAudio)&&this.state===ve.PARSING){var a=this.levels[this.level],n=r;if(isNaN(t.endPTS)&&(t.endPTS=t.startPTS+r.duration,t.endDTS=t.startDTS+r.duration),Pt.b.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(n.dropped=t.dropped,n.dropped)if(n.backtracked)Pt.b.warn("Already backtracked on this fragment, appending with the gap");else{var o=a.details;if(!o||n.sn!==o.startSN)return Pt.b.warn("missing video frame(s), backtracking fragment"),n.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=ve.IDLE,this.fragPrevious=n,void this.tick();Pt.b.warn("missing video frame(s) on first frag, appending with gap")}else n.backtracked=!1;var s=E(a.details,n,t.startPTS,t.endPTS,t.startDTS,t.endDTS),l=this.hls;l.trigger(Ot.a.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:s,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(r){r&&r.length&&e.state===ve.PARSING&&(e.appended=!0,e.pendingBuffering=!0,l.trigger(Ot.a.BUFFER_APPENDING,{type:t.type,data:r,parent:"main",content:"data"}))}),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===ve.PARSING&&(this.stats.tparsed=performance.now(),this.state=ve.PARSED,this._checkAppendedParsed())},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url,r=t.id;if(!e){if(this.mediaBuffer!==this.media){Pt.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(Pt.b.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ve.IDLE}var a=this.hls;a.trigger(Ot.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}},e.prototype.onAudioTrackSwitched=function(t){var e=t.id,r=!!this.hls.audioTracks[e].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(Pt.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()},e.prototype.onBufferCreated=function(t){var e=t.tracks,r=void 0,i=void 0,a=!1;for(var n in e){var o=e[n];"main"===o.id?(i=n,r=o,"video"===n&&(this.videoBuffer=e[n].buffer)):a=!0}a&&r?(Pt.b.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},e.prototype.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==ve.PARSING&&e!==ve.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==ve.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;Pt.b.log("main buffered : "+pe.toString(e.buffered));var r=this._bufferedFrags.filter(function(t){return ae.isBuffered(e,(t.startPTS+t.endPTS)/2)});r.push(t),this._bufferedFrags=r.sort(function(t,e){return t.startPTS-e.startPTS}),this.fragPrevious=t;var i=this.stats;i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=ve.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var r=!!this.media&&ae.isBuffered(this.media,this.media.currentTime)&&ae.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:case Ct.a.KEY_LOAD_ERROR:case Ct.a.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);e.loadCounter=0,Pt.b.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=ve.FRAG_LOADING_WAITING_RETRY}else Pt.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=ve.ERROR;break;case Ct.a.FRAG_LOOP_LOADING_ERROR:t.fatal||(r?(this._reduceMaxBufferLength(e.duration),this.state=ve.IDLE):e.autoLevel&&0!==e.level||(t.fatal=!0,this.state=ve.ERROR));break;case Ct.a.LEVEL_LOAD_ERROR:case Ct.a.LEVEL_LOAD_TIMEOUT:this.state!==ve.ERROR&&(t.fatal?(this.state=ve.ERROR,Pt.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==ve.WAITING_LEVEL||(this.state=ve.IDLE));break;case Ct.a.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==ve.PARSING&&this.state!==ve.PARSED||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ve.IDLE):(Pt.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},e.prototype._reduceMaxBufferLength=function(t){var e=this.config;e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,Pt.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*e.fragLoadingLoopThreshold))},e.prototype._checkBuffer=function(){var t=this.media,e=this.config;if(t&&t.readyState){var r=t.currentTime,i=this.mediaBuffer?this.mediaBuffer:t,a=i.buffered;if(!this.loadedmetadata&&a.length){this.loadedmetadata=!0;var n=t.seeking?r:this.startPosition,o=ae.isBuffered(i,n),s=a.start(0),l=!o&&Math.abs(n-s)<e.maxSeekHole;(r!==n||l)&&(Pt.b.log("target start position:"+n),l&&(n=s,Pt.b.log("target start position not buffered, seek to buffered.start(0) "+n)),Pt.b.log("adjust currentTime from "+r+" to "+n),t.currentTime=n)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var u=ae.bufferInfo(t,r,0),d=!(t.paused||t.ended||0===t.buffered.length),h=r!==this.lastCurrentTime;if(h)this.stallReported&&(Pt.b.warn("playback not stuck anymore @"+r+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(d){var c=performance.now(),f=this.hls;if(this.stalled){var p=c-this.stalled,g=u.len,v=this.nudgeRetry||0;if(g<=.5&&p>1e3*e.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,Pt.b.warn("playback stalling in low buffer @"+r),f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:g}));var y=u.nextStart,m=y-r;if(y&&m<e.maxSeekHole&&m>0){this.nudgeRetry=++v;var b=v*e.nudgeOffset;Pt.b.log("adjust currentTime from "+t.currentTime+" to next buffered @ "+y+" + nudge "+b),t.currentTime=y+b,this.stalled=void 0,f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:y+b-r})}}else if(g>.5&&p>1e3*e.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,Pt.b.warn("playback stalling in high buffer @"+r),f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:g})),this.stalled=void 0,this.nudgeRetry=++v,v<e.nudgeMaxRetry){var E=t.currentTime,T=E+v*e.nudgeOffset;Pt.b.log("adjust currentTime from "+E+" to "+T),t.currentTime=T,f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else Pt.b.error("still stuck in high buffer @"+r+" after "+e.nudgeMaxRetry+", raise fatal error"),f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=c,this.stallReported=!1}}}},e.prototype.onFragLoadEmergencyAborted=function(){this.state=ve.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},e.prototype.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(e){return ae.isBuffered(t,(e.startPTS+e.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=ve.IDLE,this.fragPrevious=null},e.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.prototype.computeLivePosition=function(t,e){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-r)},ge(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,Pt.b.log("main stream:"+e+"->"+t),this.hls.trigger(Ot.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}]),e}(Nt),me=ye,be=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ee=function(t){function e(r){O(this,e);var i=C(this,t.call(this,r,Ot.a.MANIFEST_LOADED,Ot.a.LEVEL_LOADED,Ot.a.FRAG_LOADED,Ot.a.ERROR));return i.canload=!1,i.currentLevelIndex=null,i.manualLevelIndex=-1,i.timer=null,i}return P(e,t),e.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},e.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},e.prototype.stopLoad=function(){this.canload=!1},e.prototype.onManifestLoaded=function(t){var e=[],r=void 0,i={},a=null,n=!1,s=!1,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),u=[];if(t.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,n=n||!!t.videoCodec,s=s||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),!0===l&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),a=i[t.bitrate],void 0===a?(t.url=[t.url],t.urlId=0,i[t.bitrate]=t,e.push(t)):a.url.push(t.url)}),!0===n&&!0===s&&(e=e.filter(function(t){return!!t.videoCodec})),e=e.filter(function(t){var e=t.audioCodec,r=t.videoCodec;return(!e||o(e))&&(!r||o(r))}),t.audioTracks&&(u=t.audioTracks.filter(function(t){return!t.audioCodec||o(t.audioCodec,"audio")})),e.length>0){r=e[0].bitrate,e.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=e;for(var d=0;d<e.length;d++)if(e[d].bitrate===r){this._firstLevel=d,Pt.b.log("manifest loaded,"+e.length+" level(s) found, first bitrate:"+r);break}this.hls.trigger(Ot.a.MANIFEST_PARSED,{levels:e,audioTracks:u,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:n,altAudio:u.length>0})}else this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},e.prototype.setLevelInternal=function(t){var e=this._levels,r=this.hls;if(t>=0&&t<e.length){if(this.cleanTimer(),this.currentLevelIndex!==t){Pt.b.log("switching to level "+t),this.currentLevelIndex=t;var i=e[t];i.level=t,r.trigger(Ot.a.LEVEL_SWITCH,i),r.trigger(Ot.a.LEVEL_SWITCHING,i)}var a=e[t],n=a.details;if(!n||!0===n.live){var o=a.urlId;r.trigger(Ot.a.LEVEL_LOADING,{url:a.url[o],level:t,id:o})}}else r.trigger(Ot.a.ERROR,{type:Ct.b.OTHER_ERROR,details:Ct.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},e.prototype.onError=function(t){if(!0===t.fatal)return void(t.type===Ct.b.NETWORK_ERROR&&this.cleanTimer());var e=!1,r=!1,i=void 0;switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:case Ct.a.FRAG_LOOP_LOADING_ERROR:case Ct.a.KEY_LOAD_ERROR:case Ct.a.KEY_LOAD_TIMEOUT:i=t.frag.level,r=!0;break;case Ct.a.LEVEL_LOAD_ERROR:case Ct.a.LEVEL_LOAD_TIMEOUT:i=t.context.level,e=!0;break;case Ct.a.REMUX_ALLOC_ERROR:i=t.level,e=!0}void 0!==i&&this.recoverLevel(t,i,e,r)},e.prototype.recoverLevel=function(t,e,r,i){var a=this,n=this.hls.config,o=t.details,s=this._levels[e],l=void 0,u=void 0,d=void 0;if(s.loadError++,s.fragmentError=i,!0===r){if(!(this.levelRetryCount+1<=n.levelLoadingMaxRetry))return Pt.b.error("level controller, cannot recover from "+o+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(t.fatal=!0);u=Math.min(Math.pow(2,this.levelRetryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return a.loadLevel()},u),t.levelRetry=!0,this.levelRetryCount++,Pt.b.warn("level controller, "+o+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}!0!==r&&!0!==i||(l=s.url.length,l>1&&s.loadError<l?(Pt.b.warn("level controller, "+o+" for level "+e+": switching to redundant stream id "+s.urlId),s.urlId=(s.urlId+1)%l,s.details=void 0):-1===this.manualLevelIndex?(d=0===e?this._levels.length-1:e-1,Pt.b.warn("level controller, "+o+": switch to "+d),this.hls.nextAutoLevel=this.currentLevelIndex=d):!0===i&&(Pt.b.warn("level controller, "+o+": reload a fragment"),this.currentLevelIndex=null))},e.prototype.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var r=this._levels[e.level];void 0!==r&&(r.fragmentError=!1,r.loadError=0,this.levelRetryCount=0)}},e.prototype.onLevelLoaded=function(t){var e=this,r=t.level;if(r===this.currentLevelIndex){var i=this._levels[r];!1===i.fragmentError&&(i.loadError=0,this.levelRetryCount=0);var a=t.details;if(a.live){var n=1e3*(a.averagetargetduration?a.averagetargetduration:a.targetduration),o=i.details;o&&a.endSN===o.endSN&&(n/=2,Pt.b.log("same live playlist, reload twice faster")),n-=performance.now()-t.stats.trequest,n=Math.max(1e3,Math.round(n)),Pt.b.log("live playlist, reload in "+n+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},n)}else this.cleanTimer()}},e.prototype.loadLevel=function(){var t=void 0,e=void 0;null!==this.currentLevelIndex&&!0===this.canload&&void 0!==(t=this._levels[this.currentLevelIndex])&&t.url.length>0&&(e=t.urlId,this.hls.trigger(Ot.a.LEVEL_LOADING,{url:t.url[e],level:this.currentLevelIndex,id:e}))},be(e,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&void 0!==e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),e}(Nt),Te=Ee,Re=r(3),Ae=function(t){function e(r){x(this,e);var i=F(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.FRAG_PARSING_METADATA));return i.id3Track=void 0,i.media=void 0,i}return N(e,t),e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){this.media=t.media,this.media},e.prototype.onMediaDetaching=function(){this.media=void 0},e.prototype.onFragParsingMetadata=function(t){var e=t.frag,r=t.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,a=0;a<r.length;a++){var n=Re.a.getID3Frames(r[a].data);if(n){var o=r[a].pts,s=a<r.length-1?r[a+1].pts:e.endPTS;o===s&&(s+=1e-4);for(var l=0;l<n.length;l++){var u=n[l];if(!Re.a.isTimeStampFrame(u)){var d=new i(o,s,"");d.value=u,this.id3Track.addCue(d)}}}}},e}(Nt),Se=Ae,Le=function(){function t(e){U(this,t),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return t.prototype.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},t.prototype.getTotalWeight=function(){return this.totalWeight_},t.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}(),_e=Le,we=function(){function t(e,r,i,a){B(this,t),this.hls=e,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _e(r),this.fast_=new _e(i)}return t.prototype.sample=function(t,e){t=Math.max(t,this.minDelayMs_);var r=8e3*e/t,i=t/1e3;this.fast_.sample(i,r),this.slow_.sample(i,r)},t.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function(){},t}(),De=we,Ie=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),ke=function(t){function e(r){G(this,e);var i=j(this,t.call(this,r,Ot.a.FRAG_LOADING,Ot.a.FRAG_LOADED,Ot.a.FRAG_BUFFERED,Ot.a.ERROR));return i.lastLoadedFragLevel=0,i._nextAutoLevel=-1,i.hls=r,i.timer=null,i._bwEstimator=null,i.onCheck=i._abandonRulesCheck.bind(i),i}return H(e,t),e.prototype.destroy=function(){this.clearTimer(),Nt.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag;if("main"===e.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var r=this.hls,i=t.frag.level,a=r.levels[i].details.live,n=r.config,o=void 0,s=void 0;a?(o=n.abrEwmaFastLive,s=n.abrEwmaSlowLive):(o=n.abrEwmaFastVoD,s=n.abrEwmaSlowVoD),this._bwEstimator=new De(r,s,o,n.abrEwmaDefaultEstimate)}this.fragCurrent=e}},e.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,r=this.fragCurrent,i=r.loader,a=t.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return Pt.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var n=i.stats;if(e&&n&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&r.autoLevel&&r.level){var o=performance.now()-n.trequest,s=Math.abs(e.playbackRate);if(o>500*r.duration/s){var l=t.levels,u=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/o),d=l[r.level],h=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,c=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*h/8)),f=e.currentTime,p=(c-n.loaded)/u,g=(ae.bufferInfo(e,f,t.config.maxBufferHole).end-f)/s;if(g<2*r.duration/s&&p>g){var v=void 0,y=void 0;for(y=r.level-1;y>a;y--){var m=l[y].realBitrate?Math.max(l[y].realBitrate,l[y].bitrate):l[y].bitrate;if((v=r.duration*m/(6.4*u))<g)break}v<p&&(Pt.b.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+v.toFixed(1)+"<"+p.toFixed(1)+":"+g.toFixed(1)),t.nextLoadLevel=y,this._bwEstimator.sample(o,n.loaded),i.abort(),this.clearTimer(),t.trigger(Ot.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}},e.prototype.onFragLoaded=function(t){var e=t.frag;if("main"===e.type&&!isNaN(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[e.level],i=(r.loaded?r.loaded.bytes:0)+t.stats.loaded,a=(r.loaded?r.loaded.duration:0)+t.frag.duration;r.loaded={bytes:i,duration:a},r.realBitrate=Math.round(8*i/a)}if(t.frag.bitrateTest){var n=t.stats;n.tparsed=n.tbuffered=n.tload,this.onFragBuffered(t)}}},e.prototype.onFragBuffered=function(t){var e=t.stats,r=t.frag;if(!(!0===e.aborted||1!==r.loadCounter||"main"!==r.type||isNaN(r.sn)||r.bitrateTest&&e.tload!==e.tbuffered)){var i=e.tparsed-e.trequest
;Pt.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(i,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},e.prototype.onError=function(t){switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},e.prototype._findBestLevel=function(t,e,r,i,a,n,o,s,l){for(var u=a;u>=i;u--){var d=l[u],h=d.details,c=h?h.totalduration/h.fragments.length:e,f=!!h&&h.live,p=void 0;p=u<=t?o*r:s*r;var g=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,v=g*c/p;if(Pt.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+g+"/"+c+"/"+n+"/"+v),p>g&&(!v||f&&!this.bitrateTestDelay||v<n))return u}return-1},Ie(e,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var r=this._nextABRAutoLevel;return-1!==t&&(r=Math.min(t,r)),r},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,r=t.levels,i=t.config,a=t.minAutoLevel,n=t.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,h=(ae.bufferInfo(n,l,i.maxBufferHole).end-l)/u,c=this._findBestLevel(o,s,d,a,e,h,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(c>=0)return c;Pt.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var f=s?Math.min(s,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(0===h){var v=this.bitrateTestDelay;if(v){f=(s?Math.min(s,i.maxLoadingDelay):i.maxLoadingDelay)-v,Pt.b.trace("bitrate test took "+Math.round(1e3*v)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),p=g=1}}return c=this._findBestLevel(o,s,d,a,e,h+f,p,g,r),Math.max(c,0)}}]),e}(Nt),Oe=ke,Ce=y(),Pe=function(t){function e(r){K(this,e);var i=W(this,t.call(this,r,Ot.a.MEDIA_ATTACHING,Ot.a.MEDIA_DETACHING,Ot.a.MANIFEST_PARSED,Ot.a.BUFFER_RESET,Ot.a.BUFFER_APPENDING,Ot.a.BUFFER_CODECS,Ot.a.BUFFER_EOS,Ot.a.BUFFER_FLUSHING,Ot.a.LEVEL_PTS_UPDATED,Ot.a.LEVEL_UPDATED));return i._msDuration=null,i._levelDuration=null,i._live=null,i._objectUrl=null,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i.pendingTracks={},i.tracks={},i}return V(e,t),e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onLevelPtsUpdated=function(t){var e=t.type,r=this.tracks.audio;if("audio"===e&&r&&"audio/mpeg"===r.container){var i=this.sourceBuffer.audio;if(Math.abs(i.timestampOffset-t.start)>.1){var a=i.updating;try{i.abort()}catch(t){a=!0,Pt.b.warn("can not abort audio buffer: "+t)}a?this.audioTimestampOffset=t.start:(Pt.b.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+t.start),i.timestampOffset=t.start)}}},e.prototype.onManifestParsed=function(t){var e=t.audio,r=t.video||t.levels.length&&t.audio,i=0;t.altAudio&&(e||r)&&(i=(e?1:0)+(r?1:0),Pt.b.log(i+" sourceBuffer(s) expected")),this.sourceBufferNb=i},e.prototype.onMediaAttaching=function(t){var e=this.media=t.media;if(e){var r=this.mediaSource=new Ce;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),e.src=URL.createObjectURL(r),this._objectUrl=e.src}},e.prototype.onMediaDetaching=function(){Pt.b.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){Pt.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):Pt.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(Ot.a.MEDIA_DETACHED)},e.prototype.onMediaSourceOpen=function(){Pt.b.log("media source opened"),this.hls.trigger(Ot.a.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},e.prototype.checkPendingTracks=function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},e.prototype.onMediaSourceClose=function(){Pt.b.log("media source closed")},e.prototype.onMediaSourceEnded=function(){Pt.b.log("media source ended")},e.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;Pt.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e=this.parent,r=this.segments.reduce(function(t,r){return r.parent===e?t+1:t},0);this.hls.trigger(Ot.a.BUFFER_APPENDED,{parent:e,pending:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},e.prototype.onSBUpdateError=function(t){Pt.b.error("sourceBuffer error:",t),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var r=t[e];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},e.prototype.onBufferCodecs=function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}},e.prototype.createSourceBuffers=function(t){var e=this.sourceBuffer,r=this.mediaSource;for(var i in t)if(!e[i]){var a=t[i],n=a.levelCodec||a.codec,o=a.container+";codecs="+n;Pt.b.log("creating sourceBuffer("+o+")");try{var s=e[i]=r.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[i]={codec:n,container:a.container},a.buffer=s}catch(t){Pt.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:o})}}this.hls.trigger(Ot.a.BUFFER_CREATED,{tracks:t})},e.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},e.prototype.onBufferAppendFail=function(t){Pt.b.error("sourceBuffer error:",t.event),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferEos=function(t){var e=this.sourceBuffer,r=t.type;for(var i in e)r&&i!==r||e[i].ended||(e[i].ended=!0,Pt.b.log(i+" sourceBuffer now EOS"));this.checkEos()},e.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(!e||"open"!==e.readyState)return void(this._needsEos=!1);for(var r in t){var i=t[r];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}Pt.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){Pt.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},e.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},e.prototype.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._live=e.live,this.updateMediaElementDuration())},e.prototype.updateMediaElementDuration=function(){var t=this.hls.config,e=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(Pt.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||e===1/0||isNaN(e))&&(Pt.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},e.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,r=this.sourceBuffer;try{for(var i in r)e+=r[i].buffered.length}catch(t){Pt.b.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(Ot.a.BUFFER_FLUSHED)}},e.prototype.doAppending=function(){var t=this.hls,e=this.sourceBuffer,r=this.segments;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void Pt.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var i=r.shift();try{var a=i.type,n=e[a];n?n.updating?r.unshift(i):(n.ended=!1,this.parent=i.parent,n.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){Pt.b.error("error while trying to append buffer:"+e.message),r.unshift(i);var o={type:Ct.b.MEDIA_ERROR,parent:i.parent};if(22===e.code)return this.segments=[],o.details=Ct.a.BUFFER_FULL_ERROR,o.fatal=!1,void t.trigger(Ot.a.ERROR,o);if(this.appendError?this.appendError++:this.appendError=1,o.details=Ct.a.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry)return Pt.b.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],o.fatal=!0,void t.trigger(Ot.a.ERROR,o);o.fatal=!1,t.trigger(Ot.a.ERROR,o)}}}},e.prototype.flushBuffer=function(t,e,r){var i,a,n,o,s,l,u=this.sourceBuffer;if(Object.keys(u).length){if(Pt.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if(i=u[d],i.ended=!1,i.updating)return Pt.b.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),o=i.buffered.end(a),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(s=t,l=e):(s=Math.max(n,t),l=Math.min(o,e)),Math.min(l,o)-s>.5)return this.flushBufferCounter++,Pt.b.log("flush "+d+" ["+s+","+l+"], of ["+n+","+o+"], pos:"+this.media.currentTime),i.remove(s,l),!1}catch(t){Pt.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else Pt.b.warn("abort flushing too many retries");Pt.b.log("buffer flushed")}return!0},e}(Nt),xe=Pe,Fe=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ne=function(t){function e(r){return Y(this,e),z(this,t.call(this,r,Ot.a.FPS_DROP_LEVEL_CAPPING,Ot.a.MEDIA_ATTACHING,Ot.a.MANIFEST_PARSED))}return X(e,t),e.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},e.prototype.onFpsDropLevelCapping=function(t){e.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},e.prototype.onMediaAttaching=function(t){this.media=t.media instanceof HTMLVideoElement?t.media:null},e.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],e.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,e.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.prototype.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},e.prototype.getMaxLevel=function(t){var r=this;if(!this.levels)return-1;var i=this.levels.filter(function(i,a){return e.isLevelAllowed(a,r.restrictedLevels)&&a<=t});return e.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},e.isLevelAllowed=function(t){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(t)},e.getMaxLevelByMediaSize=function(t,e,r){if(!t||t&&!t.length)return-1;for(var i=t.length-1,a=0;a<t.length;a+=1){var n=t[a];if((n.width>=e||n.height>=r)&&function(t,e){return!e||(t.width!==e.width||t.height!==e.height)}(n,t[a+1])){i=a;break}}return i},Fe(e,[{key:"mediaWidth",get:function(){var t=void 0,r=this.media;return r&&(t=r.width||r.clientWidth||r.offsetWidth,t*=e.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,r=this.media;return r&&(t=r.height||r.clientHeight||r.offsetHeight,t*=e.contentScaleFactor),t}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}]),e}(Nt),Me=Ne,Ue=function(t){function e(r){return q(this,e),Q(this,t.call(this,r,Ot.a.MEDIA_ATTACHING))}return J(e,t),e.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},e.prototype.onMediaAttaching=function(t){var e=this.hls.config;if(e.capLevelOnFPSDrop){"function"==typeof(this.video=t.media instanceof HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod)}},e.prototype.checkFPS=function(t,e,r){var i=performance.now();if(e){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,o=e-this.lastDecodedFrames,s=1e3*n/a,l=this.hls;if(l.trigger(Ot.a.FPS_DROP,{currentDropped:n,currentDecoded:o,totalDroppedFrames:r}),s>0&&n>l.config.fpsDroppedMonitoringThreshold*o){var u=l.currentLevel;Pt.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(Ot.a.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=e}},e.prototype.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},e}(Nt),Be=Ue,Ge=function(){function t(e){$(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return t.prototype.destroy=function(){this.abort(),this.loader=null},t.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function(t,e,r){this.context=t,this.config=e,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},t.prototype.loadInternal=function(){var t,e=this.context;t=this.loader=new XMLHttpRequest;var r=this.stats;r.tfirst=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(t,e.url)}catch(r){t.open("GET",e.url,!0),i(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(r){return void this.callbacks.onError({code:t.status,text:r.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.prototype.readystatechange=function(t){var e=t.currentTarget,r=e.readyState,i=this.stats,a=this.context,n=this.config;if(!i.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===r){var o=e.status;if(o>=200&&o<300){i.tload=Math.max(i.tfirst,performance.now());var s=void 0,l=void 0;"arraybuffer"===a.responseType?(s=e.response,l=s.byteLength):(s=e.responseText,l=s.length),i.loaded=i.total=l;var u={url:e.responseURL,data:s};this.callbacks.onSuccess(u,i,a,e)}else i.retry>=n.maxRetry||o>=400&&o<499?(Pt.b.error(o+" while loading "+a.url),this.callbacks.onError({code:o,text:e.statusText},a,e)):(Pt.b.warn(o+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,n.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),n.timeout)},t.prototype.loadtimeout=function(){Pt.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function(t){var e=t.currentTarget,r=this.stats;r.loaded=t.loaded,t.lengthComputable&&(r.total=t.total);var i=this.callbacks.onProgress;i&&i(r,this.context,null,e)},t}(),je=Ge,He=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ke=function(t){function e(r){Z(this,e);var i=tt(this,t.call(this,r,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_PARSED,Ot.a.AUDIO_TRACK_LOADED,Ot.a.ERROR));return i.ticks=0,i.ontick=i.tick.bind(i),i}return et(e,t),e.prototype.destroy=function(){this.cleanTimer(),Nt.prototype.destroy.call(this)},e.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},e.prototype.doTick=function(){this.updateTrack(this.trackId)},e.prototype.onError=function(t){t.fatal&&t.type===Ct.b.NETWORK_ERROR&&this.cleanTimer()},e.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},e.prototype.onManifestParsed=function(t){var e=this,r=t.audioTracks||[],i=!1;this.tracks=r,this.hls.trigger(Ot.a.AUDIO_TRACKS_UPDATED,{audioTracks:r});var a=0;r.forEach(function(t){if(t.default&&!i)return e.audioTrack=a,void(i=!0);a++}),!1===i&&r.length&&(Pt.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},e.prototype.onAudioTrackLoaded=function(t){t.id<this.tracks.length&&(Pt.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&this.cleanTimer())},e.prototype.setAudioTrackInternal=function(t){if(t>=0&&t<this.tracks.length){this.cleanTimer(),this.trackId=t,Pt.b.log("switching to audioTrack "+t);var e=this.tracks[t],r=this.hls,i=e.type,a=e.url,n={id:t,type:i,url:a};r.trigger(Ot.a.AUDIO_TRACK_SWITCH,n),r.trigger(Ot.a.AUDIO_TRACK_SWITCHING,n);var o=e.details;!a||void 0!==o&&!0!==o.live||(Pt.b.log("(re)loading playlist for audioTrack "+t),r.trigger(Ot.a.AUDIO_TRACK_LOADING,{url:a,id:t}))}},e.prototype.updateTrack=function(t){if(t>=0&&t<this.tracks.length){this.cleanTimer(),this.trackId=t,Pt.b.log("updating audioTrack "+t);var e=this.tracks[t],r=e.url,i=e.details;!r||void 0!==i&&!0!==i.live||(Pt.b.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(Ot.a.AUDIO_TRACK_LOADING,{url:r,id:t}))}},He(e,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.trackId===t&&void 0!==this.tracks[t].details||this.setAudioTrackInternal(t)}}]),e}(Nt),We=Ke,Ve=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ye={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},ze=function(t){function e(r){rt(this,e);var i=it(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.AUDIO_TRACKS_UPDATED,Ot.a.AUDIO_TRACK_SWITCHING,Ot.a.AUDIO_TRACK_LOADED,Ot.a.KEY_LOADED,Ot.a.FRAG_LOADED,Ot.a.FRAG_PARSING_INIT_SEGMENT,Ot.a.FRAG_PARSING_DATA,Ot.a.FRAG_PARSED,Ot.a.ERROR,Ot.a.BUFFER_RESET,Ot.a.BUFFER_CREATED,Ot.a.BUFFER_APPENDED,Ot.a.BUFFER_FLUSHED,Ot.a.INIT_PTS_FOUND));return i.config=r.config,i.audioCodecSwap=!1,i.ticks=0,i._state=Ye.STOPPED,i.ontick=i.tick.bind(i),i.initPTS=[],i.waitingFragment=null,i.videoTrackCC=null,i}return at(e,t),e.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Nt.prototype.destroy.call(this),this.state=Ye.STOPPED},e.prototype.onInitPtsFound=function(t){var e=t.id,r=t.frag.cc,i=t.initPTS;"main"===e&&(this.initPTS[r]=i,this.videoTrackCC=r,Pt.b.log("InitPTS for cc:"+r+" found from video track:"+i),this.state===Ye.WAITING_INIT_PTS&&this.tick())},e.prototype.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,e>0&&-1===t?(Pt.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=Ye.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=Ye.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=Ye.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ye.STOPPED},e.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},e.prototype.doTick=function(){var t,e,r,i=this.hls,a=i.config;switch(this.state){case Ye.ERROR:case Ye.PAUSED:case Ye.BUFFER_FLUSHING:break;case Ye.STARTING:this.state=Ye.WAITING_TRACK,this.loadedmetadata=!1;break;case Ye.IDLE:var n=this.tracks;if(!n)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var o=this.mediaBuffer?this.mediaBuffer:this.media,s=this.videoBuffer?this.videoBuffer:this.media,l=ae.bufferInfo(o,t,a.maxBufferHole),u=ae.bufferInfo(s,t,a.maxBufferHole),d=l.len,h=l.end,c=this.fragPrevious,f=Math.max(a.maxBufferLength,u.len),p=this.audioSwitch,g=this.trackId;if((d<f||p)&&g<n.length){if(void 0===(r=n[g].details)){this.state=Ye.WAITING_TRACK;break}if(!p&&!r.live&&c&&c.sn===r.endSN&&!l.nextStart&&(!this.media.seeking||this.media.duration-h<c.duration/2)){this.hls.trigger(Ot.a.BUFFER_EOS,{type:"audio"}),this.state=Ye.ENDED;break}var v=r.fragments,y=v.length,m=v[0].start,b=v[y-1].start+v[y-1].duration,E=void 0;if(p)if(r.live&&!r.PTSKnown)Pt.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),h=0;else if(h=t,r.PTSKnown&&t<m){if(!(l.end>m||l.nextStart))return;Pt.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=m+.05}if(r.initSegment&&!r.initSegment.data)E=r.initSegment;else if(h<=m){if(E=v[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=A(v,this.videoTrackCC)),r.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var T=l.nextStart?l.nextStart:m;return Pt.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(T+.05)),void(this.media.currentTime=T+.05)}}else{var R=void 0,S=a.maxFragLookUpTolerance,L=c?v[c.sn-v[0].sn+1]:void 0,_=function(t){var e=Math.min(S,t.duration);return t.start+t.duration-e<=h?1:t.start-e>h&&t.start?-1:0};h<b?(h>b-S&&(S=0),R=L&&!_(L)?L:re.search(v,_)):R=v[y-1],R&&(E=R,m=R.start,c&&E.level===c.level&&E.sn===c.sn&&(E.sn<r.endSN?(E=v[E.sn+1-r.startSN],Pt.b.log("SN just loaded, load next one: "+E.sn)):E=null))}if(E)if(E.decryptdata&&null!=E.decryptdata.uri&&null==E.decryptdata.key)Pt.b.log("Loading key for "+E.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+g),this.state=Ye.KEY_LOADING,i.trigger(Ot.a.KEY_LOADING,{frag:E});else{if(Pt.b.log("Loading "+E.sn+", cc: "+E.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+g+", currentTime:"+t+",bufferEnd:"+h.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,E.loadCounter){E.loadCounter++;var w=a.fragLoadingLoopThreshold;if(E.loadCounter>w&&Math.abs(this.fragLoadIdx-E.loadIdx)<w)return void i.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:E})}else E.loadCounter=1;E.loadIdx=this.fragLoadIdx,this.fragCurrent=E,this.startFragRequested=!0,isNaN(E.sn)||(this.nextLoadPosition=E.start+E.duration),i.trigger(Ot.a.FRAG_LOADING,{frag:E}),this.state=Ye.FRAG_LOADING}}break;case Ye.WAITING_TRACK:e=this.tracks[this.trackId],e&&e.details&&(this.state=Ye.IDLE);break;case Ye.FRAG_LOADING_WAITING_RETRY:var D=performance.now(),I=this.retryDate;o=this.media;var k=o&&o.seeking;(!I||D>=I||k)&&(Pt.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=Ye.IDLE);break;case Ye.WAITING_INIT_PTS:var O=this.videoTrackCC;if(void 0===this.initPTS[O])break;var C=this.waitingFragment;if(C){var P=C.frag.cc;O!==P?(e=this.tracks[this.trackId],e.details&&e.details.live&&(Pt.b.warn("Waiting fragment CC ("+P+") does not match video track CC ("+O+")"),this.waitingFragment=null,this.state=Ye.IDLE)):(this.state=Ye.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=Ye.IDLE;break;case Ye.STOPPED:case Ye.FRAG_LOADING:case Ye.PARSING:case Ye.PARSED:case Ye.ENDED:}},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(Pt.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.tracks;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){this.state===Ye.ENDED&&(this.state=Ye.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},e.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.prototype.onAudioTracksUpdated=function(t){Pt.b.log("audio tracks updated"),this.tracks=t.audioTracks},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=Ye.PAUSED,this.waitingFragment=null,e?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=Ye.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},e.prototype.onAudioTrackLoaded=function(t){var e=t.details,r=t.id,i=this.tracks[r],a=e.totalduration,n=0;if(Pt.b.log("track "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+a),e.live){var o=i.details;o&&e.fragments.length>0?(T(o,e),n=e.fragments[0].start,e.PTSKnown?Pt.b.log("live audio playlist sliding:"+n.toFixed(3)):Pt.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,Pt.b.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(i.details=e,!this.startFragRequested){if(-1===this.startPosition){var s=e.startTimeOffset;isNaN(s)?this.startPosition=0:(Pt.b.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s)}this.nextLoadPosition=this.startPosition}this.state===Ye.WAITING_TRACK&&(this.state=Ye.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===Ye.KEY_LOADING&&(this.state=Ye.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,r=t.frag;if(this.state===Ye.FRAG_LOADING&&e&&"audio"===r.type&&r.level===e.level&&r.sn===e.sn){var i=this.tracks[this.trackId],a=i.details,n=a.totalduration,o=e.level,s=e.sn,l=e.cc,u=this.config.defaultAudioCodec||i.audioCodec||"mp4a.40.2",d=this.stats=t.stats;if("initSegment"===s)this.state=Ye.IDLE,d.tparsed=d.tbuffered=performance.now(),a.initSegment.data=t.payload,this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:d,frag:e,id:"audio"}),this.tick();else{this.state=Ye.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new ce(this.hls,"audio"));var h=this.initPTS[l],c=a.initSegment?a.initSegment.data:[];if(a.initSegment||void 0!==h){this.pendingBuffering=!0,Pt.b.log("Demuxing "+s+" of ["+a.startSN+" ,"+a.endSN+"],track "+o);this.demuxer.push(t.payload,c,u,null,e,n,!1,h)}else Pt.b.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+a.startSN+" ,"+a.endSN+"],track "+o),this.waitingFragment=t,this.state=Ye.WAITING_INIT_PTS}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;if(e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===Ye.PARSING){var i=t.tracks,a=void 0;if(i.video&&delete i.video,a=i.audio){a.levelCodec=a.codec,a.id=t.id,this.hls.trigger(Ot.a.BUFFER_CODECS,i),Pt.b.log("audio track:audio,container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var n=a.initSegment;if(n){var o={type:"audio",data:n,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ot.a.BUFFER_APPENDING,o))}this.tick()}}},e.prototype.onFragParsingData=function(t){var e=this,r=this.fragCurrent,i=t.frag;if(r&&"audio"===t.id&&"audio"===t.type&&i.sn===r.sn&&i.level===r.level&&this.state===Ye.PARSING){var a=this.trackId,n=this.tracks[a],o=this.hls;isNaN(t.endPTS)&&(t.endPTS=t.startPTS+r.duration,t.endDTS=t.startDTS+r.duration),Pt.b.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),E(n.details,r,t.startPTS,t.endPTS);var s=this.audioSwitch,l=this.media,u=!1;if(s&&l)if(l.readyState){var d=l.currentTime;Pt.b.log("switching audio track : currentTime:"+d),
d>=t.startPTS&&(Pt.b.log("switching audio track : flushing all audio"),this.state=Ye.BUFFER_FLUSHING,o.trigger(Ot.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u=!0,this.audioSwitch=!1,o.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:a}))}else this.audioSwitch=!1,o.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:a});var h=this.pendingData;this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&h.push({type:t.type,data:e,parent:"audio",content:"data"})}),!u&&h.length&&(h.forEach(function(t){e.state===Ye.PARSING&&(e.pendingBuffering=!0,e.hls.trigger(Ot.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===Ye.PARSING&&(this.stats.tparsed=performance.now(),this.state=Ye.PARSED,this._checkAppendedParsed())},e.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},e.prototype.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==Ye.PARSING&&e!==Ye.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==Ye.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,r=this.hls;if(t){this.fragPrevious=t,e.tbuffered=performance.now(),r.trigger(Ot.a.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;Pt.b.log("audio buffered : "+pe.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Ye.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:if(!t.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r,e.loadCounter=0;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);Pt.b.warn("audioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=performance.now()+a,this.state=Ye.FRAG_LOADING_WAITING_RETRY}else Pt.b.error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Ye.ERROR}break;case Ct.a.FRAG_LOOP_LOADING_ERROR:case Ct.a.AUDIO_TRACK_LOAD_ERROR:case Ct.a.AUDIO_TRACK_LOAD_TIMEOUT:case Ct.a.KEY_LOAD_ERROR:case Ct.a.KEY_LOAD_TIMEOUT:this.state!==Ye.ERROR&&(this.state=t.fatal?Ye.ERROR:Ye.IDLE,Pt.b.warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ..."));break;case Ct.a.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===Ye.PARSING||this.state===Ye.PARSED)){var n=this.mediaBuffer,o=this.media.currentTime;if(n&&ae.isBuffered(n,o)&&ae.isBuffered(n,o+.5)){var s=this.config;s.maxMaxBufferLength>=s.maxBufferLength&&(s.maxMaxBufferLength/=2,Pt.b.warn("audio:reduce max buffer length to "+s.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*s.fragLoadingLoopThreshold),this.state=Ye.IDLE}else Pt.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ye.BUFFER_FLUSHING,this.hls.trigger(Ot.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},e.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(Pt.b.log("appending pending audio data on Buffer Flushed"),e.forEach(function(e){t.hls.trigger(Ot.a.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=Ye.PARSED):(this.state=Ye.IDLE,this.fragPrevious=null,this.tick())},Ve(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,Pt.b.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}]),e}(Nt),Xe=ze,qe=function(){function t(t){return"string"==typeof t&&(!!n[t.toLowerCase()]&&t.toLowerCase())}function e(t){return"string"==typeof t&&(!!o[t.toLowerCase()]&&t.toLowerCase())}function r(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)t[i]=r[i]}return t}function i(i,n,o){var s=this,l=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),u={};l?s=document.createElement("custom"):u.enumerable=!0,s.hasBeenReset=!1;var d="",h=!1,c=i,f=n,p=o,g=null,v="",y=!0,m="auto",b="start",E=50,T="middle",R=50,A="middle";if(Object.defineProperty(s,"id",r({},u,{get:function(){return d},set:function(t){d=""+t}})),Object.defineProperty(s,"pauseOnExit",r({},u,{get:function(){return h},set:function(t){h=!!t}})),Object.defineProperty(s,"startTime",r({},u,{get:function(){return c},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",r({},u,{get:function(){return f},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",r({},u,{get:function(){return p},set:function(t){p=""+t,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",r({},u,{get:function(){return g},set:function(t){g=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",r({},u,{get:function(){return v},set:function(e){var r=t(e);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");v=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",r({},u,{get:function(){return y},set:function(t){y=!!t,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",r({},u,{get:function(){return m},set:function(t){if("number"!=typeof t&&t!==a)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",r({},u,{get:function(){return b},set:function(t){var r=e(t);if(!r)throw new SyntaxError("An invalid or illegal string was specified.");b=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",r({},u,{get:function(){return E},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",r({},u,{get:function(){return T},set:function(t){var r=e(t);if(!r)throw new SyntaxError("An invalid or illegal string was specified.");T=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",r({},u,{get:function(){return R},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");R=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",r({},u,{get:function(){return A},set:function(t){var r=e(t);if(!r)throw new SyntaxError("An invalid or illegal string was specified.");A=r,this.hasBeenReset=!0}})),s.displayState=void 0,l)return s}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var a="auto",n={"":!0,lr:!0,rl:!0},o={start:!0,middle:!0,end:!0,left:!0,right:!0};return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),Qe=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};st.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var Je=new qe(0,0,0),$e="middle"===Je.align?"middle":"center";nt.prototype={parse:function(t){function e(){var t=r.buffer,e=0;for(t=dt(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var i=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,r.buffer=t.substr(e),i}var r=this;t&&(r.buffer+=r.decoder.decode(t,{stream:!0}));try{var i;if("INITIAL"===r.state){if(!/\r\n|\n/.test(r.buffer))return this;i=e();var a=i.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var n=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(n?n=!1:i=e(),r.state){case"HEADER":/:/.test(i)?function(t){lt(t,function(t,e){switch(t){case"Region":console.log("parse region",e)}},/:/)}(i):i||(r.state="ID");continue;case"NOTE":i||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){r.state="NOTE";break}if(!i)continue;if(r.cue=new qe(0,0,""),r.state="CUE",-1===i.indexOf("--\x3e")){r.cue.id=i;continue}case"CUE":try{ut(i,r.cue,r.regionList)}catch(t){r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var o=-1!==i.indexOf("--\x3e");if(!i||o&&(n=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}r.cue.text&&(r.cue.text+="\n"),r.cue.text+=i;continue;case"BADCUE":i||(r.state="ID");continue}}}catch(t){"CUETEXT"===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state="INITIAL"===r.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}};var Ze=nt,tr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},er=function(t){var e=t;return tr.hasOwnProperty(t)&&(e=tr[t]),String.fromCharCode(e)},rr=15,ir=100,ar={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},nr={17:2,18:4,21:6,22:8,23:10,19:13,20:15},or={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},sr={25:2,26:4,29:6,30:8,31:10,27:13,28:15},lr=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],ur={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){var r=this.verboseFilter[t];this.verboseLevel>=r&&console.log(this.time+" ["+t+"] "+e)}},dr=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e},hr=function(){function t(e,r,i,a,n){ct(this,t),this.foreground=e||"white",this.underline=r||!1,this.italics=i||!1,this.background=a||"black",this.flash=n||!1}return t.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},t.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},t.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},t.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),cr=function(){function t(e,r,i,a,n,o){ct(this,t),this.uchar=e||" ",this.penState=new hr(r,i,a,n,o)}return t.prototype.reset=function(){this.uchar=" ",this.penState.reset()},t.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},t.prototype.setPenState=function(t){this.penState.copy(t)},t.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},t.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},t.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),fr=function(){function t(){ct(this,t),this.chars=[];for(var e=0;e<ir;e++)this.chars.push(new cr);this.pos=0,this.currPenState=new hr}return t.prototype.equals=function(t){for(var e=!0,r=0;r<ir;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<ir;e++)this.chars[e].copy(t.chars[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<ir;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},t.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(ur.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>ir&&(ur.log("ERROR","Too large cursor position "+this.pos),this.pos=ir)},t.prototype.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},t.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.prototype.insertChar=function(t){t>=144&&this.backSpace();var e=er(t);if(this.pos>=ir)return void ur.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},t.prototype.clearFromPos=function(t){var e;for(e=t;e<ir;e++)this.chars[e].reset()},t.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.prototype.getTextString=function(){for(var t=[],e=!0,r=0;r<ir;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},t.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),pr=function(){function t(){ct(this,t),this.rows=[];for(var e=0;e<rr;e++)this.rows.push(new fr);this.currRow=rr-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function(){for(var t=0;t<rr;t++)this.rows[t].clear();this.currRow=rr-1},t.prototype.equals=function(t){for(var e=!0,r=0;r<rr;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<rr;e++)this.rows[e].copy(t.rows[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<rr;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},t.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},t.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},t.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},t.prototype.setCursor=function(t){ur.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},t.prototype.setPAC=function(t){ur.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<rr;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var n=a.rows[i].cueStartTime;if(n&&n<ur.time)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(a.rows[i+o])}}this.currRow=e;var s=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,u=Math.max(l-1,0);s.setCursor(t.indent),t.color=s.chars[u].penState.foreground}var d={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(d)},t.prototype.setBkgData=function(t){ur.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},t.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},t.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void ur.log("DEBUG","roll_up but nrRollUpRows not set yet");ur.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),ur.log("INFO","Rolling up")},t.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],r="",i=-1,a=0;a<rr;a++){var n=this.rows[a].getTextString();n&&(i=a+1,t?e.push("Row "+i+": '"+n+"'"):e.push(n.trim()))}return e.length>0&&(r=t?"["+e.join(" | ")+"]":e.join("\n")),r},t.prototype.getTextAndFormat=function(){return this.rows},t}(),gr=function(){function t(e,r){ct(this,t),this.chNr=e,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new pr,this.nonDisplayedMemory=new pr,this.lastOutputScreen=new pr,this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return t.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.prototype.getHandler=function(){return this.outputFilter},t.prototype.setHandler=function(t){this.outputFilter=t},t.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},t.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},t.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,ur.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},t.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";ur.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(ur.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function(){ur.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.prototype.ccBS=function(){ur.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function(){},t.prototype.ccAON=function(){},t.prototype.ccDER=function(){ur.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.prototype.ccRU=function(t){ur.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},t.prototype.ccFON=function(){ur.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function(){ur.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=function(){ur.log("INFO","TR"),this.setMode("MODE_TEXT")},t.prototype.ccRTD=function(){ur.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.prototype.ccEDM=function(){ur.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.prototype.ccCR=function(){ur.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.prototype.ccENM=function(){ur.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.prototype.ccEOC=function(){if(ur.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,ur.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function(t){ur.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},t.prototype.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var r=Math.floor(t/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[r]}ur.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},t.prototype.outputDataUpdate=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=ur.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),vr=function(){function t(e,r,i){ct(this,t),this.field=e||1,this.outputs=[r,i],this.channels=[new gr(1,r),new gr(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function(t){return this.channels[t].getHandler()},t.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},t.prototype.addData=function(t,e){var r,i,a,n=!1;this.lastTime=t,ur.setTime(t);for(var o=0;o<e.length;o+=2)if(i=127&e[o],a=127&e[o+1],0!==i||0!==a){if(ur.log("DATA","["+dr([e[o],e[o+1]])+"] -> ("+dr([i,a])+")"),r=this.parseCmd(i,a),r||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(n=this.parseChars(i,a)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(n)}else ur.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,ur.log("WARNING","Couldn't parse cleaned data "+dr([i,a])+" orig: "+dr([e[o],e[o+1]])))}else this.dataCounters.padding+=2},t.prototype.parseCmd=function(t,e){var r=null,i=(20===t||28===t)&&32<=e&&e<=47,a=(23===t||31===t)&&33<=e&&e<=35;if(!i&&!a)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,ur.log("DEBUG","Repeated command ("+dr([t,e])+") is dropped"),!0;r=20===t||23===t?1:2;var n=this.channels[r-1];return 20===t||28===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},t.prototype.parseMidrow=function(t,e){var r=null;if((17===t||25===t)&&32<=e&&e<=47){if((r=17===t?1:2)!==this.currChNr)return ur.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[r-1].ccMIDROW(e),ur.log("DEBUG","MIDROW ("+dr([t,e])+")"),!0}return!1},t.prototype.parsePAC=function(t,e){var r=null,i=null,a=(17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127,n=(16===t||24===t)&&64<=e&&e<=95;if(!a&&!n)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=t<=23?1:2,i=64<=e&&e<=95?1===r?ar[t]:or[t]:1===r?nr[t]:sr[t];var o=this.interpretPAC(i,e);return this.channels[r-1].setPAC(o),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},t.prototype.interpretPAC=function(t,e){var r=e,i={color:null,italics:!1,indent:null,underline:!1,row:t};return r=e>95?e-96:e-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},t.prototype.parseChars=function(t,e){var r=null,i=null,a=null;if(t>=25?(r=2,a=t-8):(r=1,a=t),17<=a&&a<=19){var n=e;n=17===a?e+80:18===a?e+112:e+144,ur.log("INFO","Special char '"+er(n)+"' in channel "+r),i=[n]}else 32<=t&&t<=127&&(i=0===e?[t]:[t,e]);if(i){var o=dr(i);ur.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i},t.prototype.parseBackgroundAttributes=function(t,e){var r,i,a,n,o=(16===t||24===t)&&32<=e&&e<=47,s=(23===t||31===t)&&45<=e&&e<=47;return!(!o&&!s)&&(r={},16===t||24===t?(i=Math.floor((e-32)/2),r.background=lr[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0)),a=t<24?1:2,n=this.channels[a-1],n.setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)},t.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},t.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},t}(),yr=vr,mr=function(){function t(e,r){ft(this,t),this.timelineController=e,this.track=r,this.startTime=null,this.endTime=null,this.screen=null}return t.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},t.prototype.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.track)},t}(),br=mr,Er=function(t,e,r){return t.substr(r||0,e.length)===e},Tr=function(t){var e=parseInt(t.substr(-3)),r=parseInt(t.substr(-6,2)),i=parseInt(t.substr(-9,2)),a=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;return isNaN(e)||isNaN(r)||isNaN(i)||isNaN(a)?-1:(e+=1e3*r,e+=6e4*i,e+=36e5*a)},Rr=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()},Ar=function(t,e,r){var i=t[e],a=t[i.prevCC];if(!a||!a.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;a&&a.new;)t.ccOffset+=i.start-a.start,i.new=!1,i=a,a=t[i.prevCC];t.presentationOffset=r},Sr={parse:function(t,e,r,i,a,n){var o=/\r\n|\n\r|\n|\r/g,s=Object(Re.b)(new Uint8Array(t)).trim().replace(o,"\n").split("\n"),l="00:00.000",u=0,d=0,h=0,c=[],f=void 0,p=!0,g=new Ze;g.oncue=function(t){var e=r[i],a=r.ccOffset;e&&e.new&&(void 0!==d?a=r.ccOffset=e.start:Ar(r,i,h)),h&&(a=h+r.ccOffset-r.presentationOffset),t.startTime+=a-d,t.endTime+=a-d,t.id=Rr(t.startTime.toString())+Rr(t.endTime.toString())+Rr(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&c.push(t)},g.onparsingerror=function(t){f=t},g.onflush=function(){if(f&&n)return void n(f);a(c)},s.forEach(function(t){if(p){if(Er(t,"X-TIMESTAMP-MAP=")){p=!1,t.substr(16).split(",").forEach(function(t){Er(t,"LOCAL:")?l=t.substr(6):Er(t,"MPEGTS:")&&(u=parseInt(t.substr(7)))});try{e=e<0?e+8589934592:e,u-=e,d=Tr(l)/1e3,h=u/9e4,-1===d&&(f=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){f=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(p=!1)}g.parse(t+"\n")}),g.flush()}},Lr=Sr,_r=function(t){function e(r){pt(this,e);var i=gt(this,t.call(this,r,Ot.a.MEDIA_ATTACHING,Ot.a.MEDIA_DETACHING,Ot.a.FRAG_PARSING_USERDATA,Ot.a.FRAG_DECRYPTED,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_LOADED,Ot.a.FRAG_LOADED,Ot.a.LEVEL_SWITCHING,Ot.a.INIT_PTS_FOUND));if(i.hls=r,i.config=r.config,i.enabled=!0,i.Cues=r.config.cueHandler,i.textTracks=[],i.tracks=[],i.unparsedVttFrags=[],i.initPTS=void 0,i.cueRanges=[],i.config.enableCEA708Captions){var a=new br(i,1),n=new br(i,2);i.cea608Parser=new yr(0,a,n)}return i}return vt(e,t),e.prototype.addCues=function(t,e,r,i){for(var a=this.cueRanges,n=!1,o=a.length;o--;){var s=a[o],l=bt(s[0],s[1],e,r);if(l>=0&&(s[0]=Math.min(s[0],e),s[1]=Math.max(s[1],r),n=!0,l/(r-e)>.5))return}n||a.push([e,r]),this.Cues.newCue(this[t],e,r,i)},e.prototype.onInitPtsFound=function(t){var e=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])},e.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r],a="textTrack"+t;if(!0===i[a])return i}return null},e.prototype.sendAddTrackEvent=function(t,e){var r=null;try{r=new window.Event("addtrack")}catch(t){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)},e.prototype.createCaptionsTrack=function(t){var e="textTrack"+t;if(!this[e]){var r=this.getExistingTrack(t);if(r)this[e]=r,yt(this[e]),this.sendAddTrackEvent(this[e],this.media);else{var i=this.createTextTrack("captions",this.config["captionsTextTrack"+t+"Label"],this.config.captionsTextTrack1LanguageCode);i&&(i[e]=!0,this[e]=i)}}},e.prototype.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},e.prototype.onMediaDetaching=function(){yt(this.textTrack1),yt(this.textTrack2)},e.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},e.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)yt(e[r])}},e.prototype.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var r=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,i){var a=void 0;if(i<r.length){var n=r[i];mt(n,t)&&(a=n)}a||(a=e.createTextTrack("subtitles",t.name,t.lang)),a.mode=t.default?"showing":"hidden",e.textTracks.push(a)})}},e.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},e.prototype.onFragLoaded=function(t){var e=t.frag,r=t.payload;if("main"===e.type){var i=e.sn;if(i!==this.lastSn+1){var a=this.cea608Parser;a&&a.reset()}this.lastSn=i}else if("subtitle"===e.type)if(r.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);var n=e.decryptdata;null!=n&&null!=n.key&&"AES-128"===n.method||this._parseVTTs(e,r)}else this.hls.trigger(Ot.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},e.prototype._parseVTTs=function(t,e){var r=this.vttCCs;r[t.cc]||(r[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var i=this.textTracks,a=this.hls;Lr.parse(e,this.initPTS,r,t.cc,function(e){var r=i[t.trackId];e.forEach(function(t){if(!r.cues.getCueById(t.id))try{r.addCue(t)}catch(i){var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,r.addCue(e)}}),a.trigger(Ot.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(e){Pt.b.log("Failed to parse VTT cue: "+e),a.trigger(Ot.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},e.prototype.onFragDecrypted=function(t){var e=t.payload,r=t.frag;if("subtitle"===r.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);this._parseVTTs(r,e)}},e.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var r=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,r)}},e.prototype.extractCea608Data=function(t){for(var e,r,i,a,n,o=31&t[0],s=2,l=[],u=0;u<o;u++)e=t[s++],r=127&t[s++],i=127&t[s++],a=0!=(4&e),n=3&e,0===r&&0===i||a&&0===n&&(l.push(r),l.push(i));return l},e}(Nt),wr=_r,Dr=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ir=function(t){function e(r){Et(this,e)
;var i=Tt(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_LOADED,Ot.a.SUBTITLE_TRACK_LOADED));return i.tracks=[],i.trackId=-1,i.media=void 0,i.subtitleDisplay=!1,i}return Rt(e,t),e.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=At(this.media.textTracks),r=0;r<e.length;r++)"showing"===e[r].mode&&(t=r);this.subtitleTrack=t}},e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},e.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},e.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},e.prototype.onManifestLoaded=function(t){var e=this,r=t.subtitles||[];this.tracks=r,this.trackId=-1,this.hls.trigger(Ot.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:r}),r.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},e.prototype.onTick=function(){var t=this.trackId,e=this.tracks[t];if(e){var r=e.details;void 0!==r&&!0!==r.live||(Pt.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(Ot.a.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))}},e.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(Pt.b.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},e.prototype.setSubtitleTrackInternal=function(t){if(!(t<-1||t>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var e=At(this.media.textTracks);if(-1!==this.trackId&&this.subtitleDisplay&&(e[this.trackId].mode="hidden"),this.trackId=t,Pt.b.log("switching to subtitle track "+t),this.hls.trigger(Ot.a.SUBTITLE_TRACK_SWITCH,{id:t}),-1!==t){var r=this.tracks[t];this.subtitleDisplay&&(e[t].mode="showing");var i=r.details;void 0!==i&&!0!==i.live||(Pt.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(Ot.a.SUBTITLE_TRACK_LOADING,{url:r.url,id:t}))}}},Dr(e,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&this.setSubtitleTrackInternal(t)}}]),e}(Nt),kr=Ir,Or=r(4),Cr={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Pr=function(t){function e(r){St(this,e);var i=Lt(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.ERROR,Ot.a.KEY_LOADED,Ot.a.FRAG_LOADED,Ot.a.SUBTITLE_TRACKS_UPDATED,Ot.a.SUBTITLE_TRACK_SWITCH,Ot.a.SUBTITLE_TRACK_LOADED,Ot.a.SUBTITLE_FRAG_PROCESSED));return i.config=r.config,i.vttFragSNsProcessed={},i.vttFragQueues=void 0,i.currentlyProcessing=null,i.state=Cr.STOPPED,i.currentTrackId=-1,i.ticks=0,i.decrypter=new Or.a(r.observer,r.config),i}return _t(e,t),e.prototype.destroy=function(){Nt.prototype.destroy.call(this),this.state=Cr.STOPPED},e.prototype.clearVttFragQueues=function(){var t=this;this.vttFragQueues={},this.tracks.forEach(function(e){t.vttFragQueues[e.id]=[]})},e.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=t,this.hls.trigger(Ot.a.FRAG_LOADING,{frag:t}),this.state=Cr.FRAG_LOADING}},e.prototype.onSubtitleFragProcessed=function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.state=Cr.IDLE,this.nextFrag()},e.prototype.onMediaAttached=function(){this.state=Cr.IDLE},e.prototype.onError=function(t){var e=t.frag;e&&"subtitle"!==e.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},e.prototype.tick=function(){var t=this;1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(function(){t.tick()},1),this.ticks=0)},e.prototype.doTick=function(){var t=this;switch(this.state){case Cr.IDLE:var e=this.tracks,r=this.currentTrackId,i=this.vttFragSNsProcessed[r],a=this.vttFragQueues[r],n=this.currentlyProcessing?this.currentlyProcessing.sn:-1,o=function(t){return i.indexOf(t.sn)>-1},s=function(t){return a.some(function(e){return e.sn===t.sn})};if(!e)break;var l;if(r<e.length&&(l=e[r].details),void 0===l)break;l.fragments.forEach(function(e){o(e)||e.sn===n||s(e)||(e.decryptdata&&null!=e.decryptdata.uri&&null==e.decryptdata.key?(Pt.b.log("Loading key for "+e.sn),t.state=Cr.KEY_LOADING,t.hls.trigger(Ot.a.KEY_LOADING,{frag:e})):(e.trackId=r,a.push(e),t.nextFrag()))})}},e.prototype.onSubtitleTracksUpdated=function(t){var e=this;Pt.b.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]})},e.prototype.onSubtitleTrackSwitch=function(t){this.currentTrackId=t.id,this.clearVttFragQueues()},e.prototype.onSubtitleTrackLoaded=function(){this.tick()},e.prototype.onKeyLoaded=function(){this.state===Cr.KEY_LOADING&&(this.state=Cr.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,r=t.frag.decryptdata,i=t.frag,a=this.hls;if(this.state===Cr.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&null!=r&&null!=r.key&&"AES-128"===r.method){var n;try{n=performance.now()}catch(t){n=Date.now()}this.decrypter.decrypt(t.payload,r.key.buffer,r.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}a.trigger(Ot.a.FRAG_DECRYPTED,{frag:i,payload:t,stats:{tstart:n,tdecrypt:e}})})}},e}(Nt),xr=Pr,Fr={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:je,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:Oe,bufferController:xe,capLevelController:Me,fpsController:Be,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};Fr.subtitleStreamController=xr,Fr.subtitleTrackController=kr,Fr.timelineController=wr,Fr.cueHandler=Dt,Fr.enableCEA708Captions=!0,Fr.enableWebVTT=!0,Fr.captionsTextTrack1Label="English",Fr.captionsTextTrack1LanguageCode="en",Fr.captionsTextTrack2Label="Spanish",Fr.captionsTextTrack2LanguageCode="es",Fr.audioStreamController=Xe,Fr.audioTrackController=We;var Nr=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Mr=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};wt(this,t);var i=t.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in i)a in r||(r[a]=i[a]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(Pt.a)(r.debug),this.config=r,this._autoLevelCapping=-1;var n=this.observer=new se.a;n.trigger=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];n.emit.apply(n,[t,t].concat(r))},n.off=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];n.removeListener.apply(n,[t].concat(r))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n);var o=this.abrController=new r.abrController(this),s=new r.bufferController(this),l=new r.capLevelController(this),u=new r.fpsController(this),d=new Qt(this),h=new $t(this),c=new te(this),f=new Se(this),p=this.levelController=new Te(this),g=this.streamController=new me(this),v=[p,g],y=r.audioStreamController;y&&v.push(new y(this)),this.networkControllers=v;var m=[d,h,c,o,s,l,u,f];if(y=r.audioTrackController){var b=new y(this);this.audioTrackController=b,m.push(b)}if(y=r.subtitleTrackController){var E=new y(this);this.subtitleTrackController=E,m.push(E)}[r.subtitleStreamController,r.timelineController].forEach(function(t){t&&m.push(new t(e))}),this.coreComponents=m}return t.isSupported=function(){return M()},Nr(t,null,[{key:"version",get:function(){return"0.8.9"}},{key:"Events",get:function(){return Ot.a}},{key:"ErrorTypes",get:function(){return Ct.b}},{key:"ErrorDetails",get:function(){return Ct.a}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:Fr},set:function(e){t.defaultConfig=e}}]),t.prototype.destroy=function(){Pt.b.log("destroy"),this.trigger(Ot.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function(t){Pt.b.log("attachMedia"),this.media=t,this.trigger(Ot.a.MEDIA_ATTACHING,{media:t})},t.prototype.detachMedia=function(){Pt.b.log("detachMedia"),this.trigger(Ot.a.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function(t){t=kt.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),Pt.b.log("loadSource:"+t),this.url=t,this.trigger(Ot.a.MANIFEST_LOADING,{url:t})},t.prototype.startLoad=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;Pt.b.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},t.prototype.stopLoad=function(){Pt.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},t.prototype.swapAudioCodec=function(){Pt.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function(){Pt.b.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},Nr(t,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){Pt.b.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){Pt.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){Pt.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){Pt.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){Pt.b.log("set startLevel:"+t);var e=this;-1!==t&&(t=Math.max(t,e.minAutoLevel)),e.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){Pt.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this,e=t.levels,r=t.config.minAutoBitrate,i=e?e.length:0,a=0;a<i;a++){if((e[a].realBitrate?Math.max(e[a].realBitrate,e[a].bitrate):e[a].bitrate)>r)return a}return 0}},{key:"maxAutoLevel",get:function(){var t=this,e=t.levels,r=t.autoLevelCapping;return-1===r&&e&&e.length?e.length-1:r}},{key:"nextAutoLevel",get:function(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function(t){var e=this;e.abrController.nextAutoLevel=Math.max(e.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),t}();e.default=Mr},function(t,e,r){function i(t){function e(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e.oe=function(t){throw console.error(t),t};var i=e(e.s=ENTRY_MODULE);return i.default||i}function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(t){var e=[],r=t.toString(),i=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return e;for(var n,o=i[1],s=new RegExp("(\\\\n|\\W)"+a(o)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");n=s.exec(r);)e.push(n[3]);return e}function o(t,e){for(var r=[e],i=[],a={};r.length;){var o=r.pop();if(!a[o]&&t[o]){a[o]=!0,i.push(o);var s=n(t[o]);r=r.concat(s)}}return i}t.exports=function(t,e){e=e||{};var a=r.m,n=e.all?Object.keys(a):o(a,t),s="("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n.map(function(t){return JSON.stringify(t)+": "+a[t].toString()}).join(",")+"})(self);",l=new window.Blob([s],{type:"text/javascript"});if(e.bare)return l;var u=window.URL||window.webkitURL||window.mozURL||window.msURL,d=u.createObjectURL(l),h=new window.Worker(d);return h.objectURL=d,h}},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});var i=r(7),a=r(1),n=r(0),o=r(5),s=r.n(o),l=function(t){var e=new s.a;e.trigger=function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];e.emit.apply(e,[t,t].concat(i))},e.off=function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];e.removeListener.apply(e,[t].concat(i))};var r=function(e,r){t.postMessage({event:e,data:r})};t.addEventListener("message",function(a){var o=a.data;switch(o.cmd){case"init":var s=JSON.parse(o.config);t.demuxer=new i.a(e,o.typeSupported,s,o.vendor);try{Object(n.a)(!0===s.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}r("init",null);break;case"demux":t.demuxer.push(o.data,o.decryptdata,o.initSegment,o.audioCodec,o.videoCodec,o.timeOffset,o.discontinuity,o.trackSwitch,o.contiguous,o.duration,o.accurateTimeOffset,o.defaultInitPTS)}}),e.on(a.a.FRAG_DECRYPTED,r),e.on(a.a.FRAG_PARSING_INIT_SEGMENT,r),e.on(a.a.FRAG_PARSED,r),e.on(a.a.ERROR,r),e.on(a.a.FRAG_PARSING_METADATA,r),e.on(a.a.FRAG_PARSING_USERDATA,r),e.on(a.a.INIT_PTS_FOUND,r),e.on(a.a.FRAG_PARSING_DATA,function(e,r){var i=[],a={event:e,data:r};r.data1&&(a.data1=r.data1.buffer,i.push(r.data1.buffer),delete r.data1),r.data2&&(a.data2=r.data2.buffer,i.push(r.data2.buffer),delete r.data2),t.postMessage(a,i)})};e.default=l}]).default});hy.define("player.akamai",["popcorn","virtualmediaelement","hls","utils.embed"],function(Popcorn,VirtualMediaElement,Hls,Utils){window.Hls=Hls;return VirtualMediaElement.register("akamai",function(state,parent,options){var that=this,destroyed=false;var player,elem,akamaiConfig;function createElement(){elem=document.createElement("div");elem.id="akamai-media-player";elem.style.width=(state.width||640)+"px";elem.style.height=(state.height||360)+"px";parent.appendChild(elem)}function hidePlayerComponent(componentName){if(player&&player.container&&player.container.querySelector&&player.container.querySelector(componentName)){player.container.querySelector(componentName).style.display="none"}}return{apiRequires:{Akamai:function(){if(window.akamai){return""}return"/js/vendor/akamai/amp/amp.min.js"}},player:function(resources,resolve){function akamaiSetupEvents(player){player.addEventListener("timeupdate",function(time){state.setCurrentTime(time.data)});player.addEventListener("volumechange",function(evt){state.setVolume(evt.data)});player.addEventListener("pause",state.setPaused);player.addEventListener("play",state.setPlay);player.addEventListener("ended",function(){state.setEnded()});player.addEventListener("seeking",function(){state.setSeeking()});player.addEventListener("seeked",function(){that._utils.updatePlayerUI(player,false);state.setSeeked()});player.addEventListener("fullscreenchange",function(e){var playerElement=e.player.viewComponent.querySelector(".hapyak-annotation-container"),isFullscreen=e.detail;if(e.detail===true){playerElement.style["z-index"]=0}if(e.detail===false){playerElement.style["z-index"]=""}});that.WasteManagement.toggleOpenEnrollment(false);state.setDimensions(+player.viewComponent.offsetWidth,+player.viewComponent.offsetHeight);state.setDuration(player.getDuration());state.setVolume(player.getVolume());that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA);resolve(player)})}destroyed=false;if(options&&options.partnerVideoAsset){state.src=options.partnerVideoAsset}if(typeof state.src==="string"){if(!elem){createElement()}akamaiConfig={playback_clicktoggle_enabled:false,autoplay:true,playoverlay:{enabled:false},plugins:{react:{enabled:false}},media:{title:"",poster:"",source:[{src:decodeURIComponent(state.src).replace("http:","https:"),type:options.partnerAssetType||"application/x-mpegURL"}],playback_clicktoggle_enabled:false},flash:{vars:{playback_clicktoggle_enabled:false}},paths:{base:"/js/vendor/akamai/akamai/amp/",root:"/js/vendor/akamai/",resources:"/js/vendor/akamai/resources/",player:"/js/vendor/akamai/amp/",plugins:"/js/vendor/akamai/akamai/amp/"}};player=akamai.amp.AMP.create("akamai-media-player",akamaiConfig);that.WasteManagement.setup(player,"addEventListener","removeEventListener");player.addEventListener("ready",function(){if(player.getMediaElement()){player.getMediaElement().controls=state.controls}player.addEventListener("loadedmetadata",function loadedMetaDataListener(){player.removeEventListener("loadedmetadata",loadedMetaDataListener);player.pause(true);akamaiSetupEvents(player)})})}else{var annotationContainer,mediaElement;player=state.src;that.WasteManagement.setup(player,"addEventListener","removeEventListener");if(typeof player.getMediaElement==="function"){mediaElement=player.getMediaElement();annotationContainer=Utils.dotget(mediaElement,"amp.viewComponent.children.3")}if(player.controls){player.controls.setMode(!state.controls?"none":"auto")}else if(player.react){player.react.mode=!state.controls?"none":"auto";hidePlayerComponent(".amp-pause-overlay");hidePlayerComponent(".amp-interactive");annotationContainer.addEventListener("click",function(event){if(Utils.dotget(event,"target.classList").contains("hapyak-annotation-container")){if(player.paused){that.play()}else{that.pause()}}});annotationContainer.style["pointer-events"]="auto";annotationContainer.style.opacity="1"}akamaiSetupEvents(player)}},currentTime:function(time){if(destroyed){return}if(player&&time!==undefined&&time>=0){state.setCurrentTime(time);player.setCurrentTime(time)}return state.currentTime},play:function(){player.play(true)},pause:function(){player.pause(true)},volume:function(volume){if(volume!==undefined&&player){player.unmute();player.setVolume(volume)}return state.volume},muted:function(isMuted){state.setMuted(isMuted);state.setVolume(+!isMuted)},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}if(window.onDestroyRemoveDellEmcStylesheet&&state.currentTime>.5){window.onDestroyRemoveDellEmcStylesheet(state.currentTime)}player=null;elem=null;akamaiConfig=null},width:function(width){if(player&&width){player.viewComponent.style.width=width+"px"}return state.width},height:function(height){if(player&&height){player.viewComponent.style.height=height+"px"}return state.height},offsetWidth:function(){if(player){return player.getContainer().offsetWidth}return parent&&parent.offsetWidth||0},offsetHeight:function(){if(player){return player.getContainer().offsetHeight}return parent&&parent.offsetHeight||0},outerContainer:function(){return player.container.firstElementChild},videoWidth:function(){var mediaElement,quality,qualityLevels;if(player){mediaElement=player.getMediaElement();quality=player.getQuality();qualityLevels=player.getQualityLevels();if(mediaElement&&mediaElement.width&&mediaElement.width.indexOf("%")===-1){return mediaElement.width}if(quality&&qualityLevels[quality]){return qualityLevels[quality].width}}return state.videoWidth},videoHeight:function(){var mediaElement,quality,qualityLevels;if(player){mediaElement=player.getMediaElement();quality=player.getQuality();qualityLevels=player.getQualityLevels();if(mediaElement&&mediaElement.height&&mediaElement.height.indexOf("%")===-1){return mediaElement.height}if(quality&&qualityLevels[quality]){return qualityLevels[quality].height}}return state.videoHeight},canPlayType:function(){return"probably"}}},{findExisting:function(obj){if(typeof obj.getDuration==="function"){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"},utils:{getPlayerInstance:function(){return player},updatePlayerUI:function(player,show){var bigPlayButton;if(!player||!player.container){return}bigPlayButton=player.container.querySelector(".amp-pause-overlay");if(!bigPlayButton){return}bigPlayButton.style.display=show?"":"none"}}})});hy.define("player.profile.akamai",["popcorn","player.wrappers","player.akamai"],function(Popcorn,wrappers,HTMLAkamaiVideoElement){Popcorn.HTMLAkamaiVideoElement=HTMLAkamaiVideoElement;wrappers.akamai={id:"akamai",name:"Akamai",fn:"HTMLAkamaiVideoElement",args:function(video,options){return[options.playerParameters]},container:function(container){return container.getContainer()}};return wrappers.akamai});(function(window,Popcorn,undefined){var document=window.document,EMPTY_STRING="",apiScriptElement,apiReadyCallbacks=[],playerUtil,limelightSWF=(window.location.protocol==="https"?"https":"http")+"://assets.delvenetworks.com/player/loader.swf",htmlEvents={onError:"error",onPlayerLoad:"loadstart",onMediaLoad:"loadedmetadata",onMediaComplete:"ended",onPlayheadUpdate:"timeupdate"},readyStates=[["loadstart"],["durationchange","loadedmetadata"],["loadeddata"],["loadeddata","canplay"],["canplaythrough"]];function findExistingPlayer(src){var DelvePlayer=window.DelvePlayer;if(DelvePlayer&&DelvePlayer.getPlayers){return DelvePlayer.getPlayers().some(function(player){return player===src})}return false}function isApiReady(){if(window.LimelightPlayerUtil){playerUtil=window.LimelightPlayerUtil;while(apiReadyCallbacks.length){apiReadyCallbacks.shift()()}return}setTimeout(isApiReady,100)}function apiReadyPromise(fn){if(!window.LimelightPlayerUtil&&!apiScriptElement){apiScriptElement=document.createElement("script");apiScriptElement.async=true;apiScriptElement.src=(document.location.protocol==="file:"?"http:":document.location.protocol)+"//assets.delvenetworks.com/player/embed.js";document.head.appendChild(apiScriptElement)}if(window.LimelightPlayerUtil){playerUtil=window.LimelightPlayerUtil;fn()}else{apiReadyCallbacks.push(fn);isApiReady()}}function HTMLLimelightVideoElement(id){var self=this,parent=typeof id==="string"?Popcorn.dom.find(id):id,elem,impl={src:EMPTY_STRING,networkState:self.NETWORK_EMPTY,readyState:self.HAVE_NOTHING,seeking:false,autoplay:EMPTY_STRING,preload:EMPTY_STRING,controls:false,loop:false,poster:EMPTY_STRING,volume:1,muted:0,currentTime:0,duration:NaN,ended:false,paused:true,width:parent.getPlayer?parent.getPlayer().offsetWidth:parent.offsetWidth,height:parent.getPlayer?parent.getPlayer().offsetHeight:parent.offsetHeight,error:null,progressAmount:null},maxReadyState=0,playEventPending=false,playingEventPending=false,playerReady=false,player,existingPlayer,playerReadyCallbacks=[],stalledTimeout,playerElem,eventCallbacks={},mediaInfo;function playerReadyPromise(fn,unique){var i;if(playerReady){fn();return}if(unique){i=playerReadyCallbacks.indexOf(fn);if(i>=0){playerReadyCallbacks.splice(i,1)}}playerReadyCallbacks.push(fn)}function registerEventListener(name,src,dest){var callback;callback=eventCallbacks[name];if(callback){removeListener(name,callback)}if(typeof src==="function"){callback=function(evt){if(src.call(this,evt)){if(htmlEvents[name]){self.dispatchEvent(htmlEvents[name])}}}}else{callback=function(){if(htmlEvents[name]){self.dispatchEvent(htmlEvents[name])}}}eventCallbacks[name]=callback}function removeEventListeners(){Popcorn.forEach(eventCallbacks,function(name){eventCallbacks[name]=null})}function setReadyState(state){var i,queue;if(state<=impl.readyState){return}maxReadyState=Math.max(maxReadyState,state);if(state-impl.readyState>1){return}impl.readyState++;queue=readyStates[maxReadyState];for(i=0;i<queue.length;i++){self.dispatchEvent(queue[i])}setReadyState(maxReadyState)}function destroyPlayer(){clearTimeout(stalledTimeout);if(!(playerReady&&player)){return}player.doPause();removeEventListeners();playerReady=false;player=null;parent.removeChild(elem);elem=null}function onDurationChange(data){var duration;if(mediaInfo&&mediaInfo.durationInMilliseconds){duration=mediaInfo.durationInMilliseconds/1e3}else{duration=NaN}if(impl.duration!==duration&&duration){impl.duration=duration}if(!impl.duration){return}if(impl.readyState<self.HAVE_METADATA){setReadyState(self.HAVE_METADATA)}else{self.dispatchEvent("durationchange")}if(playEventPending){self.dispatchEvent("play")}if(playingEventPending){playingEventPending=false;self.dispatchEvent("playing")}if(playEventPending){playEventPending=false;if(impl.paused){self.dispatchEvent("pause")}}}function onStalled(){if(!impl.duration||impl.progressAmount<impl.duration){impl.networkState=self.NETWORK_IDLE;self.dispatchEvent("stalled")}else{monitorStalled()}}function monitorStalled(){clearTimeout(stalledTimeout);stalledTimeout=setTimeout(onStalled,3e3)}function updateSize(){playerElem.width=impl.width;playerElem.height=impl.height}function changeSrc(aSrc){destroyPlayer();impl.readyState=-1;maxReadyState=-1;playEventPending=false;playingEventPending=false;if(impl.networkState!==self.NETWORK_EMPTY){if(impl.networkState===self.NETWORK_LOADING||impl.networkState===self.NETWORK_IDLE){self.dispatchEvent("abort")}self.dispatchEvent("emptied")}if(!impl.paused&&playerReady){player.doPause()}impl.seeking=false;impl.duration=NaN;if(impl.currentTime){impl.currentTime=0;self.dispatchEvent("timeupdate")}impl.error=null;if(!aSrc){impl.readyState=self.HAVE_NOTHING;return}if(!self._canPlaySrc(aSrc)){impl.error={name:"MediaError",message:"Media Source Not Supported",code:window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};impl.networkState=self.NETWORK_NO_SRC;self.dispatchEvent("error");return}impl.src=aSrc;impl.networkState=self.NETWORK_LOADING;setReadyState(self.HAVE_NOTHING);apiReadyPromise(function(){var oldDelvePlayerCallback;if(!impl.src&&player){destroyPlayer()}existingPlayer=findExistingPlayer(impl.src);if(!existingPlayer){elem=document.createElement("object");elem.type="application/x-shockwave-flash";elem.id=Popcorn.guid("hapyak-limelight-");elem.name=elem.id;elem.className="LimelightEmbeddedPlayerFlash";elem.width=impl.width;elem.height=impl.height;elem.data=limelightSWF;Popcorn.forEach({movie:limelightSWF,wmode:"transparent",allowScriptAccess:"always",allowFullScreen:"true",flashVars:decodeURIComponent(impl.src.split("?")[1])},function(val,key){var param=document.createElement("param");param.name=key;param.value=val;elem.appendChild(param)});window.delvePlayerCallback=function(playerId,eventName,data){if(eventName==="onPlayerLoad"){window.DelvePlayer.registerPlayer(elem.id)}else if(eventName==="onMediaLoad"&&!player){player=window.DelvePlayer.getPlayer();playerElem=player.getPlayer();mediaInfo=player.doGetCurrentMedia();apiReady()}if(eventName&&eventCallbacks[eventName]){eventCallbacks[eventName](data)}};parent.appendChild(elem);playerUtil.initEmbed(elem.id)}else{player=impl.src;playerElem=player.getPlayer();impl.src="http://link.delvenetworks.com/media/?"+player.getPlayer().querySelector("[name=flashVars]").value;impl.width=playerElem.offsetWidth;impl.height=playerElem.offsetHeight}function apiReady(){playerReady=true;while(playerReadyCallbacks.length){playerReadyCallbacks.shift()()}}if(existingPlayer){mediaInfo=player.doGetCurrentMedia();onDurationChange();oldDelvePlayerCallback=window.delvePlayerCallback;window.delvePlayerCallback=function(playerId,eventName,data){if(eventName&&eventCallbacks[eventName]){eventCallbacks[eventName](data)}oldDelvePlayerCallback(playerId,eventName,data)};apiReady()}playerReadyPromise(function(){registerEventListener("onError");monitorStalled();function updateProgress(){if(!impl.duration||!mediaInfo||!mediaInfo.durationInMilliseconds){onDurationChange()}if(!impl.duration){return}impl.progressAmount=player.doGetPlayheadPositionInMilliseconds()/1e3;setReadyState(self.HAVE_CURRENT_DATA);if(impl.progressAmount>=impl.duration){impl.networkState=self.NETWORK_IDLE;setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);setReadyState(self.HAVE_ENOUGH_DATA)}else{impl.networkState=self.NETWORK_LOADING;monitorStalled()}return true}updateProgress();registerEventListener("onPlayheadUpdate",function(data){var currentTime=data.positionInMilliseconds/1e3,volume=player.doGetVolume();if(impl.currentTime!==currentTime){impl.currentTime=currentTime}if(impl.volume!==volume){impl.volume=volume;self.dispatchEvent("volumechange")}updateProgress();self.dispatchEvent("timeupdate");return true})
;registerEventListener("onMediaLoad",onDurationChange);registerEventListener("onPlayStateChanged",function(data){onDurationChange();if(!impl.duration){playingEventPending=true;return false}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);if(data.isPlaying){impl.paused=false;self.dispatchEvent("play")}else{impl.paused=true;self.dispatchEvent("pause")}if(impl.seeking){self.dispatchEvent("seeking");impl.seeking=false;self.dispatchEvent("seeked")}return true});registerEventListener("ended",function(){if(impl.loop){player.doSeekToSecond(0);player.doPlay()}else{impl.ended=true;return true}});player.doPlay();player.doPause()})},true)}function setVolume(){player.doSetVolume(impl.volume)}function getVolume(){return impl.muted>0?impl.muted:impl.volume}function setMuted(){player.doSetVolume(impl.muted>0?0:impl.volume)}function getMuted(){return impl.muted>0}function setCurrentTime(){player.doSeekToSecond(impl.currentTime);impl.seeking=true;self.dispatchEvent("seeking");impl.seeking=false;self.dispatchEvent("seeked")}self._eventNamespace=Popcorn.guid("HTMLLimelightVideoElement::");self.parentNode=parent instanceof Element?parent:parent.getPlayer();self._util=Popcorn.extend({},self._util);self._util.type="Dailymotion";self.play=function(){function play(){player.doPlay()}playerReadyPromise(play,true)};self.pause=function(){function pause(){player.doPause()}playerReadyPromise(pause,true)};self.load=function(){changeSrc(impl.src)};Object.defineProperties(self,{src:{get:function(){return impl.src},set:function(aSrc){if(aSrc!==impl.src){changeSrc(aSrc)}}},autoplay:{get:function(){return impl.autoplay},set:function(aValue){impl.autoplay=self._util.isAttributeSet(aValue)}},loop:{get:function(){return impl.loop},set:function(aValue){impl.loop=self._util.isAttributeSet(aValue)}},width:{get:function(){if(player&&playerElem){return playerElem.offsetWidth}return impl.width},set:function(aValue){impl.width=aValue;playerReadyPromise(updateSize)}},videoWidth:{get:function(){return mediaInfo&&mediaInfo.images.slice(-1)[0].width||0}},height:{get:function(){if(player&&playerElem){return playerElem.offsetHeight}return impl.height},set:function(aValue){impl.height=aValue;playerReadyPromise(updateSize)}},videoHeight:{get:function(){return mediaInfo&&mediaInfo.images.slice(-1)[0].height||0}},currentTime:{get:function(){if(player&&impl.duration){return player.doGetPlayheadPositionInMilliseconds()/1e3}return 0},set:function(aValue){aValue=parseFloat(aValue);impl.currentTime=aValue;playerReadyPromise(setCurrentTime,true)}},currentSrc:{get:function(){return impl.src}},duration:{get:function(){return impl.duration}},ended:{get:function(){return impl.ended}},paused:{get:function(){return impl.paused}},seeking:{get:function(){return impl.seeking}},readyState:{get:function(){return impl.readyState}},networkState:{get:function(){return impl.networkState}},volume:{get:function(){return getVolume()},set:function(aValue){aValue=parseFloat(aValue);if(aValue<0||aValue>1||isNaN(aValue)){throw new Error("Volume value must be between 0.0 and 1.0")}impl.volume=aValue;playerReadyPromise(setVolume,true);self.dispatchEvent("volumechange")}},muted:{get:function(){return getMuted()},set:function(aValue){impl.muted=self._util.isAttributeSet(aValue)&&1||0;playerReadyPromise(setMuted,true);self.dispatchEvent("volumechange")}},error:{get:function(){return impl.error}}})}HTMLLimelightVideoElement.prototype=new Popcorn._MediaElementProto;HTMLLimelightVideoElement.prototype.constructor=HTMLLimelightVideoElement;HTMLLimelightVideoElement.prototype._canPlaySrc=function(url){return findExistingPlayer(url)||typeof url==="string"&&url.match(/^(https?:\/\/)(\w[\w\-\.]*\w\.)?delvenetworks\.com/)};HTMLLimelightVideoElement.prototype.canPlayType=function(type){return type==="video/x-limelight"?"probably":EMPTY_STRING};Popcorn.HTMLLimelightVideoElement=function(id){return new HTMLLimelightVideoElement(id)};Popcorn.HTMLLimelightVideoElement._canPlaySrc=HTMLLimelightVideoElement.prototype._canPlaySrc})(this,this.Popcorn);hy.define("popcorn.htmllimelightvideoelement",function(){});hy.define("player.profile.limelight",["player.wrappers","popcorn.htmllimelightvideoelement"],function(wrappers){wrappers.limelight={id:"limelight",name:"Limelight",fn:"HTMLLimelightVideoElement",container:function(container,wrapper){if(window.DelvePlayer&&container.getPlayer){return container.getPlayer().parentNode}return container.parentNode},src:function(video,options){var key,params=options.playerParameters||video.getCustomProperty("source_parameters"),sourceId=video.get("source_id"),src=window.location.protocol+"//link.delvenetworks.com/media/?";if(params){for(key in params){src+=key+"="+params[key]+"&"}}if(sourceId){src+="channelId="+sourceId}return src}};return wrappers.limelight});hy.define("popcorn.htmlmediaelementvideoelement",["module","popcorn"],function(module,Popcorn){var document=window.document,assetsUrl=module.config().assetsUrl,EMPTY_STRING="",apiScriptElement,apiCSSElement,apiReadyCallbacks=[],MediaElement,mejs,validMediaTypes={mp4:{type:"video/mp4"},ogv:{type:"video/ogg"},webm:{type:"video/webm"},flv:{type:"video/flv"},m4v:{type:"videp/mp4"},aac:{type:"audio/mp4"},m4a:{type:"audio/mp4"},f4a:{type:"audio/mp4"},mp3:{type:"audio/mpeg"},ogg:{type:"audio/ogg"},oga:{type:"audio/ogg"}},readyStates=[["loadstart"],["durationchange","loadedmetadata"],["loadeddata"],["loadeddata","canplay"],["canplaythrough"]];function findExistingPlayer(src){if(!MediaElement){MediaElement=window.MediaElement}if(!mejs){mejs=window.mejs}if(MediaElement&&mejs&&mejs.players){for(var player in mejs.players){if(mejs.players[player]===src){return true}}}return false}function apiReadyPromise(fn){function checkAPIReady(){if(window.MediaElement){MediaElement=window.MediaElement;mejs=window.mejs;while(apiReadyCallbacks.length){apiReadyCallbacks.shift()()}return}setTimeout(checkAPIReady,100)}if(!window.MediaElement&&!apiScriptElement){apiScriptElement=document.createElement("script");apiScriptElement.async=true;apiScriptElement.src=assetsUrl+"/vendor/mediaelement/mediaelement-and-player.min.js";document.head.appendChild(apiScriptElement)}if(!apiCSSElement){apiCSSElement=document.createElement("link");apiCSSElement.rel="stylesheet";apiCSSElement.type="text/css";apiCSSElement.href=assetsUrl+"/vendor/mediaelement/mediaelementplayer.css";document.head.appendChild(apiCSSElement)}if(window.MediaElement){MediaElement=window.MediaElement;mejs=window.mejs;fn()}else{apiReadyCallbacks.push(fn)}checkAPIReady()}function HTMLMediaElementVideoElement(id){var self=this,parent=typeof id==="string"?Popcorn.dom.find(id):id,impl={src:EMPTY_STRING,networkState:self.NETWORK_EMPTY,readyState:self.HAVE_NOTHING,seeking:false,autoplay:EMPTY_STRING,preload:EMPTY_STRING,controls:false,loop:false,poster:EMPTY_STRING,volume:1,muted:0,currentTime:0,duration:NaN,ended:false,paused:true,width:parent.container&&parent.container[0]?parent.container[0].offsetWidth:parent.offsetWidth,height:parent.container&&parent.container[0]?parent.container[0].offsetHeight:parent.offsetHeight,error:null,progressAmount:null},maxReadyState=0,mediaElementContainer,playEventPending=false,playingEventPending=false,playerReady=false,player,playerObject,existingPlayer,playerReadyCallbacks=[],stalledTimeout,eventCallbacks={};function playerReadyPromise(fn,unique){var i;if(playerReady){fn();return}if(unique){i=playerReadyCallbacks.indexOf(fn);if(i>=0){playerReadyCallbacks.splice(i,1)}}playerReadyCallbacks.push(fn)}function registerEventListener(name,src,dest){var callback;callback=eventCallbacks[name];if(callback){player.removeEventListener(name,callback)}if(typeof src==="string"){callback=function(){var val=player[dest||src];if(impl[src]!==val){impl[src]=val;self.dispatchEvent(name)}}}else if(typeof src==="function"){callback=function(evt){if(src.call(this,evt)){self.dispatchEvent(name)}}}else{callback=function(){self.dispatchEvent(name)}}eventCallbacks[name]=callback;player.addEventListener(name,callback)}function removeEventListeners(){Popcorn.forEach(eventCallbacks,function(name,callback){player.removeEventListener(name,callback)})}function setReadyState(state){var i,queue;if(state<=impl.readyState){return}maxReadyState=Math.max(maxReadyState,state);if(state-impl.readyState>1){return}impl.readyState++;queue=readyStates[impl.readyState];for(i=0;i<queue.length;i++){self.dispatchEvent(queue[i])}setReadyState(maxReadyState)}function destroyPlayer(){clearTimeout(stalledTimeout);if(!(playerReady&&player)){return}player.pause();removeEventListeners();player.remove()}function onDurationChange(){impl.duration=player.duration;if(impl.readyState<self.HAVE_METADATA){setReadyState(self.HAVE_METADATA)}else{self.dispatchEvent("durationchange")}if(playEventPending){self.dispatchEvent("play")}if(playingEventPending){playingEventPending=false;self.dispatchEvent("playing")}if(playEventPending){playEventPending=false;if(impl.paused){self.dispatchEvent("pause")}}}function onStalled(){if(!impl.duration||impl.progressAmount<impl.duration){impl.networkState=self.NETWORK_IDLE;self.dispatchEvent("stalled")}else{monitorStalled()}}function monitorStalled(){clearTimeout(stalledTimeout);stalledTimeout=setTimeout(onStalled,3e3)}function updateSize(){Popcorn.forEach([mediaElementContainer,mediaElementContainer.querySelector(".mejs-container")],function(container){if(container){container.style.width=impl.width+"px";container.style.height=impl.height+"px"}})}function changeSrc(aSrc){destroyPlayer();impl.readyState=-1;maxReadyState=-1;playEventPending=false;playingEventPending=false;if(impl.networkState!==self.NETWORK_EMPTY){if(impl.networkState===self.NETWORK_LOADING||impl.networkState===self.NETWORK_IDLE){self.dispatchEvent("abort")}self.dispatchEvent("emptied")}if(!impl.paused){if(playerReady){player.pause()}impl.paused=false}impl.seeking=false;impl.duration=NaN;if(impl.currentTime){impl.currentTime=0;self.dispatchEvent("timeupdate")}impl.error=null;if(!aSrc){impl.readyState=self.HAVE_NOTHING;return}if(!self._canPlaySrc(aSrc)){impl.error={name:"MediaError",message:"Media Source Not Supported",code:window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};impl.networkState=self.NETWORK_NO_SRC;self.dispatchEvent("error");return}impl.src=aSrc;impl.networkState=self.NETWORK_LOADING;setReadyState(self.HAVE_NOTHING);apiReadyPromise(function(){var mediaElem,videoElement;if(!impl.src){if(player){destroyPlayer()}}function apiReady(){playerReady=true;while(playerReadyCallbacks.length){playerReadyCallbacks.shift()()}}existingPlayer=findExistingPlayer(impl.src);if(!existingPlayer){mediaElementContainer=document.createElement("div");mediaElementContainer.style.width=parent.offsetWidth+"px";mediaElementContainer.style.height=parent.offsetHeight+"px";videoElement=document.createElement("video");videoElement.setAttribute("controls",undefined);if(Array.isArray(impl.src)){Popcorn.forEach(impl.src,function(source){var elem=document.createElement("source");elem.type=source.type;elem.src=source.src;videoElement.appendChild(elem)})}else{videoElement.src=impl.src}mediaElementContainer.appendChild(videoElement);parent.appendChild(mediaElementContainer);mediaElem=new MediaElementPlayer(videoElement,{videoHeight:"100%",videoWidth:"100%",loop:impl.loop,pluginPath:assetsUrl+"/vendor/mediaelement/",flashName:"flashmediaelement.swf",silverlightName:"silverlightmediaelement.xap",features:[],success:function(mediaElement,domObject){player=mediaElement;apiReady()}});mediaElem.controlsEnabled=false;mediaElem.container[0].firstChild.querySelector(".mejs-controls").style.display="none"}else{player=impl.src.media;playerObject=impl.src;impl.src=player.src;impl.width=impl.src.width||impl.width;impl.height=impl.src.height||impl.height;mediaElementContainer=playerObject.container[0];if(/[?&]autoplay=/.test(impl.src)){impl.autoplay=!!+impl.src.split("autoplay=")[1][0]}else{impl.autoplay=false}}if(existingPlayer){apiReady()}playerReadyPromise(function(){registerEventListener("error");monitorStalled();function updateProgress(){if(!impl.duration&&player.duration){onDurationChange()}if(player.bufferedTime<Infinity){impl.progressAmount=player.bufferedTime}impl.progressAmount=Math.max(impl.progressAmount,player.currentTime);setReadyState(self.HAVE_CURRENT_DATA);if(impl.progressAmount>=impl.duration){impl.networkState=self.NETWORK_IDLE;setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);setReadyState(self.HAVE_ENOUGH_DATA)}else{impl.networkState=self.NETWORK_LOADING;monitorStalled()}return true}updateProgress();registerEventListener("progress",updateProgress);registerEventListener("stalled",onStalled);registerEventListener("timeupdate","currentTime");registerEventListener("volumechange",function(){var volume=player.volume,muted=player.muted;if(impl.volume!==volume||impl.muted!==muted){impl.volume=volume;impl.muted=muted;return true}});registerEventListener("canplay",function(){if(!impl.duration&&player.duration){onDurationChange()}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA)});registerEventListener("play",function(){if(impl.paused){impl.paused=false;if(!impl.duration){playEventPending=true}else{return true}}});registerEventListener("seeking",function(){impl.seeking=true;return true});registerEventListener("seeked",function(){if(impl.seeking){impl.seeking=false;self.dispatchEvent("seeked");return true}});registerEventListener("playing",function(){if(!impl.duration&&player.duration){onDurationChange()}if(!impl.duration){playingEventPending=true;return false}setReadyState(self.HAVE_CURRENT_DATA);setReadyState(self.HAVE_FUTURE_DATA);return true});registerEventListener("pause",function(){if(!impl.paused){impl.paused=true}return true});registerEventListener("ended",function(){impl.ended=true;return true});if(impl.autoplay){player.play()}})},true)}function setVolume(){player.setVolume(impl.volume)}function getVolume(){return impl.muted>0?impl.muted:impl.volume}function setMuted(){player.setMuted(impl.muted)}function getMuted(){return impl.muted>0}function setCurrentTime(){player.setCurrentTime(impl.currentTime)}self._eventNamespace=Popcorn.guid("HTMLMediaElementVideoElement::");self.parentNode=parent instanceof Element?parent:parent.container[0];self._util=Popcorn.extend({},self._util);self._util.type="MediaElement";self.play=function(){function play(){player.play()}playerReadyPromise(play,true)};self.pause=function(){function pause(){player.pause()}playerReadyPromise(pause,true)};self.load=function(){changeSrc(impl.src)};Object.defineProperties(self,{src:{get:function(){return impl.src},set:function(aSrc){if(aSrc!==impl.src){changeSrc(aSrc)}}},autoplay:{get:function(){return impl.autoplay},set:function(aValue){impl.autoplay=self._util.isAttributeSet(aValue)}},loop:{get:function(){return impl.loop},set:function(aValue){impl.loop=self._util.isAttributeSet(aValue)}},width:{get:function(){return playerObject&&playerObject.container&&playerObject.container[0].offsetWidth||impl.width},set:function(aValue){impl.width=aValue;playerReadyPromise(updateSize)}},videoWidth:{get:function(){return player&&player.videoWidth||0}},height:{get:function(){return playerObject&&playerObject.container&&playerObject.container[0].offsetHeight||impl.height},set:function(aValue){impl.height=aValue;playerReadyPromise(updateSize)}},videoHeight:{get:function(){return player&&player.videoHeight||0}},currentTime:{get:function(){return player&&player.currentTime||0},set:function(aValue){aValue=parseFloat(aValue);if(!impl.duration||aValue<0||isNaN(aValue)){throw new Error("Invalid currentTime")}impl.currentTime=aValue;playerReadyPromise(setCurrentTime,true)}},currentSrc:{get:function(){return impl.src}},duration:{get:function(){return impl.duration}},ended:{get:function(){return impl.ended}},paused:{get:function(){return impl.paused}},seeking:{get:function(){return impl.seeking}},readyState:{get:function(){return impl.readyState}},networkState:{get:function(){return impl.networkState}},volume:{get:function(){return getVolume()},set:function(aValue){aValue=parseFloat(aValue);if(aValue<0||aValue>1||isNaN(aValue)){throw new Error("Volume value must be between 0.0 and 1.0")}impl.volume=aValue;playerReadyPromise(setVolume,true);self.dispatchEvent("volumechange")}},muted:{get:function(){return getMuted()},set:function(aValue){impl.muted=self._util.isAttributeSet(aValue)&&1||0;playerReadyPromise(setMuted,true);self.dispatchEvent("volumechange")}},error:{get:function(){return impl.error}}})}HTMLMediaElementVideoElement.prototype=new Popcorn._MediaElementProto;HTMLMediaElementVideoElement.prototype.constructor=HTMLMediaElementVideoElement;HTMLMediaElementVideoElement.prototype._canPlaySrc=function(source){var result,extensionIdx,tmpElement,extension;if(findExistingPlayer(source)){return true}if(Array.isArray(source)){for(var i=0,l=source.length;i<l&&!result;i++){result=HTMLMediaElementVideoElement.prototype._canPlaySrc(source[i]);if(result){return result}}return result}if(typeof source==="object"){return HTMLMediaElementVideoElement.prototype._canPlaySrc(source.src)}if(typeof source==="string"){tmpElement=document.createElement("video");extensionIdx=source.lastIndexOf(".");extension=validMediaTypes[source.substr(extensionIdx+1,source.length-extensionIdx)];return tmpElement.canPlayType(source)||extension?"probably":EMPTY_STRING}return EMPTY_STRING};HTMLMediaElementVideoElement.prototype.canPlayType=function(type){return type==="video/x-mediaelement"?"probably":EMPTY_STRING};Popcorn.HTMLMediaElementVideoElement=function(id){return new HTMLMediaElementVideoElement(id)};Popcorn.HTMLMediaElementVideoElement._canPlaySrc=HTMLMediaElementVideoElement.prototype._canPlaySrc});hy.define("player.profile.mediaelement",["popcorn","player.wrappers","popcorn.htmlmediaelementvideoelement"],function(Popcorn,wrappers){wrappers.mediaelement={id:"mediaelement",name:"MediaElement.js",fn:"HTMLMediaElementVideoElement",src:function(video){var arr=[];Popcorn.forEach(video.getCustomProperty("sources"),function(val){arr.push({type:val.mime_type,src:val.url})});return arr},container:function(container){return container.container[0]}};return wrappers.mediaelement});hy.define("player.profile.mediaplatform",["popcorn","player.wrappers","player.videojs4"],function(Popcorn,wrappers,HTMLVideojs4VideoElement){Popcorn.HTMLVideojs4VideoElement=HTMLVideojs4VideoElement;wrappers["mediaplatform"]={id:"mediaplatform",name:"Media Platform",fn:"HTMLVideojs4VideoElement",forceIpadControls:function(player,elements){player.controlBar.el_.style.display="none"},preserveFullscreenStyles:true,args:function(video,options){return[options.playerParameters]},container:function(container){if(typeof container.el==="function"){container=container.el()}else{container=container.el}return container},modify:function(elements,container){container.insertBefore(elements.annotationContainer,container.querySelector(".vjs-text-track-display")||container.querySelector(".vjs-loading-spinner")||container.querySelector(".vjs-big-play-button")||container.querySelector(".vjs-controls")||elements.controlBar||null)},src:function(video,options){return video.getCustomProperty("sources")}};return wrappers["mediaplatform"]});(function(Popcorn,document){var DEFAULT_UPDATE_RESOLUTION_MS=16,DEFAULT_UPDATE_RESOLUTION_S=DEFAULT_UPDATE_RESOLUTION_MS/1e3,EMPTY_STRING="",temporalRegex=/#t=(\d+)?,?(\d+)?/,instances=[];function findExistingPlayer(obj){var i,instance;if(!obj||typeof obj==="string"){return false}if(obj instanceof HTMLNullVideoElement){return obj}for(i=0;i<instances.length;i++){instance=instances[i];if(instance.parentNode===obj){return instance}}return false}function NullPlayer(options){this.currentTime=+options.currentTime||0;this.duration=+options.duration||NaN;this.playInterval=null;this.ended=options.endedCallback||Popcorn.nop}function nullPlay(video){if(video.currentTime+DEFAULT_UPDATE_RESOLUTION_S>=video.duration){video.currentTime=video.duration;video.pause();video.ended()}else{video.currentTime+=DEFAULT_UPDATE_RESOLUTION_S}}NullPlayer.prototype={play:function(){var video=this;this.playInterval=setInterval(function(){nullPlay(video)},DEFAULT_UPDATE_RESOLUTION_MS)},pause:function(){clearInterval(this.playInterval)},seekTo:function(aTime){aTime=aTime<0?0:aTime;aTime=aTime>this.duration?this.duration:aTime;this.currentTime=aTime}};function HTMLNullVideoElement(id){var self=this,parent=typeof id==="string"?document.querySelector(id):id,elem,playerReady=false,player,impl={src:EMPTY_STRING,networkState:self.NETWORK_EMPTY,readyState:self.HAVE_NOTHING,autoplay:EMPTY_STRING,preload:EMPTY_STRING,controls:EMPTY_STRING,loop:false,poster:EMPTY_STRING,volume:1,muted:false,width:parent.width|0?parent.width:self._util.MIN_WIDTH,height:parent.height|0?parent.height:self._util.MIN_HEIGHT,seeking:false,ended:false,paused:1,error:null},playerReadyCallbacks=[],timeUpdateInterval;self._eventNamespace=Popcorn.guid("HTMLNullVideoElement::");self.parentNode=parent;self._util=Popcorn.extend({},self._util);self._util.type="NullVideo";instances.push(self);function addPlayerReadyCallback(callback){playerReadyCallbacks.unshift(callback)}function onPlayerReady(){playerReady=true;impl.networkState=self.NETWORK_IDLE;impl.readyState=self.HAVE_METADATA;self.dispatchEvent("loadedmetadata");self.dispatchEvent("loadeddata");impl.readyState=self.HAVE_FUTURE_DATA;self.dispatchEvent("canplay");impl.readyState=self.HAVE_ENOUGH_DATA;self.dispatchEvent("canplaythrough");var i=playerReadyCallbacks.length;while(i--){playerReadyCallbacks[i]();delete playerReadyCallbacks[i]}if(impl.autoplay){self.play()}}function getDuration(){return player?player.duration:NaN}function destroyPlayer(){var i;i=instances.indexOf(self);if(i>=0){instances.splice(i,1)}if(!(playerReady&&player)){return}player.pause();player=null;parent.removeChild(elem);elem=null}function changeSrc(aSrc){var existing;if(!self._canPlaySrc(aSrc)){impl.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};self.dispatchEvent("error");return}existing=findExistingPlayer(aSrc);if(existing){aSrc=existing.src}impl.src=aSrc;if(playerReady){destroyPlayer();instances.push(self)}elem=document.createElement("div");elem.width=impl.width;elem.height=impl.height;parent.appendChild(elem);var fragments=temporalRegex.exec(aSrc),start=fragments[1],duration=fragments[2];player=new NullPlayer({currentTime:start,duration:duration,endedCallback:onEnded});self.dispatchEvent("loadstart");self.dispatchEvent("progress");self.dispatchEvent("durationchange");onPlayerReady()}function getCurrentTime(){if(!player){return 0}return player.currentTime||0}function changeCurrentTime(aTime){if(!playerReady){addPlayerReadyCallback(function(){changeCurrentTime(aTime)});return}onSeeking();player.seekTo(aTime);onSeeked()}function onTimeUpdate(){self.dispatchEvent("timeupdate")}function onSeeking(target){impl.seeking=true;self.dispatchEvent("seeking")}function onSeeked(){impl.seeking=false;self.dispatchEvent("timeupdate");self.dispatchEvent("seeked");self.dispatchEvent("canplay");self.dispatchEvent("canplaythrough")}function onPlay(){if(impl.paused===1){impl.paused=false;self.dispatchEvent("play");self.dispatchEvent("playing")}else{if(impl.ended){changeCurrentTime(0)}if(impl.paused){impl.paused=false;if(!impl.loop){self.dispatchEvent("play")}self.dispatchEvent("playing")}}timeUpdateInterval=setInterval(onTimeUpdate,self._util.TIMEUPDATE_MS)}self.play=function(){if(!playerReady){addPlayerReadyCallback(function(){self.play()});return}player.play();onPlay()};function onPause(){impl.paused=true;clearInterval(timeUpdateInterval);self.dispatchEvent("pause")}self.pause=function(){if(!playerReady){addPlayerReadyCallback(function(){self.pause()});return}player.pause();onPause()};self._util.destroy=function(){destroyPlayer()};function onEnded(){if(impl.loop){changeCurrentTime(0);self.play()}else{impl.ended=true;clearInterval(timeUpdateInterval);self.dispatchEvent("timeupdate");self.dispatchEvent("ended")}}function setVolume(aValue){impl.volume=aValue;self.dispatchEvent("volumechange")}function getVolume(){return impl.volume}function setMuted(aValue){impl.muted=aValue;self.dispatchEvent("volumechange")}function getMuted(){return impl.muted}Object.defineProperties(self,{src:{get:function(){return impl.src},set:function(aSrc){if(aSrc&&aSrc!==impl.src){changeSrc(aSrc)}}},autoplay:{get:function(){return impl.autoplay},set:function(aValue){impl.autoplay=self._util.isAttributeSet(aValue)}},loop:{get:function(){return impl.loop},set:function(aValue){impl.loop=self._util.isAttributeSet(aValue)}},width:{get:function(){return impl.width},set:function(aValue){impl.width=aValue;if(elem){elem.width=aValue}}},height:{get:function(){return impl.height},set:function(aValue){impl.height=aValue;if(elem){elem.height=aValue}}},currentTime:{get:function(){return getCurrentTime()},set:function(aValue){changeCurrentTime(aValue)}},duration:{get:function(){return getDuration()}},ended:{get:function(){return impl.ended}},paused:{get:function(){return impl.paused}},seeking:{get:function(){return impl.seeking}},readyState:{get:function(){return impl.readyState}},networkState:{get:function(){return impl.networkState}},volume:{get:function(){return getVolume()},set:function(aValue){if(aValue<0||aValue>1){throw new Error("Volume value must be between 0.0 and 1.0")}setVolume(aValue)}},muted:{get:function(){return getMuted()},set:function(aValue){setMuted(self._util.isAttributeSet(aValue))}},error:{get:function(){return impl.error}}})}HTMLNullVideoElement.prototype=new Popcorn._MediaElementProto;HTMLNullVideoElement.prototype.constructor=HTMLNullVideoElement;HTMLNullVideoElement.prototype._canPlaySrc=function(url){return findExistingPlayer(url)||/#t=\d*,?\d+?/.test(url)?"probably":EMPTY_STRING};HTMLNullVideoElement.prototype.canPlayType=function(type){return type==="video/x-nullvideo"?"probably":EMPTY_STRING};Popcorn.HTMLNullVideoElement=function(id){var player=findExistingPlayer(id);if(player){return player}return new HTMLNullVideoElement(id)};Popcorn.HTMLNullVideoElement._canPlaySrc=HTMLNullVideoElement.prototype._canPlaySrc})(Popcorn,document);hy.define("popcorn.htmlnullvideoelement",function(){});hy.define("player.profile.null",["player.wrappers","popcorn.htmlnullvideoelement"],function(wrappers){wrappers["null"]={id:"null",name:"Null",fn:"HTMLNullVideoElement",src:function(video){var sourceId=video.get("source_id");if(!sourceId||parseFloat(sourceId)){return"#t=0,"+(sourceId||10)}return sourceId},container:function(container,wrapper){if(wrapper===container){container=container.parentNode}return container}};return wrappers["null"]});hy.define("player.ooyala",["virtualmediaelement","lodash.noconflict","jquery.noconflict"],function(VirtualMediaElement,_,$){return VirtualMediaElement.register("ooyala",function(state,parent,options){var that=this,player,attemptingToSeek=false,destroyed=false,played=false,pausedBeforeSeek=true;return{apiRequires:{OO:function(options){return"//player.ooyala.com/v3/"+options.pbid+"?platform=html5-priority"}},player:function(resources,resolve){var ooyala=resources.OO,firstPlay=false;destroyed=false;function ooyalaReady(api){that.WasteManagement.setup(player,"subscribe","unsubscribe");function apiReady(){var width,height,container,video,isFlash;player=api;state.setDuration(player.getDuration());if(state.existingPlayer){parent=document.getElementById(api.elementId)}container=$("div:first",parent);video=$("video.video",container);isFlash=!video.length;width=parent.offsetWidth;height=parent.offsetHeight;if(!isFlash&&video.length){if(!video.prop("readyState")){video.on("loadedmetadata",function onLoadedMetaData(){video.off("loadedmetadata",onLoadedMetaData);state.setDimensions(video.prop("videoWidth"),video.prop("videoHeight"))});video.attr("preload","metadata")}state.setDimensions(video.prop("videoWidth"),video.prop("videoHeight"))}else{state.setDimensions(width,height)}that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});_.forEach([container.get(0),$(".oo_controls",container).get(0)].concat($.makeArray($(container).children())),function(element){if(element&&element instanceof Element){element.style.zIndex="auto"}});resolve(player)}if(api.getState()==="ready"){apiReady()}else{api.subscribe("playbackReady","hapyak",apiReady)}api.subscribe("volumeChanged","hapyak",function(eventName,volume){if(!state.muted){state.setVolume(volume)}});api.subscribe("playheadTimeChanged","hapyak",function(eventName,currentTime,duration,seekableRegion){if(duration!==state.duration){state.setDuration(duration);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})}if(currentTime){if(!attemptingToSeek){pausedBeforeSeek=state.paused}state.setCurrentTime(currentTime)}});api.subscribe("paused","hapyak",function(){$(parent).trigger("paused");state.setPaused()});api.subscribe("playing","hapyak",function(){$(parent).trigger("played");played=true;state.setPlay()});api.subscribe("seek","hapyak",function(){state.setSeeking()});api.subscribe("seeked","hapyak",function(){state.setSeeked();attemptingToSeek=false});if(options.forceReadyState){api.subscribe("playing","one-time-play",function onFirstPlay(){if(!firstPlay){firstPlay=true;api.pause()}});api.play()}that.WasteManagement.toggleOpenEnrollment(false)}if(state.existingPlayer){player=state.src;ooyalaReady(player)}else{parent.id=Popcorn.guid("hapyak-ooyala-container");ooyala.Player.create(parent.id,state.src,{onCreate:ooyalaReady,wmode:"transparent",flashParams:{hide:"all"}})}},currentTime:function(time){function onPaused(){$(parent).off("paused",onPaused);player.seek(time);if(!pausedBeforeSeek){player.play()}}function onPlayed(){$(parent).off("played",onPlayed);player.pause()}if(time!==undefined&&player){attemptingToSeek=true;$(parent).on("paused",onPaused);if(!played){$(parent).on("played",onPlayed);player.play()}else if(pausedBeforeSeek){$(parent).off("paused",onPaused);player.seek(time)}else{player.pause();player.seek(time)}}},volume:function(volume){if(player){if(volume!==undefined){state.setVolume(volume);player.setVolume(volume)}else{return state.volume}}},muted:function(val){var storedVolume;if(player){storedVolume=state.volume;state.setMuted(+val);if(val){player.setVolume(0);state.setVolume(storedVolume)}else{player.setVolume(state.volume)}return!!val}},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){if(width!==undefined&&parent){parent.style.width=width+"px"}},height:function(height){if(height!==undefined&&parent){parent.style.height=height+"px"}},offsetWidth:function(){var elem=parent instanceof Element?parent:document.getElementById(parent.elementId);return elem&&elem.offsetWidth||0},offsetHeight:function(){var elem=parent instanceof Element?parent:document.getElementById(parent.elementId);return elem&&elem.offsetHeight||0},videoWidth:function(){var video=$("video.video",parent);return video.length?video.prop("videoWidth"):0},videoHeight:function(){var video=$("video.video",parent);return video.length?video.prop("videoHeight"):0}}},{findExisting:function(obj){if(window.OO&&obj.elementId&&obj.getPlayheadTime){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"}})});hy.define("player.profile.ooyala",["popcorn","player.wrappers","player.ooyala"],function(Popcorn,wrappers,HTMLOoyalaVideoElement){Popcorn.HTMLOoyalaVideoElement=HTMLOoyalaVideoElement;wrappers.ooyala={id:"ooyala",name:"Ooyala",fn:"HTMLOoyalaVideoElement",args:function(video,options){return[options.playerParameters]},container:function(container){if(container.elementId){return document.getElementById(container.elementId).parentNode}return}};return wrappers.ooyala});hy.define("player.theplatform",["logging","virtualmediaelement","lodash.noconflict","jquery.noconflict","utils.embed"],function(logging,VirtualMediaElement,_,$,utils){function getController(obj){if(!obj){
return}if(typeof obj.controller==="object"){return obj.controller}else if(typeof obj.addEventListener==="function"){return obj}}function getElement(obj){var controller,player,registry,shell,shells;if(!obj){return}else if(obj instanceof Element){return obj}controller=getController(obj);if(controller&&controller.iframe){return controller.iframe.parentNode}if(obj.shell&&obj.shell.Registry){registry=obj.shell.Registry.getInstance();shells=registry._collection&&registry._collection._shells;if(shells){for(shell in shells){if(shells.hasOwnProperty(shell)){player=shells[shell];if(typeof player.getId==="function"){return window.document.getElementById(player.getId())}}}}}throw new Error("Missing `controller.iframe` or `registry._collection._shells` for thePlatform")}return VirtualMediaElement.register("theplatform",function(state,parent,options){var destroyed=false,forceReadyState=options.forceReadyState,that=this;var hasPlayed=false,storedVolume=1;var el,player;var wrapperRef={apiRequires:{$pdk:"/vendor/theplatform/tpPdkController.js"},player:function(resources,resolve){var $pdk=resources.$pdk;destroyed=false;function theplatformReady(api){function apiReady(){var elHeight=wrapperRef.videoHeight(),elWidth=wrapperRef.videoWidth();wrapperRef.width(parent.offsetWidth);wrapperRef.height(parent.offsetHeight);if(elWidth&&elHeight){state.setDimensions(elWidth,elHeight)}resolve(player)}function updateDuration(data){var duration=utils.dotget(data,"data.duration")/1e3;state.setDuration(duration);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})}if(api.iframe){api.addEventListener("OnPlayerLoaded",apiReady)}else{apiReady()}api.addEventListener("OnMediaTime",function(data){updateDuration(data)});api.addEventListener("OnSetVolume",function(volume){state.setVolume(volume/100)});api.addEventListener("OnMediaPlaying",function(data){var currentTime=utils.dotget(data,"data.currentTime")/1e3;if(!state.duration){updateDuration(data)}state.setCurrentTime(currentTime)});api.addEventListener("OnMediaComplete",function(data){state.setPaused(true);state.setEnded(true);hasPlayed=false});api.addEventListener("OnMute",function(data){state.setMuted(!!data.data)});api.addEventListener("OnMediaPause",function(){state.setPaused()});api.addEventListener("OnMediaUnpause",function(){hasPlayed=true;state.setPlay()});api.addEventListener("OnMediaStart",function(){if(forceReadyState){player.hidePlayerRegions(true)}hasPlayed=true;state.setPlay()});api.addEventListener("OnMediaSeek",function(data){var currentTime=utils.dotget(data,"data.end.currentTime")/1e3;state.setSeeking();state.setCurrentTime(currentTime);state.setSeeked()})}if(state.existingPlayer){player=getController(state.src);if(!state.duration){state.setDuration(999)}el=getElement(state.src);theplatformReady(player)}else{parent.id=Popcorn.guid("hapyak-theplatform-container");el=window.document.createElement("iframe");el.setAttribute("src",state.src);el.setAttribute("seamless","seamless");el.setAttribute("frameborder",0);el.style.width="100%";el.style.height="100%";el.id=Popcorn.guid("theplatform-hapyak-iframe-");parent.appendChild(el);player=$pdk.bind(el.id);player.addEventListener("OnPlayerLoaded",function(data){theplatformReady(player);if(forceReadyState){player.clickPlayButton();player.addEventListener("OnMediaStart",function onMediaStart(){player.removeEventListener("OnMediaStart",onMediaStart);player.pause(true)})}})}},play:function(){if(!hasPlayed){player.clickPlayButton()}else{player.pause(false)}},pause:function(){player.pause(true)},currentTime:function(time){if(time!==undefined&&player){if(!hasPlayed&&wrapperRef.videoWidth()&&wrapperRef.videoHeight()){player.addEventListener("OnMediaStart",function onMediaStart(){player.removeEventListener("OnMediaStart",onMediaStart);player.seekToPosition(time*1e3)});player.clickPlayButton();return}player.seekToPosition(time*1e3)}},volume:function(value){if(value!==undefined&&player){state.setVolume(value);player.setVolume(value*100)}},muted:function(value){if(player){state.setMuted(!!value);if(value){storedVolume=state.volume;player.setVolume(0)}else{player.setVolume(storedVolume*100)}}},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){if(width!==undefined&&parent){parent.style.width=width+"px";if(el){el.style.width=width+"px"}}},height:function(height){if(height!==undefined&&parent){parent.style.height=height+"px";if(el){el.style.height=height+"px"}}},offsetWidth:function(){return el&&el.offsetWidth||0},offsetHeight:function(){return el&&el.offsetHeight||0},videoWidth:function(){return el&&el.offsetWidth||parent.offsetWidth||0},videoHeight:function(){return el&&el.offsetHeight||parent.offsetHeight||0}};state.setDimensions(640,360);return wrapperRef},{findExisting:function(obj){if(window.$pdk&&getController(obj)){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"},utils:{getElement:getElement}})});hy.define("player.profile.theplatform",["popcorn","player.wrappers","player.theplatform"],function(Popcorn,wrappers,HTMLThePlatformVideoElement){var utils=HTMLThePlatformVideoElement._utils;Popcorn.HTMLThePlatformVideoElement=HTMLThePlatformVideoElement;wrappers.theplatform={id:"theplatform",name:"ThePlatform",fn:"HTMLThePlatformVideoElement",args:function(video,options){return[options.playerParameters]},container:function(container){return utils.getElement(container)},src:function(video,options){var playerId,accountId,videoId,sourceParams=video.getCustomProperty("source_parameters")||{};if(options.playerParameters){playerId=options.playerParameters.playerId||false;accountId=options.playerParameters.accountId||false;videoId=options.playerParameters.videoId||false}if(accountId&&playerId&&videoId){return"//player.theplatform.com/p/"+accountId+"/"+playerId+"/embed/select/"+videoId+"?form=html"}}};return wrappers.theplatform});hy.define("player.skeleton",["logging","virtualmediaelement","utils","lodash.noconflict","jquery.noconflict"],function(logging,VirtualMediaElement,utils,_,$){var skeletonAnnotationContainer;function updateContainerPosition(options){skeletonAnnotationContainer.style.top=options.player.y+"px";skeletonAnnotationContainer.style.left=options.player.x+"px";skeletonAnnotationContainer.style.width=options.player.videoWidth+"px";skeletonAnnotationContainer.style.height=options.player.videoHeight+"px"}return VirtualMediaElement.register("skeleton",function(state,parent,options){var opts=options||{},player,playerOptions;var that=this;return{apiRequires:{},player:function(resources,resolve){playerOptions=state.src;var duration=playerOptions.duration||opts.duration;player={};_.forEach(["play","pause","currentTime"],function(methodName){if(playerOptions.instance&&playerOptions.instance[playerOptions[methodName]]){player[methodName]=function(val){playerOptions.instance[playerOptions[methodName]](val)}}else if(typeof playerOptions[methodName]==="function"){player[methodName]=playerOptions[methodName]}});if(duration){state.setDuration(duration)}that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});state.height=playerOptions.height;state.width=playerOptions.width;state.setDimensions(playerOptions.videoWidth,playerOptions.videoHeight);resolve(player)},events:{timeupdate:function(time){state.setCurrentTime(time)},durationchange:function(duration){state.setDuration(duration);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})},volumechange:function(volume){state.setVolume(volume)},ended:function(){state.setEnded()},seeking:function(){state.setSeeking()},seeked:function(){state.setSeeked()},play:function(){state.setPlay()},pause:function(){state.setPaused()}},currentTime:function(time){if(time!==undefined&&player){state.setCurrentTime(time);player.currentTime(time)}},volume:function(){return state.volume},muted:function(){return!!state.volume},destroy:function(){if(playerOptions&&playerOptions.minimalRootCss&&parent&&parent.element&&parent.element.parentNode){utils.removeClass(parent.element.parentNode,"hapyak-minimal-css")}},width:function(width){if(width!==undefined&&playerOptions){playerOptions.element.style.width=width+"px"}},height:function(height){if(height!==undefined&&playerOptions){playerOptions.element.style.height=height+"px"}},offsetWidth:function(){return playerOptions.element?playerOptions.element.offsetWidth:0},offsetHeight:function(){return playerOptions.element?playerOptions.element.offsetHeight:0},videoWidth:function(){var video=$("video",player.element);return video&&video.prop("videoWidth")||0},videoHeight:function(){var video=$("video",player.element);return video&&video.prop("videoHeight")||0}}},{findExisting:function(){return"probably"},canPlaySrc:function(){return true},utils:{setupAnnotationContainer:function(elements,options){if(options.player&&options.player.x!==undefined){if(!skeletonAnnotationContainer){skeletonAnnotationContainer=document.createElement("div");skeletonAnnotationContainer.className="hapyak-skeleton-annotation-container";elements.rootBox.appendChild(skeletonAnnotationContainer);elements.annotationContainer.parentNode.removeChild(elements.annotationContainer);elements.annotationNoscaleContainer.parentNode.removeChild(elements.annotationNoscaleContainer);skeletonAnnotationContainer.appendChild(elements.annotationContainer);skeletonAnnotationContainer.appendChild(elements.annotationNoscaleContainer)}updateContainerPosition(options)}},resize:function(elements,playerScale,options){updateContainerPosition(options);elements.annotationContainer.style.width=100/playerScale+"%";elements.annotationNoscaleContainer.style.width="100%";elements.annotationContainer.style.height=100/playerScale+"%";elements.annotationNoscaleContainer.style.height="100%"}}})});hy.define("player.profile.skeleton",["popcorn","player.wrappers","player.skeleton"],function(Popcorn,wrappers,HTMLSkeletonVideoElement){var utils=HTMLSkeletonVideoElement._utils;Popcorn.HTMLSkeletonVideoElement=HTMLSkeletonVideoElement;wrappers.skeleton={id:"skeleton",name:"Skeleton",fn:"HTMLSkeletonVideoElement",resize:utils.resize,setupAnnotationContainer:utils.setupAnnotationContainer,args:function(video,options){return[options.playerParameters]},container:function(container){return container.element.parentNode}};return wrappers.skeleton});hy.define("player.ustream",["virtualmediaelement","lodash.noconflict"],function(VirtualMediaElement,_){var ustreamUrlRegex=/^(?:https?\:\/|\/)\/(?:[a-z]\.|[a-z][a-z0-9-]{0,61}[a-z0-9]\.)*?ustream\.tv\/(?:embed\/)?(?:recorded\/)?(\d+)/i;return VirtualMediaElement.register("ustream",function(state,parent,options){options=options||{};var destroyed=false,forceReadyState=options.forceReadyState,iframe,lastCurrentTimeUpdate=-1,lastSeeked=-1,me=this,playbackStarted=false,player,previousCurrentTime=0,readyStateTimeout,errorMessageElement,volumeBackup=0;function getTime(){function receiveTime(currentTime){var now,diff;if(!destroyed&&player){if(currentTime>=0){now=Date.now();diff=(currentTime-previousCurrentTime)*1e3;if(now-lastSeeked>20&&(diff<-10||diff-(now-lastCurrentTimeUpdate)>50)){lastSeeked=now;state.setSeeking();state.setSeeked()}state.setCurrentTime(currentTime);if(previousCurrentTime!==currentTime){lastCurrentTimeUpdate=now}previousCurrentTime=currentTime}setTimeout(getTime,20)}}if(!destroyed&&player){player.getProperty("progress",receiveTime)}}function onPlaying(eventName,isPlaying){if(!playbackStarted&&isPlaying){playbackStarted=true;if(forceReadyState){player.callMethod("pause")}player.getProperty("duration",function(duration){if(!destroyed&&duration){state.setDuration(duration);me._util.nextTick(function(){state.setReadyState(me.HAVE_ENOUGH_DATA)})}})}isPlaying?state.setPlay():state.setPaused()}function onEnded(){state.setEnded()}function dimensionsReady(eventName,dimensions){state.videoWidth=dimensions[0];state.videoHeight=dimensions[1];if(!state.existingPlayer){state.setDimensions(state.videoWidth,state.videoHeight);me._util.nextTick(function(){clearTimeout(readyStateTimeout);if(errorMessageElement&&errorMessageElement.parentNode&&errorMessageElement.parentNode===parent){parent.removeChild(errorMessageElement)}state.setReadyState(me.HAVE_ENOUGH_DATA)})}}return{apiRequires:{UstreamEmbed:hapyak.assets+"/vendor/ustream/ustream-embedapi.min.js"},player:function(resources,resolve){var height,playerProperties={},UstreamEmbed=resources.UstreamEmbed,width;destroyed=false;if(state.existingPlayer){player=state.src;iframe=document.getElementById(player.id);iframe.src=state.controls?iframe.src:iframe.src+"?controls=false";width=iframe.getAttribute("width");if(width){state.width=Math.max(0,parseInt(width,10))||0}height=iframe.getAttribute("height");if(height){state.height=Math.max(0,parseInt(height,10))||0}}else{iframe=document.createElement("iframe");iframe.width=state.width===undefined?parent.offsetWidth:state.width;iframe.height=state.height===undefined?parent.offsetHeight:state.height;iframe.id=me._util.guid("hapyak-ustream-container");iframe.src=state.src;iframe.setAttribute("frameborder","0");parent.appendChild(iframe);player=new UstreamEmbed(iframe.id)}player.addListener("ready",function onPlayerReady(){var height,width;me._util.nextTick(function(){state.setReadyState(me.HAVE_CURRENT_DATA)});player.removeListener("ready",onPlayerReady);player.addListener("playing",onPlaying);player.addListener("finished",onEnded);player.addListener("size",dimensionsReady);if(forceReadyState){player.callMethod("play")}state.volume=100;getTime();if(state.existingPlayer){width=parseInt(iframe.width,10);height=parseInt(iframe.height,10)}if(width>0&&height>0&&state.existingPlayer){state.setDimensions(width,height)}readyStateTimeout=setTimeout(function(){var text;errorMessageElement=document.createElement("div");errorMessageElement.appendChild(document.createElement("p"));errorMessageElement.className="video-wrapper-error";if(forceReadyState){text="We're having trouble loading the Ustream video. Ustream videos must be recorded in order to be annotated, live and upcoming broadcasts will not work."}else{text="The connection to Ustream timed out, retrying."}errorMessageElement.firstChild.innerHTML=text;parent.appendChild(errorMessageElement)},1e4);resolve(player)})},play:function(){player&&player.callMethod("play")},pause:function(){player&&player.callMethod("pause")},currentTime:function(time){if(time!==undefined&&player){player.callMethod("seek",time)}},volume:function(volume){if(volume!==undefined&&player){player.callMethod("volume",volume);state.setVolume(volume)}},muted:function(val){if(player){if(val){volumeBackup=state.volume;player.callMethod("volume",0);state.setMuted(true);return true}else if(val===false){player.callMethod("volume",volumeBackup);state.setMuted(false);return false}}},destroy:function(){destroyed=true;if(player&&player.removeEventListener){player.removeListener("playing",onPlaying);player.removeListener("finished",onEnded);player.removeListener("size",dimensionsReady)}if(!state.existingPlayer&&iframe&&iframe.parentNode){iframe.parentNode.removeChild(iframe)}},width:function(width){if(width!==undefined&&iframe){iframe.width=width}},height:function(height){if(height!==undefined&&iframe){iframe.height=height}},offsetWidth:function(){return iframe&&iframe.offsetWidth||0},offsetHeight:function(){return iframe&&iframe.offsetHeight||0},parentNode:function(){var elem;if(player instanceof Element){elem=player}else if(player&&player.id){elem=document.getElementById(player.id).parentNode}return elem}}},{findExisting:function(obj){if(window.UstreamEmbed&&obj.host==="http://www.ustream.tv"){return"probably"}return""},canPlaySrc:ustreamUrlRegex})});hy.define("player.profile.ustream",["popcorn","player.wrappers","player.ustream"],function(Popcorn,wrappers,HTMLUstreamVideoElement){Popcorn.HTMLUstreamVideoElement=HTMLUstreamVideoElement;wrappers.ustream={id:"ustream",name:"Ustream",fn:"HTMLUstreamVideoElement",pre:"//www.ustream.tv/embed/recorded/",args:function(video,options){return[options.playerParameters]},container:function(container){if(container instanceof Element){return container.parentNode}return document.getElementById(container.id).parentNode}};return wrappers.ustream});hy.define("player.videojs",["popcorn","virtualmediaelement"],function(Popcorn,VirtualMediaElement){function PlayerUpdateListener(player,state){this.loop=null;this.player=player;this.state=state;this.lastValues={};var that=this;var time,key,stateValue;this.callbacks={muted:function(value){that.state.setMuted(value)}};this.initializeCallbacks=function(){for(key in that.callbacks){that.lastValues[key]=0}};this.detectChanged=function(){for(key in that.callbacks){stateValue=that.player[key]();if(stateValue!==that.lastValues[key]){that.callbacks[key](stateValue)}that.lastValues[key]=stateValue}};this.start=function(){this.stop();this.loop=setInterval(function(){that.detectChanged()},250)};this.stop=function(){clearInterval(this.loop)};this.initializeCallbacks();this.start()}var player;return VirtualMediaElement.register("videojs",function(state,parent,options){var that=this,destroyed=false;var playerContainer;return{apiRequires:{VideoJS:"//vjs.zencdn.net/c/video.js"},player:function(resources,resolve){var videoGuid=state.src;var elem,vidOpts,apiCSS,playerUpdateLoop,time;function loadVjsCss(callback){var apiCSS;apiCSS=document.createElement("link");apiCSS.type="text/css";apiCSS.rel="stylesheet";apiCSS.href="//vjs.zencdn.net/c/video-js.css";apiCSS.addEventListener("load",callback);document.head.appendChild(apiCSS)}function videojsSetupEvents(player){playerUpdateLoop=new PlayerUpdateListener(player,state);player.addEvent("play",function(){state.setPlay()});player.addEvent("pause",function(){state.setPaused()});player.addEvent("timeupdate",function(){time=player.currentTime();if(!isNaN(parseInt(time,10))&&time>=0){state.setCurrentTime(time)}});player.addEvent("ended",function(){state.setEnded(true)});player.addEvent("seeked",function(){state.setCurrentTime(player.currentTime());state.setSeeked()});player.addEvent("volumechange",function(){state.setVolume(player.volume())});that.WasteManagement.toggleOpenEnrollment(false);state.setDimensions(+elem.style.width.split("px")[0]||player.width(),elem.style.height.split("px")[0]||player.height());state.setDuration(player.duration());state.setVolume(player.volume());that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});resolve(player)}if(state.existingPlayer){player=state.src;that.WasteManagement.setup(player,"addEvent","removeEvent");state.controls=true;player.ready(function(){elem=player.el;videojsSetupEvents(player)})}else{loadVjsCss(function(){parent.id=Popcorn.guid("hapyak-videojs-container");elem=document.createElement("video");parent.appendChild(elem);elem.id="videojs_"+videoGuid;elem.style.width=(state.width||640)+"px";elem.style.height=(state.height||360)+"px";player=VideoJS(elem,{width:elem.style.width,height:elem.style.height,loop:false,preload:true,autoplay:false,controls:false,flash:{swf:"//d2qrdklrsxowl2.cloudfront.net/vendor/videojs/video-js.swf"}});that.WasteManagement.setup(player,"addEvent","removeEvent");player.ready(function(){player.src(unescape(state.src));player.tech.el.load();player.addEvent("loadedmetadata",function(){videojsSetupEvents(player)})})})}},currentTime:function(time){if(player&&time!==undefined&&time>=0){player.currentTime(time);state.setCurrentTime(time)}},play:function(){player.play()},pause:function(){player.pause()},volume:function(volume){if(volume!==undefined&&player){state.setVolume(volume);player.volume(volume)}},muted:function(isMuted){if(state.muted===true){isMuted=false}state.setMuted(isMuted);player.muted(isMuted)},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){if(width&&player){player.tech.el.style.width=width+"px"}},height:function(height){if(height&&player){player.tech.el.style.height=height+"px"}},offsetWidth:function(){if(player){return player.el.offsetWidth}return parent&&parent.offsetWidth||0},offsetHeight:function(){if(player){return player.el.offsetHeight}return parent&&parent.offsetHeight||0},videoWidth:function(){if(player.techName==="html5"&&player.tech.el){return player.tech.el.videoWidth}return state.videoWidth},videoHeight:function(){if(player.techName==="html5"&&player.tech.el){return player.tech.el.videoHeight}return state.videoHeight}}},{findExisting:function(obj){if(obj.isReady===true){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"}})});hy.define("player.profile.videojs",["popcorn","player.wrappers","player.videojs"],function(Popcorn,wrappers,HTMLVideojsVideoElement){Popcorn.HTMLVideojsVideoElement=HTMLVideojsVideoElement;wrappers.videojs={id:"videojs",name:"Video.js",fn:"HTMLVideojsVideoElement",args:function(video,options){return[options.playerParameters]},container:function(container){if(typeof container.el==="function"){container=container.el()}else if(container._embedContainer){container=container._embedContainer}else{container=container.el}return container},modify:function(elements,container){container.insertBefore(elements.annotationContainer,container.querySelector(".vjs-text-track-display")||container.querySelector(".vjs-loading-spinner")||container.querySelector(".vjs-big-play-button")||container.querySelector(".vjs-controls")||elements.controlBar||null)}};return wrappers.videojs});hy.define("player.profile.videojs4",["popcorn","player.wrappers","player.videojs4"],function(Popcorn,wrappers,HTMLVideojs4VideoElement){Popcorn.HTMLVideojs4VideoElement=HTMLVideojs4VideoElement;wrappers.videojs4={id:"videojs4",name:"Video.js 4",fn:"HTMLVideojs4VideoElement",src:function(video){var arr=[];Popcorn.forEach(video.getCustomProperty("sources"),function(val){arr.push({type:val.mime_type,src:val.url})});return arr},args:function(video,options){var args=options.playerParameters;args.projectId=options.projectId;return[args]},container:function(container){if(typeof container.el==="function"){container=container.el()}else{container=container.el}return container},modify:function(elements,container){container.insertBefore(elements.annotationContainer,container.querySelector(".vjs-text-track-display")||container.querySelector(".vjs-loading-spinner")||container.querySelector(".vjs-big-play-button")||container.querySelector(".vjs-controls")||elements.controlBar||null)}};return wrappers.videojs4});hy.define("player.VideoJS6FlashShim",[],function(){function VideoJS6FlashShim(vjsInstance){this.vjsInstance=vjsInstance;this.playheadStalled=false;this.desiredSeekTime=undefined}VideoJS6FlashShim.prototype.onSeeking=function(){this.playheadStalled=true;this.desiredSeekTime=this.vjsInstance.currentTime()};VideoJS6FlashShim.prototype.isCaughtUp=function(){return this.vjsInstance.currentTime()-this.desiredSeekTime>0};VideoJS6FlashShim.prototype.onTimeUpdate=function(vmeState){if(this.playheadStalled){vmeState.setCurrentTime(this.desiredSeekTime);if(this.isCaughtUp()){this.playheadStalled=false;vmeState.setCurrentTime(this.vjsInstance.currentTime());vmeState.setSeeked()}}else{vmeState.setCurrentTime(this.vjsInstance.currentTime())}};return VideoJS6FlashShim});hy.define("player.videojs6",["logging","virtualmediaelement","lodash.noconflict","jquery.noconflict","utils.embed","configuration","require","player.VideoJS6FlashShim"],function(logging,VirtualMediaElement,_,$,utils,configuration,require,VideoJS6FlashShim){return VirtualMediaElement.register("videojs6",generatePlayer,{findExisting:function(obj){if(obj&&typeof obj.id==="function"&&typeof obj.el==="function"){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"||_.isArray(src)}});function generatePlayer(state,parent,options){var assets={VIDEO_JS:"/js/vendor/videojs/6.11.0/video.min.js",VJS_HLS_PLUGIN:hapyak.api+"/js/vendor/videojs/videojs-contrib-hls/5.15.0/contrib-hls.min.js",VJS_STYLES:"/js/vendor/videojs/6.11.0/video-js.min.css"};function VideoJS6Player(state,parentEl,options,vmeInstance){this.state=state;this.parentEl=parentEl;this.options=options;this.vmeInstance=vmeInstance;this.playerConfig=configuration.player||{};this.numLoadRetries=0;this.__bindProperties__()}VideoJS6Player.prototype.__bindProperties__=function(){Object.keys(VideoJS6Player.prototype).forEach(function(prop){if(prop!=="__bindProperties__"){this[prop]=this[prop].bind(this)}}.bind(this))};VideoJS6Player.prototype.player=function(resources,resolve){window.videojs=this.videojsLib=resources.videojs;if(this.isNative||!this.isHls){this.setupVJSInstance(resolve)}else{require([assets.VJS_HLS_PLUGIN],this.setupVJSInstance.bind(this,resolve))}};VideoJS6Player.prototype.setupVJSInstance=function(resolver){var overrideNative=videojs.browser&&videojs.browser.IS_SAFARI;if(this.isHls){videojs.options.html5.nativeVideoTracks=!overrideNative;videojs.options.html5.nativeAudioTracks=!overrideNative;videojs.options.html5.nativeTextTracks=!overrideNative;videojs.options.hls.overrideNative=overrideNative}if(!this.isNative){this.vjsInstance=this.createVJSInstance()}else{this.vjsInstance=this.state.src}state.controls=state.controls?true:false;this.vjsInstance.controls(this.state.controls);this.connectEventListeners(this.vjsInstance);this.vjsInstance.ready(function(){this.vjsInstance.src(this.getEmbedSrc(this.videoSrc));this.flashShim=new VideoJS6FlashShim(this.vjsInstance);resolver(this.vjsInstance)}.bind(this))};VideoJS6Player.prototype.createVJSInstance=function(){var overrideNative=videojs.browser&&videojs.browser.IS_SAFARI,PLAYER_SETTINGS={html5:{hls:{withCredentials:this.isSecure,overrideNative:overrideNative},nativeVideoTracks:!overrideNative,nativeAudioTracks:!overrideNative,nativeTextTracks:!overrideNative}},videoEl=$("<video/>",{id:Popcorn.guid("hapyak-videojs6-container"),playsinline:"playsinline",css:{width:"100%",height:"100%"},on:{loadedmetadata:function(){this.state.setDimensions(videoEl.prop("videoWidth"),videoEl.prop("videoHeight"))}.bind(this),canplay:function(){this.state.setDimensions(videoEl.prop("videoWidth"),videoEl.prop("videoHeight"))}.bind(this)}});var instance;$("<link/>",{rel:"stylesheet",type:"text/css",href:assets.VJS_STYLES}).appendTo(window.document.head);$(this.parentEl).append(videoEl);instance=this.videojsLib(videoEl.attr("id"),PLAYER_SETTINGS);instance.on("error",this.onError.bind(this));return instance};VideoJS6Player.prototype.getEmbedSrc=function(src){var src=typeof src!=="string"?src[0].src:src;if(this.isSecure&&options.signature&&this.isHls&&videojs.Hls&&videojs.Hls.xhr){videojs.Hls.xhr.beforeRequest=function(opts){if(opts.uri.indexOf(".ts")>-1||opts.uri.indexOf(".m3u8")>-1||opts.uri.indexOf(".jpg")>-1){opts.uri+="?"+"Signature="+options.signature["CloudFront-Signature"]+"&Key-Pair-Id="+options.signature["CloudFront-Key-Pair-Id"]+"&Policy="+options.signature["CloudFront-Policy"]}}}return{src:src.indexOf("https")===0?src:src.replace("http","https"),type:this.isHls?"application/x-mpegURL":"video/mp4",withCredentials:this.isSecure}};VideoJS6Player.prototype.onError=function(){var error=this.vjsInstance.error(),errorList=this.playerConfig.stream_error_list||[4];this.MAX_RETRIES=this.playerConfig.stream_retry_count||5;if(error&&errorList.indexOf(error.code)>-1){this.retryLoad()}};VideoJS6Player.prototype.retryLoad=function(){var RETRY_INTERVAL=this.playerConfig.stream_retry_interval||250;if(this.numLoadRetries<this.MAX_RETRIES){setTimeout(function reloadPlayer(){if(this.state&&this.state.playing===false){this.vjsInstance.src(this.vjsInstance.currentSource())}}.bind(this),RETRY_INTERVAL);this.numLoadRetries++}};VideoJS6Player.prototype.connectEventListeners=function(vjsInstance){var videoContainer=this.playerContainer?this.playerContainer.querySelector("video"):null,instance=this;if(videoContainer){vjsInstance.usingNativeControls(false);videoContainer.controls=false}this.vmeInstance.WasteManagement.setup(vjsInstance,"on","off");vjsInstance.on("durationchange",function(){instance.state.setDuration(utils.dotget(vjsInstance,"mediainfo.duration")||vjsInstance.duration());instance.vmeInstance._util.nextTick(function(){instance.state.setReadyState(instance.vmeInstance.HAVE_ENOUGH_DATA)})});vjsInstance.on("volumechange",function(){instance.state.setVolume(vjsInstance.volume())});vjsInstance.on("timeupdate",function(){if(vjsInstance.techName_==="Flash"){instance.flashShim.onTimeUpdate(instance.vmeInstance)}else{instance.state.setCurrentTime(vjsInstance.currentTime())}});vjsInstance.on("ended",function(){instance.state.setEnded(true)});vjsInstance.on("muted",function(){instance.state.setMuted(!!vjsInstance.muted())});vjsInstance.on("pause",function(){instance.state.setPaused()});vjsInstance.on("play",function(){instance.state.setPlay()});vjsInstance.on("seeking",function(){instance.state.setSeeking();if(vjsInstance.techName_==="Flash"){instance.flashShim.onSeeking()}});vjsInstance.on("seeked",function(){if(vjsInstance.techName_!=="Flash"){instance.state.setCurrentTime(vjsInstance.currentTime());instance.state.setSeeked()}});vjsInstance.on("loadedmetadata",this.onLoadedMetadata.bind(this));this.vmeInstance.WasteManagement.toggleOpenEnrollment(false)};VideoJS6Player.prototype.onLoadedMetadata=function(){var intrinsicHeight=this.videoHeight(),intrinsicWidth=this.videoWidth(),width=this.parentEl.offsetWidth||this.offsetWidth(),height=this.parentEl.offsetHeight||this.offsetHeight(),duration=utils.dotget(this.vjsInstance,"mediainfo.duration")||this.vjsInstance.duration();if(intrinsicWidth&&intrinsicHeight){this.state.setDimensions(intrinsicWidth,intrinsicHeight)}if(height&&width&&(this.options.forceReadyState||this.options.isViewer===false)){this.vjsInstance.width(width);this.vjsInstance.height(height)}if(duration){this.state.setDuration(duration);this.vmeInstance._util.nextTick(function(){this.state.setReadyState(this.vmeInstance.HAVE_ENOUGH_DATA)}.bind(this))}};VideoJS6Player.prototype.outerContainer=function(){return this.playerContainer};VideoJS6Player.prototype.currentTime=function(time){if(time!==undefined&&this.vjsInstance){this.vjsInstance.currentTime(time)}};VideoJS6Player.prototype.volume=function(value){if(value!==undefined&&this.vjsInstance){this.state.setVolume(value);this.vjsInstance.volume(value)}};VideoJS6Player.prototype.muted=function(value){if(this.vjsInstance){this.state.setMuted(!!value);this.vjsInstance.muted(!!value)}};VideoJS6Player.prototype.destroy=function(){if(!this.state.existingPlayer&&this.parentEl&&this.parentEl.children&&this.vjsInstance){this.vjsInstance.dispose()}this.vjsInstance=null};VideoJS6Player.prototype.width=function(width){if(width!==undefined&&this.vjsInstance){this.vjsInstance.width(width)}};VideoJS6Player.prototype.height=function(height){if(height!==undefined&&this.vjsInstance){this.vjsInstance.height(height)}};VideoJS6Player.prototype.offsetWidth=function(){return this.playerContainer?this.playerContainer.offsetWidth:0};VideoJS6Player.prototype.offsetHeight=function(){return this.playerContainer?this.playerContainer.offsetHeight:0};VideoJS6Player.prototype.videoWidth=function(){var video=$("video",this.playerContainer),width;if(video){width=video.prop("videoWidth")}return width||0};VideoJS6Player.prototype.videoHeight=function(){var video=$("video",this.playerContainer),height;if(video){height=video.prop("videoHeight")}return height||0};Object.defineProperties(VideoJS6Player.prototype,{apiRequires:{value:{videojs:assets.VIDEO_JS}},playerContainer:{get:function(){return this.vjsInstance&&this.vjsInstance.el&&this.vjsInstance.el()}},isNative:{get:function(){return!(typeof this.state.src==="string"||Array.isArray(this.state.src))}},isSecure:{get:function(){return this.options.workflow&&this.options.workflow.rules&&this.options.workflow.rules.is_secure}},videoSrc:{get:function(){
var src=this.isNative?this.options.videoSourceId:this.state.src;src=Array.isArray(src)?src[0]:src;return src["src"]?src["src"]:src}},isHls:{get:function(){return(this.videoSrc["src"]?this.videoSrc["src"]:this.videoSrc).indexOf(".m3u8")>-1}}});return new VideoJS6Player(state,parent,options,this)}});hy.define("player.profile.hapyakhostedplayer",["popcorn","player.wrappers","player.videojs4"],function(Popcorn,wrappers,HTMLVideojs4VideoElement){Popcorn.HTMLHapYakHostedVideoElement=HTMLVideojs4VideoElement;wrappers.hapyakhostedplayer={id:"hapyakhostedplayer",name:"HapYak Player",fn:"HTMLHapYakHostedVideoElement",src:function(video){var arr=[];Popcorn.forEach(video.getCustomProperty("sources"),function(val){arr.push({type:val.mime_type,src:val.url})});return arr},args:function(video,options){var args=options.playerParameters;args.projectId=options.projectId;args.workflow=options.workflow;args.isHapyakHostedPlayer=true;args.signature=options.signature;return[args]},container:function(container){if(!container){return container}return typeof container.el==="function"?container.el():container.el},modify:function(elements,container){container.insertBefore(elements.annotationContainer,container.querySelector(".vjs-text-track-display")||container.querySelector(".vjs-loading-spinner")||container.querySelector(".vjs-big-play-button")||container.querySelector(".vjs-controls")||elements.controlBar||null)}};return wrappers.hapyakhostedplayer});hy.define("player.profile.videojsvr",["popcorn","player.wrappers","player.videojs4"],function(Popcorn,wrappers,HTMLVideojs4VideoElement){Popcorn.HTMLVideojs4VideoElement=HTMLVideojs4VideoElement;wrappers.videojsvr={id:"videojsvr",name:"Video.js 360",fn:"HTMLVideojs4VideoElement",src:function(video){var arr=[];Popcorn.forEach(video.getCustomProperty("sources"),function(val){arr.push({type:val.mime_type,src:val.url})});return arr},args:function(video,options){if(options.playerParameters){options.playerParameters.is360=true}return[options.playerParameters]},container:function(container){if(typeof container.el==="function"){container=container.el()}else{container=container.el}return container},modify:function(elements,container){container.insertBefore(elements.annotationContainer,container.querySelector(".vjs-text-track-display")||container.querySelector(".vjs-loading-spinner")||container.querySelector(".vjs-big-play-button")||container.querySelector(".vjs-controls")||elements.controlBar||null)}};return wrappers.videojsvr});hy.define("player.vidyard",["logging","virtualmediaelement","lodash.noconflict","jquery.noconflict","utils.embed"],function(logging,VirtualMediaElement,_,$,utils){return VirtualMediaElement.register("vidyard",function(state,parent){var destroyed=false,firstPlay=true,hasTimeUpdate=true,playingBeforeSeek=false,that=this;var displayTimer,player,playerContainer,script,scriptStart;function parseSrc(){var srcParsed=typeof state.src==="string"&&state.src.match(/(.*)\/([^\/]+)$/i);if(srcParsed&&srcParsed.length===3){state.srcRoot=srcParsed[1];state.src=srcParsed[2]}}var wrapperRef={apiRequires:{Vidyard:function(){parseSrc();if(!state.srcRoot||state.srcRoot.indexOf("vidyard.com")===-1){state.srcRoot="//play.vidyard.com"}return state.srcRoot+"/v0/api.js"}},player:function(resources,resolve){var Vidyard=resources.Vidyard;var duration;destroyed=false;function vidyardReady(api){var pollTimer;function apiReady(){var iframeHeight=wrapperRef.videoHeight(),iframeWidth=wrapperRef.videoWidth(),metadata=_.isFunction(player.metadata)&&player.metadata()||player.metadata;duration=metadata&&metadata.length_in_seconds;if(duration){logging.debug("[vidyard] duration: "+duration);state.setDuration(duration)}wrapperRef.width(parent.offsetWidth);wrapperRef.height(parent.offsetHeight);if(metadata.width&&metadata.height){state.setDimensions(metadata.width,metadata.height)}that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});resolve(player)}function stopPollingTime(){clearInterval(pollTimer)}function startPollingTime(){stopPollingTime();pollTimer=setInterval(function(){var currentTime;if(api&&api.currentTime){currentTime=api.currentTime();state.setCurrentTime(currentTime);if(firstPlay&&currentTime>0){firstPlay=false;state.setPlay()}}},100)}apiReady();that.WasteManagement.setup(api,"on","off");try{api.on("volumeChange",function(volume){state.setVolume(volume)})}catch(e){logging.debug('[vidyard] error: "volumeChange" event unsupported')}try{api.on("timeupdate",function(time){state.setCurrentTime(time)})}catch(e){logging.debug('[vidyard] error: "timeupdate" event unsupported – polling instead');hasTimeUpdate=false}api.on("playerComplete",function(){logging.dev("[vidyard] playerComplete");state.setEnded(true);if(!hasTimeUpdate){stopPollingTime()}});try{api.on("muted",function(value){logging.dev("[vidyard] muted");state.setMuted(!!value)})}catch(e){logging.debug('[vidyard] error: "muted" event unsupported')}api.on("pause",function(){logging.dev("[vidyard] pause");state.setPaused();if(!hasTimeUpdate){stopPollingTime()}});api.on("play",function(){logging.dev("[vidyard] play");if(!hasTimeUpdate){startPollingTime()}state.setPlay()});api.on("beforeSeek",function(){logging.dev("[vidyard] beforeSeek");state.setSeeking()});api.on("seek",function(){logging.dev("[vidyard] seek");if(playingBeforeSeek){playingBeforeSeek=false;player.play()}state.setSeeked()});that.WasteManagement.toggleOpenEnrollment(false)}if(state.existingPlayer){var source=state.src.iframe.src;if(!state.controls&&source.indexOf("hidden_controls")<0){source=source+"hidden_controls=1"}player=state.src;playerContainer=document.getElementById("vidyard_span_"+player.uuid);vidyardReady(player)}else{parent.id=Popcorn.guid("hapyak-vidyard-container");script=window.document.createElement("script");script.async=false;script.onload=function(){var loadTime=(new Date).getTime()-scriptStart,timeout=loadTime*12;player=new Vidyard.player(state.src);playerContainer=document.getElementById("vidyard_span_"+player.uuid);if(playerContainer){playerContainer.style.width=playerContainer.style.height="100%";playerContainer.style.visibility="hidden"}logging.debug("[vidyard] load: "+loadTime+"ms");displayTimer=setTimeout(function(){if(playerContainer.style.width==="100%"){playerContainer.innerHTML='<div class="hapyak-embed-error-outer">'+'<div class="hapyak-embed-error-inner">'+'<h1 class="hapyak-embed-error-title">VidYard Error</h1>'+'<p class="hapyak-embed-error-message">This video could not be loaded</p>'+"</div>"+"</div>";playerContainer.style.visibility=""}},timeout>1e3?timeout:1e3);player.on("ready",function(){if(!playerContainer){playerContainer=document.getElementById("vidyard_span_"+player.uuid)}clearTimeout(displayTimer);playerContainer.style.visibility="";logging.debug("[vidyard] ready: "+((new Date).getTime()-scriptStart)+"ms");vidyardReady(player)})};scriptStart=(new Date).getTime();parseSrc();script.setAttribute("id","vidyard_embed_code_"+state.src);script.setAttribute("src",state.srcRoot+"/"+state.src+".js?v=3.1&type=inline");parent.appendChild(script)}},currentTime:function(time){if(time!==undefined&&player){state.setCurrentTime(time);if(state.paused){player.seek(time);return}player.on("pause",function onSeekPause(){player.off("pause",onSeekPause);playingBeforeSeek=true;player.seek(time)});player.pause()}return state.currentTime},volume:function(value){if(value!==undefined&&player){state.setVolume(value);player.setVolume(value)}},muted:function(value){if(player){state.setMuted(!!value);player.setVolume(0)}},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){if(width!==undefined&&parent){parent.style.width=width+"px";if(playerContainer){playerContainer.style.width=width+"px"}}},height:function(height){if(height!==undefined&&parent){parent.style.height=height+"px";if(playerContainer){playerContainer.style.height=height+"px"}}},offsetWidth:function(){return utils.dotget(player,"iframe.offsetWidth")||0},offsetHeight:function(){return utils.dotget(player,"iframe.offsetHeight")||0},videoWidth:function(){return state.videoWidth||0},videoHeight:function(){return state.videoHeight||0}};state.setDimensions(640,360);return wrapperRef},{findExisting:function(obj){if(window.Vidyard&&obj.iframe&&obj.uuid){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"}})});hy.define("player.profile.vidyard",["popcorn","player.wrappers","player.vidyard"],function(Popcorn,wrappers,HTMLVidyardVideoElement){Popcorn.HTMLVidyardVideoElement=HTMLVidyardVideoElement;wrappers.vidyard={id:"vidyard",name:"Vidyard",fn:"HTMLVidyardVideoElement",container:function(container){if(container instanceof Element){return container}return document.getElementById("vidyard_span_"+container.uuid)},src:function(video,options){var defaultHost="play.vidyard.com",source={host:video.get("source_host")||defaultHost,id:video.get("source_id")};var src;if(source.host.indexOf("play-staging.vidyard")!==-1){src="//play-staging.vidyard.com/staging-hulk"}else{src="//"+source.host}return src+"/"+source.id}};return wrappers.vidyard});hy.define("player.vimeo",["popcorn","virtualmediaelement","lodash.noconflict","jquery.noconflict","logging"],function(Popcorn,VirtualMediaElement,_,$,logging){return VirtualMediaElement.register("vimeo",function(state,parent,options){var player,volumeChangeInterval;var destroyed=false,that=this,hasPlayed=false;function postMessageIsSafe(){if(!player||!player.element||!player.element.contentWindow){return false}return true}return{apiRequires:{vimeo:"//player.vimeo.com/api/player.js"},player:function(resources,resolve){var guid,modifiedSrc;if(parent&&parent.src&&/[?&]api=1/.test(parent.src)){parent.src=parent.src.replace(/[?&]api=1/,"")}destroyed=false;function vimeoReady(){var hasDimensions=false;var readyStateInterval;function apiReady(){if(state.existingPlayer&&player.element){parent=player.element.parentNode}if(!postMessageIsSafe()){clearInterval(readyStateInterval);return}if(!player){return}player.getDuration().then(function(duration){function removeInitPlayEvent(){hasPlayed=true;player.off("play",removeInitPlayEvent);player.pause();state.setPaused()}if(!options.forceReadyState){state.setDuration(duration);return}if(!duration){if(!hasPlayed){player.on("play",removeInitPlayEvent)}player.play();state.setPlay();return}state.duration=true;if(hasDimensions){clearInterval(readyStateInterval)}player.on("play",function(){state.setPlay()});player.pause();state.setPaused();state.setDuration(duration)}).catch(function(error){logging.warn("error")});player.getVideoWidth().then(function(videoWidth){hasDimensions=true;if(state.duration){clearInterval(readyStateInterval)}player.getVideoHeight().then(function(videoHeight){state.setDimensions(videoWidth,videoHeight);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})}).catch(function(error){logging.warn(error)})}).catch(function(error){logging.warn(error)});resolve(player)}readyStateInterval=setInterval(apiReady,3e3);apiReady();volumeChangeInterval=setInterval(function(){if(!postMessageIsSafe()){return}player.getVolume().then(function(volume){state.setVolume(volume)}).catch(function(error){logging.warn(error)})},100);player.on("pause",function(){state.setPaused()});player.on("play",function(){state.setPlay()});player.on("seeked",function(data){state.setSeeking();state.setCurrentTime(data.seconds);state.setSeeked()});player.on("ended",function(){state.setEnded()});player.on("timeupdate",function(time){if(time&&time.seconds){state.setCurrentTime(time.seconds)}});that.WasteManagement.toggleOpenEnrollment(false)}if(state.existingPlayer){player=resources.vimeo?new resources.vimeo(state.src.id):new Vimeo.Player(state.src.id);that.WasteManagement.setup(player,"on","off");vimeoReady()}else{guid=Popcorn.guid("hapyak-vimeo-");modifiedSrc=function(src){var params,videoId;params=_.map({player_id:guid,title:0,byline:0,portrait:0},function(val,key){return key+"="+val});videoId=src.match(/^(?:https?\:\/|\/)\/(?:www\.)?vimeo\.\w{3}\/(\d+)/im);videoId=videoId&&videoId[1];return"//player.vimeo.com/video/"+videoId+"?"+params.join("&")}(state.src);$("<iframe/>",{allowFullScreen:true,frameBorder:0,height:$(parent).height(),id:guid,mozAllowFullScreen:true,src:modifiedSrc,webkitAllowFullScreen:true,width:$(parent).width()}).appendTo(parent);player=resources.vimeo?new resources.vimeo(guid):new Vimeo.Player(guid);player.ready().then(function(){that.WasteManagement.setup(player,"on","off");vimeoReady()})}},currentTime:function(time){if(_.isFinite(time)&&time>=0&&player){state.setCurrentTime(time);player.setCurrentTime(time);return time}return state.currentTime},play:function(){state.setPlay();player.play()},pause:function(){player.pause()},volume:function(volume){if(player){if(_.isFinite(volume)&&volume>=0){state.setVolume(volume);player.setVolume(volume);return volume}}return state.volume},muted:function(val){if(!state.storedVolume){state.storedVolume=state.volume}if(state.volume!=0){state.storedVolume=state.volume}if(player){state.setMuted(+val);if(val){player.setVolume(0)}else{player.setVolume(state.storedVolume)}state.setVolume(state.storedVolume);return!!val}},destroy:function(){clearInterval(volumeChangeInterval);if(!postMessageIsSafe()){return}player.unload();if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}destroyed=true},width:function(width){if(_.isFinite(width)&&width>=0&&player&&player.element){player.element.style.width=width+"px"}},height:function(height){if(_.isFinite(height)&&height>=0&&player&&player.element){player.element.style.height=height+"px"}},offsetWidth:function(){var elem=player&&player.element;return elem&&elem.offsetWidth||0},offsetHeight:function(){var elem=player&&player.element;return elem&&elem.offsetHeight||0},videoWidth:function(){return state.videoWidth},videoHeight:function(){return state.videoHeight}}},{findExisting:function(obj){if(obj.tagName==="IFRAME"&&obj.src.indexOf("vimeo.com")>-1){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"}})});hy.define("player.profile.vimeo",["popcorn","player.wrappers","player.vimeo"],function(Popcorn,wrappers,HTMLVimeoVideoElement){Popcorn.HTMLVimeoVideoElement=HTMLVimeoVideoElement;wrappers.vimeo={id:"vimeo",fn:"HTMLVimeoVideoElement",name:"Vimeo",pre:"//www.vimeo.com/",container:function(container,wrapper){return container.parentNode},args:function(video,options){return[options.playerParameters]}};return wrappers.vimeo});hy.define("player.vzaar",["virtualmediaelement","lodash.noconflict"],function(VirtualMediaElement,_){var vzaarUrlRegex=/^(https?:)?\/\/(\w[\w_\-]*\.)*vzaar\.(com|me)\/(videos\/)?(\d+)\/?[^\?]*(\?[^#]*)?/i;return VirtualMediaElement.register("vzaar",function(state,parent){var that=this,iframe,player,previousCurrentTime=0,lastCurrentTimeUpdate=-1,lastSeeked=-1,playedOnce=false,destroyed=false;function getTime(){function receiveTime(currentTime){var now,diff;currentTime=+currentTime;if(!destroyed&&player){if(currentTime>=0){now=Date.now();diff=(currentTime-previousCurrentTime)*1e3;if(now-lastSeeked>20&&(diff<-10||diff-(now-lastCurrentTimeUpdate)>50)){lastSeeked=now;state.setSeeked()}state.setCurrentTime(currentTime);if(previousCurrentTime!==currentTime){lastCurrentTimeUpdate=now}previousCurrentTime=currentTime}setTimeout(getTime,20)}}if(!destroyed&&player){player.getTime(receiveTime)}}function getVolume(){function receiveVolume(vol){if(!destroyed&&player&&vol!==state.volume){if(vol>=0){state.setMuted(false);state.setVolume(vol/5)}setTimeout(getVolume,100)}}if(!destroyed&&player){player.getVolume(receiveVolume)}}function createVzaarPlayerUrl(src){var query=vzaarUrlRegex.exec(src),playerId,protocol,queryString,queryParams={apiOn:true,border:false,autoplay:!!state.autoplay,looping:!!state.loop,hideControls:!state.controls};if(!state.controls){queryParams.disableControls=true}if(!query){return false}playerId=query[5];queryString=query[6];that._util.parseQueryString(queryString,queryParams,true);protocol=window.location.protocol==="https:"?"https":"http";return protocol+"://view.vzaar.com/"+playerId+"/player?"+_.map(queryParams,function(val,key){return key+"="+val}).join("&")}function updatePlayState(playState){if(playState==="mediaStarted"||playState==="mediaPlaying"){playedOnce=true;if(playState==="mediaStarted"&&!state.autoplay){player.pause();if(state.currentTime&&!state.ended){player.play2();player.seekTo(state.currentTime)}}state.setPlay()}else if(playState==="mediaPaused"){state.setPaused()}else if(playState==="mediaEnded"){state.setEnded();player.pause()}}function updateInteraction(action){if(action==="pause"){state.setPaused()}else if(action==="resume"){state.setPlay()}else if(action==="seekbar"){lastSeeked=Date.now();state.setSeeked()}else if(action==="seekbarhandle"){state.setSeeking()}}return{apiRequires:{vzPlayer:"//player.vzaar.com/libs/flashtakt/client.js"},player:function(resources,resolve){var vzPlayer=resources.vzPlayer,playerProperties={},width,height;destroyed=false;playedOnce=false;if(state.existingPlayer){player=state.src;that.WasteManagement.setup(player,"addEventListener","removeEventListener");iframe=player.player.element;width=iframe.getAttribute("width");if(width){state.width=Math.max(0,parseInt(width,10))||0}height=iframe.getAttribute("height");if(height){state.height=Math.max(0,parseInt(height,10))||0}playerProperties.controls=iframe.src.match(/hideControls=(true|false)/);playerProperties.autoplay=iframe.src.match(/autoplay=(true|false)/);playerProperties.loop=iframe.src.match(/looping=(true|false)/);if(!iframe.getAttribute("name")){iframe.setAttribute("name",iframe.id)}_.forEach(playerProperties,function(val,key){if(playerProperties[key]){state[key]=playerProperties[key][1]}})}else{iframe=document.createElement("iframe");iframe.width=state.width===undefined?576:state.width;iframe.height=state.height===undefined?324:state.height;iframe.id=that._util.guid("hapyak-vzaar-container");iframe.src=createVzaarPlayerUrl(state.src);iframe.setAttribute("frameborder","0");iframe.setAttribute("name",iframe.id);parent.appendChild(iframe);player=new vzPlayer(iframe.id);that.WasteManagement.setup(player,"addEventListener","removeEventListener")}player.ready(function(){var width,height;function getDuration(duration){duration=+duration;if(!duration){setTimeout(function(){player.getTotalTime(getDuration)},200)}if(!destroyed){state.setDuration(duration);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})}}player.getTotalTime(getDuration);getTime();getVolume();player.play2();player.addEventListener("playState",updatePlayState);player.addEventListener("interaction",updateInteraction);that.WasteManagement.toggleOpenEnrollment(false);if(state.existingPlayer){width=parseInt(iframe.width,10);height=parseInt(iframe.height,10)}if(width>0&&height>0&&width.toString()===iframe.width&&height.toString()===iframe.height){state.setDimensions(width,height)}else{state.setDimensions(576,324)}resolve(player)})},play:"play2",currentTime:function(time){if(time!==undefined&&player){if(!playedOnce){player.play2()}if(state.ended){player.play2();state.ended=false;state.currentTime=time;return}player.seekTo(time)}},volume:function(volume){volume=+volume;if(volume!==undefined&&player){player.muteOff();player.setVolume(volume*5)}},muted:function(val){if(player){if(val){player.muteOn();state.setMuted(true);state.setVolume(0);return true}else if(val===false){player.muteOff();state.setMuted(false);state.setVolume(state.volume);return false}return state.muted}},destroy:function(){destroyed=true;if(player&&player.removeEventListener){player.removeEventListener("playState",updatePlayState);player.removeEventListener("interaction",updateInteraction)}if(!state.existingPlayer&&iframe&&iframe.parentNode){iframe.parentNode.removeChild(iframe)}},width:function(width){if(width!==undefined&&iframe){iframe.width=width}},height:function(height){if(height!==undefined&&iframe){iframe.height=height}},offsetWidth:function(){return iframe&&iframe.offsetWidth||0},offsetHeight:function(){return iframe&&iframe.offsetHeight||0},parentNode:function(){var elem;if(player instanceof Element){elem=player}else if(player&&player.player){elem=player.player.element.parentNode}return elem}}},{findExisting:function(obj){if(window.vzPlayer&&obj instanceof window.vzPlayer){return"probably"}return""},canPlaySrc:vzaarUrlRegex})});hy.define("player.profile.vzaar",["popcorn","player.wrappers","player.vzaar"],function(Popcorn,wrappers,HTMLVzaarVideoElement){Popcorn.HTMLVzaarVideoElement=HTMLVzaarVideoElement;wrappers.vzaar={id:"vzaar",name:"Vzaar",fn:"HTMLVzaarVideoElement",pre:"//vzaar.com/videos/",container:function(container){var iframe=container.player&&container.player.element||container;if(iframe){return iframe.parentNode}return container}};return wrappers.vzaar});hy.define("player.wistia",["popcorn","virtualmediaelement","utils.embed"],function(Popcorn,VirtualMediaElement,utils){var conversionListeners=[],player;return VirtualMediaElement.register("wistia",function(state,parent){var that=this,destroyed=false;function getIntrinsicDimensions(dimension){var media_assets=utils.dotget(player,"data.media.assets");if(dimension!=="width"&&dimension!=="height"){return 0}if(!media_assets||!media_assets[0]||media_assets[0].display_name!=="Original file"){return 0}if(dimension==="width"){return media_assets[0].width}else{return media_assets[0].height}}return{apiRequires:{Wistia:"//fast.wistia.com/static/E-v1.js"},player:function(resources,resolve){var videoGuid=state.src;var elem,vidOpts;function wistiaSetupEvents(player){var email=player.email(),viewerConversion=function(type,email){var i=0;for(;i<conversionListeners.length;i++){conversionListeners[i](type,{email:email})}};window.addEventListener("keydown",function(e){if([32,13,70,122].indexOf(e.which)>-1){event.stopPropagation()}},true);state.setDimensions(getIntrinsicDimensions("width")||player.videoWidth()||player.width(),getIntrinsicDimensions("height")||player.videoHeight()||player.height());if(!state.existingPlayer){player.videoWidth(parent.offsetWidth||state.width);player.videoHeight(parent.offsetHeight||state.height)}state.setDuration(player.duration());state.setVolume(player.volume());that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});player.bind("play",function(){state.setPlay()});player.bind("pause",function(){state.setPaused()});player.bind("seek",function(currentTime){state.setSeeking();state.setCurrentTime(currentTime);state.setSeeked()});player.bind("timechange",function(time){if(!isNaN(parseInt(time,10))&&time>=0){state.setCurrentTime(time)}});player.bind("volumechange",function(vol){state.setVolume(vol)});player.bind("end",function(){state.setEnded(true)});player.bind("widthchange",function(){that.dispatchEvent("resize")});player.bind("heightchange",function(){that.dispatchEvent("resize")});player.bind("conversion",viewerConversion);that.WasteManagement.toggleOpenEnrollment(false);if(email){viewerConversion("existing-user",email)}resolve(player)}function havePlayer(wistiaPlayer){var shareElem;player=wistiaPlayer;that.WasteManagement.setup(player,"bind","unbind");if(!state.existingPlayer){shareElem=player.container.querySelector(".w-component--share");if(shareElem){shareElem.parentNode.removeChild(shareElem)}}player.ready(function(){wistiaSetupEvents(player)})}window._wq=window._wq||[];destroyed=false;if(state.existingPlayer){parent=state.src.container;player=state.src;havePlayer(player);return}parent.id=Popcorn.guid("hapyak-wistia-container");elem=document.createElement("div");elem.id="wistia_"+videoGuid;vidOpts=!/firefox/i.test(navigator.userAgent)?" playerPreference=html5 videoQuality=hd-only":"";elem.className="wistia_embed controlsVisibleOnLoad=false wistia_async_"+videoGuid+vidOpts;if(!state.controls){elem.className+=" playbar=false smallPlayButton=false volumeControl=false fullscreenButton=false settingsControl=false chromeless=true"}elem.style.width=(state.width||640)+"px";elem.style.height=(state.height||360)+"px";parent.appendChild(elem);_wq.push({id:videoGuid,onReady:havePlayer})},currentTime:function(time){if(player&&time!==undefined&&time>=0){player.time(time)}},volume:function(volume){if(volume!==undefined&&player){state.setVolume(volume);player.volume(volume)}},muted:function(isMuted){state.setMuted(isMuted);state.setVolume(+!isMuted);player.volume(+!isMuted)},destroy:function(){destroyed=true;if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){if(width&&player){player.videoWidth(width)}},height:function(height){if(height&&player){player.videoHeight(height)}},offsetWidth:function(){if(player){return player.width()}return parent&&parent.offsetWidth||0},offsetHeight:function(){if(player){return player.height()}return parent&&parent.offsetHeight||0},videoWidth:function(){return getIntrinsicDimensions("width")||player.videoWidth()||player.width()||state.videoWidth||0},videoHeight:function(){return getIntrinsicDimensions("height")||player.videoHeight()||player.height()||state.videoHeight||0},outerContainer:function(){return utils.dotget(player,"grid.center")}}},{findExisting:function(obj){if(obj.uuid&&obj._embedContainer&&obj._mediaData&&obj.playerType){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"},utils:{getPlayerInstance:function(){return player},addConversionListener:function(callback){conversionListeners.push(callback);if(player){player.ready(function(){var email=player.email();if(email){callback("existing-email",{email:email})}})}}}})});hy.define("player.profile.wistia",["popcorn","player.wrappers","utils.embed","player.wistia","module"],function(Popcorn,wrappers,embedUtils,HTMLWistiaVideoElement,module){var moduleConfig=module.config();function onWistiaReady(elem,elements){elem.removeAttribute("controls");elem.style.zIndex="auto";elem.addEventListener("click",function(){var hapyakControls=elements.controlBar.querySelector(".hapyak-controls"),isVisible=hapyakControls.style.display!=="none";hapyakControls.style.display=isVisible?"none":"block"},false)}Popcorn.HTMLWistiaVideoElement=HTMLWistiaVideoElement;wrappers.wistia={id:"wistia",name:"Wistia",fn:"HTMLWistiaVideoElement",forceIpadControls:function(wistiaObject,elements){if(wistiaObject.elem&&wistiaObject.elem()){onWistiaReady(wistiaObject.elem(),elements)}else{wistiaObject.ready(function(){onWistiaReady(wistiaObject.elem(),elements)})}},args:function(video,options){var args=options.playerParameters||{};if(moduleConfig.captions){args.captions=moduleConfig.captions}return[args]},container:function(container){if(!container){return}if(typeof container.el==="function"){container=container.el()}else if(container._embedContainer){container=container._embedContainer}else{container=container.el}return container},setupAnnotationContainer:function(elements,options){var playBox=elements&&elements.playBox,gridElement=embedUtils.dotget(options,"player.grid.center"),container=embedUtils.dotget(options,"player.container"),hyAnnotationContainer=container&&container.querySelectorAll(".hapyak-annotation-container");if(!elements||!options||!gridElement){return}if(playBox){playBox.appendChild(elements.annotationContainer);return}if(gridElement){gridElement.appendChild(elements.annotationContainer);if(hyAnnotationContainer&&hyAnnotationContainer.length){Array.prototype.forEach.call(hyAnnotationContainer,function(div){div.style.zIndex=100})}}}};return wrappers.wistia});hy.define("player.youtube",["popcorn","virtualmediaelement","utils.embed"],function(Popcorn,VirtualMediaElement,utils){function PlayerUpdateListener(player,state){this.loop=null;this.player=player;this.state=state;this.lastValues={};var that=this;this.callbacks={isMuted:function(value){that.state.setMuted(value)},getCurrentTime:function(value){if(!isNaN(parseInt(value,10))&&value>=0){that.state.setCurrentTime(value)}},getVolume:function(value){that.state.setVolume(value/100)}};this.initializeCallbacks=function(){var key;for(key in that.callbacks){that.lastValues[key]=0}};this.detectChanged=function(){var key,stateValue;for(key in that.callbacks){stateValue=typeof that.player[key]==="function"?that.player[key]():that.player[key];if(stateValue!==that.lastValues[key]){that.callbacks[key](stateValue)}that.lastValues[key]=stateValue}};this.start=function(){this.stop();this.loop=setInterval(that.detectChanged,250)};this.stop=function(){clearInterval(this.loop)};this.initializeCallbacks();this.start()}return VirtualMediaElement.register("youtube",function(state,parent,options){var that=this;var player,playerUpdateLoop;return{apiRequires:{Youtube:"//www.youtube.com/iframe_api"},player:function(resources,resolve){var videoGuid=state.src;var elem;function youtubeSetupEvents(player){state.setDimensions(player.getIframe().width,player.getIframe().height);state.setDuration(player.getDuration());state.setVolume(player.getVolume());that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)});resolve(player)}function onPlayerStateEvent(event){var ytStateMap={0:"end",1:"play",2:"pause",3:"seek"},wrapperStateMap={end:function(){state.setEnded(true)},play:function(){state.setPlay();if(!state.duration){state.setDuration(Infinity);that._util.nextTick(function(){state.setReadyState(that.HAVE_ENOUGH_DATA)})}},pause:function(){state.setPaused()},seek:function(){state.setSeeking();state.setCurrentTime(player.getCurrentTime());state.setSeeked()}};if(ytStateMap[event.data]){wrapperStateMap[ytStateMap[event.data]]()}}function normalizeUrlRegex(value){var prefix="",protocol="(?:https?\\:\\/|\\/)\\/",subdomain="(?:[a-z]\\.|[a-z][a-z0-9-]{0,61}[a-z0-9]\\.)*?";if(value.indexOf("http")!==0&&value.indexOf("//")!==0){prefix+=protocol}prefix+=subdomain;if(value.substr(0,2)==="//"){return"//"+prefix+value.substr(2)}else if(value.substr(0,1)==="/"){return prefix+value.substr(1)}return prefix+value}function getYoutubeVideoId(input){var reg,out;reg=new RegExp("^"+normalizeUrlRegex("(?:youtube\\.(?:googleapis\\.)?\\w{3}\\/(?:watch\\/?\\?)?(v|embed)[=\\/]|youtu\\.be\\/)([a-zA-Z0-9_-]{11})"),"i");out=reg.exec(input);return out?out[out.length-1]:input}function havePlayer(youtubePlayer){player=youtubePlayer.target?youtubePlayer.target:youtubePlayer;playerUpdateLoop=new PlayerUpdateListener(player,state);youtubeSetupEvents(player)}if(!state.existingPlayer){parent.id=Popcorn.guid("hapyak-youtube-container");elem=document.createElement("div");elem.id="youtube_"+videoGuid;elem.style.width=(state.width||640)+"px";elem.style.height=(state.height||360)+"px";parent.appendChild(elem);window.onYouTubeIframeAPIReady=function(){player=new YT.Player(elem.id,{height:elem.style.height,width:elem.style.width,playerVars:{controls:state.controls?1:0,rel:0,playsinline:1},videoId:getYoutubeVideoId(state.src)});that.WasteManagement.setup(player,"addEventListener","removeEventListener");player.addEventListener("onStateChange",onPlayerStateEvent);player.addEventListener("onReady",function(event){havePlayer(event.target)});that.WasteManagement.toggleOpenEnrollment(false)};if(window.YT.loaded===1){window.onYouTubeIframeAPIReady()}}else{player=window.YT.get(state.currentSrc.getIframe().id);that.WasteManagement.setup(player,"addEventListener","removeEventListener");player.addEventListener("onStateChange",onPlayerStateEvent);player.addEventListener("onReady",havePlayer);that.WasteManagement.toggleOpenEnrollment(false);if(typeof player.getDuration==="function"){havePlayer(player)}}},currentTime:function(time){if(player&&time!==undefined&&time>=0){state.setSeeking();player.seekTo(time,true);state.setCurrentTime(time);state.setSeeked()}},play:function(){typeof player.playVideo==="function"&&player.playVideo()},pause:function(){typeof player.pauseVideo==="function"&&player.pauseVideo()},
volume:function(volume){if(volume!==undefined&&player){state.setVolume(volume);player.unMute();player.setVolume(volume*100)}},muted:function(isMuted){state.setMuted(isMuted);state.setVolume(+!isMuted)},destroy:function(){if(playerUpdateLoop){playerUpdateLoop.stop()}if(!state.existingPlayer&&parent&&parent.children){Array.prototype.forEach.call(parent.children,function(child){parent.removeChild(child)})}},width:function(width){if(width&&player.getIframe){player.getIframe().style.width=width+"px"}},height:function(height){if(height&&player.getIframe){player.getIframe().style.height=height+"px"}},offsetWidth:function(){if(player&&player.getIframe){return player.getIframe().offsetWidth}return parent&&parent.offsetWidth||0},offsetHeight:function(){if(player&&player.getIframe){return player.getIframe().offsetHeight}return parent&&parent.offsetHeight||0},videoWidth:function(){if(player&&player.getIframe){return player.getIframe().width.replace("px","")}return state.videoWidth},videoHeight:function(){if(player&&player.getIframe){return player.getIframe().height.replace("px","")}return state.videoHeight}}},{findExisting:function(obj){var prop;for(prop in obj){if(obj.hasOwnProperty(prop)&&obj[prop]==="player"){return"probably"}}return""},canPlaySrc:function(src){return typeof src==="string"},utils:{getPlayerInstance:function(){return player}}})});hy.define("player.profile.youtube",["popcorn","player.wrappers","player.youtube"],function(Popcorn,wrappers,HTMLYoutubeVideoElement,undefined){Popcorn.HTMLYoutubeVideoElement=HTMLYoutubeVideoElement;wrappers.youtube={id:"youtube",name:"Youtube",fn:"HTMLYoutubeVideoElement",args:function(video,options){return[options.playerParameters]},container:function(container){if(container.getIframe){container=container.getIframe()}return container.parentNode}};return wrappers.youtube});hy.define("player.limelightevents",[],function(){return{PLAYER_LOAD:"onPlayerLoad",MEDIA_LOAD:"onMediaLoad",CHANNEL_LOAD:"onChannelLoad",AD_LOAD:"onAdLoad",MEDIA_COMPLETE:"onMediaComplete",CHANNEL_COMPLETE:"onChannelComplete",AD_COMPLETE:"onAdComplete",PLAYHEAD_UPDATE:"onPlayheadUpdate",AD_PLAYHEAD_UPDATE:"onAdPlayheadUpdate",PLAYSTATE_CHANGED:"onPlayStateChanged",QUALITY_CHANGED:"onQualityChanged",FULLSCREEN_CHANGED:"onFullScreenChanged",CUSTOM_EVENT:"onCustomEvent",ERROR:"onError"}});hy.define("utils.numbers",[],function(){var exports={nearly:function(value,target,margin){return value===target||target+margin>=value&&target-margin<=value}};return exports});(function(root){function HYLimelightEventHandler(){this._handlers=[];this._unhandledEvents=[];this.onLimelightEvent=this.onLimelightEvent.bind(this);this.registerHandler=this.registerHandler.bind(this)}HYLimelightEventHandler.prototype.onLimelightEvent=function(playerId,eventName,data){var handled=false,eventArgs=arguments;this._handlers.forEach(function(handler){if(handler.playerId===playerId){handler.onEvent.apply(handler,eventArgs);handled=true}});if(!handled){this._unhandledEvents.push({playerId:playerId,eventName:eventName,data:data})}};HYLimelightEventHandler.prototype.registerHandler=function(handler){if(this._handlers.indexOf(handler)===-1){this._handlers.push(handler);this._replayEvents(handler)}else{console.warn("handler already registered")}};HYLimelightEventHandler.prototype.unregisterHandler=function(handler){var existingIndex=this._handlers.indexOf(handler);if(existingIndex>-1){this._handlers.splice(existingIndex,1)}};HYLimelightEventHandler.prototype._replayEvents=function(handler){var replayedEvents=[];if(this._unhandledEvents.length){this._unhandledEvents.forEach(function(event){if(event.playerId===handler.playerId){handler.onEvent(event.playerId,event.eventName,event.data);replayedEvents.push(event)}});if(replayedEvents.length){this._markHandled(replayedEvents)}}};HYLimelightEventHandler.prototype._markHandled=function(handledEvents){var index;handledEvents.forEach(function(event){index=this._unhandledEvents.indexOf(event);this._unhandledEvents.splice(index,1)}.bind(this))};root.HYLimelightEventHandler=root.HYLimelightEventHandler||new HYLimelightEventHandler;root.limelightPlayerCallback=root.limelightPlayerCallback||root.HYLimelightEventHandler.onLimelightEvent})(window);hy.define("player.HYLimelightEventHandler",function(){});hy.define("player.LimelightWrapper",["player.limelightevents","ember-rsvp","utils.numbers","player.HYLimelightEventHandler"],function(LimelightEvents,RSVP,numbers){var DEFAULT_LIMELIGHT_PLAYER_FORM="LVPPlayerStandard",DEFAULT_PLAYER_ID="limelight_player_"+(new Date).getTime(),DEFAULT_WIDTH="100%",DEFAULT_HEIGHT="100%";function LimelightWrapper(vme,vmeState,parentEl,options){this.vme=vme;this.vmeState=vmeState;this.parentEl=parentEl;this.options=options;this.bindMethods()}LimelightWrapper.prototype.createPlayer=function(mediaId,playerForm,playerId,width,height){playerForm=playerForm||DEFAULT_LIMELIGHT_PLAYER_FORM;playerId=playerId||DEFAULT_PLAYER_ID;width=width||DEFAULT_WIDTH;height=height||DEFAULT_HEIGHT;this.playerId=playerId;if(window.HYLimelightEventHandler){window.HYLimelightEventHandler.registerHandler(this)}else{throw"HYLimelightEventHandler unavailable!"}this.injectEmbed(mediaId,playerForm,playerId,width,height,this.parentEl);return new RSVP.Promise(function(resolve,reject){this.playerCreatedResolver=resolve}.bind(this))};LimelightWrapper.prototype.createPlayerFromEmbed=function(embed,playerId){this.playerId=playerId;this.player=embed;this.setupListeners();this.container=document.getElementById(playerId);if(window.HYLimelightEventHandler){window.HYLimelightEventHandler.registerHandler(this)}return this.player};LimelightWrapper.prototype.injectEmbed=function(mediaId,playerForm,playerId,width,height,parent){var container=document.createElement("div");container.id=playerId;parent.appendChild(container);LimelightPlayerUtil.embed({playerId:playerId,playerForm:playerForm,mediaId:mediaId,width:width,height:height})};LimelightWrapper.prototype.setupListeners=function(){this.vme.WasteManagement.setup(this.vjsPlayer,"on","off");this.vjsPlayer.on("pause",function(){this.vmeState.setPaused()}.bind(this));this.vjsPlayer.on("play",function(){this.vmeState.setPlay()}.bind(this));this.vjsPlayer.on("seeking",function(){this.vmeState.setSeeking()}.bind(this));this.vjsPlayer.on("seeked",function(){this.vmeState.setCurrentTime(this.vjsPlayer.currentTime());this.vmeState.setSeeked()}.bind(this));this.vjsPlayer.on("timeupdate",function(){this.vmeState.setCurrentTime(this.vjsPlayer.currentTime())}.bind(this));this.vjsPlayer.on("volumechange",function(){this.vmeState.setVolume(this.vjsPlayer.volume())}.bind(this));this.vme.WasteManagement.toggleOpenEnrollment(false)};LimelightWrapper.prototype.onEvent=function(playerId,eventName,data){if(!this.player){this.player=LimelightPlayerUtil.players[playerId];this.setupListeners();if(this.playerCreatedResolver&&typeof this.playerCreatedResolver==="function"){this.playerCreatedResolver(this.player);delete this.playerCreatedResolver}}if(!this.container){this.container=document.getElementById(playerId)}this.handleEvent.apply(this,arguments)};LimelightWrapper.prototype.handleEvent=function(playerId,eventName,data){switch(eventName){case LimelightEvents.MEDIA_LOAD:this.vmeState.setDimensions(this.videoWidth(),this.videoHeight());this.vmeState.setDuration(data.durationInMilliseconds/1e3);this.vmeState.setVolume(this.player.doGetVolume());this.vmeState.setReadyState(this.vme.HAVE_ENOUGH_DATA);break;case LimelightEvents.MEDIA_COMPLETE:this.vmeState.setEnded();break}};LimelightWrapper.prototype.play=function(){this.player&&this.player.doPlay()};LimelightWrapper.prototype.pause=function(){this.player&&this.player.doPause()};LimelightWrapper.prototype.currentTime=function(time){if(this.player&&time){this.player.doSeekToSecond(time)}if(this.vjsPlayer&&typeof this.vjsPlayer.currentTime=="function"){return this.vjsPlayer.currentTime()}else{return 0}};LimelightWrapper.prototype.volume=function(volume){if(this.player&&typeof volume!=="undefined"){this.player.doSetVolume(volume);this.vmeState.setVolume(volume)}return this.vmeState.volume};LimelightWrapper.prototype.muted=function(muted){var vol=muted?0:1;if(this.player&&typeof muted!=="undefined"){this.player.doSetVolume(vol);if(this.vjsVideoEl){this.vjsVideoEl.muted=muted}this.vmeState.setMuted(muted)}return this.vmeState.muted};LimelightWrapper.prototype.width=function(width){if(width&&this.container){this.container.style.width=width+"px"}else if(this.container){return this.container.clientWidth}else{return 0}};LimelightWrapper.prototype.height=function(height){if(height&&this.container){this.container.style.height=height+"px"}else if(this.container){return this.container.clientHeight}else{return 0}};LimelightWrapper.prototype.offsetWidth=function(){return this.vjsEl&&this.vjsEl.offsetWidth||this.container&&this.container.offsetWidth||0};LimelightWrapper.prototype.offsetHeight=function(){return this.vjsEl&&this.vjsEl.offsetHeight||this.container&&this.container.offsetHeight||0};LimelightWrapper.prototype.videoWidth=function(){return this.vjsPlayer&&this.vjsPlayer.videoWidth()||this.offsetWidth()||0};LimelightWrapper.prototype.videoHeight=function(){return this.vjsPlayer&&this.vjsPlayer.videoHeight()||this.offsetHeight()||0};LimelightWrapper.prototype.canPlayType=function(){return"probably"};LimelightWrapper.prototype.hideControls=function(){if(this.vjsPlayer){this.vjsPlayer.controlBar.hide();var hidePlayButtonStyle=document.createElement("style");hidePlayButtonStyle.textContent=".vjs-limelight-big-play { display: none !important }";document.head.appendChild(hidePlayButtonStyle)}};LimelightWrapper.prototype.destroy=function(){if(window.HYLimelightEventHandler){window.HYLimelightEventHandler.unregisterHandler(this);delete this.player}};LimelightWrapper.prototype.bindMethods=function(){Object.keys(LimelightWrapper.prototype).filter(function(key){return key!=="bindMethods"}).forEach(function(key){this[key]=this[key].bind(this)}.bind(this))};Object.defineProperties(LimelightWrapper.prototype,{vjsPlayer:{get:function(){return this.player&&this.player.doGetVjsPlayer()}},vjsEl:{get:function(){var vjs=this.vjsPlayer;return vjs&&typeof vjs.el==="function"&&vjs.el()}},vjsVideoEl:{get:function(){var parentEl=this.vjsEl;return parentEl&&parentEl.querySelector("video")}}});return LimelightWrapper});hy.define("player.limelightv2",["popcorn","virtualmediaelement","player.LimelightWrapper"],function(Popcorn,VirtualMediaElement,LimelightWrapper){var EXPOSED_METHODS=["play","pause","currentTime","volume","width","height","muted","offsetWidth","offsetHeight","videoWidth","videoHeight","canPlayType","destroy"];return VirtualMediaElement.register("limelightv2",function(state,parent,options){var wrapper=new LimelightWrapper(this,state,parent,options),wrapperInterface={};wrapperInterface.apiRequires={LimelightPlayerUtil:"https://video.limelight.com/player/limelightjs-player.js"+(options.orgId?"?orgId="+options.orgId:"")};wrapperInterface.player=function(resources,resolve){if(state.currentSrc&&typeof state.currentSrc.getPlayers==="function"){wrapper.createPlayerFromEmbed(state.currentSrc,options.playerId);resolve(state.currentSrc)}else{wrapper.createPlayer(options.mediaId,options.playerForm,options.playerId).then(function(player){resolve(player);if(!state.controls){wrapper.hideControls()}})}};EXPOSED_METHODS.forEach(function delegateHandling(method){wrapperInterface[method]=wrapper[method]});return wrapperInterface},{findExisting:function(obj){if(obj&&typeof obj.getPlayers==="function"){return"probably"}return""},canPlaySrc:function(src){return typeof src==="string"}})});hy.define("player.profile.limelightv2",["player.wrappers","player.limelightv2"],function(wrappers,HTMLLimelightv2VideoElement){Popcorn.HTMLLimelightv2VideoElement=HTMLLimelightv2VideoElement;var playerId;wrappers.limelightv2={id:"limelightv2",name:"Limelight",fn:"HTMLLimelightv2VideoElement",args:function(video,options){playerId=options.playerParameters.playerId;return[options.playerParameters]},container:function(container,wrapper){if(typeof container.getPlayers==="function"&&playerId){var limelightContainer=document.getElementById(playerId);if(limelightContainer){if(limelightContainer.querySelector(".video-js")){return limelightContainer.querySelector(".video-js")}return limelightContainer}}return container.parentNode}};return wrappers.limelightv2});hy.define("facebookSDK",[],function(){var id="facebook-jssdk";function fireCallback(callback){if(callback&&typeof callback==="function"){callback()}}return{load:function(callback){var script,firstScript;firstScript=document.getElementsByTagName("script")[0];if(document.getElementById(id)){fireCallback(callback);return}script=document.createElement("script");script.id=id;script.src="//connect.facebook.net/en_US/sdk.js";script.onload=function(){fireCallback(callback)};firstScript.parentNode.insertBefore(script,firstScript)}}});hy.define("popcorn.sharing",["configuration","popcorn","utils","utils.embed","facebookSDK"],function(configuration,Popcorn,utils,embedUtils,facebookSDK,undefined){function getOption(popcorn,opt){return popcorn.options&&popcorn.options.sharing&&popcorn.options.sharing[opt]||""}function getVideoLink(popcorn){return getOption(popcorn,"url")||window.location.href}function openWindow(url){var width=400,height=300,left=parseInt(screen.availWidth/2-width/2,10),top=parseInt(screen.availHeight/2-height/2,10);return window.open(url,"popcornSharing","toolbar=no,menubar=no,status=no,location=no,resizable=yes,width=580,height=400,left="+left+",top="+top)}Popcorn.p.shareFacebook=function(url,text){var shareUrl,shareWindow;function onClose(event){if(event.data==="hapyak.close-window"){shareWindow.close();utils.removePostMessageListener(onClose)}}facebookSDK.load(function(){url=url||encodeURIComponent(getVideoLink(this));text=text||getOption(this,"title");shareUrl="https://www.facebook.com/dialog/feed?"+"app_id="+configuration.facebook.appId+"&"+"link="+url+"&"+"name="+encodeURIComponent(text)+"&"+"caption="+encodeURIComponent("Check out this video on HapYak")+"&"+"picture="+encodeURIComponent(getOption(this,"image"))+"&"+"display=popup&"+"redirect_uri="+hapyak.rootUrl+"/static/close.html";shareWindow=openWindow(shareUrl);utils.listenForPostMessage(onClose)})};Popcorn.p.shareTwitter=function(url,text){var shareUrl;url=url||encodeURIComponent(getVideoLink(this));text=text||"Check out this video on HapYak";shareUrl="https://twitter.com/share?"+"hashtags=hapyak&"+"text="+encodeURIComponent(text)+"&"+"url="+url;openWindow(shareUrl)};function twitter(url,text){var base="https://twitter.com/intent/tweet/?",body="text="+encodeURIComponent(text),link="&url="+encodeURI(url||"http://corp.hapyak.com");openWindow(base+body+link)}function facebook(url,text,title,source,overrideId){var appId=overrideId?overrideId:embedUtils.dotget(configuration,"player.facebook.appId");if(!appId){console.warn("Facebook sharing requires an app_id!");return}facebookSDK.load(function(){window.FB.init({appId:appId,status:true,xfbml:true,version:"v2.7"});window.FB.ui({method:"feed",link:url||"http://corp.hapyak.com",description:text,redirect_uri:hapyak.rootUrl+"/static/close.html",display:"popup"})})}function linkedin(url,text,title,source){var base="https://www.linkedin.com/shareArticle?mini=true",body="&summary="+encodeURIComponent(text),link="&url="+encodeURI(url||"http://corp.hapyak.com"),title="&title="+(title||encodeURIComponent("HapYak Interactive Video")),source="&source="+(source||encodeURIComponent("HapYak"));openWindow(base+body+link+title+source)}function email(url,text,title,source){var base="mailto:",subject="?Subject="+encodeURIComponent(title),body="&Body="+encodeURIComponent(text+" "+url);openWindow(base+subject+body)}Popcorn.p.shareGoogle=function(url){var shareUrl;url=url||encodeURIComponent(getVideoLink(this));shareUrl="https://plus.google.com/share?url="+url;openWindow(shareUrl)};Popcorn.p.twitter=twitter;Popcorn.p.facebook=facebook;Popcorn.p.linkedin=linkedin;return{twitter:twitter,facebook:facebook,linkedin:linkedin,email:email}});hy.define("popcorn.bookmark",["popcorn","player.playereval","configuration","popcorn.base","popcorn.sharing"],function(Popcorn,playereval,configuration){var document=window.document,sharingEnabled=configuration.player&&configuration.player.sharing===true;Popcorn.basePlugin("bookmark",function(options,base){var popcorn,container,inner,div,canvas,me,shareContainer,shareTitle,shareFacebook,shareTwitter,shareGoogle,shareLink,shareLinkContainer,shareInput,nextEvent,prevEvent,previous,next,close,id,templateEvaluator=new playereval.TemplateEvaluator(this,options),drawFn,modes={bookmark:{drawFn:function(){var style=window.getComputedStyle(container),ctx;canvas=document.createElement("canvas");canvas.width=container.offsetWidth||300;canvas.height=80;container.appendChild(canvas);ctx=canvas.getContext("2d");ctx.fillStyle=style.getPropertyValue("background-color");ctx.moveTo(0,0);ctx.lineTo(0,canvas.height);ctx.lineTo(canvas.width/2,0);ctx.lineTo(canvas.width,canvas.height);ctx.lineTo(canvas.width,0);ctx.fill()},className:"popcorn-bookmark-bookmark"},title:{className:"popcorn-bookmark-title"},invisible:{className:"popcorn-bookmark-invisible"},minimal:{className:"popcorn-bookmark-minimal"}};function updateAdjacentChapters(){var i,evt,index,list;if(!me){return}nextEvent=null;prevEvent=null;list=popcorn.data.trackEvents.byStart;index=list.indexOf(me);for(i=index-1;i>0;i--){evt=list[i];if(evt._natives&&evt._natives.type==="bookmark"){prevEvent=evt;break}}if(prevEvent){previous.style.display=""}else{previous.style.display="none"}for(i=index+1;i<list.length;i++){evt=list[i];if(evt._natives&&evt._natives.type==="bookmark"){nextEvent=evt;break}}if(nextEvent){next.style.display=""}else{next.style.display="none"}}function popcornUpdate(data){var trackEvent;if(data.id===id){return}trackEvent=popcorn.getTrackEvent(data.id);if(trackEvent._natives&&trackEvent._natives.type==="bookmark"){updateAdjacentChapters()}}function popcornRemove(trackEvent){if(trackEvent._id!==id&&trackEvent._natives&&trackEvent._natives.type==="bookmark"){updateAdjacentChapters()}}function popcornAdd(trackEvent){if(trackEvent._id!==id&&trackEvent._natives&&trackEvent._natives.type==="bookmark"){updateAdjacentChapters()}}function pauseMedia(){popcorn.pause()}function getShareText(){return"Check out "+options.text+" in this video"}function doShareTwitter(){popcorn.pause();popcorn.shareTwitter(options.url,getShareText())}function doShareFacebook(){popcorn.pause();popcorn.shareFacebook(options.url,getShareText())}function doShareGoogle(){popcorn.pause();popcorn.shareGoogle(options.url,getShareText())}function setShareLink(){var encodedUrl;if(!(sharingEnabled&&options.url)){if(shareContainer){inner.removeChild(shareContainer);shareContainer=null;shareInput=null;shareFacebook=null;shareTwitter=null}return}if(!shareContainer){shareTitle=document.createElement("span");shareTitle.innerHTML="Share this";shareContainer=document.createElement("div");shareContainer.className="popcorn-bookmark-share";shareFacebook=document.createElement("a");shareFacebook.className="popcorn-bookmark-share-facebook";shareFacebook.appendChild(document.createTextNode("Facebook"));shareFacebook.onclick=doShareFacebook;shareTwitter=document.createElement("a");shareTwitter.className="popcorn-bookmark-share-twitter";shareTwitter.appendChild(document.createTextNode("Twitter"));shareTwitter.onclick=doShareTwitter;shareGoogle=document.createElement("a");shareGoogle.className="popcorn-bookmark-share-google";shareGoogle.appendChild(document.createTextNode("Google Plus"));shareGoogle.onclick=doShareGoogle;shareLink=document.createElement("span");shareLink.className="popcorn-bookmark-share-link";shareLink.innerHTML="Link";shareLink.addEventListener("click",function(){pauseMedia();if(shareContainer.className.split(" ").indexOf("expanded")<0){base.addClass(shareContainer,"expanded")}else{base.removeClass(shareContainer,"expanded")}},false);shareLinkContainer=document.createElement("div");shareLinkContainer.className="popcorn-bookmark-share-section";shareInput=document.createElement("input");shareInput.className="popcorn-bookmark-share-text";shareInput.onclick=function(){this.focus();this.select()};shareContainer.appendChild(shareTitle);shareContainer.appendChild(shareFacebook);shareContainer.appendChild(shareTwitter);shareContainer.appendChild(shareGoogle);shareContainer.appendChild(shareLink);shareLinkContainer.appendChild(shareInput);shareContainer.appendChild(shareLinkContainer);shareContainer.appendChild(shareLinkContainer);inner.appendChild(shareContainer)}encodedUrl=encodeURIComponent(options.url);shareInput.setAttribute("value",options.url)}function setMode(){var mode;for(mode in modes){if(mode!==options.mode&&modes[mode].className){base.removeClass(container,modes[mode].className)}else{drawFn=modes[mode].drawFn;if(modes[mode].className){base.addClass(container,modes[mode].className)}}}if(canvas&&canvas.parentNode){canvas.parentNode.removeChild(canvas)}if(drawFn){drawFn()}else{canvas=null}}function setText(){var text,i;text=templateEvaluator.evaluate(options.text);div.innerHTML="";if(!text){return}text=text.split("\n");for(i=0;i<text.length;i++){if(i){div.appendChild(document.createElement("br"))}div.appendChild(document.createTextNode(text[i]))}}base.target=base.target||options.target;if(!base.target){return{_update:function(){}}}popcorn=this;container=base.makeContainer();options.container=container;if(!options.mode){options.mode="bookmark"}inner=document.createElement("div");container.appendChild(inner);div=document.createElement("div");setText();templateEvaluator.watchTemplateVars(options.text,setText);inner.appendChild(div);previous=document.createElement("div");previous.className="popcorn-bookmark-previous";previous.innerHTML="Previous Chapter";previous.addEventListener("click",function(){if(prevEvent){popcorn.currentTime(prevEvent.start)}},false);inner.appendChild(previous);next=document.createElement("div");next.className="popcorn-bookmark-next";next.innerHTML="Next Chapter";next.addEventListener("click",function(){if(nextEvent){popcorn.currentTime(nextEvent.start)}},false);inner.appendChild(next);container.style.cssText=options.style||"";base.animate(base.container);setMode();setShareLink();close=document.createElement("div");close.className="popcorn-bookmark-close";close.innerHTML="<span>x</span>";close.addEventListener("click",function(){base.removeClass(base.container,"active")},false);inner.appendChild(close);popcorn.on("trackchange",popcornUpdate);popcorn.on("trackadded",popcornAdd);popcorn.on("trackremoved",popcornRemove);options.annotationVariableConfig.add("bookmark",options,function(scope,key,data){var trackEvent=popcorn.getTrackEvent(options.id);trackEvent.text=options.text=data.text;setText()});return{start:function(){base.addClass(base.container,"active");if(!me){me=popcorn.getTrackEvent(id);if(me){updateAdjacentChapters()}else{setTimeout(function(){me=popcorn.getTrackEvent(id);updateAdjacentChapters()},0)}}},_setup:function(options){id=options._id},end:function(){base.removeClass(base.container,"active")},_update:function(trackEvent,changes){if(changes.text!==undefined&&changes.text!==options.text){options.text=changes.text||"";templateEvaluator.watchTemplateVars(options.text,setText);setText()}if(changes.hasOwnProperty("mode")&&changes.mode!==options.mode){options.mode=changes.mode;setMode()}if(changes.pause!==undefined&&options.pause!==changes.pause||changes.end!==options.end||changes.start!==options.start){options.pause=changes.pause}if(changes.url!==options.url){options.url=changes.url;setShareLink()}if(changes.style!==undefined){container.style.cssText=changes.style}if(!me){me=popcorn.getTrackEvent(id)}updateAdjacentChapters();options.annotationVariableConfig.update("bookmark",options)},_teardown:function(){popcorn.on("trackchange",popcornUpdate);popcorn.on("trackadded",popcornAdd);popcorn.on("trackremoved",popcornRemove);options.annotationVariableConfig.remove(options.annotationId)}}})});hy.define("popcorn.profile.bookmark",["popcorn.bookmark"],function(){return function(options){var rootUrl=options.rootUrl;return{id:"bookmark",icon:"bookmark",sortIndex:2,title:"a chapter marker",editor:["popcorn.quickedit.bookmark"],zIndex:5,variables:{populateConfig:function(id,options){var config={},data={},key="Bookmark_"+id;if(options.text){data.text=options.text}config[key]=data;return config}},commit:true,create:function(id,annotation,editor){var track=annotation.get("track"),video=track&&track.get("video");var baseUrl;if(video&&track){baseUrl=rootUrl+"/videos/"+video.get("id")+"/tracks/"+track.get("id");editor.setting(id,"bookmarkUrl",baseUrl+"/annotations/"+annotation.get("id"))}}}}});hy.define("popcorn.social",["lodash.noconflict","popcorn.sharing"],function(_){Popcorn.basePlugin("social",function(options,base){var listeners=[],popcorn=this,supports=["twitter","facebook","linkedin"];function setupSocial(type){if(!type||supports.indexOf(type)===-1){return}var el=document.createElement("div"),listener={el:el,callback:function(){if(popcorn&&popcorn[type]){popcorn[type](options.url,options.text,options.title)}}};el.className="fa fa-"+type;if([null,undefined].indexOf(options[type].enabled)>-1){options[type].enabled=true}listeners.push(listener);el.addEventListener("click",listener.callback,false);options.container.appendChild(el)}function findChanges(a,b){return _.reduce(a,function(result,value,key){return _.isEqual(value,b[key])?result:result.concat(key)},[])}function updateEnabled(){supports.forEach(function(type){base[options[type].enabled?"removeClass":"addClass"](base.container.querySelector(".fa-"+type),"hide")})}function updateSize(){var container=base.container,size=options.size;base.removeClass(container,"small");base.removeClass(container,"large");if(size==="medium"){return}base.addClass(container,size)}function updatePositions(){var elements=[];options.order.forEach(function(type){var el=document.querySelector(".fa-"+type);options.container.removeChild(el);elements.push(el)});elements.forEach(function(el){options.container.appendChild(el)})}base.makeContainer();options.container=base.container;options.container.style.top=options.top;options.container.style.left=options.left;options.order.forEach(setupSocial);updateEnabled();updateSize();if(options.vertical){base.addClass(base.container,"vertical")}return{start:function(){base.addClass(base.container,"active")},end:function(){base.removeClass(base.container,"active")},_update:function(trackEvent,changes){if(!_.isEqual(trackEvent.order,changes.order)){trackEvent.order=changes.order;updatePositions()}trackEvent.url=changes.url;trackEvent.text=changes.text;trackEvent.title=changes.title;trackEvent.size=changes.size;options.order.forEach(function(type){findChanges(trackEvent[type],changes[type]).forEach(function(key){trackEvent[key]=changes[key]})});updateEnabled();updateSize()},_teardown:function(){listeners.forEach(function(obj){if(obj.el&&obj.callback){obj.el.removeEventListener("click",obj.callback,false)}});listeners=[]}}})});hy.define("popcorn.profile.social",["popcorn.social"],function(){return function(options){return{id:"social",title:"Social Sharing",icon:"share",editor:["popcorn.quickedit.social"],sortIndex:3,zIndex:10,commit:true,defaults:{order:["twitter","facebook","linkedin"],url:"http://corp.hapyak.com",text:"Check out this interactive video via HapYak",title:"HapYak",size:"medium",top:"50%",left:"50%",twitter:{enabled:true},facebook:{enabled:true},linkedin:{enabled:true}}}}});hy.define("popcorn.contents",["require","jquery.noconflict","lodash.noconflict","utils","popcorn","player.playereval","logging"],function(require,$,_,utils,Popcorn,playereval,logging){var defaultMode="legacy",defaultTitle="Chapters",defaultPosition="top-left";function timeToText(t){var hr,min,sec;t=Math.floor(t);sec=t%60;min=(t-sec)/60;if(sec<10){sec=Math.max(0,sec);sec="0"+sec}if(min>59){hr=Math.floor(min/60);min=min%60;if(min<10){min=Math.max(0,min);min="0"+min}return hr+":"+min+":"+sec}if(min<10){min=Math.max(0,min);min="0"+min}return min+":"+sec}Popcorn.basePlugin("contents",function(options,base){var popcorn=this,modes={},contentsById={},contentsByTime=[],isReady=false,isOpen=false,needsReflow=true,needsResize=true,needsSetup=true,currentMode,hideTimeout,position,expandedState,duration,inner,hidden,tracking=popcorn.options.hapyakPlayer.tracking,templateEvaluator=new playereval.TemplateEvaluator(this,options);function isEditing(){return base.hasClass(base.container,"editing")}function setOptions(){if(!options.title&&options.title!==""){options.title=defaultTitle}position=options.position||defaultPosition;expandedState=options.expandedState||"collapsed";if(options.duration>3){duration=options.duration}else if(options.duration){duration=3}else{duration=10}logging.info("TOC – setOptions",_.clone(options))}function update(){if(modes[currentMode]&&typeof modes[currentMode].update==="function"){modes[currentMode].update()}}function reflow(){if(needsSetup){return}if(modes[currentMode]&&typeof modes[currentMode].reflow==="function"){modes[currentMode].reflow()}needsReflow=false}function teardown(){if(modes[currentMode]&&typeof modes[currentMode].teardown==="function"){modes[currentMode].teardown();isReady=false;needsReflow=needsResize=needsSetup=true}}function hideContainer(){base.removeClass(base.container,"visible");base.removeClass(base.container,"expanded");base.addClass(base.container,"collapsed");if(!isOpen){return}logging.info("TOC – hideContainer");clearTimeout(hideTimeout);if(modes[currentMode]&&typeof modes[currentMode].hide==="function"){modes[currentMode].hide()}isOpen=false;onResize()}function showContainer(){base.addClass(base.container,"visible");base.addClass(base.container,"expanded");base.removeClass(base.container,"collapsed");if(needsReflow){reflow()}if(isOpen){onResize();return}logging.info("TOC - showContainer");resetTimer();if(modes[currentMode]&&typeof modes[currentMode].show==="function"){modes[currentMode].show()}isOpen=true;onResize()}function onResize(){var callbacks,i,fn,trackEvent=popcorn.getTrackEvent(options._id)||options;if(trackEvent.onResize){logging.info("TOC - Resize edit controls");callbacks=base.toArray(trackEvent.onResize);for(i=0;i<callbacks.length;i++){fn=callbacks[i];if(typeof fn==="function"){fn()}}}needsResize=false}function resetTimer(){clearTimeout(hideTimeout);hideTimeout=window.setTimeout(function(){if(isEditing()){return}hideContainer()},duration*1e3)}function updateTrackEvent(trackEvent,id){var li,label,time,obj,insert,i,evt;if(trackEvent&&!id){id=trackEvent._id}else if(!trackEvent){trackEvent=popcorn.getTrackEvent(id)}if(!trackEvent._natives||trackEvent._natives.type!=="bookmark"){return}if(!trackEvent.container||!trackEvent.container.parentNode){removeTrackEvent(trackEvent);return}obj=contentsById[id];if(obj){li=obj.li;if(trackEvent.text!==obj.text||!trackEvent.text&&trackEvent.start!==obj.trackEvent.start){needsReflow=true}if(obj.start!==trackEvent.start||obj.end!==trackEvent.end){insert=true;needsReflow=true;i=contentsByTime.indexOf(obj);if(i>=0){contentsByTime.splice(i,1)}}}else{var listItemHandler=function(){var skipped=Math.abs(obj.start-popcorn.currentTime());hideContainer();if(popcorn.paused()){popcorn.on("seeked",function onSeeked(){popcorn.off("seeked",onSeeked);popcorn.play()})}popcorn.currentTime(obj.start);if(options.annotationId){tracking.annotationActionById(options.annotationId,"contents","Click",{Target:obj.trackEvent.annotationId,"Target Time":obj.start,Text:obj.trackEvent.text,Skipped:skipped})}else{logging.warn("Failed to track TOC chapter click",options)}};li=$('<li tabindex="0" role="listitem" />');a11yListener(li,listItemHandler);label=$('<span class="popcorn-contents-label" />').prependTo(li);time=$('<time class="popcorn-contents-time" />').appendTo(li);contentsById[id]=obj={li:li,label:label,time:time,start:trackEvent.start,end:trackEvent.end};insert=true;needsReflow=true}
obj.trackEvent=trackEvent;obj.start=trackEvent.start;obj.end=trackEvent.end;obj.text=trackEvent.text;if(obj.text&&obj.label){obj.label.text(templateEvaluator.evaluate(obj.text))}if([null,undefined,NaN].indexOf(obj.start)&&obj.time){obj.time.text(timeToText(trackEvent.start))}if(hidden&&insert){for(i=contentsByTime.length-1;i>=0;i--){evt=contentsByTime[i];if(evt.start<=obj.start||evt.end<obj.end){break}}contentsByTime.splice(Math.max(0,i+1),0,obj);hidden.append(li)}}function trackChange(data){updateTrackEvent(null,data.id);if(needsReflow&&isOpen){reflow()}}function removeTrackEvent(trackEvent,id){var obj,i;if(!id){id=trackEvent._id}if(!id){id=trackEvent._id;needsReflow=true}else if(!trackEvent){trackEvent=popcorn.getTrackEvent(id)}if(!trackEvent||!trackEvent._natives||trackEvent._natives.type!=="bookmark"){return}obj=contentsById[id];if(!obj){return}if(obj.li){obj.li.remove();needsReflow=true}delete contentsById[id];i=contentsByTime.indexOf(obj);if(i>=0){contentsByTime.splice(i,1)}if(needsReflow&&isOpen){reflow()}}function updateContents(){var trackEvents=popcorn.getTrackEvents(),bookmarks=[],oldContentsById,trackEvent,i,id;for(i=0;i<trackEvents.length;i++){trackEvent=trackEvents[i];if(trackEvent._natives&&trackEvent._natives.type==="bookmark"){bookmarks.push(trackEvent)}}oldContentsById=_.clone(contentsById);contentsById={};for(i=0;i<bookmarks.length;i++){(function(i){trackEvent=bookmarks[i];id=trackEvent._id;if(oldContentsById[id]){contentsById[id]=oldContentsById[id];delete oldContentsById[id]}updateTrackEvent(trackEvent,id);templateEvaluator.watchTemplateVars(trackEvent.text,function(){updateTrackEvent(trackEvent,id)})})(i)}for(id in oldContentsById){if(oldContentsById.hasOwnProperty(id)){removeTrackEvent(null,id)}}needsReflow=true;logging.info("TOC - updateContents")}function highlightCurrentBookmark(context){var trackEvents,prevEvent,currentTime,precedingBookmark,obj,i;if(typeof context==="undefined"){return}else if(context.type==="trackstart"&&context._natives.type==="bookmark"){precedingBookmark=context}else{currentTime=popcorn.currentTime();trackEvents=popcorn.getTrackEvents();i=utils.binarySearchByKey(trackEvents,"start",currentTime);while(i>=0){prevEvent=trackEvents[i];if(prevEvent.start<=currentTime+.5&&prevEvent._natives.type==="bookmark"){precedingBookmark=prevEvent;break}i--}}for(i=0;i<contentsByTime.length;i++){obj=contentsByTime[i];if(precedingBookmark&&obj.start===precedingBookmark.start){obj.li.addClass("active")}else{obj.li.removeClass("active")}}}function setupMode(){var mode,modeSetup;if(currentMode){if(currentMode===options.mode){return}teardown()}currentMode=options.mode||defaultMode;logging.info("TOC - setupMode: "+currentMode);for(mode in modes){if(mode!==currentMode&&modes[mode].className){base.removeClass(base.container,modes[mode].className)}else{modeSetup=modes[mode].setup;if(modes[mode].className){base.addClass(base.container,modes[mode].className)}}}if(typeof modeSetup==="function"){modeSetup()}isReady=true}function setup(){setOptions();setupMode();needsSetup=false;base.animate();if(isReady&&Object.keys(contentsById).length&&expandedState==="expanded"){if(isOpen){needsReflow=true}showContainer()}else{if(isOpen){reflow()}onResize();hideContainer()}}function loadMode(mode){if(!mode){mode=defaultMode}if(!modes||!modes[mode]){logging.info("TOC - loadMode (init): "+mode);require(["popcorn.contents.mode."+mode],function(modeInit){options.tracking=tracking;modes[mode]=modeInit(options,contentsById,contentsByTime,$(base.container),inner,hidden,showContainer,hideContainer);setup()})}else if(modes&&modes[mode]){logging.info("TOC - loadMode: "+mode);setup()}}setOptions();base.makeContainer();options.container=base.container;base.addClass(base.container,position);$(base.container).mouseover(function(){if(hideTimeout&&isOpen){clearTimeout(hideTimeout)}}).mouseleave(function(){if(isOpen){resetTimer()}});inner=$('<div class="popcorn-contents-inner" />').appendTo(base.container);hidden=$('<ul class="popcorn-contents-hidden" />').appendTo(inner);updateContents();loadMode(options.mode);popcorn.on("trackchange",trackChange);popcorn.on("trackadded",updateTrackEvent);popcorn.on("trackremoved",removeTrackEvent);popcorn.on("trackstart",highlightCurrentBookmark);popcorn.on("seeked",highlightCurrentBookmark);popcorn.on("resized",function(){needsReflow=true;if(isOpen){logging.info("TOC - Player was resized");reflow()}});popcorn.on("annotationsloaded",function onAnnotationsLoaded(){if(isReady&&Object.keys(contentsById).length&&expandedState==="expanded"){showContainer()}popcorn.off("annotationsloaded",onAnnotationsLoaded)});options.end=Infinity;templateEvaluator.watchTemplateVars(options.title,function(scope,name,value){options.title=value;update()});options.title=templateEvaluator.evaluate(options.title);options.annotationVariableConfig.add("contents",options,function(scope,key,data){var trackEvents=popcorn.data.trackEvents.byStart;options.title=data.text;update();_.forEach(contentsById,function(content,id){removeTrackEvent(null,id)});trackEvents.forEach(function(trackEvent){if(trackEvent&&trackEvent._natives&&trackEvent._natives.type==="bookmark"){updateTrackEvent(trackEvent)}});reflow()});return{start:function(){base.addClass(base.container,"active");if(expandedState==="expanded"){if(!isOpen){showContainer()}else{resetTimer()}}},_update:function(trackEvent,changes){if(trackEvent.annotationId!==changes.annotationId){trackEvent.annotationId=changes.annotationId}if(trackEvent.mode!==changes.mode){trackEvent.mode=changes.mode;needsSetup=true}if(trackEvent.title!==changes.title){if(changes.title===undefined){trackEvent.title=defaultTitle}else{trackEvent.title=changes.title}options.annotationVariableConfig.update("contents",options);update()}if(trackEvent.position!==changes.position){base.removeClass(trackEvent.container,trackEvent.position||defaultPosition);base.addClass(trackEvent.container,changes.position);trackEvent.position=changes.position}if(trackEvent.expandedState!==changes.expandedState){trackEvent.expandedState=changes.expandedState}if(trackEvent.duration!==changes.duration){trackEvent.duration=changes.duration}if(trackEvent.onResize!==changes.onResize){trackEvent.onResize=changes.onResize;needsResize=true}updateContents();if(needsSetup){loadMode(trackEvent.mode)}else{setOptions();if(needsResize){onResize()}}},end:function(){clearTimeout(hideTimeout);base.removeClass(base.container,"active")},_teardown:function(){var id;clearTimeout(hideTimeout);teardown();popcorn.off("trackchange",trackChange);popcorn.off("trackadded",updateTrackEvent);popcorn.off("trackremoved",removeTrackEvent);popcorn.off("trackstart",highlightCurrentBookmark);popcorn.off("seeked",highlightCurrentBookmark);for(id in contentsById){if(contentsById.hasOwnProperty(id)){removeTrackEvent(null,id)}}options.annotationVariableConfig.remove(options.annotationId)}}})});hy.define("popcorn.contents.mode.legacy",["jquery.noconflict","lodash.noconflict","logging"],function($,_,logging){return function(options,contentsById,contentsByTime,container,inner,hidden,showContainer,hideContainer){var messages=[$('<li class="no-hover popcorn-contents-help">Add items in your Table of Contents by adding chapters <span class="ss-icon" style="color: #9CF">&#x1F516;</span> to the video.</li>'),$('<li class="no-hover popcorn-contents-help">Click the <span class="ss-icon" style="color: #9CF">&#x1F516;</span> chapter icon on the tool bar as you watch the video.</li>')],pageIndex={total:1},tracking=options.tracking,page=1,title,nextPage,previousPage,list,list2,close;function updateTitle(){var oldText=title&&title.text(),newText=options.title;if(oldText===newText){return}logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") – updateTitle: "+newText);if(!title){title=$('<h3 class="popcorn-contents-title" />').click(function(){tracking.annotationActionById(options.annotationId,"contents","Expand",{Target:options.annotationId});showContainer()}).prependTo(inner)}if(!newText||newText===""){title.addClass("show-icon")}else{title.removeClass("show-icon")}$(title).text(newText)}function goToPage(value){if(value<1){value=1}else if(value>pageIndex.total){value=pageIndex.total}if(page!==value){page=value;updateColumns()}}function setupPagingControls(){if(container.hasClass("expanded")&&pageIndex.total>1){if(page===1){previousPage.addClass("inactive")}else{previousPage.removeClass("inactive")}if(page===pageIndex.total){nextPage.addClass("inactive")}else{nextPage.removeClass("inactive")}previousPage.removeClass("hidden");nextPage.removeClass("hidden")}else{previousPage.addClass("hidden");nextPage.addClass("hidden")}}function resetColumns(){if(!list||!list2||!hidden){return}pageIndex.total=1;while(list.children().length){hidden.append(list.children().last())}while(list2.children().length){hidden.append(list2.children().last())}_.each(messages,function(el){if(!Object.keys(contentsById).length){list.append(el)}else if(el.parentNode){el.remove()}})}function updateColumns(){var i,obj,height,heightAvailable,heightRemains,targetList,targetPage=1,pageBreak=false;if(!list||!list2){return}resetColumns();updateTitle();heightAvailable=inner.height();heightAvailable-=title.outerHeight(true);heightAvailable-=+list.css("marginTop").replace("px","");targetList=list;heightRemains=heightAvailable;logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") - Available height: "+heightAvailable);for(i=0;i<contentsByTime.length;i++){obj=contentsByTime[i];if(!obj.text){obj.li.find("span:first").text("Chapter "+(contentsByTime.indexOf(obj)+1))}height=obj.li.outerHeight(true);if(targetList===list&&heightRemains-height<0){targetList=list2;heightRemains=heightAvailable}if(heightRemains-height>=0){if(targetPage===page&&!pageBreak){targetList.append(obj.li)}heightRemains-=height;if(typeof pageIndex[targetPage]!=="array"){pageIndex[targetPage]=[]}pageIndex[targetPage].push(obj)}else if(targetList===list2){if(targetPage<page){targetPage+=1;pageIndex.total=targetPage;pageBreak=false;targetList=list;heightRemains=heightAvailable;i-=1}else{pageIndex.total+=1;pageBreak=true}}}if(targetList===list){logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") - Show one column",list.children().length,list2.children().length);list.css("width","100%");list.css("paddingRight",0);list2.css("display","none")}else{logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") - Show two columns",list.children().length,list2.children().length);list.removeAttr("style");list2.removeAttr("style")}setupPagingControls()}return{className:"hapyak-contents-legacy",setup:function(){logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") – setup");nextPage=$('<a href="#next-page" class="popcorn-contents-next">Next</a>').click(function(e){if(options.annotationId){tracking.annotationActionById(options.annotationId,"contents","Next")}else{logging.warn("Failed to track TOC next page click",options)}goToPage(page+1);if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return false}).appendTo(inner);previousPage=$('<a href="#previous-page" class="popcorn-contents-previous">Previous</a>').click(function(e){if(options.annotationId){tracking.annotationActionById(options.annotationId,"contents","Prev")}else{logging.warn("Failed to track TOC next page click",options)}goToPage(page-1);if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return false}).appendTo(inner);list=$("<ul />").appendTo(inner);list2=$("<ul />").appendTo(inner);close=$('<div class="popcorn-contents-close"><span>x</span></div>').click(function(){tracking.annotationActionById(options.annotationId,"contents","Collapse",{Target:options.annotationId});hideContainer()}).appendTo(inner);updateTitle()},update:function(){logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") – update");updateTitle()},reflow:function(){logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") – reflow");updateColumns()},teardown:function(){if(!title&&!nextPage&&!previousPage&&!list&&!list2&&!close){return}logging.info("TOC: LEGACY (annotationId:"+options.annotationId+") – teardown");if(title){title.remove()}if(nextPage){nextPage.remove()}if(previousPage){previousPage.remove()}if(list){resetColumns();list.remove()}if(list2){list2.remove()}if(close){close.remove()}title=nextPage=previousPage=list=list2=close=null}}}});hy.define("popcorn.contents.mode.column1",["jquery.noconflict","lodash.noconflict","logging"],function($,_,logging){return function(options,contentsById,contentsByTime,container,inner,hidden,showContainer,hideContainer){var title,list,help,more,close,height;var tracking=options.tracking;function isExpanded(){return container.hasClass("expanded")}function isEditing(){return container.hasClass("editing")}function hasContent(){return contentsByTime&&contentsByTime.length}function reset(){if(!list||!hidden){return}while(list.children().length){hidden.append(list.children().last())}}function reflow(){var listHeight=0,i,obj;updateTitle();if(!list){return}reset();logging.info("TOC: COLUMN1 (annotationId:"+options.annotationId+") - reflow");if(!hasContent()){help.prependTo(inner);return}else if(help){help.remove()}for(i=0;i<contentsByTime.length;i++){obj=contentsByTime[i];if(!obj.text){obj.li.find("span:first").text("Chapter "+(contentsByTime.indexOf(obj)+1))}list.append(obj.li);listHeight=listHeight+obj.li.outerHeight(true)}height=inner.height();if(listHeight>height){container.addClass("show-more")}else{container.removeClass("show-more")}}function updateTitle(){var oldText=title&&title.text(),newText=options.title;if(oldText===newText){return}logging.info("TOC: COLUMN1 (annotationId:"+options.annotationId+") – updateTitle: "+newText);if(!title){var trackAndShow=function(){if(!isExpanded()){tracking.annotationActionById(options.annotationId,"contents","Expand",{Target:options.annotationId});showContainer()}};title=$('<h3 class="popcorn-contents-title" tabindex="0" aria-label="Chapter Menu" role="navigation" />');a11yListener(title,trackAndShow).prependTo(container)}if(!newText||newText===""){title.addClass("show-icon")}else{title.removeClass("show-icon")}title.text(newText)}return{className:"hapyak-contents-column1",setup:function(){logging.info("TOC: COLUMN1 (annotationId:"+options.annotationId+") – setup");list=$('<ul class="popcorn-contents-list" />').appendTo(inner);help=$('<div class="popcorn-contents-help">'+'<p>Add items in your Table of Contents by adding chapters <span class="ss-icon" style="color: #9CF">&#x1F516;</span> to the video.</p>'+'<p>Click the <span class="ss-icon" style="color: #9CF">&#x1F516;</span> chapter icon on the tool bar as you watch the video.</p>'+"</div>");var showMore=function(){if(!hasContent()){return}list.animate({scrollTop:list.scrollTop()+height},400)};var showLess=function(){tracking.annotationActionById(options.annotationId,"contents","Collapse",{Target:options.annotationId});hideContainer()};more=$('<div class="popcorn-contents-more" tabindex="0" aria-label="Show More" role="button"><div class="arrow-wide-down" /></div>');a11yListener(more,showMore).appendTo(container);close=$('<div class="popcorn-contents-close" tabindex="0" aria-label="Close Chapters" role="button">&times;</div>');a11yListener(close,showLess).appendTo(container);updateTitle()},update:function(){logging.info("TOC: COLUMN1 (annotationId:"+options.annotationId+") – update");updateTitle()},reflow:reflow,teardown:function(){if(!title&&!list&&!help&&!more&&!close){return}logging.info("TOC: COLUMN1 (annotationId:"+options.annotationId+") – teardown");if(title){title.remove()}if(list){reset();list.remove()}if(help){help.remove()}if(more){more.remove()}if(close){close.remove()}title=list=help=more=close=null}}}});hy.define("popcorn.profile.contents",["popcorn.contents","popcorn.contents.mode.legacy","popcorn.contents.mode.column1"],function(){return{id:"contents",icon:"featured_play_list",sortIndex:1,title:"a chapter menu",editor:["popcorn.quickedit.contents"],zIndex:100,maxAllowed:1,variables:{populateConfig:function(id,options){var config={},data={},key="Contents_"+id;if(options.title){data.text=options.title}config[key]=data;return config}},target:"contentsContainer",defaults:{start:0,end:Infinity,columns:2,duration:10},filter:function(trackEvent){trackEvent.end=trackEvent.end||Infinity;if(!trackEvent.duration){trackEvent.duration=10}}}});(function(window,Popcorn,undefined){var requestAnimationFrame,cancelAnimationFrame;(function(){var lastTime=0,vendors=["ms","moz","webkit","o"],x;requestAnimationFrame=window.requestAnimationFrame;cancelAnimationFrame=window.cancelAnimationFrame;for(x=0;x<vendors.length&&!requestAnimationFrame;++x){requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];cancelAnimationFrame=window[vendors[x]+"CancelRequestAnimationFrame"]}if(!requestAnimationFrame||!cancelAnimationFrame){requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};cancelAnimationFrame=function(id){clearTimeout(id)}}})();Popcorn.basePlugin("drawing",function(options,base){var popcorn,media,container,canvas,ctx,duration,current,seeking=false,animationFrameId,prevAnimationTime=0,animationSkipped;function draw(drawing,fraction){var i,j,path,points,p,paths,width=canvas.width,height=canvas.height,w=drawing.width||canvas.width,h=drawing.height||canvas.height,maxTime=1;paths=drawing.paths;ctx.clearRect(0,0,canvas.width,canvas.height);if(paths&&paths.length){points=paths[paths.length-1].points;if(points&&points.length){maxTime=points[points.length-1].t||1}}for(i=0;i<paths.length;i++){path=paths[i];points=path.points;if(points.length>1){p=points[0];if(p.t/maxTime>fraction){break}ctx.strokeStyle=path.color||drawing.color||"white";ctx.lineWidth=Math.max(1,(path.lineWidth||drawing.stroke||5)*width/w);ctx.shadowOffsetX=path.shadowOffsetX;ctx.shadowOffsetY=path.shadowOffsetY;ctx.shadowBlur=path.shadowBlur;ctx.shadowColor=path.shadowColor;ctx.beginPath();ctx.moveTo(p.x*width/w,p.y*height/h);for(j=1;j<points.length;j++){p=points[j];if(p.t/maxTime>fraction){break}ctx.lineTo(p.x*width/w,p.y*height/h)}ctx.stroke()}}}function onSeeking(){seeking=true}function onSeeked(){seeking=false}function onFrame(){var time;if(!prevAnimationTime){prevAnimationTime=(new Date).getTime()}time=(new Date).getTime();if(!options.pause&&!animationSkipped){draw(options.drawing,Math.min(1,(time-prevAnimationTime)/1e3/duration))}animationFrameId=requestAnimationFrame(onFrame)}function setCanvasDimensions(){canvas.width=media.videoWidth||media.width||media.offsetWidth;canvas.height=media.videoHeight||media.height||media.offsetHeight;draw(options.drawing,1);popcorn.off("canplay",setCanvasDimensions)}base.target=base.target||options.target;if(!base.target){return{_update:function(){}}}canvas=document.createElement("canvas");if(!canvas){return}ctx=canvas.getContext("2d");if(!ctx){return}popcorn=this;media=popcorn.media;duration=Math.min((options.end-options.start)/2,.5);container=base.makeContainer();options.container=container;container.style.cssText="position: absolute; width: 100%; height: 100%;";canvas.style.cssText="width: 100%; height: 100%;";if(!options.drawing){options.drawing={paths:[]}}setCanvasDimensions();container.appendChild(canvas);popcorn.on("canplay",setCanvasDimensions);popcorn.on("resized",setCanvasDimensions);return{start:function(event,options){current=true;ctx.clearRect(0,0,canvas.width,canvas.height);base.addClass(base.container,"active");if(options.pause||seeking||popcorn.paused()){animationSkipped=true;draw(options.drawing,1)}prevAnimationTime=null;animationFrameId=requestAnimationFrame(onFrame)},end:function(){current=false;animationSkipped=false;base.removeClass(base.container,"active");cancelAnimationFrame(animationFrameId)},_update:function(trackEvent,changes){duration=Math.min((options.end-options.start)/2,.5);if(changes.drawing!==undefined&&options.drawing!==changes.drawing){if(!changes.drawing){options.drawing={paths:[]}}else{options.drawing=changes.drawing}}if(current){if(changes.hasOwnProperty("pause")&&changes.pause||trackEvent.pause){draw(options.drawing,1)}}if(changes.pause!==undefined&&options.pause!==changes.pause||changes.end!==options.end||changes.start!==options.start){options.pause=changes.pause}},_teardown:function(){popcorn.off("seeking",onSeeking);popcorn.off("seeked",onSeeked);popcorn.off("canplay",setCanvasDimensions);popcorn.off("resized",setCanvasDimensions)}}})})(this,this.Popcorn);hy.define("popcorn.drawing",function(){});hy.define("popcorn.profile.drawing",["popcorn","popcorn.drawing"],function(Popcorn){return{id:"drawing",icon:"gesture",sortIndex:8,title:"a drawing",editor:["popcorn.quickedit.drawing"],zIndex:3,filter:function(trackEvent){function translateDrawing(original){var drawing={paths:[],width:640,height:390},t=0;Popcorn.forEach(original,function(oldPath){var i=0,path,step;if(!oldPath.path||!oldPath.path.length){return}step=oldPath.path[0];do{path={color:oldPath.stroke,stroke:oldPath["stroke-width"],points:[]};do{if(step[0]==="M"||step[0]==="L"){path.points.push({x:step[1],y:step[2],t:t});t++}i++;step=oldPath.path[i]}while(step&&step[0]==="L");if(path.points.length>1){drawing.paths.push(path)}}while(i<oldPath.path.length)});return drawing}if(Array.isArray(trackEvent.drawing)){trackEvent.drawing=translateDrawing(trackEvent.drawing)}else if(!trackEvent.drawing){return false}}}});hy.define("popcorn.hotlink",["popcorn","player.playereval","popcorn.base","popcorn.gates"],function(Popcorn,playereval){Popcorn.basePlugin("hotlink",function(options,base){var container,img=document.createElement("img"),textContainer,templateEvaluator=new playereval.TemplateEvaluator(this,options);function setDimensions(){container.style.width=options.width=options.width||"40%";container.style.height=options.height=options.height||"40%";container.style.top=options.top=options.top||"10%";container.style.left=options.left=options.left||"10%"}function setText(){var text,i;text=templateEvaluator.evaluate(options.text);if(!text){if(textContainer){container.removeChild(textContainer);textContainer=null}return}if(textContainer){textContainer.innerHTML=""}else{textContainer=document.createElement("div");container.appendChild(textContainer)}text=String(text).split(/[\n\r]/);for(i=0;i<text.length;i++){if(i){textContainer.appendChild(document.createElement("br"))}if(text[i]){textContainer.appendChild(document.createTextNode(text[i]))}}textContainer.className="popcorn-hotlink-text";textContainer.setAttribute("tabindex","0");base.addClass(textContainer,options.textPosition);textContainer.style.color=options.color}container=base.makeContainer();options.container=container;setDimensions();container.style.opacity=options.opacity||"";container.style.backgroundColor=options.backgroundColor||"";container.style.borderColor=options.borderColor||"";container.style.borderRadius=options.borderRadius||"";if(options.borderWidth&&options.borderWidth.replace("px","")>0){container.style.borderStyle="solid";container.style.borderWidth=options.borderWidth}img.style.width="100%";img.style.height="100%";img.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";container.appendChild(img);setText();templateEvaluator.watchTemplateVars(options.text,setText);options.annotationVariableConfig.add("hotlink",options,function(scope,key,data){if(data.link&&typeof data.link==="string"&&options.onClick){options.onClick.gotoLink=data.link}if(data.text){options.text=data.text}setText()});return{start:function(){base.addClass(container,"active")},end:function(){base.removeClass(container,"active")},_update:function(trackEvent,changes){var modifyText=false;templateEvaluator.watchTemplateVars(options.text,setText);if(changes.hasOwnProperty("opacity")&&changes.opacity!==options.opacity){options.opacity=changes.opacity;container.style.opacity=options.opacity||""}if(changes.hasOwnProperty("text")&&changes.text!==options.text){if(!options.text){modifyText=true}options.text=changes.text;modifyText=true}if(changes.hasOwnProperty("textPosition")&&changes.textPosition!==options.textPosition){options.textPosition=changes.textPosition;modifyText=true}if(changes.hasOwnProperty("color")&&changes.color!==options.color){options.color=changes.color;modifyText=true}if(modifyText){setText()}if(changes.hasOwnProperty("backgroundColor")&&changes.backgroundColor!==options.backgroundColor){options.backgroundColor=changes.backgroundColor;container.style.backgroundColor=options.backgroundColor||""}if(changes.hasOwnProperty("borderColor")&&changes.borderColor!==options.borderColor){options.borderColor=changes.borderColor;container.style.borderColor=options.borderColor||""}if(changes.hasOwnProperty("borderRadius")&&changes.borderRadius!==options.borderRadius){options.borderRadius=changes.borderRadius;container.style.borderRadius=options.borderRadius||""}if(changes.hasOwnProperty("borderWidth")&&changes.borderWidth!==options.borderWidth){options.borderWidth=changes.borderWidth;if(options.borderWidth&&options.borderWidth.replace("px","")>0){container.style.borderStyle="solid";container.style.borderWidth=options.borderWidth}}if(changes.hasOwnProperty("top")&&changes.top!==options.top){options.top=changes.top}if(changes.hasOwnProperty("left")&&changes.left!==options.left){options.left=changes.left}if(changes.hasOwnProperty("height")&&changes.height!==options.height){options.height=changes.height}if(changes.hasOwnProperty("width")&&changes.width!==options.width){options.width=changes.width}if(changes.hasOwnProperty("pause")&&changes.pause!==options.pause){options.pause=changes.pause}setDimensions();options.annotationVariableConfig.update("hotlink",options)},_teardown:function(){options.annotationVariableConfig.remove(options.annotationid)}}})});hy.define("popcorn.profile.hotlink",["utils.parsecolor","player.normalizeonclick","player.normalizecolor","popcorn.hotlink"],function(parseColor,normalizeonclick,normalizeColor){return{id:"hotlink",icon:"crop_free",sortIndex:5,title:"transparent overlay link",editor:["popcorn.quickedit.hotlink"],variables:{populateConfig:function(id,options){var config={},data={},key="Hotlink_"+id;if(options.text){data.text=options.text}if(options.onClick&&options.onClick.gotoLink){data.link=options.onClick.gotoLink}config[key]=data;return config}},zIndex:6,normalize:{"onClick.gotoLink":normalizeonclick.gotoLink,"onClick.gotoTrack":normalizeonclick.gotoTrack,"onClick.addClasses":normalizeonclick.addClasses,"onClick.setVariables":normalizeonclick.setVariables,onClick:normalizeonclick.onClick,textPosition:function(value){if(!value){return"middle"}if(value==="top"||value==="middle"||value==="bottom"){return value}return false},backgroundColor:normalizeColor,"background-color":normalizeColor,color:normalizeColor},filter:function(trackEvent){var color;if(!trackEvent.backgroundColor||isNaN(trackEvent.opacity)||trackEvent.opacity>=1){return trackEvent}color=parseColor(trackEvent.backgroundColor);if(color&&color.a===undefined){trackEvent.backgroundColor="rgba("+color.r+", "+color.g+", "+color.b+", "+trackEvent.opacity+")";delete trackEvent.opacity}return trackEvent}}});hy.define("popcorn.ontime",["popcorn","popcorn.base","lodash.noconflict","utils.embed","player.playereval","playlist.addon"],function(Popcorn,base,_,embedUtils,playereval,playlistAddon,undefined){Popcorn.basePlugin("ontime",function(options,base){var container=base.makeContainer(),loadTrackTime=this.options.loadTrackTime,rotateToAnnotation=options.rotateToAnnotation,popcorn=this;options.container=container;return{start:function(data){var baseOptions=base.options,trackTime=baseOptions.gotoTrack,branchVideoTime=baseOptions.branchTimeInput,goToVideo=baseOptions.goToVideo,onTimeOptions=baseOptions.onTime,addonTypeId=baseOptions.addonTypeId,addonCommand=baseOptions.addonCommand,addonCommandData=baseOptions.addonCommandData,seekTime=0;var data,goToTime,goToAnnotation,goToAnnotationMatch;if(!base.popcorn.options.hapyakPlayer.editMode()&&trackTime){goToTime=trackTime.substr(1);goToAnnotationMatch=trackTime.match(/id\=([0-9]+)/);if(goToAnnotationMatch){goToAnnotation=goToAnnotationMatch[1]}}base.addClass(container,"active");if(!base.popcorn.options.hapyakPlayer.editMode()&&goToVideo){if(branchVideoTime||trackTime){seekTime=branchVideoTime?branchVideoTime:trackTime.substr(1)}playlistAddon.goTo(goToVideo,true,seekTime)}if(trackTime){if(goToAnnotation){goToTime=null}if(!goToVideo||goToVideo==="-"){loadTrackTime(null,goToTime,goToAnnotation)}}if(rotateToAnnotation){var video=popcorn.video.parentNode.getElementsByTagName("VIDEO")[0],Css360Sphere=hapyak.Css360.getSphereByContainerId(embedUtils.dotget(video,"dataset.videoId")),rotateTarget=rotateToAnnotation==="recenter"?null:popcorn.options.hapyakPlayer.annotations.get(rotateToAnnotation),transform=rotateTarget===null?"[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1]":embedUtils.dotget(rotateTarget,"properties.transform"),vector=transform&&JSON.parse(transform);if(Css360Sphere&&typeof Css360Sphere.setRotation==="function"&&vector){Css360Sphere.setRotation(-vector[0],vector[1],vector[2],true)}}if(baseOptions.setVariables){playereval.playereval(this.popcorn,baseOptions.setVariables)}if(addonTypeId&&addonCommand){data={customContext:addonTypeId,addonCommand:addonCommand};_.forEach(addonCommandData,function(val,key){if(data[key]){return}data[key]=val});hapyak.message.send(parent.window,addonCommand,data)}},end:function(){base.removeClass(container,"active")}}})});hy.define("popcorn.profile.ontime",["popcorn.ontime"],function(){return{id:"ontime",icon:"timer",sortIndex:9,title:"time triggered action",editor:["popcorn.quickedit.ontime"],zIndex:6,filter:function(trackEvent){return trackEvent}}});(function(window,Popcorn,undefined){Popcorn.basePlugin("html",function(options,base){var container=base.makeContainer(),script,styleSheet,top,left,width,height;function setDimensions(){container.style.width=options.width=options.width||"40%";container.style.height=options.height=options.height||"40%";container.style.top=options.top=options.top||"10%";container.style.left=options.left=options.left||"10%"}function createScript(target,src){script=document.createElement("script");script.type="text/javascript";if(src){script.src=src}else{script.appendChild(document.createTextNode(options.js))}target.appendChild(script)}function createStyleSheet(){styleSheet=document.createElement("style");styleSheet.type="text/css";styleSheet.appendChild(document.createTextNode(options.css));document.head.appendChild(styleSheet)}function findScriptTags(){var tags=container.getElementsByTagName("script");Popcorn.forEach(tags,function(tag){if(tag.getAttribute("src")){createScript(container,tag.getAttribute("src"))}else{createScript(container,"data:text/javascript;base64, "+btoa(tag.innerText))}})}options.container=container;options.container.innerHTML=options.html||"";options.container.style.position="absolute";if(options.css){createStyleSheet()}if(options.js){createScript(document.head)}setDimensions();findScriptTags();return{start:function(){base.addClass(base.container,"active")},end:function(){base.removeClass(base.container,"active")},_update:function(options,changes){if(changes.hasOwnProperty("html")&&changes.html!==options.html){options.html=changes.html;container.innerHTML=options.html;findScriptTags()}if(changes.hasOwnProperty("css")&&changes.css!==options.css){options.css=changes.css;if(styleSheet){document.head.removeChild(styleSheet)}createStyleSheet()}if(changes.hasOwnProperty("js")&&changes.js!==options.js){options.js=changes.js;if(script){document.head.removeChild(script)}createScript(document.head)}if(changes.hasOwnProperty("width")&&changes.width!==options.width){options.width=changes.width}if(changes.hasOwnProperty("height")&&changes.height!==options.height){options.height=changes.height}if(changes.hasOwnProperty("top")&&changes.top!==options.top){options.top=changes.top}
if(changes.hasOwnProperty("left")&&changes.left!==options.left){options.left=changes.left}setDimensions()}}})})(this,this.Popcorn);hy.define("popcorn.html",function(){});hy.define("popcorn.profile.html",["popcorn.html"],function(){return{id:"html",title:"html",icon:"JS",editor:["popcorn.quickedit.html"],sortIndex:96,zIndex:2}});hy.define("popcorn.iframe",["popcorn","player.playereval","logging","lodash.noconflict","configAPI","utils.embed","popcorn.base","popcorn.gates"],function(Popcorn,playereval,logging,_,configuration,utils){var hapyakUrlRegex=/^(https?:\/\/([a-z]+\.)?hapyak\.com|\/)/i,queryRegex=/(?:\?|&)([^&=]*)=?([^&]*)/g,dimensionRegex=/(\d+(?:\.\d*)?)(px|%)?/i;Popcorn.basePlugin("iframe",function(options,base){var iframe,loadStarted=false,popcorn=this,current=false,tracking=popcorn.options.hapyakPlayer.tracking,updateDataTimeout=0,innerDiv,srcTimeout,templateEvaluator=new playereval.TemplateEvaluator(this,options);function loadFrame(){var isEditMode=utils.dotget(popcorn,"options.hapyakPlayer.editMode"),transformUrl=function transformUrl(url){var stub=utils.dotget(configuration,"hosting.widgetHost"),isHyUpload=function(str){return url&&url.indexOf(str)>-1};var subout;if(!url){return url}if(stub){if(isHyUpload("hapyak_dev_uploads")){stub=stub.replace("hapyak-hosted","dev.hapyak-hosted");subout="hapyak_dev_uploads"}else if(isHyUpload("hapyak_uploads")){subout="hapyak_uploads"}url=url.replace(subout+".s3.amazonaws.com",stub)}return url};var src,hasQuery,hasVersion,parse,version;function changeSrc(){if(iframe){iframe.src=decodeURIComponent(src)}}function addEnv(src){var hasParam=src&&src.indexOf("?")>-1,envParam="hyEnv="+hapyak.environment;return(hasParam?"&":"?")+envParam}if(typeof isEditMode==="function"&&!isEditMode()){options.src=transformUrl(options.src)}if(options.src){options.src=options.src+addEnv(options.src);src=templateEvaluator.evaluate(options.src,true);if(hapyakUrlRegex.test(src)){queryRegex.test("");while((parse=queryRegex.exec(src))!==null){hasQuery=true;if(parse[1]==="v"){hasVersion=true;break}}if(!hasVersion){version=hapyak&&hapyak.version||1;src+=hasQuery?"&v="+version:"?v="+version}}if(iframe.src!==src){if(window.chrome){clearTimeout(srcTimeout);srcTimeout=setTimeout(changeSrc,20)}else{iframe.src=src}}}else{iframe.src="about:blank"}loadStarted=true}function updateSrc(){loadStarted=false;if(options.defer&&!current){iframe.src="about:blank"}else{loadFrame()}}function processMessage(evt){var command,id,nodes;if(evt.source===iframe.contentWindow){try{command=JSON.parse(evt.data)}catch(e){return}if(!command||command.context!=="hapyak"){return}if(command.event==="getPlaylist"){command.event="getPlaylistExternal";parent.postMessage(JSON.stringify(command),"*")}if(command.event==="setData"){if(command.key&&typeof command.key==="string"){if(command.mode!=="track"){id=options.dataId||options.id}popcorn.setData(id,command.key,command.value,command.temp)}return}if(command.event==="clearData"){if(command.key&&typeof command.key==="string"){popcorn.clearData(command.key)}return}if(command.event==="gotoTrack"){if(popcorn.options.loadTrackTime){popcorn.options.loadTrackTime(command.track,command.time)}return}if(command.event==="addClasses"&&command.classes){if(command.selector){nodes=document.querySelectorAll(command.selector);Array.prototype.forEach.call(nodes,function(node){base.addClass(node,command.classes)})}else{nodes=base.container;base.addClass(nodes,command.classes)}}if(command.event==="removeClasses"&&command.classes){if(command.selector){nodes=document.querySelectorAll(command.selector);Array.prototype.forEach.call(nodes,function(node){base.removeClass(node,command.classes)})}else{nodes=base.container;base.removeClass(nodes,command.classes)}}if(command.event==="play"){popcorn.play();return}if(command.event==="pause"){popcorn.pause();return}if(command.event==="mute"){popcorn.mute();return}if(command.event==="unmute"){popcorn.unmute();return}if(command.event==="contentTrackMsg"){if(command.action==="change"&&command.lang){popcorn.options.hapyakPlayer.contentTracks.load(command.lang)}if(command.action==="change"&&command.src){if(typeof command.src==="object"){popcorn.options.hapyakPlayer.contentTracks.add(command.src)}if(typeof command.src==="string"){require([command.src],function(){Array.prototype.forEach.call(arguments,function(trackContents){popcorn.options.hapyakPlayer.contentTracks.add(trackContents)})})}}return}if(command.event==="auth"){hapyak.auth({partner:command.auth});return}if(command.event==="volume"){popcorn.volume(command.volume);return}if(command.event==="trackAction"&&command.action){command.data=command.data||{};tracking.registerPartnerProperties(command.data);tracking.annotationActionById(options.annotationId,"iframe",command.action,Popcorn.extend({ExternalContext:iframe.src},command.data))}if(command.event==="trackWidgetAction"&&command.action){command.data=command.data||{};tracking.annotationActionById(options.annotationId,"iframe",command.action,Popcorn.extend({ExternalContext:iframe.src}),command.data)}}else{try{command=JSON.parse(evt.data)}catch(e){return}if(command.event==="gotPlaylistExternal"){fireEvent("gotPlaylist",command.data)}}}function sendData(){var keys,obj,json,id,i,k;if(!iframe||!iframe.src||iframe.src==="about:blank"||!iframe.contentWindow){return}obj={context:"hapyak",event:"data",values:{}};id=options.dataId||options.id;keys=popcorn.dataKeys(id);for(i=0;i<keys.length;i++){k=keys[i];obj.values[k]=popcorn.getData(id,k)}try{json=JSON.stringify(obj)}catch(e){return}iframe.contentWindow.postMessage(json,"*");updateDataTimeout=0}function updateData(){var id=options.dataId||options.id,hapyakIframeWidth=popcorn.getData(id,"hapyakIframeWidth"),hapyakIframeHeight=popcorn.getData(id,"hapyakIframeHeight"),hapyakIframeLeft=popcorn.getData(id,"hapyakIframeLeft"),hapyakIframeTop=popcorn.getData(id,"hapyakIframeTop"),hapyakIframeEditButton=popcorn.getData(id,"hapyakIframeEditButton"),menuMap={hyEditor:{class:"editor",value:popcorn.getData(id,"hyQuickEditEditor")},hyNudge:{class:"nudge",value:popcorn.getData(id,"hyQuickEditNudge")},hyMore:{class:"more",value:popcorn.getData(id,"hyQuickEditMore")},hyPreview:{class:"preview",value:popcorn.getData(id,"hyQuickEditPreview")},hyDone:{class:"done",value:popcorn.getData(id,"hyQuickEditDone")},hyDelete:{class:"delete",value:popcorn.getData(id,"hyQuickEditDelete")},hyDuration:{class:"duration",value:popcorn.getData(id,"hyQuickEditDuration")},hyStartTime:{class:"start",value:popcorn.getData(id,"hyQuickEditStartTime")},hyPause:{class:"pause",value:popcorn.getData(id,"hyQuickEditPause")},hyDisplayRule:{class:"precondition",value:popcorn.getData(id,"hyQuickEditDisplayRule")},hyAddClass:{class:"class",value:popcorn.getData(id,"hyQuickEditAddClass")},hyGate:{class:"gate",value:popcorn.getData(id,"hyQuickEditGate")},hyScale:{class:"scale",value:popcorn.getData(id,"hyQuickEditScale")}},setTempPosition=function(prop,styleProp){var parsed=styleProp&&prop&&dimensionRegex.exec(prop);if(parsed){base.container.style[styleProp]=parsed[1]+(parsed[2]||"px")}};var quickEditMenus,containerPopcornId,nextSibling,menuItem,mappedItem,domBtn,domBtnEl;if(base.container){setTempPosition(hapyakIframeWidth,"width");setTempPosition(hapyakIframeHeight,"height");setTempPosition(hapyakIframeLeft,"left");setTempPosition(hapyakIframeTop,"top");nextSibling=utils.dotget(base,"container.nextSibling");if(typeof hapyakIframeEditButton==="boolean"){if(nextSibling&&nextSibling.classList.contains("popcorn-quickedit-edit")&&utils.dotget(nextSibling,"dataset.popcornId")===utils.dotget(base,"container.dataset.popcornId")){nextSibling.style.display=hapyakIframeEditButton?"block":"none"}else{quickEditMenus=document.getElementsByClassName("popcorn-quickedit-edit");containerPopcornId=utils.dotget(base,"container.dataset.popcornId");Array.prototype.some.call(quickEditMenus,function(el){if(el.dataset.popcornId===containerPopcornId){el.style.display=hapyakIframeEditButton?"block":"none";return true}})}}if(nextSibling){for(menuItem in menuMap){mappedItem=menuMap[menuItem];domBtn=nextSibling.getElementsByClassName("hapyak-quickedit-"+mappedItem.class);domBtnEl=domBtn&&domBtn[0]||[];if(domBtn.length){if(mappedItem.value===false&&domBtnEl.className.indexOf("disabled")===-1){domBtnEl.className+=" disabled"}else if(mappedItem.value===true){domBtnEl.className=domBtnEl.className.replace(/disabled/g,"")}}}}}if(!updateDataTimeout){updateDataTimeout=setTimeout(sendData,0)}}function updateVariables(){var key,id;if(!options.variables){return}id=options.dataId||options.id;for(key in options.variables){if(options.variables.hasOwnProperty(key)){popcorn.setData(id,key,options.variables[key],true)}}}function fireEvent(event,data){var msg;if(!iframe||!iframe.src||iframe.src==="about:blank"||!iframe.contentWindow){return}msg={context:"hapyak",event:event};Popcorn.extend(msg,data);try{iframe.contentWindow.postMessage(JSON.stringify(msg),"*")}catch(e){return}}function onPlay(){fireEvent("play")}function onPause(){fireEvent("pause")}function timeUpdate(){fireEvent("timeupdate",{currentTime:popcorn.currentTime()})}function playerHover(isHovering){fireEvent("playerHover",{isHovering:isHovering})}function resized(){fireEvent("resized",{width:popcorn.media.width,height:popcorn.media.height})}function updateAuth(auth){if(!auth){return}fireEvent("authchange",{auth:auth.partner})}function onVolumeChange(){fireEvent("volumechange",{volume:popcorn.volume()})}function onEditModeChange(mode){fireEvent("editModeChange",{mode:mode})}function updateMetaData(){fireEvent("loadedmetadata",{duration:popcorn.duration(),currentTime:popcorn.currentTime(),paused:popcorn.paused(),volume:popcorn.volume(),width:popcorn.media.width,height:popcorn.media.height})}function sanitizeLoadOptions(options){options=options||{};var sanitized=_.clone(options);sanitized.container={};sanitized.target={};return sanitized}options.container=base.makeContainer();innerDiv=document.createElement("div");options.container.appendChild(innerDiv);iframe=document.createElement("iframe");iframe.setAttribute("allowtransparency",true);innerDiv.appendChild(iframe);iframe.addEventListener("load",function(){var hyGetData=utils.dotget(popcorn,"options.hapyakPlayer.getData"),annotations=popcorn.getData(options.dataId,"projectAnnotations");options.projectTrackId=hyGetData&&hyGetData("trackId");options.annotationTrackId=annotations&&annotations[options.annotationId];options.projectConfig=hyGetData&&hyGetData("projectConfig");options.groupConfig=configuration&&configuration.player;options.configAPI=configuration;options.projectId=hyGetData&&hyGetData("projectId");fireEvent("annotationload",{data:sanitizeLoadOptions(options),volume:popcorn.volume(),editMode:popcorn.options.hapyakPlayer.editMode()});if(current){fireEvent("iframeshow",{editMode:popcorn.options.hapyakPlayer.editMode()})}updateAuth(hapyak.auth());if(popcorn.duration()&&popcorn.media&&popcorn.media.isHapyakHosted&&popcorn.media.width||popcorn.media&&popcorn.duration()&&!popcorn.media.isHapyakHosted){updateMetaData()}sendData()},false);updateDataTimeout=1;popcorn.on("authchange",updateAuth);popcorn.on("loadedmetadata",updateMetaData);popcorn.on("timeupdate",timeUpdate);popcorn.on("playerHover",playerHover);popcorn.on("resized",resized);popcorn.on("play",onPlay);popcorn.on("pause",onPause);popcorn.on("volumechange",onVolumeChange);popcorn.on("editModeChange",onEditModeChange);updateVariables();popcorn.watchData(options.dataId||options.id,"",updateData);if(!options.width){iframe.width="100%"}else if(!isNaN(options.width)){iframe.width=options.width}if(!options.height){iframe.height="100%"}else if(!isNaN(options.height)){iframe.height=options.height}if(options.id&&typeof options.id==="string"){iframe.id=options.id}updateSrc();templateEvaluator.watchTemplateVars(options.src,loadFrame);base.animate("width",function(val){if(isNaN(val)){iframe.style.width=val}else{iframe.width=val}});base.animate("height",function(val){if(isNaN(val)){iframe.style.height=val}else{iframe.height=val}});base.animate(base.container);base.animate("scroll",function(val){var scrollHeight;if(base.popcorn.paused()){return}try{scrollHeight=iframe.contentDocument.documentElement.scrollHeight||iframe.contentDocument.body.scrollHeight;iframe.contentWindow.scrollTo(0,val*scrollHeight)}catch(e){}});window.addEventListener("message",processMessage,false);if(options.noscale){base.addClass(base.container,"noscale")}return{start:function(){if(!current){fireEvent("iframeshow",{editMode:popcorn.options.hapyakPlayer.editMode()})}current=true;base.addClass(base.container,"active");if(!loadStarted){loadFrame()}},_update:function(trackEvent,changes){templateEvaluator.watchTemplateVars(options.src,loadFrame);if(changes.hasOwnProperty("variables")){trackEvent.variables=changes.variables;updateVariables()}if(changes.hasOwnProperty("defer")){options.defer=changes.defer}if(changes.hasOwnProperty("src")&&options.src!==changes.src||changes.hasOwnProperty("html")&&options.html!==changes.html){options.src=changes.src;options.html=changes.html;updateSrc()}if(changes.hasOwnProperty("pause")&&options.pause!==changes.pause||changes.end!==options.end||changes.start!==options.start){options.pause=changes.pause}if(trackEvent.noscale!==changes.noscale){if(changes.noscale){logging.debug("[popcorn.iframe] Move to unscaled container")}else{logging.debug("[popcorn.iframe] Move to scaled container")}}},end:function(){if(current){fireEvent("iframehide")}current=false;base.removeClass(base.container,"active")},_teardown:function(){iframe=null;popcorn.off("authchange",updateAuth);popcorn.off("loadedmetadata",updateMetaData);popcorn.off("timeupdate",timeUpdate);popcorn.off("playerHover",playerHover);popcorn.off("play",onPlay);popcorn.off("pause",onPause);window.removeEventListener("message",processMessage,false)}}},{about:{name:"Popcorn iframe Plugin",version:"0.1",author:"Brian Chirls, @bchirls",website:"http://github.com/brianchirls"}})});hy.define("popcorn.profile.iframe",["popcorn.iframe"],function(){return{id:"iframe",icon:"widgets",sortIndex:6,title:"from the widget library",editor:["popcorn.quickedit.iframe"],zIndex:1,defaults:{top:"20%",left:"20%",width:"60%",height:"60%"}}});hy.define("popcorn.image",["configuration","utils","popcorn","player.playereval","popcorn.base","popcorn.gates"],function(config,utils,Popcorn,playerEval,undefined){var document=window.document;Popcorn.basePlugin("image",function(options,base){var currentGroup=config.group&&config.group.id,templateEvaluator=new playerEval.TemplateEvaluator(this,options);var popcorn,video,src,container,img,link,linkClickHandler,creationEnv,isEditMode,cloudfrontUrl;function setImageDimensions(){if(container.style.width){img.style.width="100%"}else{img.style.width=""}if(container.style.height){img.style.height="100%"}else{img.style.height=""}}function watchSrc(scope,name,value){img.src=value}function decodeVariable(variable){return decodeURIComponent(templateEvaluator.evaluate(variable))}base.target=base.target||options.target;if(!base.target){return}popcorn=this;video=popcorn.media;container=base.makeContainer();options.container=container;img=document.createElement("img");creationEnv=options.creationEnvironment||"";isEditMode=popcorn.options.hapyakPlayer.editMode();cloudfrontUrl=options.url&&currentGroup?utils.getCloudfrontUrlForS3Resource(options.url,currentGroup,hapyak.environment,creationEnv,"image",isEditMode):"";src=cloudfrontUrl?cloudfrontUrl:options.url||"";templateEvaluator.watchTemplateVars(src,watchSrc);img.src=decodeVariable(src);img.removeAttribute("width");img.removeAttribute("height");img.addEventListener("load",function(){if(typeof options.onLoad==="function"){options.onLoad(options)}},true);img.addEventListener("error",function errorHandler(){img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},false);base.animate();container.appendChild(img);options.annotationVariableConfig.add("image",options,function(scope,key,data){if(data.link&&typeof data.link==="string"&&options.onClick){options.onClick.gotoLink=data.link}if(data.src){options.url=data.src;img.src=decodeVariable(options.url)}});return{start:function(){if(base.options.url){base.addClass(base.container,"active");setImageDimensions()}},_update:function(trackEvent,changes){if(changes.hasOwnProperty("url")&&changes.url!==options.url){templateEvaluator.watchTemplateVars(changes.url,watchSrc);img.src=decodeVariable(changes.url)}if(changes.hasOwnProperty("pause")&&options.pause!==changes.pause||changes.end!==options.end||changes.start!==options.start){options.pause=changes.pause}setImageDimensions();options.annotationVariableConfig.update("image",options)},end:function(){base.removeClass(base.container,"active")},_teardown:function(){options.annotationVariableConfig.remove(options.annotationId)}}},{about:{name:"Popcorn Image Plugin",version:"0.1",author:"Hapyak",website:"http://www.hapyak.com"},options:{start:{elem:"input",type:"number",label:"Start",units:"seconds"},end:{elem:"input",type:"number",label:"End",units:"seconds"},url:{elem:"input",type:"url",label:"Source URL"},width:{elem:"input",type:"number",label:"Width",default:100,units:"%",hidden:true},height:{elem:"input",type:"number",label:"Height",default:100,units:"%",hidden:true},top:{elem:"input",type:"number",label:"Top",default:0,units:"%",hidden:true},left:{elem:"input",type:"number",label:"Left",default:0,units:"%",hidden:true},link:{elem:"input",type:"url",label:"Link URL"},linkTarget:{elem:"input",type:"text",label:"Link Target"}}})});hy.define("popcorn.profile.image",["player.normalizeonclick","player.normalizetransition","popcorn.image"],function(normalizeonclick,normalizeTransition){return function(options){var uploadAuth=options.uploadAuth;return{id:"image",icon:"photo",sortIndex:7,title:"image overlay link",editor:["popcorn.quickedit.image"],zIndex:3,variables:{populateConfig:function(id,options){var config={},data={},key="Image_"+id;if(options.url){data.src=options.url}if(options.onClick&&options.onClick.gotoLink){data.link=options.onClick.gotoLink}config[key]=data;return config}},commit:true,normalize:{"onClick.gotoLink":normalizeonclick.gotoLink,"onClick.gotoTrack":normalizeonclick.gotoTrack,"onClick.addClasses":normalizeonclick.addClasses,"onClick.setVariables":normalizeonclick.setVariables,onClick:normalizeonclick.onClick,transitionClass:normalizeTransition},filter:function(trackEvent){if(!trackEvent.url){return false}},create:function(id,annotation,editor){var commentId=annotation.get("id");if(uploadAuth){editor.setting(id,"uploadUrl","/api/comments/"+commentId+"/uploads?"+uploadAuth)}}}}});(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.filter");require("popcorn.gates");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.pearsonlssubmit",["popcorn","popcorn.filter","popcorn.gates"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,popcornfilter,popcorngates,undefined){Popcorn.filter("pearson","pearsonLearningStudioQuizSubmit",function(name,options,next){options.src="/static/iframes/pearson/quizsubmit.html";next(options,"iframe")},false)});hy.define("popcorn.profile.pearsonlssubmit",["popcorn.iframe","popcorn.pearsonlssubmit"],function(){return{id:"pearsonlssubmit",plugin:"pearsonLearningStudioQuizSubmit",title:"Pearson Quiz Submit",icon:"P",editor:["popcorn.quickedit.pearsonlssubmit"],sortIndex:7,zIndex:1,maxAllowed:1,defaults:{left:"10%",top:"10%",width:"80%",height:"80%",gate:true,start:function(video,popcorn){return popcorn.duration()-1}}}});hy.define("utils.linkifiedtext",["configuration","module","utils.samedomain","utils.validatelink"],function(configuration,module,sameDomain,validateLink){var linkRegex=/(\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’])))/gi,protocolRegex=/^https?:\/\//i;var moduleConfig=module.config(),playerConfig=configuration&&configuration.player;var localLinks=playerConfig.localLinks||moduleConfig.localLinks||false;function linkifiedText(element,text){var lines=text.split("\n"),i,s,j,link,url;element.innerHTML="";for(i=0;i<lines.length;i++){if(i){element.appendChild(document.createElement("br"))}s=lines[i];j=0;linkRegex.lastIndex=0;url=linkRegex.exec(s);if(url&&!validateLink(url[0])){url=null}while(url){element.appendChild(document.createTextNode(s.substr(j,url.index-j)));if(url[1]){if(!protocolRegex.test(url[1])){url[1]="http://"+url[1]}link=document.createElement("a");if(!localLinks||!sameDomain.test(url[1])){link.setAttribute("target","_blank")}link.setAttribute("href",url[1]);link.setAttribute("data-hapyak-log",true);link.appendChild(document.createTextNode(url[0]));element.appendChild(link)}j=linkRegex.lastIndex;url=linkRegex.exec(s)}if(link){link.setAttribute("title",link.href)}if(j<s.length){element.appendChild(document.createTextNode(s.substr(j)))}}}return linkifiedText});hy.define("quiz",["module","dao","jquery.noconflict","lodash","vendor/i18n!nls/ui","base64","utils.linkifiedtext","configuration","utils.embed","tracking","language.manager"],function(module,dao,$,_,nls,base64,linkifiedText,config,utils,tracking,LanguageManager){var labelId=0,quizNls=nls.annotation.quiz,randomizedQuizProvisioned=utils.dotget(config,"provisioning.randomizedQuiz");return function(options){var session=options&&options.session||null,_tracking=tracking.getInstance(options.trackingId),_onDataChange,correctAnswers=[],correctAnswerValues={},correctAnswersPerQuestion={},defaultThankYouText,passingMark,languageManager,multipleAnswers,multipleRequired,inputType,randomizeAnswers,setPassThreshold,showResults,showReview,showRetry;function getLocalizedText(key){var quizNlsKey=key.split("quiz.")[1];return _.escape(languageManager.get("annotation",key)||utils.dotget(quizNls,quizNlsKey))}function fireDataChangedCallback(){if(_onDataChange&&typeof _onDataChange==="function"){_onDataChange()}}this.viewer=function(options){var singleClickQuiz=config&&config.provisioning&&config.provisioning.singleClickQuiz;options=$.extend({viewer:true},options);languageManager=options.annotationVariableConfig.languageManager;multipleAnswers=options.data.multipleAnswers;multipleRequired=options.data.multipleRequired;inputType=multipleAnswers?"checkbox":"radio";session.annotationId=session.annotationId||options.id;var viewer=build(options),submitButton,skipButton;function assessInput(){var val=this&&this.value,hasText=val&&val.replace(/\s/g,"")!=="";$('input[type="'+inputType+'"]',$(this).closest("li")).prop("checked",true);if(!hasText){submitButton.addClass("disabled");return}updateSubmitButtonState()}viewer.element.addClass("viewer");viewer.element.append($('<div class="submit-back-buttons pull-right">'+'<button type="button" class="btn btn-large skip hide" tabindex="0" role="button">'+getLocalizedText("quiz.button.cancel")+"</button>"+'<button type="button" class="btn btn-large go-back hide" tabindex="0" role="button">'+getLocalizedText("quiz.button.back")+"</button>"+'<button type="button" class="btn btn-large btn-primary submit-answers disabled" tabindex="0" role="button">'+getLocalizedText("quiz:button.submit")+"</button>"+"</div>"));submitButton=$(".submit-answers",viewer.element);skipButton=$(".skip",viewer.element);if(singleClickQuiz){submitButton.addClass("hide")}function updateSubmitButtonState(){var results=getQuizResults(getCurrentPage());submitButton.toggleClass("disabled",results.numQuestions!==results.numAnswered);submitButton.text(viewer.paging.currentPage+1<viewer.paging.numPages?getLocalizedText("quiz.button.next"):getLocalizedText("quiz.button.submit"))}updateSubmitButtonState();var answerSelected=function(event){var hiddenRadio=event.currentTarget.getElementsByTagName("input");event.type==="keypress"&&hiddenRadio.length&&hiddenRadio[0].click();updateSubmitButtonState();if(singleClickQuiz){if(options.data.showReview){submitWithResultsPage()}else{submitWithoutResultsPage()}}};var answerInput=$(".answer",viewer.element);a11yListener(answerInput,answerSelected);answerInput.dblclick(function(){$('input[type="'+inputType+'"]',$(this).closest("li")).prop("checked",false);updateSubmitButtonState()});if(utils.dotget(config,"provisioning.quiz.requireInputText")){$("textarea").keyup(assessInput).focus(assessInput)}else{$("textarea",viewer.element).focus(function(){$('input[type="'+inputType+'"]',$(this).closest("li")).prop("checked",true);updateSubmitButtonState()})}function getCurrentPage(){return $($(".pages",viewer.element).children()[viewer.paging.currentPage])}function getQuizResults(fromEl){fromEl=fromEl||viewer.element;var results={numQuestions:0,numAnswered:0,numCorrect:0,answers:[]},idx;correctAnswersPerQuestion={};$(".question",fromEl).each(function(){results.numQuestions++;var questionEl=$(this),answerEls=$(".answer input:checked",questionEl),pageNumber=parseInt(questionEl.parents("li.page").attr("page"),10),answered=false;$(answerEls).each(function(){var answer={questionId:parseInt(questionEl.attr("question-id"),10),question:$(".question-text",questionEl).text(),page:pageNumber,elementId:$(this).attr("id")},checked=$(this),textInput;correctAnswersPerQuestion[answer.questionId]=correctAnswersPerQuestion[answer.questionId]||[];results.answers.push(answer);if(checked.length===0){answer.correct=false}else{if(!answered){results.numAnswered++}checked=$(checked[0]);answer.answer=checked.siblings("label").children(".label-text").text();textInput=checked.siblings("label").children(".answer-text");if(textInput.length>0){answer.answer=textInput.val()}if(!answer.answer){answer.correct=false;results.answers.pop();return}$(".answers",questionEl).children().each(function(){idx=correctAnswers.indexOf($('input[type="'+inputType+'"]',$(this)).attr("id"));if(idx>-1){if(!answered){correctAnswersPerQuestion[answer.questionId].push(correctAnswerValues[correctAnswers[idx]])}if(textInput.length>0){answer.correct=function(){var answerText=correctAnswerValues[correctAnswers[idx]];if(!answerText||multipleAnswers&&!answer.answer.trim()){return true}return answerText.trim().toLowerCase()===answer.answer.trim().toLowerCase()}()}}});if(correctAnswers.length){idx=correctAnswers.indexOf(checked.attr("id"));if(idx>-1&&textInput.length<=0){answer.correct=true}}else{answer.correct=true}if(answer.correct&&(!multipleRequired||!answered)){results.numCorrect++}answered=true}})});_.forEach(results.answers,function(answer){var answers=correctAnswersPerQuestion[answer.questionId];if(answers){answer.correctAnswer=answers.join(", ")}});return results}function submitWithResultsPage(){var results=getQuizResults(viewer.element),summaryEl,thankYouEl,thankYouText,questionIds=[],paging={numPages:+results.numQuestions,currentPage:0},injectedAnswers=[],incorrectQuestions=[],unanswered=[];function printMultipleCorrectAnswers(answers,index){var elId="correct-answer-"+index,ul=document.getElementById(elId),i=0;if(!ul||!answers){return}ul.innerHTML="";Array.prototype.forEach.call(answers,function(answer){var answerEl=document.createElement("li");if(!answer||!answer.correct||!answer.text){return}i+=1;answerEl.innerHTML=i+". "+answer.text;answerEl.classList.add("correct-answer");ul.appendChild(answerEl)});ul.classList.add("correct-answer-list")}if(viewer.paging.currentPage+1<viewer.paging.numPages){viewer.nextPage();$(".go-back",viewer.element).toggleClass("hide",viewer.paging.currentPage===0);updateSubmitButtonState()}else{viewer.element.children().hide();summaryEl=$('<ul class="clearfix">'+'<li class="page">'+'<div class="summary">'+'<div class="questions">'+'<h4 class="thank-you hide"></h4>'+'<ol class="question-list pages"></ol>'+'<div class="hapyak-share">'+'<a class="zocial facebook icon">&nbsp;</a>'+'<a class="zocial twitter icon">&nbsp;</a>'+"</div>"+"</div>"+"</div>"+"</li>"+"</ul>"+'<div class="view-num-correct hide">'+'<span class="num-correct">'+results.numCorrect+"</span> "+getLocalizedText("quiz.text.label.out_of")+' <span class="num-questions">'+results.numQuestions+"</span> "+getLocalizedText("quiz.text.label.correct")+"</div>"+'<div class="ok-retry-buttons pull-right">'+'<button type="button" class="btn btn-large btn-primary ok">'+getLocalizedText("quiz.button.done")+"</button>"+"</div>"+(results.numQuestions>1?'<div class="pagination pagination-small review-screen pull-right">'+"<ul>"+'<li class="previous-page disabled"><a>« '+getLocalizedText("quiz.button.previous_page")+"</a></li>"+'<li class="next-page"><a>'+getLocalizedText("quiz.button.next_page")+" »</a></li>"+"</ul>":"")+"</div>");viewer.element.append(summaryEl);$(".next-page",summaryEl).click(function(event){if(!$(this).hasClass("disabled")){nextPage(summaryEl,paging)}event.stopPropagation()});$(".previous-page",summaryEl).click(function(event){if(!$(this).hasClass("disabled")){previousPage(summaryEl,paging)}event.stopPropagation()});if(results.numQuestions>1){viewer.element.children(".view-num-correct").removeClass("hide")}$(".zocial.facebook",viewer.element).click(function(event){options.facebookShare();event.stopPropagation()});$(".zocial.twitter",viewer.element).click(function(event){options.twitterShare();event.stopPropagation()});if(multipleAnswers){unanswered=_.clone(correctAnswers);_.forEach(results.answers,function(answer){var idx=unanswered.indexOf(answer.elementId),questionId=answer.questionId;if(idx>-1){unanswered.splice(idx,1)}if(questionId&&!answer.correct&&incorrectQuestions.indexOf(questionId)===-1){incorrectQuestions.push(questionId)}});if(results.answers.length>results.numQuestions){results.numCorrect=results.numQuestions-incorrectQuestions.length}results.numCorrect=Math.max(results.numCorrect,0);$(".num-correct",summaryEl).text(results.numCorrect);if(unanswered.length!==correctAnswers.length){_.forEach(unanswered,function(elementId){var answer,answerEl=$("#"+elementId),correctAnswer,page=parseInt(answerEl.closest(".page").attr("page"),10),questionEl=answerEl.closest(".question"),questionId=parseInt(questionEl.attr("question-id"),10);correctAnswer=correctAnswersPerQuestion[questionId].join(", ");answer={questionId:questionId,question:$(".question-text",questionEl).text(),elementId:elementId,page:page,correct:false,unanswered:true,answer:answerEl.siblings("label").children(".label-text").text(),correctAnswer:correctAnswer};_.forEach(results.answers,function(arrayAnswer,index){if(answer.questionId===arrayAnswer.questionId&&incorrectQuestions.indexOf(questionId)===-1&&arrayAnswer.correct){if(results.numCorrect&&injectedAnswers.indexOf(questionId)===-1){injectedAnswers.push(questionId);if(multipleRequired){results.numCorrect--;incorrectQuestions.push(questionId)}$(".num-correct",summaryEl).text(results.numCorrect)}results.answers.splice(index+1,0,answer);return false}})})}}thankYouText=options.getThankYouText(results);if(thankYouText){thankYouEl=$(".thank-you",viewer.element);linkifiedText(thankYouEl[0],thankYouText);if(typeof options.externalClick==="function"){thankYouEl.find("a[data-hapyak-log]").click(function(event){options.externalClick(event.currentTarget)})}thankYouEl.removeClass("hide")}$.each(results.answers,function(index,answer){
var questionSummaryContainer=$('<li class="question clearfix page hide"></li>'),questionSummaryEl=$("<ul>"+"<li>"+'<h4 class="question-text"></h4>'+'<div class="incorrect'+(answer.unanswered?" unanswered":"")+'">'+'<a tabindex="0" class="show-answer '+(multipleRequired?"hide":"")+'">'+getLocalizedText("quiz.button.show_answer")+"</a>"+'<div class="correct-answer hide">Correct Answers<ul id="correct-answer-'+index+'"></ul></div>'+'<a tabindex="0" class="retry">'+getLocalizedText("quiz.button.retry")+"</a>"+"</div>"+'<div class="answer">'+(correctAnswers.length?answer.correct?'<span style="color:green" class="ss-icon ss-check"></span>':'<span style="color:red" class="ss-icon ss-delete"></span>':"")+'<pre class="answer-text"></pre>'+"</div>"+"</li>"+"</ul>"),incorrectIndex=incorrectQuestions.indexOf(answer.questionId),sameQuestion=questionIds.indexOf(answer.questionId)>-1;questionIds.push(answer.questionId);$(".retry",questionSummaryEl).hide();$(".incorrect",questionSummaryEl).hide();if(incorrectQuestions.length||!multipleAnswers&&!answer.correct){if(incorrectIndex>-1){incorrectQuestions.splice(incorrectIndex,1)}$(".incorrect",questionSummaryEl).show();if(options.data.showRetry){var $retry=$(".retry",questionSummaryEl);$retry.show();a11yListener($retry,function(){summaryEl.remove();viewer.element.children(":not(.pagination):not(.delete)").show();viewer.gotoPage(answer.page);if(options.retry){options.retry()}})}a11yListener($(".show-answer",questionSummaryEl),function(){var questionPages=options&&options.data&&options.data.pages&&options.data.pages[answer&&answer.page],answers=questionPages&&utils.dotget(questionPages,"content.0.answers");$(this).hide();if(multipleAnswers){printMultipleCorrectAnswers(answers,index)}else{$(".correct-answer",questionSummaryEl).text(getLocalizedText("quiz.text.label.answer")+": "+answer.correctAnswer)}$(".correct-answer",questionSummaryEl).removeClass("hide");$(".retry",questionSummaryEl).hide()})}$(".show-answer",questionSummaryEl)[options.data.showResults?"show":"hide"]();$(".question-text",questionSummaryEl).text(answer.question);if(sameQuestion){$(".incorrect",questionSummaryEl).remove();$(".question-text",questionSummaryEl).remove();if(options.data.showRetry&&(!results.answers[index+1]||multipleRequired&&results.answers[index+1].questionId!==answer.questionId&&!answer.correct)){$(".retry",questionSummaryEl).show()}$(".question-list",summaryEl).children().last().append(questionSummaryEl)}else{questionSummaryContainer.append(questionSummaryEl);$(".question-list",summaryEl).append(questionSummaryContainer);if(options.data.showRetry){$(".retry",questionSummaryEl).show()}}$(".answer-text",questionSummaryEl).text(answer.answer)});updatePages(summaryEl,paging);$(".question-list > .question > .incorrect",summaryEl).each(function(){if(!$(this).hasClass("unanswered")&&$(this).is(":visible")&&options.data.showResults){$(".show-answer",$(this)).show()}});a11yListener($(".ok",summaryEl),function(){onSuccess(results)})}}function submitWithoutResultsPage(){var currentPage=getCurrentPage(),results=getQuizResults(currentPage),incorrectQuestions=[],injectedAnswers=[],unanswered=[],thankYouEl,thankYouText;if(!options.data.showRetry||results.numQuestions===results.numCorrect){submitButton.removeClass("btn-primary btn-danger disabled");submitButton.addClass("btn-success");currentPage.removeClass("failure");if(viewer.paging.currentPage+1<viewer.paging.numPages){viewer.nextPage();$(".go-back",viewer.element).toggleClass("hide",viewer.paging.currentPage===0);updateSubmitButtonState()}else{results=getQuizResults(viewer.element);if(multipleAnswers){unanswered=_.clone(correctAnswers);_.forEach(results.answers,function(answer){var idx=unanswered.indexOf(answer.elementId),questionId=answer.questionId;if(idx>-1){unanswered.splice(idx,1)}if(questionId&&!answer.correct&&incorrectQuestions.indexOf(questionId)===-1){incorrectQuestions.push(questionId)}});if(results.answers.length>results.numQuestions){results.numCorrect=results.numQuestions-incorrectQuestions.length}results.numCorrect=Math.max(results.numCorrect,0);if(unanswered.length!==correctAnswers.length){_.forEach(unanswered,function(elementId){var answer,answerEl=$("#"+elementId),correctAnswer,page=parseInt(answerEl.closest(".page").attr("page"),10),questionEl=answerEl.closest(".question"),questionId=parseInt(questionEl.attr("question-id"),10);correctAnswer=correctAnswersPerQuestion[questionId].join(", ");answer={questionId:questionId,question:$(".question-text",questionEl).text(),elementId:elementId,page:page,correct:false,unanswered:true,answer:answerEl.siblings("label").children(".label-text").text(),correctAnswer:correctAnswer};_.forEach(results.answers,function(arrayAnswer,index){if(answer.questionId===arrayAnswer.questionId&&incorrectQuestions.indexOf(questionId)===-1&&arrayAnswer.correct){if(results.numCorrect&&injectedAnswers.indexOf(questionId)===-1){injectedAnswers.push(questionId);results.numCorrect--}results.answers.splice(index+1,0,answer);return false}})})}}onSuccess(results)}}else if(options.data.showRetry){submitButton.removeClass("btn-primary btn-success");submitButton.addClass("btn-danger");currentPage.addClass("failure")}}function onSuccess(results){var partnerData={};if(_tracking&&(module.config().tracking||_tracking.getRegisteredProperty("Partner Data"))){_.forEach(_tracking.getRegisteredProperty("Partner Data"),function(obj){partnerData[obj.key]=obj.value});results.partnerData=partnerData}var params=$.extend({data:base64.encode(JSON.stringify(results)),key:module.config().apiKey},session),configTracking=module.config().tracking;params.tracking=base64.encode(JSON.stringify(configTracking)||"");dao.store.postJSON(module.config().api,params);if(options.success){options.success(results)}}submitButton.click(function(){if($(this).hasClass("disabled")){return}if(options.data.showReview){submitWithResultsPage()}else{submitWithoutResultsPage()}});if(options.data.showSkip&&options.data.pages){skipButton.removeClass("hide");skipButton.click(function(){if(options.skip){options.skip()}})}$(".go-back",viewer.element).click(function(){if(viewer.paging.currentPage>0){viewer.previousPage();$(".go-back",viewer.element).toggleClass("hide",viewer.paging.currentPage===0);updateSubmitButtonState()}});return{destroy:function(){viewer.destroy()}}};this.editor=function(options){options=$.extend({editor:true},options);languageManager=options.annotationVariableConfig.languageManager;options.isEditMode=true;multipleAnswers=options.data.multipleAnswers;multipleRequired=options.data.multipleRequired;inputType=multipleAnswers?"checkbox":"radio";var editor=build(options);if(options.data){defaultThankYouText=options.data.thankYouText||getLocalizedText("quiz.dialog.onSubmit.thankYouText");passingMark=options.data.passingMark;randomizeAnswers=options.data.randomizeAnswers;setPassThreshold=options.data.setPassThreshold;showRetry=options.data.showRetry;showResults=options.data.showResults;showReview=options.data.showReview}if(showRetry===undefined){showRetry=true}if(showResults===undefined){showResults=true}if(showReview===undefined){showReview=true}editor.element.addClass("editor");_onDataChange=options.onDataChange;return{save:function(){var json={id:options.id,pages:[],passingMark:passingMark,randomizeAnswers:$(".randomize-answers input",editor.element).prop("checked"),setPassThreshold:setPassThreshold,showSkip:$(".show-skip input",editor.element).prop("checked"),showRetry:showRetry,showResults:showResults,showReview:showReview,multipleAnswers:multipleAnswers,multipleRequired:multipleRequired,showHints:true,thankYouText:defaultThankYouText},me=this;if(json.thankYouText===getLocalizedText("quiz.dialog.onSubmit.thankYouText")){json.thankYouText=""}me.isEmpty=true;$(".pages",editor.element).children().each(function(pageNumber){var page=this;var jsonPage={id:pageNumber+1,content:[]};json.pages.push(jsonPage);$(".questions",page).children().each(function(){var question=$(this);var jsonQuestion={};jsonQuestion.text=$('input[type="text"]',question).val();if(jsonQuestion.text){me.isEmpty=false;if(question.hasClass("heading")){jsonQuestion.type="heading"}else{jsonQuestion.id=parseInt(question.attr("question-id"),10);jsonQuestion.type="question";jsonQuestion.answers=[];$(".answers",question).children().each(function(){var answer=$(this);var jsonAnswer={};jsonQuestion.answers.push(jsonAnswer);jsonAnswer.text=$('textarea, input[type="text"]',answer).val().trim();if(answer.hasClass("choice-answer")||answer.hasClass("text-choice-answer")){jsonAnswer.type=answer.hasClass("choice-answer")?"choice":"text-choice";if(jsonPage.content.indexOf(jsonQuestion)===-1){jsonPage.content.push(jsonQuestion)}if(jsonAnswer.type==="text-choice"||jsonAnswer.text){if($('input[type="'+inputType+'"]',answer).prop("checked")){jsonAnswer.correct=true}}}})}}})});if(me.isEmpty){json.pages=null}return json},destroy:function(){editor.destroy()},isEmpty:true}};function build(options){var container=$(options.element),paging={numPages:0,currentPage:0},builder,i,nextQuestionId=1,enable=options.enable||{};var randomizeAnswers;correctAnswers=[];correctAnswerValues={};correctAnswersPerQuestion={};function updateDeletePageVisibility(show){$(".delete-page",builder).toggle(show)}function verifyDelete(callback){options.verifyDelete(function(){if(callback){callback($(".page:not(.hide)"))}onDelete()})}function onDelete(){var show=paging.numPages>1;if(show){paging.numPages--;paging.currentPage=0;show=paging.numPages>1;updateDeletePageVisibility(show);updatePages(container,paging)}}function createPage(data){var i,pageNumber,content,el,show;paging.numPages++;pageNumber=paging.numPages-1;show=paging.numPages>1;el=$('<li class="page hide"'+(options.viewer?' page="'+pageNumber+'"':"")+">"+(options.viewer?'<span class="failure-label label label-important">'+getLocalizedText("quiz.text.label.incorrect")+"</span>":"")+'<ol class="questions"></ol>'+"</li>");if(data&&data.content){for(i=0;i<data.content.length;i++){content=data.content[i];if(content.type==="question"&&content.id!==undefined&&content.id>=nextQuestionId){nextQuestionId=content.id+1}}for(i=0;i<data.content.length;i++){content=data.content[i];if(content.type==="question"){if(content.id===undefined){content.id=nextQuestionId++}$(".questions",el).append(createQuestion(content))}else if(content.type==="heading"){$(".questions",el).append(createHeading(content))}}}else if(options.editor){$(".questions",el).append(createQuestion())}updateDeletePageVisibility(show);return el}function createQuestion(data){var i,answerEl,questionAnswers,answer,questionId=data?data.id:nextQuestionId++,enableTextChoice=enable.textChoice!==false;var el=$('<li class="question" question-id="'+questionId+'">'+(options.editor?deleteButton("delete-question"):"")+'<form class="question-form">'+"<fieldset>"+(options.editor?text(getLocalizedText("quiz.text.placeholder.new_question"),"question-text input-xlarge"):'<h4 class="question-text"></h4>')+'<ol class="answers"></ol>'+"</fieldset>"+"</form>"+(options.editor?'<div class="btn-group pull-right">'+button("&#x002B; "+getLocalizedText("quiz.button.new_choice"),"new-choice","icon-list")+(enableTextChoice?button("&#x002B; "+getLocalizedText("quiz.button.new_input"),"new-text-choice","icon-italic"):"")+"</div>":"")+"</li>");function shuffle(array){if(!array&&Array.isArray(array)){return}var answerTextArray=[],openResponseArray=[],dict={},finalArray=[];var answer,currentIndex,temporaryValue,randomIndex;array.forEach(function(answer){if(answer.type==="choice"){answerTextArray.push(answer.text);dict[answer.text]=answer}else{openResponseArray.push(answer)}});currentIndex=answerTextArray.length;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=answerTextArray[currentIndex];answerTextArray[currentIndex]=answerTextArray[randomIndex];answerTextArray[randomIndex]=temporaryValue}answerTextArray.forEach(function(answerText,ind){var ob;for(ob in array){if(array[ob].text===answerText){finalArray.push(array[ob]);break}}});return finalArray.concat(openResponseArray)}$(".question-form",el).submit(function(event){event.preventDefault();return false});if(options.editor){$(".new-choice",el).click(function(){var answer=createChoiceAnswer(data,{id:$(".answers",el).children().length});$(".answers",el).append(answer);$('input[type="text"]',answer).focus();$('input[type="text"]',answer).click(function(event){event.stopPropagation()})});$(".new-text-choice",el).click(function(){var answer=createChoiceAnswer(data,{id:$(".answers",el).children().length},true);$(".answers",el).append(answer);$("textarea",answer).focus();$("textarea",answer).click(function(event){event.stopPropagation()})});setupDeleteButton(el,{selector:".delete-question"})}if(data){if(data.text){if(options.editor){$(".question-text",el).val(data.text)}else{$(".question-text",el).text(data.text)}}questionAnswers=data.answers;if(questionAnswers){if(randomizedQuizProvisioned&&!options.isEditMode&&utils.dotget(options,"data.randomizeAnswers")){questionAnswers=shuffle(questionAnswers)}for(i=0;i<questionAnswers.length;i++){answer=questionAnswers[i];if(answer.type==="text-choice"){answerEl=createChoiceAnswer(data,answer,true)}else{answerEl=createChoiceAnswer(data,answer)}$(".answers",el).append(answerEl)}}}else if(options.editor){$(".answers",el).append(createChoiceAnswer(data,{id:$(".answers",el).children().length}))}return el}function createChoiceAnswer(question,data,textChoice){var radioEl,id=labelId++,hasCorrectAnswer=false,radioHtml=radio(data.id,id),el=setupDeleteButton($('<li class="answer '+(textChoice?"text-":"")+'choice-answer">'+radioHtml+'<label tabindex="0" role="listitem" class="radio '+(options.editor?"inline":"")+'" for="hapyak-label-'+id+'">'+'<div class="hapyak-select"> &nbsp; </div>'+(options.viewer?textChoice?textarea(getLocalizedText("quiz.text.placeholder.new_choice"),"answer-text"):'<div class="label-text"></div>':"")+"</label>"+(options.editor?textChoice?textarea(getLocalizedText("quiz.text.placeholder.new_input"),"answer-text"):text(getLocalizedText("quiz.text.placeholder.new_choice"),"answer-text"):"")+(options.editor?deleteButton():"")+"</li>"));if(question){hasCorrectAnswer=question.answers.some(function(answer){return!!answer.correct})}radioEl=$('input[type="'+inputType+'"]',el);if(options.editor){radioEl.dblclick(function(){$(this).removeAttr("checked")});if(data){if(data.text){if(data.type==="choice"){$('input[type="text"]',el).val(data.text)}else{$("textarea",el).val(data.text)}}if(data.correct){radioEl.attr("checked",true);correctAnswers.push("hapyak-label-"+id);if(data.text){correctAnswerValues["hapyak-label-"+id]=data.text}}}}else if(data){if(data.text){if(!textChoice){$(".label-text",el).text(data.text);var optionLabel=el[0].getElementsByTagName("label");optionLabel.length&&(optionLabel[0].ariaLabel="Option - "+data.text)}}if(data.correct||!hasCorrectAnswer){correctAnswers.push("hapyak-label-"+id);if(data.text){correctAnswerValues["hapyak-label-"+id]=data.text}}}return el}function createHeading(data){var el=setupDeleteButton($('<li class="heading">'+(options.editor?text("Enter Heading","heading-text input-xlarge"):"<h3></h3>")+(options.editor?deleteButton("delete-heading"):"")+"</li>"),{selector:".delete-heading"});if(options.editor){if(data&&data.text){$('input[type="text"]',el).val(data.text)}}else if(data&&data.text){$("h3",el).text(data.text)}return el}builder=setupDeleteButton($('<div class="hapyak-quiz-builder clearfix">'+(options.editor?'<div class="thank-you-text hide"></div>'+'<div class="btn-toolbar clearfix">'+'<div class="btn-group pull-left">'+'<a class="btn btn-large new-question bcov-flat-btn">&#x002B; '+getLocalizedText("quiz.menu.new_item.new_question")+"</a>"+"</div>"+'<div class="options-menu btn-group pull-right">'+'<a class="btn btn-large dropdown-toggle bcov-flat-btn" data-toggle="dropdown" href="#">'+getLocalizedText("quiz.menu.set_option.menu_label")+' <span class="caret"></span></a>'+'<ul class="dropdown-menu" style="width:293px;">'+'<li><a class="show-skip"><input type="checkbox"><label><div class="hapyak-select"> &nbsp; </div> '+getLocalizedText("quiz.menu.set_option.cancel")+"</a></li>"+(randomizedQuizProvisioned?'<li><a class="randomize-answers"><input type="checkbox"><label><div class="hapyak-select"> &nbsp; </div> '+getLocalizedText("quiz.menu.set_option.randomizeAnswers")+"</a></li>":"")+'<li><a class="edit-on-submit-actions"><p>'+getLocalizedText("quiz.menu.set_option.reviewScreen")+"</p></a></li>"+'<li><a class="edit-pass-fail-actions"><p>'+getLocalizedText("quiz.menu.set_option.passFail")+"</p></a></li>"+'<li><a class="edit-questions-actions"><p>'+getLocalizedText("quiz.menu.set_option.question")+"</p></a></li>"+"</ul>"+"</div>"+"</div>":"")+(options.editor?deleteButton("delete-page"):"")+'<ul class="pages clearfix"></ul>'+'<span class="page-number pull-left"></span>'+'<div class="pagination pagination-small pull-right">'+"<ul>"+'<li class="previous-page"><a class="bcov-flat-btn">« '+getLocalizedText("quiz.button.previous_page")+"</a></li>"+'<li class="next-page"><a class="bcov-flat-btn">'+getLocalizedText("quiz.button.next_page")+" »</a></li>"+"</ul>"+"</div>"+"</div>"),{paging:paging,verifyDelete:options.verifyDelete?verifyDelete:null});container.append(builder);fireDataChangedCallback();if(options.editor){if(!options.verifyDelete){$(".delete-page",builder).click(onDelete)}$(".next-page",builder).click(function(event){if(!$(this).hasClass("disabled")){nextPage(container,paging)}event.stopPropagation()});$(".previous-page",builder).click(function(event){if(!$(this).hasClass("disabled")){previousPage(container,paging)}event.stopPropagation()});$(".new-question",builder).click(function(event){$(".pages",builder).append(createPage());paging.currentPage=paging.numPages-1;updatePages(container,paging)});$(".edit-on-submit-actions",builder).click(function(){options.onSubmitDialog(function(options){showRetry=options.quiz.showRetry;showReview=options.quiz.showReview;showResults=options.quiz.showResults;defaultThankYouText=options.quiz.thankYouText})});$(".edit-pass-fail-actions",builder).click(function(){options.actionsDialog(function(options){passingMark=options.quiz.passingMark||"50";setPassThreshold=options.quiz.setPassThreshold})});$(".edit-questions-actions",builder).click(function(){options.questionsDialog(function(options){multipleAnswers=options.quiz.multipleAnswers;multipleRequired=options.quiz.multipleRequired})});$(".new-heading",builder).click(function(){var heading=createHeading();$(".questions",getPage(paging.currentPage,builder)).append(heading);$('input[type="text"]',heading).focus();fireDataChangedCallback()});$(".options-menu li",builder).click(function(event){var checkbox=$("input",$(this));if(checkbox.length>0){checkbox.prop("checked",!checkbox.prop("checked"));event.stopPropagation()}});$(".options-menu li input",builder).click(function(event){event.stopPropagation()});if(!!utils.dotget(options,"data.randomizeAnswers")){$(".randomize-answers input",builder).prop("checked",true)}var showSkip=options.data&&options.data.showSkip;if(showSkip===undefined){showSkip=options.showSkip}if(showSkip===undefined){showSkip=true}if(showSkip){$(".show-skip input",builder).prop("checked",true)}}if(options.data&&options.data.pages){for(i=0;i<options.data.pages.length;i++){$(".pages",builder).append(createPage(options.data.pages[i]))}}else if(options.editor){$(".pages",builder).append(createPage())}updatePages(container,paging);return{element:builder,paging:paging,gotoPage:function(page){gotoPage(container,paging,page)},nextPage:function(){nextPage(container,paging)},previousPage:function(){previousPage(container,paging)},destroy:function(){builder.remove()}}}function updatePages(container,paging){var i,previousBtn=$(".previous-page",container),nextBtn=$(".next-page",container);for(i=0;i<paging.numPages;i++){getPage(i,container).toggleClass("hide",i!==paging.currentPage)}$(".page-number",container).toggleClass("one-page",paging.numPages<=1);previousBtn.toggleClass("disabled",paging.currentPage===0);nextBtn.toggleClass("disabled",paging.currentPage+1>=paging.numPages);$(".page-number",container).text(getLocalizedText("quiz.text.label.page")+" "+(paging.currentPage+1)+" "+getLocalizedText("quiz.text.label.of")+" "+paging.numPages);fireDataChangedCallback()}function previousPage(container,paging){gotoPage(container,paging,paging.currentPage-1)}function nextPage(container,paging){gotoPage(container,paging,paging.currentPage+1)}function gotoPage(container,paging,page){paging.currentPage=page;updatePages(container,paging)}function getPage(index,container){return $($(".pages",container).children()[index])}function button(text,className,icon){icon=null;return'<button type="button" class="'+className+' btn btn-large">'+(icon?'<i class="'+icon+'"></i> ':"")+text+"</button>"}function radio(value,id){return'<input id="hapyak-label-'+id+'" '+(!multipleAnswers?'name="choice"':"")+' type="'+inputType+'" value="'+value+'" tabindex="-1">'}function text(placeholder,className){return'<input type="text" class="'+className+'" placeholder="'+placeholder+'">'}function textarea(placeholder,className){return'<textarea type="text" class="'+className+'" placeholder="'+placeholder+'"></textarea>'}function deleteButton(className){className=className||"";return'<a class="delete '+className+'"><i class="ss-icon ss-symbolicons-block icon-color">&#xE0D0;</i></a>'}function setupDeleteButton(el,options){options=options||{};var selector=options.selector||".delete",verifyDelete=options.verifyDelete||null,button=$(selector,el);function onClick(){el.remove();fireDataChangedCallback()}button.click(function(event){if(verifyDelete){verifyDelete(function(element){var tmpEl=el;el=element;onClick();el=tmpEl})}else{onClick()}event.stopPropagation()});return el}}});hy.define("popcorn.quiz",["jquery.noconflict","lodash.noconflict","popcorn","player.playereval","quiz","cookie","utils","vendor/i18n!nls/ui","logging","playlist.addon","popcorn.base","popcorn.sharing"],function($,_,Popcorn,playereval,Quiz,cookie,utils,nls,logging,playlistAddon){Popcorn.basePlugin("quiz",function(options,base){var popcorn=this,container=options.container=base.makeContainer(),viewerContainer,quiz,success=false,showContainer=true,viewer,width,top,left,annotationId,initialVideoStatePaused=null,mouseActionIsHovered=false,initialMouseActionRecorded=false,started=false,dirty=false,submitting=false,watchingVariables={},templateEvaluator=new playereval.TemplateEvaluator(this,options),tracking=popcorn.options.hapyakPlayer.tracking,quizNls=nls.annotation.quiz;function getAnnotationId(){if(options&&options.annotationId){return options.annotationId}logging.error("Error annotationId not found on popcorn options.")}function watchVariables(){if(dirty&&!submitting){createViewer()}if(started){container.addClass("active")}}function createViewer(){var annotationId,key;for(key in watchingVariables){if(watchingVariables.hasOwnProperty(key)){popcorn.unwatchData(options.dataId||options.id,"condition",watchVariables);delete watchingVariables[key]}}function continueVideo(condition,pause){popcorn.emit("hapyak-quiz-done",options.dataId||options.id);showContainer=false;container.removeClass("active");container.off("click",onMouseEnter);container.off("mouseover",onMouseEnter);container.off("mouseout",onMouseLeave);if(condition){popcorn.setData(options.dataId||options.id,"condition",true)}if(!pause){popcorn.play()}}if(viewer){viewer.destroy()}success=false;annotationId=getAnnotationId();viewer=quiz.viewer({id:annotationId,element:viewerContainer,data:options.quiz,getThankYouText:function(results){var correctAnswers=0,message,multipleRequired,pass,passThreshold;if(options.quiz&&options.quiz.setPassThreshold){passThreshold=options.quiz.passingMark?options.quiz.passingMark:51}else{passThreshold=51}if(options.quiz&&options.quiz.multipleRequired){multipleRequired=true}Popcorn.forEach(results.answers,function(answer){if(answer.correct){correctAnswers++}});pass=(multipleRequired?results.numCorrect/results.numQuestions:correctAnswers/results.answers.length)>=passThreshold/100;if(options.pass&&pass){message=options.pass.thankYou}else if(options.fail&&!pass){message=options.fail.thankYou}if(!message){message=options.quiz.thankYouText||_.escape(quizNls.dialog.onSubmit.thankYouText)}container.addClass("hapyak-review-screen").css({top:0,left:"auto"});return message},success:function(results){var actionsToTrack={},annotationId=getAnnotationId(),condition=true,correctAnswers=0,pass=false,pause=false;var actions,passThreshold,percentCorrect,goToVideo,trackTime,link;success=true;if(options.quiz&&options.quiz.setPassThreshold){passThreshold=options.quiz.passingMark?options.quiz.passingMark:51}else{passThreshold=51}if(annotationId){submitting=true;Popcorn.forEach(results.answers,function(answer){tracking.annotationActionById(annotationId,"quiz","Answer",{Question:answer.question,Page:answer.page,Answer:answer.answer,Correct:answer.correct===true,Multiple:options.quiz.multipleAnswers});if(answer.correct){correctAnswers++}popcorn.setData("quiz_"+annotationId+"_"+answer.questionId,answer.answer);popcorn.setData("quiz_"+annotationId+"_"+answer.questionId+"_correct",answer.correct);popcorn.setData("quiz_"+annotationId+"_"+answer.questionId+"_info",{question:answer.question,time:options.start,answer:answer.answer,correct:answer.correct})});submitting=false;percentCorrect=options.quiz.multipleRequired?results.numCorrect/results.numQuestions:correctAnswers/results.answers.length;if(percentCorrect>=passThreshold/100){actions=options.pass;pass=true}else{actions=options.fail;pass=false}}container.removeClass("hapyak-review-screen").css({top:top||50,left:left||50});popcorn.setData("quiz_"+annotationId+"_pass",pass);if(actions){if(actions.gotoLink){link=templateEvaluator.evaluate(actions.gotoLink,true);popcorn.emit("clearactivepauses");utils.navigateToUrl(link);actionsToTrack["Target Link"]=link;pause=!!actions.pause}if(actions.gotoTrack){trackTime=utils.getTrackTime(/^([0-9]+)?(?:#(?:([0-9]+):)?([0-9id\=]+(?:\.[0-9]+)?))?$/.exec(actions.gotoTrack));if(trackTime.time){popcorn.on("seeked",function onSeek(){popcorn.off("seeked",onSeek);popcorn.play()});actionsToTrack["Target Time"]=trackTime.time}if(trackTime.track){actionsToTrack["Target Track"]=trackTime.track}if(!actions.goToVideo||actions.goToVideo==="-"){popcorn.options.loadTrackTime(trackTime.track,trackTime.time,trackTime.annotationId)}}if(actions.goToVideo){var seekTime=0,branchVideoTime=actions.branchVideoTime,gotoTrack=actions.gotoTrack;var trackTime;if(branchVideoTime||gotoTrack){trackTime=branchVideoTime?branchVideoTime:utils.getTrackTime(/^([0-9]+)?(?:#(?:([0-9]+):)?([0-9id\=]+(?:\.[0-9]+)?))?$/.exec(gotoTrack)),seekTime=branchVideoTime?trackTime:trackTime.time}playlistAddon.goTo(actions.goToVideo,true,seekTime)}if(actions.resetVariables){createViewer();condition=false}if(actions.setVariables){playereval.playereval(popcorn,actions.setVariables);if(actions.setVariables.indexOf("resetVariables()")>-1){createViewer();condition=false}}}tracking.annotationActionById(annotationId,"quiz","Submit",Popcorn.extend({"Num Questions":results.numQuestions,"Num Answered":results.numAnswered,"Num Correct":results.numCorrect,Multiple:options.quiz.multipleAnswers,Pass:pass,Summary:function(){var summary={};var answered=results.answers.filter(function(item){return!item.unanswered});_.forEach(answered,function(answer){if(!summary[answer.questionId]){summary[answer.questionId]={question:answer.question,answers:[],correct_answer:answer.correctAnswer}}summary[answer.questionId].answers.push(answer.answer)});return _.values(summary)}()},actionsToTrack));dirty=true;continueVideo(condition,pause)},retry:function(){var annotationId=getAnnotationId();if(annotationId){tracking.annotationActionById(annotationId,"quiz","Retry")}dirty=true},skip:function(){var annotationId=getAnnotationId();if(annotationId){tracking.annotationActionById(annotationId,"quiz","Skip")}continueVideo(false);dirty=true},annotationVariableConfig:options.annotationVariableConfig,facebookShare:function(){popcorn.shareFacebook()},twitterShare:function(){popcorn.shareTwitter()},externalClick:function(element){var annotationId=getAnnotationId();if(annotationId){tracking.annotationActionById(annotationId,"quiz","External Click",{Target:element.href,Text:element.text,Remaining:popcorn.duration()-popcorn.currentTime()})}}});if(options.quiz&&options.quiz.pages&&annotationId){Popcorn.forEach(options.quiz.pages,function(page){Popcorn.forEach(page.content,function(question){var id="quiz_"+annotationId+"_"+question.id;if(!watchingVariables[id]){popcorn.watchData(options.dataId||options.id,id,watchVariables);watchingVariables[id]=true}popcorn.setData(id+"_info",{question:question.text,time:options.start})})})}}function setDimensions(){if(!container.hasClass("hapyak-review-screen")){container.css({width:width,left:left||50,top:top||50})}}function onMouseEnter(){if(!showContainer){return}if(options.target.classList.contains("hapyak-editing")){popcorn.pause();return}if(!initialMouseActionRecorded){initialVideoStatePaused=null;initialVideoStatePaused=popcorn.paused();initialMouseActionRecorded=true}popcorn.pause()}function onMouseLeave(){if(options.target.classList.contains("hapyak-editing")||options&&options.pause){popcorn.pause();return}if(!showContainer||container.is(":hover")){return}if(initialVideoStatePaused){popcorn.pause()}else{popcorn.play()}initialMouseActionRecorded=false}container.setAttribute("role","form");container=$(container);quiz=new Quiz({trackingId:popcorn.options.hapyakPlayer.instanceId,session:{playId:popcorn.getData("playerId"),projectId:popcorn.getData("projectId"),trackId:popcorn.getData("trackId"),annotationId:getAnnotationId()}});width=options.width||"960px";top=options.top||"12%";left=options.left||"4%";setDimensions();viewerContainer=$('<div class="hapyak-quiz-container quiz-viewer" tabindex="0"></div>');container.append(viewerContainer);if(options.quiz){createViewer()}options.annotationVariableConfig.add("quiz",options,function(scope,key,data){var pass=data.pass,fail=data.fail,questions=data.questions;if(data.default_review_message){options.quiz.thankYouText=data.default_review_message}if(pass){if(pass.review_message){options.pass.thankYou=data.pass.review_message}if(pass.link){options.pass.gotoLink=pass.link}}if(fail){if(fail.review_message){options.fail.thankYou=data.fail.review_message}if(fail.link){options.fail.gotoLink=fail.link}}if(options.quiz.pages){options.quiz.pages.forEach(function(page,index){var content=page.content;if(content){content.forEach(function(question,idx){var newQuestionData=questions[question.id];if(newQuestionData){if(newQuestionData.question){options.quiz.pages[index].content[idx].text=newQuestionData.question}if(newQuestionData.answers){newQuestionData.answers.forEach(function(answerText,answerIndex){options.quiz.pages[index].content[idx].answers[answerIndex].text=answerText})}}})}})}createViewer()});return{start:function(){started=true;if(options.pause){popcorn.pause()}if(!showContainer){return}container.on("click",onMouseEnter);container.on("mouseover",onMouseEnter);container.on("mouseout",onMouseLeave);container.addClass("active")},_update:function(trackEvent,changes){if(changes.hasOwnProperty("quiz")){if(!_.isEqual(trackEvent.quiz,changes.quiz)||changes.pluginData.recreateViewer){trackEvent.quiz=changes.quiz;delete changes.pluginData.recreateViewer;createViewer()}}if(changes.hasOwnProperty("width")&&changes.width!==width){width=changes.width}if(changes.hasOwnProperty("top")&&changes.top!==top){top=changes.top}if(changes.hasOwnProperty("left")&&changes.left!==left){left=changes.left}setDimensions();options.annotationVariableConfig.update("quiz",options)},end:function(){started=false;showContainer=true;container.off("click",onMouseEnter);container.off("mouseover",onMouseEnter);container.off("mouseout",onMouseLeave);container.removeClass("active")
;initialVideoStatePaused=null;mouseActionIsHovered=false;initialMouseActionRecorded=false},getExportedVariables:function(){var annotationId=getAnnotationId(),exportedVariables=[];if(options.quiz){Popcorn.forEach(options.quiz.pages,function(page){Popcorn.forEach(page.content,function(item){if(item.type==="question"){exportedVariables.push({title:item.text,name:"quiz_"+annotationId+"_"+item.id})}})})}return exportedVariables},_teardown:function(){var key;container.off("click",onMouseEnter);container.off("mouseover",onMouseEnter);container.off("mouseout",onMouseLeave);if(viewer){viewer.destroy()}if(viewerContainer&&viewerContainer.children().size()>0){viewerContainer.empty()}for(key in watchingVariables){if(watchingVariables.hasOwnProperty(key)){popcorn.unwatchData(options.dataId||options.id,"condition",watchVariables);delete watchingVariables[key]}}options.annotationVariableConfig.remove(options.annotationId)}}},{about:{name:"Quiz Plugin",version:"0.1",author:"Jason Horman, @jhorman",website:"https://github.com/hapyak"},options:{start:{elem:"input",type:"number",label:"Start",units:"seconds"},end:{elem:"input",type:"number",label:"End",units:"seconds"}}})});hy.define("popcorn.profile.quiz",["popcorn.gates","popcorn.quiz"],function(){return function(options){var uploadAuth=options.uploadAuth;return{id:"quiz",icon:"live_help",sortIndex:3,title:"a question",editor:["popcorn.quickedit.quiz"],zIndex:7,variables:{populateConfig:function(id,options){var config={},data={questions:{}},key="Quiz_"+id,pass=options.pass,fail=options.fail,quiz=options.quiz;if(pass){data.pass={};if(pass.gotoLink){data.pass.link=pass.gotoLink}if(pass.thankYou){data.pass.review_message=pass.thankYou}}if(fail){data.fail={};if(fail.gotoLink){data.fail.link=fail.gotoLink}if(fail.thankYou){data.fail.review_message=fail.thankYou}}if(quiz&&quiz.thankYouText){data.default_review_message=quiz.thankYouText}if(quiz&&quiz.pages&&quiz.pages.length){quiz.pages.forEach(function(page){var content=page.content;if(!content){return}content.forEach(function(question){var questionData={answers:[]};if(question.text){questionData.question=question.text}if(question.answers){question.answers.forEach(function(answer,index){if(answer.text){questionData.answers.push(answer.text)}})}data.questions[question.id]=questionData})})}config[key]=data;return config}},commit:true,defaults:{precondition:true,pluginData:{}},filter:function(trackEvent,annotation){if(!trackEvent.quiz){return false}if(!trackEvent.quiz.id){trackEvent.quiz.id=annotation.get("id")}},create:function(id,annotation,editor){var commentId,trackId;if(editor){commentId=annotation.get("id");trackId=annotation.get("track.id");editor.setting(id,"annotationId",commentId);editor.setting(id,"csvExport","/api/quiz/report?track_id="+trackId+"&"+uploadAuth)}}}}});(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.filter");require("popcorn.gates");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.quizreview",["popcorn","popcorn.filter","popcorn.gates"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,popcornfilter,popcorngates,undefined){Popcorn.filter("quizreview","quizreview",function(name,options,next){options.src=hapyak.rootUrl+"/static/iframes/quiz/review.html";next(options,"iframe")},false)});hy.define("popcorn.profile.quizreview",["popcorn.iframe","popcorn.quizreview"],function(){return{id:"quizreview",plugin:"quizreview",title:"Final Quiz Review",icon:"&#x2713;",editor:["popcorn.quickedit.quizreview"],sortIndex:6,zIndex:1,maxAllowed:1,defaults:{left:"10%",top:"10%",width:"80%",height:"80%",gate:true,start:function(video,popcorn){return popcorn.duration()-1}}}});hy.define("popcorn.closedcaptions",["popcorn","popcorn.base"],function(Popcorn){function calculateContainerPlacement(container,languageContainer,annotationContainer){var containerRect=container.getBoundingClientRect(),languageContainerRect=languageContainer.getBoundingClientRect(),annotationContainerRect=annotationContainer.getBoundingClientRect();function calculateVerticalPosition(){if(containerRect.top-annotationContainerRect.top>languageContainerRect.height){return"bottom"}return"top"}if(containerRect.left-annotationContainerRect.left>languageContainerRect.width){return calculateVerticalPosition()+"-left"}return calculateVerticalPosition()+"-right"}var canCreateAnnotation=true;Popcorn.basePlugin("closedcaptions",function(options,base){var annotationContainer,container=document.createElement("div"),disableCaptions=document.createElement("div"),me=this,languageContainer=document.createElement("div"),languageInnerElement=document.createElement("div"),lastContainerPlacement="";function showLanguageContainer(){lastContainerPlacement=calculateContainerPlacement(container,languageContainer,annotationContainer);base.addClass(languageContainer,lastContainerPlacement)}function hideLanguageContainer(){base.addClass(languageContainer,"hide");base.removeClass(languageContainer,lastContainerPlacement)}function updateCaptionsState(disable,event){var parent=me.media.parentNode;var video;if(disable){base.addClass(languageContainer,"hide");base.removeClass(languageContainer,lastContainerPlacement)}else if(event&&event.type==="click"){showLanguageContainer()}base[disable?"removeClass":"addClass"](container,"enabled");Popcorn.forEach(me.data.trackEvents.byStart,function(trackEvent){if(trackEvent.isSubtitle){base[disable?"addClass":"removeClass"](trackEvent.container,"hide")}});if(parent&&parent.querySelector){video=parent.querySelector("video")}if(video){Array.prototype.forEach.call(video.textTracks,function(track){track.mode=disable?"disabled":"showing"})}}function onContainerClick(e){updateCaptionsState(base.hasClass(container,"enabled"),e)}function onLanguageContainerClick(e){e.stopPropagation()}function onLanguageContainerMouseOut(e){if(!languageContainer.contains(e.toElement)){hideLanguageContainer()}}function onInnerContainerMouseOver(){if(base.hasClass(container,"enabled")){showLanguageContainer()}}function onInnerContainerMouseOut(e){if([container,languageContainer].indexOf(e.toElement)<0||!languageContainer.contains(e.toElement)){hideLanguageContainer()}}if(!canCreateAnnotation){return}canCreateAnnotation=false;options.container=base.makeContainer();options.container.appendChild(container);languageContainer.appendChild(languageInnerElement);languageInnerElement.appendChild(disableCaptions);options.container.appendChild(languageContainer);annotationContainer=options.container.parentNode;base.addClass(container,"closedcaptions-container");base.addClass(languageContainer,"closedcaptions-options");base.addClass(languageContainer,"hide");container.innerHTML="CC";options.container.style.top=options.top;options.container.style.left=options.left;options.container.style.width=options.width;options.container.style.height=options.height;disableCaptions.innerHTML="Captions off";base.addClass(languageContainer,"hide");options.container.addEventListener("click",onContainerClick,false);languageContainer.addEventListener("click",onLanguageContainerClick,false);languageContainer.addEventListener("mouseout",onLanguageContainerMouseOut,false);container.addEventListener("mouseover",onInnerContainerMouseOver,false);container.addEventListener("mouseout",onInnerContainerMouseOut,false);updateCaptionsState(!(options.src&&options.captionsActiveByDefault));return{start:function(){base.addClass(container,"active")},end:function(){base.removeClass(container,"active")},_update:function(trackEvent,changes){if(changes.hasOwnProperty("popTop")&&changes.popTop!==trackEvent.popTop){trackEvent.popTop=changes.popTop}if(changes.hasOwnProperty("top")&&changes.top!==trackEvent.top){trackEvent.top=changes.top}if(changes.hasOwnProperty("left")&&changes.left!==trackEvent.left){trackEvent.left=changes.left}if(changes.hasOwnProperty("width")&&changes.width!==trackEvent.width){trackEvent.width=changes.width}if(changes.hasOwnProperty("height")&&changes.height!==trackEvent.height){trackEvent.height=changes.height}if(changes.hasOwnProperty("src")&&changes.src!==trackEvent.src){trackEvent.src=changes.src}updateCaptionsState(!base.hasClass(container,"enabled"))},_teardown:function(){canCreateAnnotation=true;options.container.removeEventListener("click",onContainerClick,false);languageContainer.removeEventListener("click",onLanguageContainerClick,false);languageContainer.removeEventListener("mouseout",onLanguageContainerMouseOut,false);container.removeEventListener("mouseover",onInnerContainerMouseOver,false);container.removeEventListener("mouseout",onInnerContainerMouseOut,false)}}})});hy.define("popcorn.profile.closedcaptions",["popcorn.closedcaptions"],function(){return function(options){var rootUrl=options.rootUrl,uploadAuth=options.uploadAuth;return{id:"closedcaptions",icon:"closed_caption",sortIndex:11,title:"closed captioning",editor:["popcorn.quickedit.closedcaptions"],zIndex:5,commit:true,maxAllowed:1,defaults:{top:"3%",left:"2%",start:0,end:Infinity,subtitles:null},filter:function(trackEvent){trackEvent.start=0;trackEvent.end=Infinity},create:function(id,annotation,editor){var commentId=annotation.get("id"),track=annotation.get("track"),video,baseUrl;if(track){video=track.get("video");baseUrl=rootUrl+"/videos/"+video.get("id")+"/tracks/"+track.get("id");editor.setting(id,"closedcaptionUrl",baseUrl+"/annotations/"+annotation.get("id"))}if(uploadAuth){editor.setting(id,"uploadUrl","/api/comments/"+commentId+"/uploads?"+uploadAuth);editor.setting(id,"srtUrl","/api/srt/")}}}}});(function(root,factory){if(typeof exports==="object"){var Popcorn=require("popcorn");require("popcorn.filter");require("popcorn.gates");module.exports=factory(Popcorn)}else if(typeof hy.define==="function"&&hy.define.amd){hy.define("popcorn.response",["popcorn","popcorn.filter","popcorn.gates","configuration"],factory)}else{factory(root.Popcorn)}})(this,function(Popcorn,popcornfilter,popcorngates,configuration,undefined){Popcorn.dataFilter(["editMode"],"response","response",function(name,options,next,node,editMode){if(!options.src){options.src=hapyak.rootUrl+"/plugins/response_annotation";next(options,"iframe")}else{next(options,"iframe")}},false)});hy.define("popcorn.profile.response",["popcorn.response","popcorn.iframe"],function(){return{id:"response",plugin:"response",sortIndex:10,title:"a response poll",icon:"poll",editor:["popcorn.quickedit.response"],zIndex:1,defaults:{left:"0%",top:"0%",width:"100%",height:"100%",_duration:10,duration:10,pause:-1}}});hy.define("popcorn.basic360",["dao","utils.embed","utils.parsecolor","popcorn","popcorn.base"],function(dao,utils,parseColor,Popcorn){function buildAnnotation(options){var img=options.inputType==="image",el=document.createElement(img?"img":"div"),opacity=options["opacity"]||0;var c;if(options.inputType!=="hotspot"){el[img?"src":"innerHTML"]=options.text}el.classList.add("basic360-"+options.inputType+"-standard");if(options.color){el.style.color=options.color}if(options["background-color"]){c=parseColor(options["background-color"]);el.style.backgroundColor="rgba("+c.r+","+c.g+","+c.b+","+opacity+")"}return el}Popcorn.basePlugin("basic360",function(options,base){var popcorn=this;var container,Css360DOMElement,Css360Sphere;base.target=base.target||options.target;if(!options.inputType){options.inputType="hotspot"}if(!options.text){options.text=""}if(!options.transform){options.transform="[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1]"}container=base.makeContainer();options.container=container;container.appendChild(buildAnnotation(options));container.style.display="none";function addAnnotationToSphere(options){var video=popcorn.video.parentNode.getElementsByTagName("VIDEO")[0],that=this;Css360Sphere=hapyak.Css360&&hapyak.Css360.getSphereByContainerId(utils.dotget(video,"dataset.videoId"));if(!that.addedToSphere){if(Css360Sphere){Css360DOMElement=Css360Sphere.add({id:options.dataId,transform:options.transform&&JSON.parse(options.transform)||[0,0,0,0,0,0,0,0,0,1,1,1],saveCallback:function(transform){popcorn.options.hapyakPlayer.annotations.update(options.annotationId,{transform:transform})}},container);that.addedToSphere=true}}if(Css360DOMElement&&typeof Css360DOMElement.show==="function"){Css360DOMElement.show()}if(utils.dotget(utils.getQueryParams(location.href),"edit")!=="true"&&options.rotateOnStart&&Css360DOMElement&&typeof Css360DOMElement.rotateToMe==="function"){Css360DOMElement.rotateToMe(true)}container.style.display="block"}return{start:function(event,options){var that=this;if(popcorn.video.readyState===4){addAnnotationToSphere.bind(this)(options);return}popcorn.on("canplay",function(){addAnnotationToSphere.bind(that)(options)})},end:function(){if(Css360DOMElement&&typeof Css360DOMElement.hide==="function"){Css360DOMElement.hide()}container.style.display="none"},_update:function(trackEvent,changes){if(changes.pause!==undefined&&options.pause!==changes.pause||changes.end!==options.end||changes.start!==options.start){options.pause=changes.pause}options.inputType=changes.inputType||"hotspot";options.text=changes.text||"";options["background-color"]=changes["background-color"]||"";options.color=changes.color||"";options.opacity=changes.opacity||"";container.innerHTML="";container.appendChild(buildAnnotation(options));if(options.transform!==changes.transform&&Css360DOMElement){options.transform=changes.transform||"[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1]";if(Css360DOMElement&&typeof Css360DOMElement.setPositionFromString==="function"){Css360DOMElement.setPositionFromString(options.transform)}}},_teardown:function(){requestAnimationFrame(function(){if(Css360DOMElement&&typeof Css360DOMElement.remove==="function"){Css360DOMElement.remove()}})}}})});hy.define("popcorn.profile.basic360",["player.normalizeonclick","popcorn.basic360"],function(normalizeonclick){return{id:"basic360",title:"Basic 360",icon:"&#x1F310",editor:["popcorn.quickedit.basic360"],sortIndex:20,zIndex:7,defaults:{text:"",inputType:"hotspot","background-color":"#000000",color:"#ffffff",opacity:"0.3",transform:"[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1]"},normalize:{"onClick.gotoLink":normalizeonclick.gotoLink,"onClick.gotoTrack":normalizeonclick.gotoTrack,"onClick.addClasses":normalizeonclick.addClasses,"onClick.setVariables":normalizeonclick.setVariables,onClick:normalizeonclick.onClick}}});hy.define("hyrtm.client",["hyrtm"],function(HYRTM){if(!HYRTM){return{}}if(HYRTM.HYRTMClient){return HYRTM.HYRTMClient}return HYRTM});hy.define("brightcove-v2.adapter",["hyrtm.client"],function(HYRTMClient){function BrightcoveV2Adapter(channel,environment){var that=this;this.supports=["id3","realtime"];this.hyrtm=new HYRTMClient(channel,{environment:environment||"production"});this.setupPlayer=function(player){that.player=player;if(!player.id3CuePointsTrack||typeof player.id3CuePointsTrack!=="function"){return}this.hyrtm.sendRemote("*","get",{},function(data){if(!data||!data.payload){return}player.src({src:data.payload.streamMetadata.playback_url,type:"application/x-mpegURL"});player.play()});that.skewModule=new this.id3};this.id3=function(){var track=that.player.id3CuePointsTrack(),filterTags=["HPYK"];function decodeArrayString(intArray){var str="",code,i=1,bufferArray=intArray;if(intArray.byteLength&&!intArray.length){bufferArray=new Uint8Array(intArray)}else{bufferArray["length"]=0}for(;i<bufferArray.length;i++){code=bufferArray[i];if(code>0&&code){str+=String.fromCharCode(bufferArray[i])}}return str}function decodeID3(cue){return{key:cue.frame?cue.frame.key:cue.value.key,value:decodeArrayString(cue.frame?cue.frame.data:cue.value.data),start:cue.startTime,end:cue.endTime}}if(track&&track.addEventListener){track.addEventListener("cuechange",function(){var cues=track.activeCues.cues_;if(!cues){cues=track.activeCues}Array.prototype.forEach.call(cues,function(cue){var decodedCue=decodeID3(cue);if(filterTags.indexOf(decodedCue.key)===-1){return}data=JSON.parse(decodedCue.value)||{};that.hyrtm.sendLocal(window.parent,"id3_event",data)})})}}}return BrightcoveV2Adapter});(function(root,factory){if(typeof exports=="object")module.exports=factory();else if(typeof hy.define==="function"&&hy.define.amd)hy.define("spin",factory);else root.Spinner=factory()})(this,function(){var prefixes=["webkit","Moz","ms","O"],animations={},useCssAnimations;function createEl(tag,prop){var el=document.createElement(tag||"div"),n;for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i++)parent.appendChild(arguments[i]);return parent}var sheet=function(){var el=createEl("style",{type:"text/css"});ins(document.getElementsByTagName("head")[0],el);return el.sheet||el.styleSheet}();function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(alpha*100),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";if(!animations[name]){sheet.insertRule("@"+pre+"keyframes "+name+"{"+"0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}"+"100%{opacity:"+z+"}"+"}",sheet.cssRules.length);animations[name]=1}return name}function vendor(el,prop){var s=el.style,pp,i;prop=prop.charAt(0).toUpperCase()+prop.slice(1);for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop;if(s[pp]!==undefined)return pp}if(s[prop]!==undefined)return prop}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)if(obj[n]===undefined)obj[n]=def[n]}return obj}function pos(el){var o={x:el.offsetLeft,y:el.offsetTop};while(el=el.offsetParent)o.x+=el.offsetLeft,o.y+=el.offsetTop;return o}function getColor(color,idx){return typeof color=="string"?color:color[idx%color.length]}var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};function Spinner(o){if(typeof this=="undefined")return new Spinner(o);this.opts=merge(o||{},Spinner.defaults,defaults)}Spinner.defaults={};merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp;if(target){target.insertBefore(el,target.firstChild||null);tp=pos(target);ep=pos(el);css(el,{left:(o.left=="auto"?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+"px",top:(o.top=="auto"?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+"px"})}el.setAttribute("role","progressbar");self.lines(el,self.opts);if(!useCssAnimations){var i=0,start=(o.lines-1)*(1-o.direction)/2,alpha,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var j=0;j<o.lines;j++){alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity);self.opacity(el,j*o.direction+start,alpha,o)}self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))})()}return self},stop:function(){var el=this.el;if(el){clearTimeout(this.timeout);if(el.parentNode)el.parentNode.removeChild(el);this.el=undefined}return this},lines:function(el,o){var i=0,start=(o.lines-1)*(1-o.direction)/2,seg;function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px"+",0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(;i<o.lines;i++){seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"});if(o.shadow)ins(seg,css(fill("#000","0 0 4px "+"#000"),{top:2+"px"}));ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")))}return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}});function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)");Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r;function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}var margin=-(o.width+o.length)*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin}),i;function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)};Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0;if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild;if(c)c.opacity=val}}}var probe=css(createEl("group"),{behavior:"url(#default#VML)"});if(!vendor(probe,"transform")&&probe.adj)initVML();else useCssAnimations=vendor(probe,"animation");return Spinner});hy.define("brightcove.cuepoints",["popcorn","utils.embed"],function(Popcorn,utils){return function(container,video,opts,wrapper,callback){var brightcove=window.brightcove,videojs=window.videojs;function loadCuePoints(){var player,brightcovePlayer,APIModules;brightcove=window.brightcove;if(!wrapper._util.player){return}player=wrapper._util.player;brightcovePlayer=wrapper._util.brightcovePlayer;APIModules=brightcove.api.modules.APIModules;player.getCurrentVideo(function(brightcoveVideo){var cuePointsModule=brightcovePlayer.getModule(APIModules.CUE_POINTS);cuePointsModule.getCuePoints(brightcoveVideo.id,function(cuePointData){var events=[];Popcorn.forEach(cuePointData,function(cuePoint){if(cuePoint.type){events.push({id:"brightcove.cuepoint/"+cuePoint.videoID+"/"+Math.round(cuePoint.time*100)/100,plugin:"bookmark",popcorn:{start:cuePoint.time,mode:"invisible",text:cuePoint.name}})}});if(events.length>0){events.push({id:Popcorn.guid("contents"),plugin:"contents",popcorn:{start:0,end:Infinity}});callback(events,["bookmark","contents"])}})})}function loadV2Cuepoints(){var cuepoints,player;var events=[];videojs=window.videojs;if(!wrapper._util.player){return}player=wrapper._util.player;cuepoints=player.mediainfo&&player.mediainfo["cue_points"];if(cuepoints){cuepoints.forEach(function(cuepoint,index){var time=cuepoint.time;if(cuepoint.type!=="AD"){events.push({id:"brightcove.cuepoint/"+cuepoint.id+"/"+Math.round(time*100)/100,plugin:"bookmark",popcorn:{start:time,mode:"invisible",text:cuepoint.name}})}});if(events.length>0){events.push({id:Popcorn.guid("contents"),plugin:"contents",popcorn:{start:0,end:Infinity}});callback(events,["bookmark","contents"])}}}if(Popcorn.HTMLBrightcoveVideoElement&&utils.dotget(wrapper,"_util.type")==="Brightcove"){if(brightcove&&wrapper.readyState){loadCuePoints()}else{wrapper.addEventListener("loadedmetadata",loadCuePoints,false)}}else if(Popcorn.HTMLVideojs4VideoElement&&utils.dotget(wrapper,"_util.type")==="videojs4"){if(videojs&&wrapper.readyState){loadV2Cuepoints()}else{wrapper.addEventListener("loadedmetadata",loadV2Cuepoints,false)}}}});